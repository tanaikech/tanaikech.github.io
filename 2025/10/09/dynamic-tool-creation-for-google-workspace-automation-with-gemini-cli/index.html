<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <meta name="google-site-verification" content="1BvDMY90ui0jRLHkrpqdQ_x62h5VNEMuK6mQsDvVQH0" />

  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.98.0" />

  <title>Dynamic Tool Creation for Google Workspace Automation with Gemini CLI &middot; tanaike</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://tanaikech.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">

  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet" type="text/css">

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css">
  <script async src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://tanaikech.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://tanaikech.github.io/">TANAIKE</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/topics/"><i class='fa fa-folder fa-fw'></i>Topics</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/link/"><i class='fa fa-thumbs-up fa-fw'></i>Links</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/webapps/"><i class='fas fa-toolbox'></i>Web Applications</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/donate/"><i class='fas fa-donate'></i>Donate</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/tanaikech" rel="me" target="_blank"><i class="fab fa-twitter-square fa-fw"></i>X</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/tanaikech" rel="me" target="_blank"><i class="fab fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/7108653" rel="me" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2017. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Dynamic Tool Creation for Google Workspace Automation with Gemini CLI</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>09 Oct 2025, 14:43</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/gastips">GasTips</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/nodetips">NodeTips</a>
    
  </div>
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/google-apps-script">Google Apps Script</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/model-context-protocol">Model Context Protocol</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/mcp">MCP</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/gemini">Gemini</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/node.js">Node.js</a>
    
  </div>
  
  

</div>

  <p><a href="https://gist.github.com/tanaikech/91321df429b3e94f6a71176bd4ecafbb">Gists</a></p>
<p><img src="https://tanaikech.github.io/image-storage/20251009a/fig1.jpg" alt=""></p>
<h2 id="abstract">Abstract</h2>
<p>This article presents a method for optimizing Google Workspace automation by dynamically converting frequently used, AI-generated Google Apps Scripts into permanent, reusable tools. By integrating the Gemini CLI with a <code>gas-fakes</code> sandbox via an MCP server, we demonstrate how to securely add and manage these custom tools, reducing operational costs and improving efficiency.</p>
<h2 id="introduction">Introduction</h2>
<p>When using generative AI to create scripts, ensuring the secure execution of the generated code is critical. This is especially true for applications that manage cloud resources like Google Workspace, where it is paramount to prevent unintended data access or modification. The standard permission model for Google Apps Script often requires broad access, creating a significant security risk when running code from untrusted sources.</p>
<p>To address this, a &ldquo;fake-sandbox&rdquo; environment was developed using the <code>gas-fakes</code> library, which allows for the safe, local execution of AI-generated Google Apps Script in Node.js. <a href="https://medium.com/google-cloud/a-fake-sandbox-for-google-apps-script-a-feasibility-study-on-securely-executing-code-generated-by-cc985ce5dae3">Ref</a> This library emulates the Apps Script environment by translating GAS calls into direct, underlying Google API requests, enabling the use of more granular, file-specific permissions to enhance security.</p>
<p>To make this sandbox accessible to AI agents, an MCP (Model Context Protocol) server was created. <a href="https://medium.com/google-cloud/secure-and-conversational-google-workspace-automation-integrating-gemini-cli-with-a-gas-fakes-mcp-0a5341559865">Ref</a> This setup allows the Gemini CLI to generate and execute Google Apps Script within the <code>gas-fakes</code> sandbox for safe and conversational Google Workspace automation.</p>
<p>Initially, generated scripts were treated as disposable. However, repeatedly generating the same script for frequent tasks is inefficient and increases costs. This article explores a solution: automatically adding frequently used, AI-generated scripts to the MCP server as permanent tools. This makes them instantly and perpetually available for secure execution, optimizing both cost and efficiency.</p>
<h2 id="repository">Repository</h2>
<p>The scripts for the MCP server used in this article are available at this GitHub repository: <a href="https://github.com/tanaikech/gas-fakes-mcp">https://github.com/tanaikech/gas-fakes-mcp</a>.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>Before you begin, ensure you have the following installed on your system:</p>
<ul>
<li><strong>Node.js and npm:</strong> Required to run the <code>gas-fakes</code> library and the MCP server.</li>
<li><strong>Gemini CLI:</strong> The AI agent used to generate and execute the Google Apps Script.</li>
</ul>
<h2 id="setup-and-configuration">Setup and Configuration</h2>
<p>Follow these steps to set up the environment.</p>
<h3 id="step-1-install-gas-fakes">Step 1: Install gas-fakes</h3>
<p>In your working directory (e.g., a new folder named <code>sample</code>), install <code>gas-fakes</code>. You can find detailed instructions at the official <a href="https://github.com/brucemcpherson/gas-fakes">gas-fakes GitHub repository by Bruce</a>. A crucial step is to correctly authorize the necessary scopes for <code>gas-fakes</code> to interact with Google services.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>npm install @mcpher/gas-fakes
</span></span></code></pre></div><h3 id="step-2-install-and-configure-the-mcp-server">Step 2: Install and Configure the MCP Server</h3>
<p>Next, install the required modules for the MCP server in the same directory.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>npm install @modelcontextprotocol/sdk zod
</span></span></code></pre></div><p>Then, from the <a href="https://github.com/tanaikech/gas-fakes-mcp">gas-fakes-mcp repository</a>, copy the following files into the root of your project directory:</p>
<ul>
<li><code>gas-fakes-mcp.js</code></li>
<li><code>gas-fakes-mcp-tools.js</code></li>
</ul>
<p>This script defines the base tools and a sample tool that the Gemini CLI will use.</p>
<h3 id="step-3-install-the-gemini-cli">Step 3: Install the Gemini CLI</h3>
<p>If you haven&rsquo;t already, install the Gemini CLI. Instructions are available at the <a href="https://github.com/google-gemini/gemini-cli">official Gemini CLI GitHub repository</a>.</p>
<h3 id="step-4-configure-the-gemini-cli">Step 4: Configure the Gemini CLI</h3>
<p>To connect the Gemini CLI to your MCP server, modify its <code>settings.json</code> file, which is located in your <code>.gemini</code> directory. Add the <code>mcpServers</code> configuration as shown below.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;security&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;auth&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;selectedType&#34;</span>: <span style="color:#e6db74">&#34;### your setting ###&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;ui&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;theme&#34;</span>: <span style="color:#e6db74">&#34;Default&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;mcpServers&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;gas-fakes&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;command&#34;</span>: <span style="color:#e6db74">&#34;node&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;args&#34;</span>: [<span style="color:#e6db74">&#34;./gas-fakes-mcp.js&#34;</span>]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="step-5-verify-your-directory-structure">Step 5: Verify Your Directory Structure</h3>
<p>After completing the setup, your project directory should have the following structure:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>/sample/
</span></span><span style="display:flex;"><span>├── .env
</span></span><span style="display:flex;"><span>├── gas-fakes-mcp.js
</span></span><span style="display:flex;"><span>├── gas-fakes-mcp-tools.js
</span></span><span style="display:flex;"><span>├── gasfakes.json
</span></span><span style="display:flex;"><span>├── package-lock.json
</span></span><span style="display:flex;"><span>├── package.json
</span></span><span style="display:flex;"><span>├── .gemini/
</span></span><span style="display:flex;"><span>│   ├── settings.json
</span></span><span style="display:flex;"><span>└── node_modules/
</span></span></code></pre></div><h2 id="demonstration">Demonstration</h2>
<p>With everything configured, launch the Gemini CLI from your project directory.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gemini
</span></span></code></pre></div><p>Here are two sample scenarios demonstrating how to dynamically create and manage tools.</p>
<h3 id="sample-1-creating-a-currency-conversion-tool">Sample 1: Creating a Currency Conversion Tool</h3>
<p>In this sample, we will generate a Google Apps Script to retrieve the current USD-to-JPY exchange rate and add it as a permanent tool to the MCP server.</p>
<p><strong>Prompt 1: Generate and Test the Script</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Follow the following mission in order.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>## 1. Create a Google Apps Script
</span></span><span style="display:flex;"><span>Create a Google Apps Script for achieving the following steps. Here, the script is not required to be run. Just show the created script.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>1. Create a new Google Spreadsheet.
</span></span><span style="display:flex;"><span>2. Put a formula `=GOOGLEFINANCE(&#34;CURRENCY:USDJPY&#34;)` in a cell &#34;A1&#34; of the 1st sheet in a Google Spreadsheet.
</span></span><span style="display:flex;"><span>3. Get the value of the cell &#34;A1&#34;.
</span></span><span style="display:flex;"><span>4. Show the value.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>## 2. Run script.
</span></span><span style="display:flex;"><span>Run the script in a sandbox.
</span></span></code></pre></div><p>The Gemini CLI will generate the script and test it in the sandbox.</p>
<p><img src="https://tanaikech.github.io/image-storage/20251009a/fig2a.jpg" alt="Figure 1: Generating and testing the currency script."></p>
<p><strong>Prompt 2: Add the Script as a New Tool</strong></p>
<p>Now that the script is confirmed to work, add it to the MCP server as a new tool.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Add the generated Google Apps Script as a tool of the MCP server by removing &#34;console.log&#34; by following the tool &#34;explanation_add_gas_to_mcp&#34;.
</span></span></code></pre></div><p><img src="https://tanaikech.github.io/image-storage/20251009a/fig2b.jpg" alt="Figure 2: Adding the script as a new tool."></p>
<p>This action adds the following code block to the MCP server script:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Name of this tool
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;create_and_read_spreadsheet&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * JSON schema for giving arguments
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">schema</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Creates a Google Spreadsheet, adds a GOOGLEFINANCE formula, and reads the cell value.&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">inputSchema</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">         * This object is used for using a sandbox of gas-fakes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">         */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gas_fakes_args</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">z</span>
</span></span><span style="display:flex;"><span>          .<span style="color:#a6e22e">object</span>({
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">whitelistItems</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">z</span>
</span></span><span style="display:flex;"><span>              .<span style="color:#a6e22e">array</span>(<span style="color:#a6e22e">z</span>.<span style="color:#a6e22e">string</span>().<span style="color:#a6e22e">describe</span>(<span style="color:#e6db74">`File ID of file on Google Drive`</span>))
</span></span><span style="display:flex;"><span>              .<span style="color:#a6e22e">describe</span>(
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">`Use this to access the existing files on Google Drive. Provide the file IDs of the files on Google Drive as an array. When this is used, the property &#34;sandbox&#34; is required to be true. The default is no items in an array.`</span>
</span></span><span style="display:flex;"><span>              )
</span></span><span style="display:flex;"><span>              .<span style="color:#a6e22e">optional</span>(),
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">sandbox</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">z</span>
</span></span><span style="display:flex;"><span>              .<span style="color:#66d9ef">boolean</span>()
</span></span><span style="display:flex;"><span>              .<span style="color:#a6e22e">describe</span>(
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">`The default is true. When this is true, the script is run with the sandbox. When this is false, the script is run without the sandbox.`</span>
</span></span><span style="display:flex;"><span>              ),
</span></span><span style="display:flex;"><span>          })
</span></span><span style="display:flex;"><span>          .<span style="color:#a6e22e">describe</span>(),
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Function for processing a task of this tool
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Please include &#34;__sandbox.head&#34; and &#34;__sandbox.foot&#34;.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">func</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">object</span> <span style="color:#f92672">=</span> {}) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * This is required to be included for using gas-fakes.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       */</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">await</span> <span style="color:#66d9ef">import</span>(<span style="color:#e6db74">&#34;@mcpher/gas-fakes/main.js&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * Header for sandbox of gas-fakes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * This is required to be set.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       */</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">behavior</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">__sandbox</span>.<span style="color:#a6e22e">head</span>(<span style="color:#a6e22e">object</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * Google Apps Script
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * Directly put the generated Google Apps Script here as follows.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       */</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">spreadsheet</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">SpreadsheetApp</span>.<span style="color:#a6e22e">create</span>(<span style="color:#e6db74">&#34;Currency Data&#34;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sheet</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">spreadsheet</span>.<span style="color:#a6e22e">getSheets</span>()[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">sheet</span>.<span style="color:#a6e22e">getRange</span>(<span style="color:#e6db74">&#34;A1&#34;</span>).<span style="color:#a6e22e">setFormula</span>(<span style="color:#e6db74">&#39;=GOOGLEFINANCE(&#34;CURRENCY:USDJPY&#34;)&#39;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">SpreadsheetApp</span>.<span style="color:#a6e22e">flush</span>();
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sheet</span>.<span style="color:#a6e22e">getRange</span>(<span style="color:#e6db74">&#34;A1&#34;</span>).<span style="color:#a6e22e">getValue</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * Footer for sandbox of gas-fakes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * This is required to be set.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       */</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">__sandbox</span>.<span style="color:#a6e22e">foot</span>({ ...<span style="color:#a6e22e">object</span>, <span style="color:#a6e22e">behavior</span> });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       * The value of a property &#34;content[0].text&#34; is required to be a string value.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       */</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> { <span style="color:#a6e22e">content</span><span style="color:#f92672">:</span> [{ <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;text&#34;</span>, <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> String(<span style="color:#a6e22e">value</span>) }] };
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  },
</span></span></code></pre></div><p>The main script of this tool is Google Apps Script. So, you can also simply update.</p>
<p><strong>Prompt 3: Refresh and Verify the Tool List</strong></p>
<p>Confirm that the tool was added successfully.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>/mcp
</span></span><span style="display:flex;"><span>/mcp refresh
</span></span></code></pre></div><p><img src="https://tanaikech.github.io/image-storage/20251009a/fig2c.jpg" alt="Figure 3: Refreshing the MCP server tool list."></p>
<p><strong>Prompt 4: Test the New Tool</strong></p>
<p>You can now use the newly created tool with a simple, natural language prompt.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Get the current USD to JPY exchange rate.
</span></span></code></pre></div><p><img src="https://tanaikech.github.io/image-storage/20251009a/fig2d.jpg" alt="Figure 4: Executing the new custom tool."></p>
<p><strong>Prompt 5: Remove the Tool</strong></p>
<p>You can also remove tools when they are no longer needed.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Remove a tool &#34;create_and_read_spreadsheet&#34;.
</span></span></code></pre></div><p><img src="https://tanaikech.github.io/image-storage/20251009a/fig2e.jpg" alt="Figure 5: Removing a tool from the MCP server."></p>
<h3 id="sample-2-creating-a-tool-to-read-from-a-specific-spreadsheet">Sample 2: Creating a Tool to Read from a Specific Spreadsheet</h3>
<p>This sample demonstrates creating a tool to retrieve data from an existing Google Sheet.</p>
<p><strong>Prompt 1: Get the Spreadsheet ID</strong></p>
<p>First, retrieve the ID of the target spreadsheet.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Follow the following mission in order.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>## 1. Create a Google Apps Script (A)
</span></span><span style="display:flex;"><span>Create a Google Apps Script for achieving the following steps. Here, the script is not required to be run. Just show the created script.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>1. Get a Spreadsheet ID of a Google Spreadsheet from the filename of &#34;sample for gas-fakes&#34;.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>## 2. Run script.
</span></span><span style="display:flex;"><span>Run the script (A) with a sandbox.
</span></span></code></pre></div><p><img src="https://tanaikech.github.io/image-storage/20251009a/fig3a.jpg" alt="Figure 6: Retrieving the Spreadsheet ID."></p>
<p><strong>Prompt 2: Read Data from the Spreadsheet</strong></p>
<p>Next, generate a script to retrieve values from the sheet using the obtained ID.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Follow the following mission in order.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>## 1. Create a Google Apps Script (B)
</span></span><span style="display:flex;"><span>Create a Google Apps Script for achieving the following steps. Here, the script is not required to be run. Just show the created script.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>1. Retrieve values from the &#34;Sheet1&#34; sheet in the Google Spreadsheet using the Spreadsheet ID obtained by Google Apps Script (A).
</span></span><span style="display:flex;"><span>2. Show the retrieved values.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>## 2. Run script.
</span></span><span style="display:flex;"><span>Run the script (B) with a sandbox including the retrieved Spreadsheet ID in the whitelist.
</span></span></code></pre></div><p><img src="https://tanaikech.github.io/image-storage/20251009a/fig3b.jpg" alt="Figure 7: Reading data from the specified sheet."></p>
<p><strong>Prompt 3: Add the Script as a New Tool</strong></p>
<p>Add the script for reading the sheet as a new tool on the MCP server.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Add Google Apps Script (B) as a tool of the MCP server by following the &#34;explanation_add_gas_to_mcp&#34;. At that time, include that the Spreadsheet title of the retrieved Spreadsheet ID is &#34;sample for gas-fakes&#34; in the description of the tool. Remove &#34;console.log&#34;.
</span></span></code></pre></div><p><img src="https://tanaikech.github.io/image-storage/20251009a/fig3c.jpg" alt="Figure 8: Adding the spreadsheet-reading script as a new tool."></p>
<p>The following tool definition, with the Spreadsheet ID hardcoded as a default value, is added to the MCP server script:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;read_spreadsheet_sheet1&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">schema</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Retrieve values from the &#39;Sheet1&#39; sheet in the Google Spreadsheet with the Spreadsheet ID &#39;1-IemO5f______________________Q3_3zU5i3kBh_s&#39;. The Spreadsheet title is &#39;sample for gas-fakes&#39;.&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">inputSchema</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gas_fakes_args</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">z</span>
</span></span><span style="display:flex;"><span>          .<span style="color:#a6e22e">object</span>({
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">whitelistItems</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">z</span>
</span></span><span style="display:flex;"><span>              .<span style="color:#a6e22e">array</span>(<span style="color:#a6e22e">z</span>.<span style="color:#a6e22e">string</span>().<span style="color:#a6e22e">describe</span>(<span style="color:#e6db74">`File ID of file on Google Drive`</span>))
</span></span><span style="display:flex;"><span>              .<span style="color:#a6e22e">describe</span>(
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">`Use this to access the existing files on Google Drive. Provide the file IDs of the files on Google Drive as an array. When this is used, the property \&#34;sandbox\&#34; is required to be true. The default is no items in an array.`</span>
</span></span><span style="display:flex;"><span>              )
</span></span><span style="display:flex;"><span>              .<span style="color:#66d9ef">default</span>([<span style="color:#e6db74">&#34;1-IemO5f______________________Q3_3zU5i3kBh_s&#34;</span>]),
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">sandbox</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">z</span>
</span></span><span style="display:flex;"><span>              .<span style="color:#66d9ef">boolean</span>()
</span></span><span style="display:flex;"><span>              .<span style="color:#a6e22e">describe</span>(
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">`The default is true. When this is true, the script is run with the sandbox. When this is false, the script is run without the sandbox.`</span>
</span></span><span style="display:flex;"><span>              )
</span></span><span style="display:flex;"><span>              .<span style="color:#66d9ef">default</span>(<span style="color:#66d9ef">true</span>),
</span></span><span style="display:flex;"><span>          })
</span></span><span style="display:flex;"><span>          .<span style="color:#a6e22e">describe</span>(),
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">func</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">object</span> <span style="color:#f92672">=</span> {}) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">await</span> <span style="color:#66d9ef">import</span>(<span style="color:#e6db74">&#34;@mcpher/gas-fakes/main.js&#34;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">behavior</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">__sandbox</span>.<span style="color:#a6e22e">head</span>(<span style="color:#a6e22e">object</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">spreadsheetId</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;1-IemO5f______________________Q3_3zU5i3kBh_s&#34;</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sheetName</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Sheet1&#34;</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">spreadsheet</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">SpreadsheetApp</span>.<span style="color:#a6e22e">openById</span>(<span style="color:#a6e22e">spreadsheetId</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sheet</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">spreadsheet</span>.<span style="color:#a6e22e">getSheetByName</span>(<span style="color:#a6e22e">sheetName</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">values</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">sheet</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">values</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sheet</span>.<span style="color:#a6e22e">getDataRange</span>().<span style="color:#a6e22e">getValues</span>();
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">__sandbox</span>.<span style="color:#a6e22e">foot</span>({ ...<span style="color:#a6e22e">object</span>, <span style="color:#a6e22e">behavior</span> });
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> { <span style="color:#a6e22e">content</span><span style="color:#f92672">:</span> [{ <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;text&#34;</span>, <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">values</span>) }] };
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  },
</span></span></code></pre></div><p><strong>Prompt 4: Refresh and Verify the Tool List</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>/mcp
</span></span><span style="display:flex;"><span>/mcp refresh
</span></span></code></pre></div><p><img src="https://tanaikech.github.io/image-storage/20251009a/fig3d.jpg" alt="Figure 9: Refreshing the MCP server tool list to confirm the new tool."></p>
<p><strong>Prompt 5: Test the New Tool</strong></p>
<p>Finally, test the new tool with a simple prompt.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Show the values from the &#34;Sheet1&#34; sheet in the Google Spreadsheet of &#34;sample for gas-fakes&#34;.
</span></span></code></pre></div><p><img src="https://tanaikech.github.io/image-storage/20251009a/fig3e.jpg" alt="Figure 10: Executing the new tool to read spreadsheet values."></p>
<p>The values are retrieved correctly, demonstrating that adding frequently used scripts as permanent tools is a powerful and cost-effective method for automating Google Workspace tasks.</p>
<h2 id="important">Important</h2>
<p>During testing, it was noted that a tool might not be added correctly on the first attempt. If this occurs, running the command again should resolve the issue and allow the tool to be added successfully.</p>
<h2 id="summary">Summary</h2>
<ul>
<li><strong>Secure Execution:</strong> The <code>gas-fakes</code> library provides a secure sandbox to run AI-generated Google Apps Script with granular permissions, mitigating the risks of broad-access scopes.</li>
<li><strong>AI Integration:</strong> An MCP server makes this sandbox environment accessible to AI agents like the Gemini CLI, enabling conversational automation of Google Workspace.</li>
<li><strong>Cost and Efficiency:</strong> Repeatedly generating the same script for common tasks is inefficient and costly. This method addresses that by creating permanent, reusable tools.</li>
<li><strong>Dynamic Tool Creation:</strong> Users can dynamically add, test, use, and remove AI-generated scripts as tools directly from the Gemini CLI, creating a flexible automation workflow.</li>
<li><strong>Practical Automation:</strong> This approach makes it practical to build a robust library of custom tools for Google Workspace, streamlining repetitive tasks and enhancing productivity.</li>
</ul>
<h2 id="additional-information">Additional information</h2>
<p>While this article focuses on adding tools built with Google Apps Script via gas-fakes to safely manage Google Workspace, the method is not limited to this use case. Tools built directly with Node.js can also be added by adhering to the <code>tools_obj</code> structure in the <code>gas-fakes-mcp-tools.js</code> script.</p>
<p>The demonstration in this article uses a single MCP server with two base tools and one sample tool. In practice, the Gemini CLI can be configured to work with numerous tools across multiple MCP servers. (As a sample, it&rsquo;s <a href="https://github.com/tanaikech/ToolsForMCPServer">ToolsForMCPServer</a>) The dynamic tool creation process described here is especially useful in such complex setups, particularly when a task cannot be completed with the existing tools.</p>

  
  <h4><i class="fas fa-share-alt" aria-hidden="true"></i>&nbsp;Share!</h4>
<ul class="share-buttons">
	<li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftanaikech.github.io%2f2025%2f10%2f09%2fdynamic-tool-creation-for-google-workspace-automation-with-gemini-cli%2f" target="_blank" title="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span class="sr-only">Share on Facebook</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://twitter.com/intent/tweet?source=https%3a%2f%2ftanaikech.github.io%2f2025%2f10%2f09%2fdynamic-tool-creation-for-google-workspace-automation-with-gemini-cli%2f" target="_blank" title="Tweet"><i class="fab fa-twitter" aria-hidden="true"></i><span class="sr-only">Tweet</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://plus.google.com/share?url=https%3a%2f%2ftanaikech.github.io%2f2025%2f10%2f09%2fdynamic-tool-creation-for-google-workspace-automation-with-gemini-cli%2f" target="_blank" title="Share on Google+"><i class="fab fa-google-plus" aria-hidden="true"></i><span class="sr-only">Share on Google+</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.tumblr.com/share?v=3&u=https%3a%2f%2ftanaikech.github.io%2f2025%2f10%2f09%2fdynamic-tool-creation-for-google-workspace-automation-with-gemini-cli%2f" target="_blank" title="Post to Tumblr"><i class="fab fa-tumblr" aria-hidden="true"></i><span class="sr-only">Post to Tumblr</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2ftanaikech.github.io%2f2025%2f10%2f09%2fdynamic-tool-creation-for-google-workspace-automation-with-gemini-cli%2f" target="_blank" title="Pin it"><i class="fab fa-pinterest-p" aria-hidden="true"></i><span class="sr-only">Pin it</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.reddit.com/submit?url=https%3a%2f%2ftanaikech.github.io%2f2025%2f10%2f09%2fdynamic-tool-creation-for-google-workspace-automation-with-gemini-cli%2f" target="_blank" title="Submit to Reddit"><i class="fab fa-reddit-alien" aria-hidden="true"></i><span class="sr-only">Submit to Reddit</span></a>
	</li>
</ul>


<style>
	ul.share-buttons{
	  list-style: none;
	  padding: 0;
	}

	ul.share-buttons li{
	  display: inline;
	}

	ul.share-buttons .sr-only{
	  position: absolute;
	  clip: rect(1px 1px 1px 1px);
	  clip: rect(1px, 1px, 1px, 1px);
	  padding: 0;
	  border: 0;
	  height: 1px;
	  width: 1px;
	  overflow: hidden;
	}
</style>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://tanaikech.github.io/2025/10/02/a-collaborative-dialogue-between-gemini-cli-and-copilot-cli-through-mcp/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://tanaikech.github.io/2025/10/02/a-collaborative-dialogue-between-gemini-cli-and-copilot-cli-through-mcp/">A Collaborative Dialogue Between Gemini CLI and Copilot CLI Through MCP</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://tanaikech.github.io/2025/10/12/recipient-of-the-outstanding-google-developer-expert-award/">Recipient of the Outstanding Google Developer Expert Award</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://tanaikech.github.io/2025/10/12/recipient-of-the-outstanding-google-developer-expert-award/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>


  
  
  
  

  

</div>

</div>
</div>
<script src="https://tanaikech.github.io/js/ui.js"></script>
<script src="https://tanaikech.github.io/js/menus.js"></script>






<script async src="https://www.googletagmanager.com/gtag/js?id=G-J3Z6T50WL5"></script>
<script>
  
  if (window.location.hostname != "localhost") {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-J3Z6T50WL5');
  }
</script>






<script src="https://tanaikech.github.io/js/math-code.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  


</body>
</html>

