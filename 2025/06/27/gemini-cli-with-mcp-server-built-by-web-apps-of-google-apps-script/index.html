<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <meta name="google-site-verification" content="1BvDMY90ui0jRLHkrpqdQ_x62h5VNEMuK6mQsDvVQH0" />

  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.98.0" />

  <title>Gemini CLI with MCP Server Built by Web Apps of Google Apps Script &middot; tanaike</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://tanaikech.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">

  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet" type="text/css">

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css">
  <script async src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://tanaikech.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://tanaikech.github.io/">TANAIKE</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/topics/"><i class='fa fa-folder fa-fw'></i>Topics</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/link/"><i class='fa fa-thumbs-up fa-fw'></i>Links</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/webapps/"><i class='fas fa-toolbox'></i>Web Applications</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/donate/"><i class='fas fa-donate'></i>Donate</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/tanaikech" rel="me" target="_blank"><i class="fab fa-twitter-square fa-fw"></i>X</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/tanaikech" rel="me" target="_blank"><i class="fab fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/7108653" rel="me" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2017. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Gemini CLI with MCP Server Built by Web Apps of Google Apps Script</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>27 Jun 2025, 16:12</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/gastips">GasTips</a>
    
  </div>
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/google-apps-script">Google Apps Script</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/gemini">Gemini</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/gemini-cli">gemini-cli</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/model-context-protocol">Model Context Protocol</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/mcp">MCP</a>
    
  </div>
  
  

</div>

  <p><a href="https://gist.github.com/tanaikech/4052c4dd938c845618746be420c5cc9c">Gists</a></p>
<h1 id="abstract">Abstract</h1>
<p>The Gemini CLI can be integrated with Google Workspace via Google Apps Script to securely access personal data, enabling powerful automations like email summaries and calendar management.</p>
<h1 id="introduction">Introduction</h1>
<p>The recently released Gemini CLI is a powerful command-line interface for interacting with Google&rsquo;s Gemini models and cloud resources. <a href="https://cloud.google.com/blog/ja/topics/developers-practitioners/introducing-gemini-cli">Ref</a> While powerful on its own, its utility can be significantly enhanced by connecting it to a user&rsquo;s personal Google resources, such as Google Sheets, Docs, Slides, Gmail, and Calendar.</p>
<p>Google Apps Script emerges as the ideal solution for this integration. It natively handles the complex OAuth2 authorization process, allowing for secure and seamless access to a user&rsquo;s Google Workspace data. This is achieved by deploying an Apps Script project as a Web App, which effectively creates a secure API endpoint. To standardize this communication, a recent report details how to build a Model Context Protocol (MCP) server using this Web App approach. <a href="https://medium.com/google-cloud/gmail-processing-using-mcp-network-powered-by-google-apps-script-5ede2a25c94e">Ref</a> This method is particularly advantageous as it is cost-effective and leverages the familiar Google ecosystem, requiring no separate cloud infrastructure.</p>
<p>By integrating this MCP server with the Gemini CLI, the tool is transformed. It gains the ability to ground its responses and actions in the user&rsquo;s specific context, allowing for powerful automations like summarizing recent emails, creating documents from prompts, or managing calendar events directly from the command line. This report provides a step-by-step guide on how to implement this integration, unlocking the full potential of the Gemini CLI by securely connecting it to your Google Workspace environment.</p>
<h1 id="usage">Usage</h1>
<p>In this usage, first, the MCP server is deployed and tested with the Gemini CLI.</p>
<h2 id="preparing-mcp-server">Preparing MCP server</h2>
<h3 id="1-create-a-google-apps-script-project">1. Create a Google Apps Script Project</h3>
<p>First, create a new standalone Google Apps Script project. A standalone project is not bound to a specific Google Sheet, Doc, or Form, making it ideal for creating a general-purpose web service. You can create one by visiting <a href="https://script.google.com/home/projects/create">script.google.com</a>. <a href="https://developers.google.com/apps-script/guides/projects#create-standalone">Ref</a></p>
<h3 id="2-install-a-library">2. Install a library</h3>
<h4 id="repository">Repository</h4>
<p><a href="https://github.com/tanaikech/MCPApp">https://github.com/tanaikech/MCPApp</a></p>
<h4 id="librarys-project-key">Library&rsquo;s project key</h4>
<pre tabindex="0"><code>1TlX_L9COAriBlAYvrMLiRFQ5WVf1n0jChB6zHamq2TNwuSbVlI5sBUzh
</code></pre><p>To simplify building the MCP server, we will use a pre-built Google Apps Script library. This encapsulates the complex MCP handling logic, keeping your main script clean and focused on defining the custom tools.</p>
<ol>
<li>Open the script editor of the project you just created.</li>
<li><a href="https://developers.google.com/apps-script/guides/libraries">Install this library</a>: The library&rsquo;s project key is <strong><code>1TlX_L9COAriBlAYvrMLiRFQ5WVf1n0jChB6zHamq2TNwuSbVlI5sBUzh</code></strong>. Use <code>MCPApp</code> as the identifier.</li>
</ol>
<h3 id="3-script">3. Script</h3>
<p>Please copy and paste the following script to the script editor and save the script. This script defines two custom tools: <code>get_exchange_rate</code> and <code>get_current_weather</code>, which the Gemini CLI will be able to invoke.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getObjects_</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">functions</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// This &#39;params_&#39; object defines the schema for the available tools, following the Gemini tool-calling specification.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">params_</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">get_exchange_rate</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;Use this to get the current exchange rate. Using this, for example, it can exchange yen for dollars.&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">parameters</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">properties</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">currency_from</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Source currency (major currency). Default is USD.&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">currency_to</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;Destination currency (major currency). Default is EUR.&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">currency_date</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;Date of the currency. Default is latest. It should be ISO format (YYYY-MM-DD).&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">required</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;currency_from&#34;</span>, <span style="color:#e6db74">&#34;currency_to&#34;</span>, <span style="color:#e6db74">&#34;currency_date&#34;</span>],
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">get_current_weather</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;Use this to get the weather using the latitude and the longitude.&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;At that time, convert the location to the latitude and the longitude and provide them to the function.&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">`The date is required to be included. The date format is &#34;yyyy-MM-dd HH:mm&#34;`</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">`If you cannot know the location, decide the location using the timezone.`</span>,
</span></span><span style="display:flex;"><span>        ].<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;\n&#34;</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">parameters</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">properties</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">latitude</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;number&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;The latitude of the inputed location.&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">longitude</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;number&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;The longitude of the inputed location.&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">date</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`Date for searching the weather. The date format is &#34;yyyy-MM-dd HH:mm&#34;`</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">timezone</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`The timezone. In the case of Japan, &#34;Asia/Tokyo&#34; is used.`</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">required</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;latitude&#34;</span>, <span style="color:#e6db74">&#34;longitude&#34;</span>, <span style="color:#e6db74">&#34;date&#34;</span>, <span style="color:#e6db74">&#34;timezone&#34;</span>],
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * This function implements the get_exchange_rate tool.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Ref: https://github.com/google/A2A/blob/main/samples/python/agents/langgraph/agent.py#L19
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">get_exchange_rate</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">object</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;Run the function get_exchange_rate.&#34;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">object</span>); <span style="color:#75715e">// Check arguments.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">currency_from</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;USD&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">currency_to</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;EUR&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">currency_date</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;latest&#34;</span>,
</span></span><span style="display:flex;"><span>      } <span style="color:#f92672">=</span> <span style="color:#a6e22e">object</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">res</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">resStr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">`https://api.frankfurter.app/</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">currency_date</span><span style="color:#e6db74">}</span><span style="color:#e6db74">?from=</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">currency_from</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&amp;to=</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">currency_to</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>
</span></span><span style="display:flex;"><span>        ).<span style="color:#a6e22e">getContentText</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">resStr</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">`The raw data from the API is </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">resStr</span><span style="color:#e6db74">}</span><span style="color:#e6db74">. The detailed result is as follows.`</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">`The currency rate at </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">currency_date</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> from &#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">currency_from</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34; to &#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">currency_to</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34; is </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">rates</span>[<span style="color:#a6e22e">currency_to</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">.`</span>,
</span></span><span style="display:flex;"><span>        ].<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;\n&#34;</span>);
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">catch</span> ({ <span style="color:#a6e22e">stack</span> }) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">stack</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>); <span style="color:#75715e">// Check response.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">jsonrpc</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;2.0&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">result</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">content</span><span style="color:#f92672">:</span> [{ <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;text&#34;</span>, <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">res</span> }], <span style="color:#a6e22e">isError</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span> },
</span></span><span style="display:flex;"><span>      };
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * This function implements the get_current_weather tool.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * The API is from https://open-meteo.com/
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * { latitude = &#34;35.681236&#34;, longitude = &#34;139.767125&#34;, date = &#34;2025-05-27 12:00&#34;, timezone = &#34;Asia/Tokyo&#34; } is Tokyo station.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">get_current_weather</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">object</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;Run the function get_current_weather.&#34;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">object</span>); <span style="color:#75715e">// Check arguments.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">latitude</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;35.681236&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">longitude</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;139.767125&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">date</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;2025-05-27 12:00&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">timezone</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Asia/Tokyo&#34;</span>,
</span></span><span style="display:flex;"><span>      } <span style="color:#f92672">=</span> <span style="color:#a6e22e">object</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">res</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Ref: https://open-meteo.com/en/docs?hourly=weather_code&amp;current=weather_code#weather_variable_documentation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">code</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">0</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Clear sky&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Mainly clear, partly cloudy, and overcast&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Mainly clear, partly cloudy, and overcast&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">3</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Mainly clear, partly cloudy, and overcast&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">45</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Fog and depositing rime fog&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">48</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Fog and depositing rime fog&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">51</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Drizzle: Light, moderate, and dense intensity&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">53</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Drizzle: Light, moderate, and dense intensity&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">55</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Drizzle: Light, moderate, and dense intensity&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">56</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Freezing Drizzle: Light and dense intensity&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">57</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Freezing Drizzle: Light and dense intensity&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">61</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Rain: Slight, moderate and heavy intensity&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">63</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Rain: Slight, moderate and heavy intensity&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">65</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Rain: Slight, moderate and heavy intensity&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">66</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Freezing Rain: Light and heavy intensity&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">67</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Freezing Rain: Light and heavy intensity&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">71</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Snow fall: Slight, moderate, and heavy intensity&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">73</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Snow fall: Slight, moderate, and heavy intensity&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">75</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Snow fall: Slight, moderate, and heavy intensity&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">77</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Snow grains&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">80</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Rain showers: Slight, moderate, and violent&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">81</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Rain showers: Slight, moderate, and violent&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">82</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Rain showers: Slight, moderate, and violent&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">85</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Snow showers slight and heavy&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">86</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Snow showers slight and heavy&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">95</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Thunderstorm: Slight or moderate&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">96</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Thunderstorm with slight and heavy hail&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">99</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Thunderstorm with slight and heavy hail&#34;</span>,
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">endpoint</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`https://api.open-meteo.com/v1/forecast?latitude=</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">latitude</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&amp;longitude=</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">longitude</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&amp;hourly=weather_code&amp;timezone=</span><span style="color:#e6db74">${</span>encodeURIComponent(
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">timezone</span>
</span></span><span style="display:flex;"><span>        )<span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">resObj</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">endpoint</span>, {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">muteHttpExceptions</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">resObj</span>.<span style="color:#a6e22e">getResponseCode</span>() <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">resObj</span>.<span style="color:#a6e22e">getContentText</span>());
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">hourly</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">time</span>, <span style="color:#a6e22e">weather_code</span> },
</span></span><span style="display:flex;"><span>          } <span style="color:#f92672">=</span> <span style="color:#a6e22e">obj</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">widx</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">indexOf</span>(<span style="color:#a6e22e">date</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">&#34; &#34;</span>, <span style="color:#e6db74">&#34;T&#34;</span>).<span style="color:#a6e22e">trim</span>());
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">widx</span> <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">code</span>[<span style="color:#a6e22e">weather_code</span>[<span style="color:#a6e22e">widx</span>]];
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;No value was returned. Please try again.&#34;</span>;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;No value was returned. Please try again.&#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">catch</span> ({ <span style="color:#a6e22e">stack</span> }) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">stack</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>); <span style="color:#75715e">// Check response.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">jsonrpc</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;2.0&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">result</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">content</span><span style="color:#f92672">:</span> [{ <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;text&#34;</span>, <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">res</span> }], <span style="color:#a6e22e">isError</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span> },
</span></span><span style="display:flex;"><span>      };
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// The following structure is required by the MCPApp library to define the server&#39;s capabilities and available tools.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">itemsForMCP</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;initialize&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">protocolVersion</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;2024-11-05&#34;</span>, <span style="color:#75715e">// or &#34;2025-03-26&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">capabilities</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">tools</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">listChanged</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span> } },
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">serverInfo</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;gas_web_apps&#34;</span>, <span style="color:#a6e22e">version</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;1.0.0&#34;</span> },
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    ...Object.<span style="color:#a6e22e">keys</span>(<span style="color:#a6e22e">functions</span>.<span style="color:#a6e22e">params_</span>).<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">f</span>) =&gt; ({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;tools/list&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">function</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">functions</span>[<span style="color:#a6e22e">f</span>],
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">f</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">functions</span>.<span style="color:#a6e22e">params_</span>[<span style="color:#a6e22e">f</span>].<span style="color:#a6e22e">description</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">inputSchema</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">functions</span>.<span style="color:#a6e22e">params_</span>[<span style="color:#a6e22e">f</span>].<span style="color:#a6e22e">parameters</span>,
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    })),
</span></span><span style="display:flex;"><span>  ];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">itemsForMCP</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * This is the main entry point for the Web App. It&#39;s automatically run when the Gemini CLI makes a POST request.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">doPost</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">e</span>) =&gt; <span style="color:#a6e22e">main</span>(<span style="color:#a6e22e">e</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">main</span>(<span style="color:#a6e22e">eventObject</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">object</span> <span style="color:#f92672">=</span> { <span style="color:#a6e22e">eventObject</span>, <span style="color:#a6e22e">items</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">getObjects_</span>() };
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// The &#39;accessKey&#39; provides a simple layer of security. Ensure this key matches the one in your Gemini CLI configuration.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">MCPApp</span>.<span style="color:#a6e22e">mcpApp</span>({ <span style="color:#a6e22e">accessKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;sample&#34;</span> })
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">setServices</span>({ <span style="color:#a6e22e">lock</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">LockService</span>.<span style="color:#a6e22e">getScriptLock</span>() })
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">server</span>(<span style="color:#a6e22e">object</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="4-deploy-web-apps">4. Deploy Web Apps</h3>
<p>To allow the Gemini CLI to communicate with our script, we must deploy it as a Web App. This creates a unique URL that acts as our MCP server endpoint.</p>
<p>You can find detailed information in <a href="https://developers.google.com/apps-script/guides/web#deploy_a_script_as_a_web_app">the official documentation</a>.</p>
<p>Please follow these steps to deploy the Web App in the script editor:</p>
<ol>
<li>In the script editor, at the top right, click <strong>Deploy</strong> -&gt; <strong>New deployment</strong>.</li>
<li>Click <strong>Select type</strong> -&gt; <strong>Web App</strong>.</li>
<li>Enter a description for the Web App in the fields under <strong>Deployment configuration</strong>.</li>
<li>Select <strong>&ldquo;Me&rdquo;</strong> for <strong>&ldquo;Execute as&rdquo;</strong>. This is crucial, as it allows the script to run with your permissions to access your Google services.</li>
<li>Select <strong>&ldquo;Anyone&rdquo;</strong> for <strong>&ldquo;Who has access to the app:&rdquo;</strong>. This makes the URL callable from the internet. Access is still controlled by the unguessable URL and the <code>accessKey</code> defined in the script.</li>
<li>Click <strong>Deploy</strong>.</li>
<li>After authorizing the necessary scopes, copy the <strong>Web app URL</strong>. It will be similar to <code>https://script.google.com/macros/s/###/exec</code>. This is your MCP server endpoint.</li>
</ol>
<p><strong>Note:</strong> When you modify the Apps Script code, you must create a new deployment to publish the changes. Click <strong>Deploy</strong> &gt; <strong>Manage deployments</strong>, select your active deployment, click the pencil icon, and choose <strong>&ldquo;New version&rdquo;</strong> from the Version dropdown. <a href="https://github.com/tanaikech/taking-advantage-of-Web-Apps-with-google-apps-script?tab=readme-ov-file#redeploy">More info here</a>.</p>
<h2 id="preparing-gemini-cli">Preparing Gemini CLI</h2>
<h3 id="1-install-gemini-cli">1. Install Gemini CLI</h3>
<p>Follow the official documentation to install the Gemini CLI on your system. <a href="https://github.com/google-gemini/gemini-cli">Ref</a></p>
<h3 id="2-modify-settingsjson">2. Modify <code>settings.json</code></h3>
<p>To connect Gemini CLI to your new Apps Script server, you need to edit its settings file. This file is typically located at <code>~/.gemini/settings.json</code> on macOS/Linux or <code>%USERPROFILE%\.gemini\settings.json</code> on Windows.</p>
<p>Add the <code>mcpServers</code> configuration block as shown below. Replace <code>https://script.google.com/macros/s/###/exec</code> with the Web App URL you copied earlier.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;theme&#34;</span>: <span style="color:#e6db74">&#34;Default&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;selectedAuthType&#34;</span>: <span style="color:#e6db74">&#34;###&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;mcpServers&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;gas_web_apps&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;command&#34;</span>: <span style="color:#e6db74">&#34;npx&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;args&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;mcp-remote&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;https://script.google.com/macros/s/###/exec?accessKey=sample&#34;</span>
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;env&#34;</span>: {}
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li><code>&quot;gas_web_apps&quot;</code>: A local name for your server.</li>
<li><code>&quot;command&quot;</code> and <code>&quot;args&quot;</code>: These tell the Gemini CLI how to invoke the MCP remote tool, which then communicates with your Web App URL.</li>
<li><code>accessKey=sample</code>: This query parameter must exactly match the <code>accessKey</code> you set in your Google Apps Script <code>main</code> function.</li>
</ul>
<h2 id="testing">Testing</h2>
<p>When both the MCP server and Gemini CLI are correctly prepared, you can test the integration. When you issue a prompt, the Gemini CLI will intelligently call your Web App to use the custom tools when needed to fulfill the request.</p>
<p><img src="https://tanaikech.github.io/image-storage/20250627a/fig1.gif" alt=""></p>
<p>This demonstration runs as follows:</p>
<ol>
<li>Run Gemini CLI in interactive mode: <code>gemini</code></li>
<li>Confirm the available MCP server is recognized: <code>/mcp list</code></li>
<li>Run a prompt that requires the currency tool: <code>How much is 10,000 yen in USD?</code>
<ul>
<li>Behind the scenes, Gemini CLI calls your Web App, which executes the <code>get_exchange_rate</code> function and returns the result. Gemini then uses this result to formulate the final answer.</li>
</ul>
</li>
<li>Run a prompt that requires the weather tool: <code>What is the weather forecast for Tokyo at noon today?</code>
<ul>
<li>Similarly, the CLI calls the <code>get_current_weather</code> function via your Web App to get the necessary data.</li>
</ul>
</li>
</ol>
<p>When using non-interactive mode, the commands are simpler:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gemini -p <span style="color:#e6db74">&#34;How much is 10,000 yen in USD?&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gemini -p <span style="color:#e6db74">&#34;What is the weather forecast for Tokyo at noon today?&#34;</span>
</span></span></code></pre></div><h1 id="summary">Summary</h1>
<ul>
<li>This report explained how to integrate the Gemini CLI with your personal Google Workspace data (like Gmail and Calendar) for powerful automations.</li>
<li>The integration was achieved by building a Model Context Protocol (MCP) server using a Google Apps Script project deployed as a Web App.</li>
<li>This method leveraged Google Apps Script to securely handle authorization, allowing Gemini to use custom-defined tools to access your data without requiring separate cloud infrastructure.</li>
<li>The guide provided the full Apps Script code, including example functions for getting currency exchange rates and weather forecasts, to demonstrate how to define tools for Gemini.</li>
<li>Setup involved deploying the script as a Web App and configuring the Gemini CLI&rsquo;s <code>settings.json</code> file to connect to the new Web App URL, which acted as the MCP server endpoint.</li>
</ul>

  
  <h4><i class="fas fa-share-alt" aria-hidden="true"></i>&nbsp;Share!</h4>
<ul class="share-buttons">
	<li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftanaikech.github.io%2f2025%2f06%2f27%2fgemini-cli-with-mcp-server-built-by-web-apps-of-google-apps-script%2f" target="_blank" title="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span class="sr-only">Share on Facebook</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://twitter.com/intent/tweet?source=https%3a%2f%2ftanaikech.github.io%2f2025%2f06%2f27%2fgemini-cli-with-mcp-server-built-by-web-apps-of-google-apps-script%2f" target="_blank" title="Tweet"><i class="fab fa-twitter" aria-hidden="true"></i><span class="sr-only">Tweet</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://plus.google.com/share?url=https%3a%2f%2ftanaikech.github.io%2f2025%2f06%2f27%2fgemini-cli-with-mcp-server-built-by-web-apps-of-google-apps-script%2f" target="_blank" title="Share on Google+"><i class="fab fa-google-plus" aria-hidden="true"></i><span class="sr-only">Share on Google+</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.tumblr.com/share?v=3&u=https%3a%2f%2ftanaikech.github.io%2f2025%2f06%2f27%2fgemini-cli-with-mcp-server-built-by-web-apps-of-google-apps-script%2f" target="_blank" title="Post to Tumblr"><i class="fab fa-tumblr" aria-hidden="true"></i><span class="sr-only">Post to Tumblr</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2ftanaikech.github.io%2f2025%2f06%2f27%2fgemini-cli-with-mcp-server-built-by-web-apps-of-google-apps-script%2f" target="_blank" title="Pin it"><i class="fab fa-pinterest-p" aria-hidden="true"></i><span class="sr-only">Pin it</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.reddit.com/submit?url=https%3a%2f%2ftanaikech.github.io%2f2025%2f06%2f27%2fgemini-cli-with-mcp-server-built-by-web-apps-of-google-apps-script%2f" target="_blank" title="Submit to Reddit"><i class="fab fa-reddit-alien" aria-hidden="true"></i><span class="sr-only">Submit to Reddit</span></a>
	</li>
</ul>


<style>
	ul.share-buttons{
	  list-style: none;
	  padding: 0;
	}

	ul.share-buttons li{
	  display: inline;
	}

	ul.share-buttons .sr-only{
	  position: absolute;
	  clip: rect(1px 1px 1px 1px);
	  clip: rect(1px, 1px, 1px, 1px);
	  padding: 0;
	  border: 0;
	  height: 1px;
	  width: 1px;
	  overflow: hidden;
	}
</style>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://tanaikech.github.io/2025/06/26/a-practical-analysis-of-the-gemini-apis-url-context-tool/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://tanaikech.github.io/2025/06/26/a-practical-analysis-of-the-gemini-apis-url-context-tool/">A Practical Analysis of the Gemini API&#39;s URL Context Tool</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
  </div>
</div>


  
  
  
  

  

</div>

</div>
</div>
<script src="https://tanaikech.github.io/js/ui.js"></script>
<script src="https://tanaikech.github.io/js/menus.js"></script>






<script async src="https://www.googletagmanager.com/gtag/js?id=G-J3Z6T50WL5"></script>
<script>
  
  if (window.location.hostname != "localhost") {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-J3Z6T50WL5');
  }
</script>






<script src="https://tanaikech.github.io/js/math-code.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  


</body>
</html>

