<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.61.0" />

  <title>Request of multipart/form-data with Simple Request Body using Google Apps Script &middot; tanaike</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://tanaikech.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.9.0/css/all.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://tanaikech.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://tanaikech.github.io/">TANAIKE</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/topics/"><i class='fa fa-folder fa-fw'></i>Topics</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/link/"><i class='fa fa-thumbs-up fa-fw'></i>Links</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/webapps/"><i class='fas fa-toolbox'></i>Web Applications</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/donate/"><i class='fas fa-donate'></i>Donate</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/tanaikech" rel="me" target="_blank"><i class="fab fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/7108653" rel="me" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2017. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Request of multipart/form-data with Simple Request Body using Google Apps Script</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>17 Oct 2020, 11:00</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/gastips">GasTips</a>
    
  </div>
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/google-apps-script">Google Apps Script</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/multipart">multipart</a>
    
  </div>
  
  

</div>

  <p><a href="https://gist.github.com/tanaikech/5cd0dc9ea7d75e4a2ff65049ed3d78c3">Gists</a></p>
<p>This is a sample script of the request of <code>multipart/form-data</code> with a simple request body using Google Apps Script. I hope that the users will easy to use Class UrlFetchApp by this report.</p>
<p>This report is the updated post of &ldquo;<a href="https://tanaikech.github.io/2017/07/21/multipart-post-request-using-google-apps-script/">Multipart-POST Request Using Google Apps Script</a>&quot;.</p>
<h2 id="description">Description</h2>
<p>I had already reported about this at <a href="https://tanaikech.github.io/2017/07/21/multipart-post-request-using-google-apps-script/">this report</a>. In that case, it was required to create a bit complicated request body to request <code>multipart/form-data</code>. Today, by <a href="https://stackoverflow.com/questions/64382781/api-post-request-in-google-app-script-not-working/64382970?noredirect=1#comment113873694_64382970">a comment</a>, I could notice the sample script of Class UrlFetchApp in the official document had been updated. By this, I thought that <code>multipart/form-data</code> will be requested with a simple request body. In this report, I would like to introduce a sample script for requesting <code>multipart/form-data</code> with a simple request body. But I'm not sure whether this request got to be able to be done by the internal update of Class UrlFetchApp.</p>
<h2 id="sample-script">Sample script</h2>
<p>In this sample script, the CSV and XLSX files can be converted to Google Spreadsheet using Drive API v3 with UrlFetchApp. You can see the sample script for directly creating the request body of <code>multipart/form-data</code> at &ldquo;2. Convert Excel files To Spreadsheets On Google Drive Using Drive API v3.&rdquo; of <a href="https://tanaikech.github.io/2017/07/21/multipart-post-request-using-google-apps-script/">this report</a>. In this sample script, the same request is run with the simple request body. Before you use this script, please enable Drive API at Advanced Google services.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">myFunction</span>() {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fileId</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;### file ID on Google Drive ###&#34;</span>; <span style="color:#75715e">// Please set the file ID of CSV or XLSX file.
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">metadata</span> <span style="color:#f92672">=</span> {
    <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;sampleFile&#34;</span>,
    <span style="color:#a6e22e">mimeType</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;application/vnd.google-apps.spreadsheet&#34;</span>,
    <span style="color:#a6e22e">parents</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;### folder ID ###&#34;</span>], <span style="color:#75715e">// If you want to put the converted Spreadsheet to the specific folder, please use this.
</span><span style="color:#75715e"></span>  };
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fields</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;id,mimeType,name&#34;</span>;

  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">payload</span> <span style="color:#f92672">=</span> {
    <span style="color:#a6e22e">metadata</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">newBlob</span>(<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">metadata</span>), <span style="color:#e6db74">&#34;application/json&#34;</span>),
    <span style="color:#a6e22e">file</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">DriveApp</span>.<span style="color:#a6e22e">getFileById</span>(<span style="color:#a6e22e">fileId</span>).<span style="color:#a6e22e">getBlob</span>(),
  };
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">options</span> <span style="color:#f92672">=</span> {
    <span style="color:#a6e22e">method</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;post&#34;</span>,
    <span style="color:#a6e22e">payload</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">payload</span>,
    <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">authorization</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Bearer &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">ScriptApp</span>.<span style="color:#a6e22e">getOAuthToken</span>() },
  };
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span>
    <span style="color:#e6db74">&#34;https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&amp;fields=&#34;</span> <span style="color:#f92672">+</span>
    encodeURIComponent(<span style="color:#a6e22e">fields</span>);
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">options</span>).<span style="color:#a6e22e">getContentText</span>();
  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>);

  <span style="color:#75715e">// DriveApp.createFile(blob)  // This is used for automatically detecting the scope of &#34;https://www.googleapis.com/auth/drive&#34;.
</span><span style="color:#75715e"></span>}
</code></pre></div><ul>
<li>When this script is run, the CSV and XLSX file are converted to Google Spreadsheet.</li>
<li>At UrlFetchApp, it seems that when the metadata is sent as the blob including the mimeType of <code>application/json</code> like <code>metadata: Blob</code>, the string of object <code>metadata</code> can be sent to the form as <code>application/json</code>. And when the file is sent as <code>file: Blob</code>, the file is sent as the file.</li>
</ul>
<h3 id="result">Result</h3>
<p>When above script is run, the following response is returned.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;###&#34;</span>,
  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;sampleFile&#34;</span>,
  <span style="color:#f92672">&#34;mimeType&#34;</span>: <span style="color:#e6db74">&#34;application/vnd.google-apps.spreadsheet&#34;</span>
}
</code></pre></div><h2 id="note">Note</h2>
<ul>
<li>When above sample script is converted to the curl command, it becomes as follows.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -X POST -L <span style="color:#ae81ff">\</span>
     -H <span style="color:#e6db74">&#34;Authorization: Bearer ### access token ###&#34;</span> <span style="color:#ae81ff">\</span>
     -F <span style="color:#e6db74">&#34;metadata={ \
</span><span style="color:#e6db74">                  name : &#39;### uploaded filename on Google Drive ###&#39;, \
</span><span style="color:#e6db74">                  mimeType : &#39;application/vnd.google-apps.spreadsheet&#39; \
</span><span style="color:#e6db74">                  };type=application/json;charset=UTF-8&#34;</span> <span style="color:#ae81ff">\</span>
     -F <span style="color:#e6db74">&#34;file=@### Excel file ###;type=application/vnd.ms-excel&#34;</span> <span style="color:#ae81ff">\</span>
     <span style="color:#e6db74">&#34;https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&#34;</span>
</code></pre></div><ul>
<li>
<p>As other sample, when you want to send the file data to the file, you can use the following simple script.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>;
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">url</span>, {
  <span style="color:#a6e22e">method</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;post&#34;</span>,
  <span style="color:#a6e22e">payload</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">file</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">DriveApp</span>.<span style="color:#a6e22e">getFileById</span>(<span style="color:#e6db74">&#34;### file ID ###&#34;</span>).<span style="color:#a6e22e">getBlob</span>() },
}).<span style="color:#a6e22e">getContentText</span>();
</code></pre></div><ul>
<li>In this case, the value is sent to <code>{&quot;files&quot;: {&quot;file&quot;: &quot;### data ###&quot;}}</code>.</li>
</ul>
</li>
<li>
<p>As other sample, when you want to send the JSON object to the form, you can use the following simple script.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>;
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">url</span>, {
  <span style="color:#a6e22e">method</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;post&#34;</span>,
  <span style="color:#a6e22e">payload</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">key1</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;value1&#34;</span>, <span style="color:#a6e22e">key2</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;value2&#34;</span> },
}).<span style="color:#a6e22e">getContentText</span>();
</code></pre></div><ul>
<li>In this case, the value is sent to <code>{&quot;form&quot;: {&quot;key1&quot;: &quot;value1&quot;, &quot;key2&quot;: &quot;value2&quot;}}</code>.</li>
</ul>
</li>
</ul>
<h2 id="references">References</h2>
<ul>
<li><a href="https://developers.google.com/apps-script/reference/url-fetch/url-fetch-app">Class UrlFetchApp</a>
<ul>
<li>This is the official document.</li>
</ul>
</li>
<li><a href="https://tanaikech.github.io/2017/07/21/multipart-post-request-using-google-apps-script/">Multipart-POST Request Using Google Apps Script</a>
<ul>
<li>This is the report I posted before in this blog.</li>
</ul>
</li>
<li><a href="https://developers.google.com/drive/api/v3/manage-uploads#multipart">Perform a multipart upload</a></li>
</ul>

  


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://tanaikech.github.io/2020/10/13/retrieving-all-values-from-all-sheets-from-url-of-2pacx-of-web-published-google-spreadsheet-using-python/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://tanaikech.github.io/2020/10/13/retrieving-all-values-from-all-sheets-from-url-of-2pacx-of-web-published-google-spreadsheet-using-python/">Retrieving All Values from All Sheets from URL of 2PACX- of Web Published Google Spreadsheet using Python</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://tanaikech.github.io/2020/10/21/creating-multiple-buttons-on-google-spreadsheet-using-google-apps-script/">Creating Multiple Buttons on Google Spreadsheet using Google Apps Script</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://tanaikech.github.io/2020/10/21/creating-multiple-buttons-on-google-spreadsheet-using-google-apps-script/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  

</div>

</div>
</div>
<script src="https://tanaikech.github.io/js/ui.js"></script>
<script src="https://tanaikech.github.io/js/menus.js"></script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
    }
  });
</script>


<script>
  
  if (window.location.hostname != "localhost") {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-84325623-1', 'auto');
    ga('send', 'pageview');
  }
</script>





<script src="https://tanaikech.github.io/js/math-code.js"></script>
  <script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  


</body>
</html>

