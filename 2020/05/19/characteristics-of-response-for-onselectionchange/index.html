<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.61.0" />

  <title>Characteristics of Response for onSelectionChange &middot; tanaike</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://tanaikech.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.9.0/css/all.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://tanaikech.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://tanaikech.github.io/">TANAIKE</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/topics/"><i class='fa fa-folder fa-fw'></i>Topics</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/link/"><i class='fa fa-thumbs-up fa-fw'></i>Links</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/webapps/"><i class='fas fa-toolbox'></i>Web Applications</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/tanaikech" rel="me" target="_blank"><i class="fab fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/7108653" rel="me" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2017. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Characteristics of Response for onSelectionChange</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>19 May 2020, 14:19</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/report">report</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/gastips">GasTips</a>
    
  </div>
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/google-apps-script">Google Apps Script</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/spreadsheet">Spreadsheet</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/event">event</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/trigger">trigger</a>
    
  </div>
  
  

</div>

  <p><a href="https://gist.github.com/tanaikech/ca5812ed19dd6858879246bd2304266f">Gists</a></p>
<h2 id="abstract">Abstract</h2>
<p>I have already reported about &ldquo;Change Tab Detection on Google Spreadsheet using onSelectionChange Event Trigger with Google Apps Script&rdquo;. <a href="https://tanaikech.github.io/2020/05/18/change-tab-detection-on-google-spreadsheet-using-onselectionchange-event-trigger-with-google-apps-script/">Ref</a> It is considered that when the situation which uses the event trigger of <code>onSelectionChange</code> is thought, the response speed is important. So, here, I investigated the characteristics of response for the event trigger of <code>onSelectionChange</code>.</p>
<h2 id="demo">Demo</h2>
<p><img src="https://tanaikech.github.io/img/20200519a-fig1.gif" alt=""></p>
<h2 id="experiment">Experiment</h2>
<h3 id="sample-script">Sample script</h3>
<p>In order to investigate the response speed, I used the following sample script. The work of sample script can be seen at above demonstration movie. In this report, the script is important for discussing the result. So I pot this at this section instead of the appendix.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">start</span>() {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">randRange</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span>) =&gt; Math.<span style="color:#a6e22e">floor</span>(Math.<span style="color:#a6e22e">random</span>() <span style="color:#f92672">*</span> (<span style="color:#a6e22e">b</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">a</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">a</span>);
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">getStr</span> <span style="color:#f92672">=</span> () =&gt; <span style="color:#e6db74">&#34;abcdefghij&#34;</span>[Math.<span style="color:#a6e22e">floor</span>(Math.<span style="color:#a6e22e">random</span>() <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span>)];

  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ca</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">CacheService</span>.<span style="color:#a6e22e">getScriptCache</span>();
  <span style="color:#a6e22e">ca</span>.<span style="color:#a6e22e">remove</span>(<span style="color:#e6db74">&#34;sample&#34;</span>);
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sheet</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">SpreadsheetApp</span>.<span style="color:#a6e22e">getActiveSpreadsheet</span>().<span style="color:#a6e22e">getSheetByName</span>(<span style="color:#e6db74">&#34;Sheet4&#34;</span>);
  <span style="color:#a6e22e">sheet</span>.<span style="color:#a6e22e">getRange</span>(<span style="color:#e6db74">&#34;L3:L5&#34;</span>).<span style="color:#a6e22e">clearContent</span>();
  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">ar</span> <span style="color:#f92672">=</span> [];
  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">10</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">range</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sheet</span>.<span style="color:#a6e22e">getRange</span>(
      <span style="color:#a6e22e">getStr</span>() <span style="color:#f92672">+</span> <span style="color:#a6e22e">randRange</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">10</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">getStr</span>() <span style="color:#f92672">+</span> <span style="color:#a6e22e">randRange</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">10</span>)
    );
    <span style="color:#a6e22e">ar</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">range</span>.<span style="color:#a6e22e">getA1Notation</span>());
    <span style="color:#a6e22e">range</span>.<span style="color:#a6e22e">setBackground</span>(<span style="color:#e6db74">&#34;#ff0000&#34;</span>);
    <span style="color:#a6e22e">SpreadsheetApp</span>.<span style="color:#a6e22e">flush</span>();

    <span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">sleep</span>(<span style="color:#ae81ff">3000</span>); <span style="color:#75715e">// &lt;--- Important
</span><span style="color:#75715e"></span>
    <span style="color:#a6e22e">range</span>.<span style="color:#a6e22e">setBackground</span>(<span style="color:#e6db74">&#34;#ffffff&#34;</span>);
    <span style="color:#a6e22e">SpreadsheetApp</span>.<span style="color:#a6e22e">flush</span>();
  }
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ca</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;sample&#34;</span>).<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#34;,&#34;</span>);
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">rr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ar</span>.<span style="color:#a6e22e">filter</span>((<span style="color:#a6e22e">r</span>, <span style="color:#a6e22e">i</span>) =&gt; <span style="color:#a6e22e">r</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">v</span>[<span style="color:#a6e22e">i</span>]);
  <span style="color:#a6e22e">sheet</span>
    .<span style="color:#a6e22e">getRange</span>(<span style="color:#e6db74">&#34;L3:L5&#34;</span>)
    .<span style="color:#a6e22e">setValues</span>([
      [<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">ar</span>)],
      [<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">v</span>)],
      [<span style="color:#a6e22e">rr</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">ar</span>.<span style="color:#a6e22e">length</span>],
    ]);
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">onSelectionChange</span>(<span style="color:#a6e22e">e</span>) {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">range</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">range</span>;
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">a1Notation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">range</span>.<span style="color:#a6e22e">getA1Notation</span>();
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ca</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">CacheService</span>.<span style="color:#a6e22e">getScriptCache</span>();
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ca</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;sample&#34;</span>);
  <span style="color:#a6e22e">ca</span>.<span style="color:#a6e22e">put</span>(
    <span style="color:#e6db74">&#34;sample&#34;</span>,
    <span style="color:#a6e22e">range</span>.<span style="color:#a6e22e">getBackgrounds</span>().<span style="color:#a6e22e">every</span>((<span style="color:#a6e22e">r</span>) =&gt; <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">every</span>((<span style="color:#a6e22e">c</span>) =&gt; <span style="color:#a6e22e">c</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;#ff0000&#34;</span>))
      <span style="color:#f92672">?</span> <span style="color:#a6e22e">v</span>
        <span style="color:#f92672">?</span> <span style="color:#a6e22e">v</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;,&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">a1Notation</span>
        <span style="color:#f92672">:</span> <span style="color:#a6e22e">a1Notation</span>
      <span style="color:#f92672">:</span> <span style="color:#a6e22e">v</span>
      <span style="color:#f92672">?</span> <span style="color:#a6e22e">v</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;,&#34;</span>
      <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&#34;</span>
  );
}
</code></pre></div><h3 id="experimental-procedure">Experimental procedure</h3>
<p>In this script, the wait time of <code>Utilities.sleep(3000)</code> is very important for using the event trigger of <code>onSelectionChange</code>. <code>3000</code> means 3,000 ms. Because when <code>range.setBackground(&quot;#ff0000&quot;)</code> is run, it is required to retrieve the event object and run the script before <code>range.setBackground(&quot;#ffffff&quot;)</code> is run.</p>
<p>By the way, at GAS, the processing time is not stable as you know. So in this experiment, the average value for 20 times measurements was used for each data point which is shown by the following figure. At this time, the fluctuation of the average values was less than 5 %. I worry that each detailed-data point at my environment might be different from that at other user's environment. But I think that the trend of this result can be used.</p>
<h2 id="result-and-discussion">Result and discussion</h2>
<p><img src="https://tanaikech.github.io/img/20200519a-fig2.png" alt=""></p>
<p>Fig. 1: Wait time vs. rate.</p>
<!-- raw HTML omitted -->
<p>Figure 1 shows the wait tile vs. the rate. Rate means the successful rate that <code>onSelectionChange</code> could be correctly worked. From Fig. 1, it is found that when the wait time is small, the rate is 0 %. This indicates that the event object cannot be retrieved between <code>range.setBackground(&quot;#ff0000&quot;)</code> and <code>range.setBackground(&quot;#ffffff&quot;)</code>. When the wait time is 3,000 ms, the rate is closed to almost 100 %. By this, it is found that the wait time is very important for using the event trigger of <code>onSelectionChange</code>. And also, it is found that in order to retrieve the stable work of <code>onSelectionChange</code>, at least, the wait time of more than 3 seconds is required. Furthermore, from this experiment, it was found that the event trigger of <code>onSelectionChange</code> could be worked even when the other function was running.</p>
<h2 id="summary">Summary</h2>
<p>In this report, I investigated the characteristics of response for the event trigger of <code>onSelectionChange</code>. As the result, the following results were obtained.</p>
<ol>
<li>
<p>It was found that the wait time was very important for using the event trigger of <code>onSelectionChange</code>.</p>
</li>
<li>
<p>It was found that in order to retrieve the stable work of <code>onSelectionChange</code>, at least, the wait time of more than 3 seconds was required.</p>
</li>
<li>
<p>It was found that the event trigger of <code>onSelectionChange</code> could be worked even when the other function was running.</p>
</li>
</ol>
<h2 id="references">References</h2>
<ul>
<li><a href="https://developers.google.com/apps-script/guides/triggers#onselectionchangee">onSelectionChange(e)</a></li>
<li><a href="https://tanaikech.github.io/2020/05/18/change-tab-detection-on-google-spreadsheet-using-onselectionchange-event-trigger-with-google-apps-script/">Change Tab Detection on Google Spreadsheet using onSelectionChange Event Trigger with Google Apps Script</a></li>
<li><a href="https://developers.google.com/apps-script/reference/utilities/utilities#sleepmilliseconds">sleep(milliseconds)</a></li>
</ul>

  


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://tanaikech.github.io/2020/05/18/change-tab-detection-on-google-spreadsheet-using-onselectionchange-event-trigger-with-google-apps-script/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://tanaikech.github.io/2020/05/18/change-tab-detection-on-google-spreadsheet-using-onselectionchange-event-trigger-with-google-apps-script/">Change Tab Detection on Google Spreadsheet using onSelectionChange Event Trigger with Google Apps Script</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://tanaikech.github.io/2020/05/26/gas-library-copyfolder/">GAS Library - CopyFolder</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://tanaikech.github.io/2020/05/26/gas-library-copyfolder/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  

</div>

</div>
</div>
<script src="https://tanaikech.github.io/js/ui.js"></script>
<script src="https://tanaikech.github.io/js/menus.js"></script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
    }
  });
</script>


<script>
  
  if (window.location.hostname != "localhost") {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-84325623-1', 'auto');
    ga('send', 'pageview');
  }
</script>







</body>
</html>

