<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <meta name="google-site-verification" content="1BvDMY90ui0jRLHkrpqdQ_x62h5VNEMuK6mQsDvVQH0" />

  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.98.0" />

  <title>Expanding Error Messages of Google Apps Script using Gemini Pro API with Google Apps Script &middot; tanaike</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://tanaikech.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.6.0/css/all.css">

  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet" type="text/css">

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css">
  <script async src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://tanaikech.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://tanaikech.github.io/">TANAIKE</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/topics/"><i class='fa fa-folder fa-fw'></i>Topics</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/link/"><i class='fa fa-thumbs-up fa-fw'></i>Links</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/webapps/"><i class='fas fa-toolbox'></i>Web Applications</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/donate/"><i class='fas fa-donate'></i>Donate</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/tanaikech" rel="me" target="_blank"><i class="fa-brands fa-square-x-twitter"></i>X</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://medium.com/@tanaike" rel="me" target="_blank"><i class="fa-brands fa-medium"></i>Medium</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/tanaike" rel="me" target="_blank"><i class="fab fa-linkedin fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/tanaikech" rel="me" target="_blank"><i class="fa-brands fa-github"></i>GitHub</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://gist.github.com/tanaikech" rel="me" target="_blank"><i class="fas fa-code fa-fw"></i>Gists</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/7108653" rel="me" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://dev.to/tanaike" rel="me" target="_blank"><i class="fa-brands fa-dev fa-fw"></i>DEV</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://zenn.dev/tanaike" rel="me" target="_blank"><i class="fas fa-edit fa-fw"></i>Zenn</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://devpost.com/tanaike" rel="me" target="_blank"><i class="fas fa-code fa-fw"></i>Devpost</a>
    </li>
    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2017. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Expanding Error Messages of Google Apps Script using Gemini Pro API with Google Apps Script</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>20 Dec 2023, 08:25</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/gastips">GasTips</a>
    
  </div>
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/google-apps-script">Google Apps Script</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/gemini">Gemini</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/ai">AI</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/llm">LLM</a>
    
  </div>
  
  

</div>

  <p><a href="https://gist.github.com/tanaikech/b86db4d574474cbb079b185271f679ce">Gists</a></p>
<p><img src="https://tanaikech.github.io/image-storage/20231220a/fig1.gif" alt=""></p>
<h2 id="abstract">Abstract</h2>
<p>It is considered that when the current error message of Google Apps Script is expanded, it will be useful for a lot of users. This report introduces a sample script for expanding the error message of Google Apps Script using Gemini Pro API with Google Apps Script.</p>
<h2 id="introduction">Introduction</h2>
<p>The recent release of the LLM model Gemini as an API on Vertex AI and Google AI Studio opens a world of possibilities. <a href="https://deepmind.google/technologies/gemini/#introduction">Ref</a> and <a href="https://blog.google/technology/ai/google-gemini-ai/#sundar-note">Ref</a></p>
<p>I believe Gemini API significantly expands the potential of Google Apps Script and paves the way for diverse applications. In this report, I present a sample script for expanding the error message of Google Apps Script using Gemini Pro API with Google Apps Script, and I would also like to mention the potential of the expanded error message using Gemini Pro API.</p>
<p>In the current stage, when an error occurs with Google Apps Script, a simple error message is returned. For example, when the following simple sample script for the container-bound script of Google Spreadsheet is used,</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">onEdit</span>(<span style="color:#a6e22e">e</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">range</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">range</span>.<span style="color:#a6e22e">getA1Notation</span>());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When a cell is edited, you can see the cell coordinate as a1Notation in the log by automatically executing <code>onEdit</code> with the simple trigger. However, when you directly run the function <code>onEdit</code> with the script editor, an error of <code>TypeError: Cannot destructure property 'range' of 'e' as it is undefined.</code>. The reason for this error is due to that the event object <code>e</code> is not given by directly executing the function. But, when I saw Stackoverflow, I saw several questions related to this error. From this situation, I thought that when more information is added to this error message, it might be useful for a lot of users. So, I published this report. When the method of this report is used, the error message by adding more information is shown. I believe that it will assist a lot of users in developing applications with Google Apps Script.</p>
<h2 id="usage">Usage</h2>
<h3 id="1-create-a-standalone-google-apps-script-project">1. Create a standalone Google Apps Script project</h3>
<p>Create a standalone Google Apps Script project. The filename is <code>server</code>. This Google Apps Script project is used as a server for using Google Apps Script API.</p>
<h3 id="2-open-the-server-file-and-link-server-with-the-google-cloud-platform">2. Open the &ldquo;server&rdquo; file and link &ldquo;server&rdquo; with the Google Cloud Platform</h3>
<p>You can see how to link the Google Apps Script Project with the Google Cloud Platform Project at <a href="https://github.com/tanaikech/Linking-Google-Cloud-Platform-Project-to-Google-Apps-Script-Project-for-New-IDE">here</a>.</p>
<h3 id="3-enable-apis">3. Enable APIs</h3>
<p>Please enable the following APIs at the API console.</p>
<ul>
<li>Google Apps Script API</li>
</ul>
<h3 id="4-enable-change-of-google-apps-script-project">4. Enable change of Google Apps Script project</h3>
<p>Please access to <a href="https://script.google.com/home/usersettings">https://script.google.com/home/usersettings</a> using your browser and please change to &ldquo;ON&rdquo; for &ldquo;Google Apps Script API&rdquo; at &ldquo;Settings&rdquo;. When you have already done this, this process can be skipped.</p>
<h3 id="5-retrieve-api-key-for-using-gemini-api">5. Retrieve API key for using Gemini API</h3>
<p>Please access <a href="https://makersuite.google.com/app/apikey">https://makersuite.google.com/app/apikey</a> and create your API key. At that time, please enable Generative Language API at the API console. This API key is used for this sample script.</p>
<p>This official document can be also seen. <a href="https://ai.google.dev/">Ref</a>.</p>
<p>As additional information, of course, in this case, when you use the Google Apps Script project linked with the Google Cloud Platform, when Generative Language API is enabled at the API console, you can also use the access token retrieved by <code>ScriptApp.getOAuthToken()</code> instead of the API key. In this sample, the API key is used.</p>
<h3 id="6-sample-script-for-server">6. Sample script for &ldquo;server&rdquo;</h3>
<p>Please copy and paste the following script to the script editor of &ldquo;server&rdquo;, and please set your API key to <code>apiKey</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">doGet</span>(<span style="color:#a6e22e">e</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">apiKey</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>; <span style="color:#75715e">// Please set your API key.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">scriptId</span>, <span style="color:#a6e22e">errorMessage</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">parameter</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">scriptId</span> <span style="color:#f92672">||</span> <span style="color:#f92672">!</span><span style="color:#a6e22e">errorMessage</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">ContentService</span>.<span style="color:#a6e22e">createTextOutput</span>(<span style="color:#e6db74">&#34;No script ID or an error message.&#34;</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url1</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`https://script.googleapis.com/v1/projects/</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">scriptId</span><span style="color:#e6db74">}</span><span style="color:#e6db74">/content`</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res1</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">url1</span>, {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">authorization</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Bearer &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">ScriptApp</span>.<span style="color:#a6e22e">getOAuthToken</span>() },
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> { <span style="color:#a6e22e">files</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">res1</span>.<span style="color:#a6e22e">getContentText</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">script</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">files</span>
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">filter</span>(({ <span style="color:#a6e22e">type</span> }) =&gt; [<span style="color:#e6db74">&#34;SERVER_JS&#34;</span>, <span style="color:#e6db74">&#34;HTML&#34;</span>].<span style="color:#a6e22e">includes</span>(<span style="color:#a6e22e">type</span>))
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">map</span>(({ <span style="color:#a6e22e">source</span> }) =&gt; <span style="color:#a6e22e">source</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;\n&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">text</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`Read the following script and the error message. Return the reason for the error within 100 words.\nScript is as follows.\n</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">script</span><span style="color:#e6db74">}</span><span style="color:#e6db74">\nError message is as follows.\n</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">errorMessage</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url2</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">apiKey</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">payload</span> <span style="color:#f92672">=</span> { <span style="color:#a6e22e">contents</span><span style="color:#f92672">:</span> [{ <span style="color:#a6e22e">parts</span><span style="color:#f92672">:</span> [{ <span style="color:#a6e22e">text</span> }] }] };
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">options</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">payload</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">payload</span>),
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">contentType</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;application/json&#34;</span>,
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res2</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">url2</span>, <span style="color:#a6e22e">options</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">res2</span>.<span style="color:#a6e22e">getContentText</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">candidates</span> <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">candidates</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">candidates</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">content</span>.<span style="color:#a6e22e">parts</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    ) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">ContentService</span>.<span style="color:#a6e22e">createTextOutput</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">candidates</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">content</span>.<span style="color:#a6e22e">parts</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">text</span>
</span></span><span style="display:flex;"><span>      );
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">ContentService</span>.<span style="color:#a6e22e">createTextOutput</span>(<span style="color:#e6db74">&#34;No response.&#34;</span>);
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">catch</span> ({ <span style="color:#a6e22e">stack</span> }) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">ContentService</span>.<span style="color:#a6e22e">createTextOutput</span>(<span style="color:#a6e22e">stack</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="7-deploy-web-apps">7. Deploy Web Apps</h3>
<p>Please deploy Web Apps on the “server” file.</p>
<p>The detailed information can be seen in <a href="https://developers.google.com/apps-script/guides/web#deploy_a_script_as_a_web_app">the official document</a>.</p>
<ol>
<li>On the script editor, at the top right of the script editor, please click &ldquo;click Deploy&rdquo; -&gt; &ldquo;New deployment&rdquo;.</li>
<li>Please click &ldquo;Select type&rdquo; -&gt; &ldquo;Web App&rdquo;.</li>
<li>Please input the information about the Web App in the fields under &ldquo;Deployment configuration&rdquo;.</li>
<li>Please select <strong>&ldquo;Me&rdquo;</strong> for <strong>&ldquo;Execute as&rdquo;</strong>.</li>
<li>Please select <strong>&ldquo;Only myself&rdquo;</strong> for <strong>&ldquo;Who has access&rdquo;</strong>.</li>
<li>Please click &ldquo;Deploy&rdquo; button.</li>
<li>Please run the function <code>getUr()</code> of the above script. By this, you can see your Web Apps URL. It’s like <code>https://script.google.com/macros/s/###/dev</code>. Please copy this URL. This URL is used on the client side.</li>
</ol>
<p>By this flow, the preparation is finished.</p>
<p>By using Google Apps Script API with Web Apps, all Google Apps Script projects in your Google Drive can be used. This approach is the same with <a href="https://medium.com/google-cloud/managing-history-of-google-apps-script-50434541038f">this post</a>.</p>
<h3 id="8-testing">8. Testing</h3>
<p>In order to test this script, please create a Google Spreadsheet and open the script editor of the created Spreadsheet. And, please copy and paste the following script to the script editor, please set your Web Apps URL to <code>webAppsURL</code>, and save the script.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">expandErrorMessage_</span>(<span style="color:#a6e22e">errorMessage</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">webAppsURL</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://script.google.com/macros/s/###/dev&#34;</span>; <span style="color:#75715e">// Please set your Web Apps URL.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">webAppsURL</span><span style="color:#e6db74">}</span><span style="color:#e6db74">?scriptId=</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">ScriptApp</span>.<span style="color:#a6e22e">getScriptId</span>()<span style="color:#e6db74">}</span><span style="color:#e6db74">&amp;errorMessage=</span><span style="color:#e6db74">${</span>encodeURIComponent(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">errorMessage</span>.<span style="color:#a6e22e">stack</span>
</span></span><span style="display:flex;"><span>    )<span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>,
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">authorization</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Bearer &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">ScriptApp</span>.<span style="color:#a6e22e">getOAuthToken</span>() },
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">muteHttpExceptions</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">getResponseCode</span>() <span style="color:#f92672">!=</span> <span style="color:#ae81ff">200</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> { <span style="color:#a6e22e">errorMessage</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">errorMessage</span>.<span style="color:#a6e22e">stack</span>, <span style="color:#a6e22e">expandedErrorMessage</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">null</span> };
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">errorMessage</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">errorMessage</span>.<span style="color:#a6e22e">stack</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">expandedErrorMessage</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">getContentText</span>(),
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// DriveApp.getFiles(); // This comment line is used for automatically detecting a scope of &#34;https://www.googleapis.com/auth/drive.readonly&#34;. This scope is used for requesting Web Apps. Please don&#39;t remove this comment line.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">onEdit</span>(<span style="color:#a6e22e">e</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">range</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">range</span>.<span style="color:#a6e22e">getA1Notation</span>());
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">err</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#a6e22e">expandErrorMessage_</span>(<span style="color:#a6e22e">err</span>));
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>In this sample script, when you edit a cell, you can see the cell coordinate of the edited cell in the log by automatically executing <code>onEdit</code> with the simple trigger.</p>
<p>When you directly run <code>onEdit</code> with the script editor, an error occurs. However, at that time, you can see both the original error message and the expanded error message in the log by the method in this report. You can see a demonstration at the top GIF image.</p>
<p>The expanded error message at the top image is as follows.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;errorMessage&#34;</span>: <span style="color:#e6db74">&#34;TypeError: Cannot destructure property &#39;range&#39; of &#39;e&#39; as it is undefined.\n    at onEdit (Code:4:13)\n    at __GS_INTERNAL_top_function_call__.gs:1:8&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;expandedErrorMessage&#34;</span>: <span style="color:#e6db74">&#34;The error occurs because the event object (&#39;e&#39;) passed to the &#39;onEdit&#39; function doesn&#39;t have a &#39;range&#39; property. The &#39;range&#39; property is expected to contain information about the edited range in the spreadsheet. Without the &#39;range&#39; property, the script is unable to proceed with its intended operations.&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>If you want to obtain more details error message, please modify <code>const text = `Read the following script and the error message. Return the reason for the error within 100 words.\nScript is as follows.\n${script}\nError message is as follows.\n${errorMessage}`;</code> of the function <code>doGet</code>.</p>
<p>By the way, in the demonstration of the top image, the function <code>expandErrorMessage_</code> is put into a script file of <code>expandErrorMessage_.gs</code>.</p>
<p>Also, in the case of the simple trigger, <code>UrlFetchApp</code> cannot be used. So, if you want to retrieve the expanded error message with the OnEdit trigger, please use the installable OnEdit trigger instead of the simple trigger.</p>
<h2 id="summary">Summary</h2>
<p>From this result, I believe that Gemini API has the potential to be used for expanding the error message of the script.</p>
<h2 id="note">Note</h2>
<ul>
<li>In the current stage, Gemini Pro API can be requested 60 times in 1 minute as the default. <a href="https://cloud.google.com/vertex-ai/docs/generative-ai/migrate/migrate-google-ai#google-ai">Ref</a> Please be careful about this.</li>
</ul>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="https://ai.google.dev/api/rest/v1beta/models/generateContent">Method: models.generateContent</a></li>
</ul>

  
  <h4><i class="fas fa-share-alt" aria-hidden="true"></i>&nbsp;Share!</h4>
<ul class="share-buttons">
	<li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftanaikech.github.io%2f2023%2f12%2f20%2fexpanding-error-messages-of-google-apps-script-using-gemini-pro-api-with-google-apps-script%2f" target="_blank" title="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span class="sr-only">Share on Facebook</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://twitter.com/intent/tweet?source=https%3a%2f%2ftanaikech.github.io%2f2023%2f12%2f20%2fexpanding-error-messages-of-google-apps-script-using-gemini-pro-api-with-google-apps-script%2f" target="_blank" title="Tweet"><i class="fab fa-twitter" aria-hidden="true"></i><span class="sr-only">Tweet</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://plus.google.com/share?url=https%3a%2f%2ftanaikech.github.io%2f2023%2f12%2f20%2fexpanding-error-messages-of-google-apps-script-using-gemini-pro-api-with-google-apps-script%2f" target="_blank" title="Share on Google+"><i class="fab fa-google-plus" aria-hidden="true"></i><span class="sr-only">Share on Google+</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.tumblr.com/share?v=3&u=https%3a%2f%2ftanaikech.github.io%2f2023%2f12%2f20%2fexpanding-error-messages-of-google-apps-script-using-gemini-pro-api-with-google-apps-script%2f" target="_blank" title="Post to Tumblr"><i class="fab fa-tumblr" aria-hidden="true"></i><span class="sr-only">Post to Tumblr</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2ftanaikech.github.io%2f2023%2f12%2f20%2fexpanding-error-messages-of-google-apps-script-using-gemini-pro-api-with-google-apps-script%2f" target="_blank" title="Pin it"><i class="fab fa-pinterest-p" aria-hidden="true"></i><span class="sr-only">Pin it</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.reddit.com/submit?url=https%3a%2f%2ftanaikech.github.io%2f2023%2f12%2f20%2fexpanding-error-messages-of-google-apps-script-using-gemini-pro-api-with-google-apps-script%2f" target="_blank" title="Submit to Reddit"><i class="fab fa-reddit-alien" aria-hidden="true"></i><span class="sr-only">Submit to Reddit</span></a>
	</li>
</ul>


<style>
	ul.share-buttons{
	  list-style: none;
	  padding: 0;
	}

	ul.share-buttons li{
	  display: inline;
	}

	ul.share-buttons .sr-only{
	  position: absolute;
	  clip: rect(1px 1px 1px 1px);
	  clip: rect(1px, 1px, 1px, 1px);
	  padding: 0;
	  border: 0;
	  height: 1px;
	  width: 1px;
	  overflow: hidden;
	}
</style>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://tanaikech.github.io/2023/12/19/flexible-labeling-for-gmail-using-gemini-pro-api-with-google-apps-script/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://tanaikech.github.io/2023/12/19/flexible-labeling-for-gmail-using-gemini-pro-api-with-google-apps-script/">Flexible Labeling for Gmail using Gemini Pro API with Google Apps Script</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://tanaikech.github.io/2023/12/22/inserting-generated-text-to-google-documents-google-spreadsheets-and-google-slides-using-gemini-pro-api-with-google-apps-script/">Inserting Generated Text to Google Documents, Google Spreadsheets, and Google Slides using Gemini Pro API with Google Apps Script</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://tanaikech.github.io/2023/12/22/inserting-generated-text-to-google-documents-google-spreadsheets-and-google-slides-using-gemini-pro-api-with-google-apps-script/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>


  
  
  
  

  

</div>

</div>
</div>
<script src="https://tanaikech.github.io/js/ui.js"></script>
<script src="https://tanaikech.github.io/js/menus.js"></script>






<script async src="https://www.googletagmanager.com/gtag/js?id=G-J3Z6T50WL5"></script>
<script>
  
  if (window.location.hostname != "localhost") {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-J3Z6T50WL5');
  }
</script>






<script src="https://tanaikech.github.io/js/math-code.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  


</body>
</html>

