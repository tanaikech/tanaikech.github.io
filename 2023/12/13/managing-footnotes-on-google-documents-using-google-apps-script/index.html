<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <meta name="google-site-verification" content="1BvDMY90ui0jRLHkrpqdQ_x62h5VNEMuK6mQsDvVQH0" />

  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.98.0" />

  <title>Managing Footnotes on Google Documents using Google Apps Script &middot; tanaike</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://tanaikech.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">

  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet" type="text/css">

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css">
  <script async src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://tanaikech.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://tanaikech.github.io/">TANAIKE</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/topics/"><i class='fa fa-folder fa-fw'></i>Topics</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/link/"><i class='fa fa-thumbs-up fa-fw'></i>Links</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/webapps/"><i class='fas fa-toolbox'></i>Web Applications</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/donate/"><i class='fas fa-donate'></i>Donate</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/tanaikech" rel="me" target="_blank"><i class="fab fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/tanaikech" rel="me" target="_blank"><i class="fab fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/7108653" rel="me" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2017. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Managing Footnotes on Google Documents using Google Apps Script</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>13 Dec 2023, 09:30</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/gastips">GasTips</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/document">document</a>
    
  </div>
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/google-apps-script">Google Apps Script</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/document">document</a>
    
  </div>
  
  

</div>

  <p><a href="https://gist.github.com/tanaikech/cd7bf2ca7b9109e081bd64ec50db54fc">Gists</a></p>
<p><img src="https://tanaikech.github.io/image-storage/20231213a/fig1.png" alt=""></p>
<h1 id="description">Description</h1>
<p>Google Documents can be managed by the Document service of Google Apps Script. <a href="https://developers.google.com/apps-script/reference/document">Ref</a> One day, you might have a situation in which you are required to manage the footnotes on Google Documents using Google Apps Script. There are several official documents related to the footnotes for Google Apps Script. <a href="https://developers.google.com/apps-script/reference/document/footnote">Ref</a> and <a href="https://developers.google.com/apps-script/reference/document/footnote-section">Ref</a> However, unfortunately, I&rsquo;m worried that it might be difficult a little to understand the management of the footnotes from these documents. Actually, I saw some questions related to the footnotes on Google Documents at Stackoverflow. In this report, I would like to introduce a method for managing the footnotes on Google Documents using Google Apps Script.</p>
<p>In this report, the method for managing the footnotes is introduced by the following 4 sections.</p>
<ol>
<li>Get footnotes</li>
<li>Remove footnotes</li>
<li>Update footnotes</li>
<li>Create footnotes</li>
</ol>
<h2 id="1-get-footnotes">1. Get footnotes</h2>
<p>The sample Google Document is as follows.</p>
<p><img src="https://tanaikech.github.io/image-storage/20231213a/fig2.png" alt=""></p>
<p>The sample script for retrieving those footnotes is as follows. This sample script is required to be in the container-bound script of Google Document.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sample1</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">doc</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">DocumentApp</span>.<span style="color:#a6e22e">getActiveDocument</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">footnotes</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">doc</span>.<span style="color:#a6e22e">getFootnotes</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">footnoteContents</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">footnotes</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">f</span>, <span style="color:#a6e22e">i</span>) =&gt; [
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">i</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">getFootnoteContents</span>().<span style="color:#a6e22e">getText</span>().<span style="color:#a6e22e">trim</span>(),
</span></span><span style="display:flex;"><span>  ]);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">footnoteContents</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When this script is run to the above sample Document, the following result is obtained.</p>
<pre tabindex="0"><code>[
  [1,&#34;sample footnote 1&#34;],
  [2,&#34;sample footnote 2&#34;],
  [3,&#34;sample footnote 3&#34;],
  [4,&#34;sample footnote 4&#34;],
  [5,&#34;sample footnote 5&#34;],
  [6,&#34;sample footnote 6&#34;]
]
</code></pre><p>For example, when you want to move the cursor to the specific footnote in the document body, you can use the following script.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sample2</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">n</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>; <span style="color:#75715e">// Move cursor to the 3rd footnote.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">doc</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">DocumentApp</span>.<span style="color:#a6e22e">getActiveDocument</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">footnotes</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">doc</span>.<span style="color:#a6e22e">getFootnotes</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">pos</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">doc</span>.<span style="color:#a6e22e">newPosition</span>(<span style="color:#a6e22e">footnotes</span>[<span style="color:#a6e22e">n</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>].<span style="color:#a6e22e">getParent</span>(), <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">doc</span>.<span style="color:#a6e22e">setCursor</span>(<span style="color:#a6e22e">pos</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When this script is run to the above sample Document, the cursor is moved to the footnote of <code>3</code>.</p>
<h2 id="2-remove-footnotes">2. Remove footnotes</h2>
<p>The sample script for removing footnotes is as follows.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sample3</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">n</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>; <span style="color:#75715e">// Remove the 3rd footnote.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">doc</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">DocumentApp</span>.<span style="color:#a6e22e">getActiveDocument</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">footnotes</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">doc</span>.<span style="color:#a6e22e">getFootnotes</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">footnotes</span>[<span style="color:#a6e22e">n</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>].<span style="color:#a6e22e">removeFromParent</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When this script is run to the above sample Document, the 3rd footnote is removed.</p>
<h2 id="3-update-footnotes">3. Update footnotes</h2>
<p>The sample script for updating footnotes is as follows.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sample4</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">n</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>; <span style="color:#75715e">// Update the 3rd footnote.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">doc</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">DocumentApp</span>.<span style="color:#a6e22e">getActiveDocument</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">footnotes</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">doc</span>.<span style="color:#a6e22e">getFootnotes</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">footnoteContent</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">footnotes</span>[<span style="color:#a6e22e">n</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>].<span style="color:#a6e22e">getFootnoteContents</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">footnoteContent</span>.<span style="color:#a6e22e">replaceText</span>(<span style="color:#e6db74">&#34;^.*$&#34;</span>, <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;Updated&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When this script is run to the above sample Document, the 3rd footnote is updated from <code>sample footnote 3</code> to <code>Updated</code>.</p>
<p>Here, I used <code>replaceText</code> instead of <code>setText</code> for updating the text to keep the text style. When this script is run, the text &ldquo;Updated&rdquo; is set while keeping the font color. If the text is set with <code>setText</code>, the text style is reset. This technique might be also important.</p>
<h2 id="4-create-footnotes">4. Create footnotes</h2>
<p>In the current stage, unfortunately, the Classes and Methods for creating the footnotes are not prepared in the Document service of Google Apps Script. However, fortunately, when Google Docs API is used, this can be achieved. Here, I would like to introduce a sample script for creating the footnotes to Google Documents using Google Docs API with Google Apps Script.</p>
<p>When you test this script, please enable Google Docs API at Advanced Google services. <a href="https://developers.google.com/apps-script/guides/services/advanced#enable_advanced_services">Ref</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sample5</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">documentId</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>; <span style="color:#75715e">// Please set your Google Document ID. Or, if you are using the container-bound script of Document, you can also use const documentId = DocumentApp.getActiveDocument().getId();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// This is a sample placeholer and replacement data.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;{{footnote1}}&#34;</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;sample footnote 1&#34;</span>, <span style="color:#a6e22e">fontColor</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;#ff0000&#34;</span> },
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;{{footnote2}}&#34;</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;sample footnote 2&#34;</span>, <span style="color:#a6e22e">fontColor</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;#ff9900&#34;</span> },
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;{{footnote3}}&#34;</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;sample footnote 3&#34;</span>, <span style="color:#a6e22e">fontColor</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;#38761d&#34;</span> },
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;{{footnote4}}&#34;</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;sample footnote 4&#34;</span>, <span style="color:#a6e22e">fontColor</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;#3c78d8&#34;</span> },
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;{{footnote5}}&#34;</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;sample footnote 5&#34;</span>, <span style="color:#a6e22e">fontColor</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;#674ea7&#34;</span> },
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;{{footnote6}}&#34;</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;sample footnote 6&#34;</span>, <span style="color:#a6e22e">fontColor</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;#741b47&#34;</span> },
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Create request body.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">para</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">o</span>, <span style="color:#a6e22e">e</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">paragraph</span>.<span style="color:#a6e22e">elements</span>.<span style="color:#a6e22e">forEach</span>((<span style="color:#a6e22e">f</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">textRun</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">m</span> <span style="color:#f92672">=</span> [...<span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">textRun</span>.<span style="color:#a6e22e">content</span>.<span style="color:#a6e22e">matchAll</span>(<span style="color:#a6e22e">r</span>)];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">forEach</span>((<span style="color:#a6e22e">c</span>) =&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">texts</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">c</span>[<span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">requests1</span>.<span style="color:#a6e22e">push</span>(
</span></span><span style="display:flex;"><span>              {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">createFootnote</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">location</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">index</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">startIndex</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">index</span> } },
</span></span><span style="display:flex;"><span>              },
</span></span><span style="display:flex;"><span>              {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">deleteContentRange</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>                  <span style="color:#a6e22e">range</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">startIndex</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">startIndex</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">index</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">endIndex</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">startIndex</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">index</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">c</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">length</span>,
</span></span><span style="display:flex;"><span>                  },
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            );
</span></span><span style="display:flex;"><span>          });
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Retrieve the initial object from Google Document.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">obj1</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Docs</span>.<span style="color:#a6e22e">Documents</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">documentId</span>).<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">content</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Retrieving texts and creating footnotes.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">dataObj</span> <span style="color:#f92672">=</span> Object.<span style="color:#a6e22e">fromEntries</span>(
</span></span><span style="display:flex;"><span>    Object.<span style="color:#a6e22e">entries</span>(<span style="color:#a6e22e">data</span>).<span style="color:#a6e22e">map</span>(([<span style="color:#a6e22e">k</span>, <span style="color:#a6e22e">v</span>]) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">c</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">SpreadsheetApp</span>.<span style="color:#a6e22e">newColor</span>().<span style="color:#a6e22e">setRgbColor</span>(<span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">fontColor</span>).<span style="color:#a6e22e">asRgbColor</span>();
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> [
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">k</span>,
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">text</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">fontColor</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">red</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">getRed</span>() <span style="color:#f92672">/</span> <span style="color:#ae81ff">255</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">green</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">getGreen</span>() <span style="color:#f92672">/</span> <span style="color:#ae81ff">255</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">blue</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">getBlue</span>() <span style="color:#f92672">/</span> <span style="color:#ae81ff">255</span>,
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>      ];
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">keys</span> <span style="color:#f92672">=</span> Object.<span style="color:#a6e22e">keys</span>(<span style="color:#a6e22e">dataObj</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">r</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> RegExp(<span style="color:#a6e22e">keys</span>.<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;|&#34;</span>), <span style="color:#e6db74">&#34;g&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> { <span style="color:#a6e22e">requests1</span>, <span style="color:#a6e22e">texts</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">obj1</span>.<span style="color:#a6e22e">reduce</span>(
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">o</span>, <span style="color:#a6e22e">e</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">paragraph</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">para</span>(<span style="color:#a6e22e">o</span>, <span style="color:#a6e22e">e</span>);
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">table</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">table</span>.<span style="color:#a6e22e">tableRows</span>.<span style="color:#a6e22e">forEach</span>((<span style="color:#a6e22e">row</span>) =&gt; {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">row</span>.<span style="color:#a6e22e">tableCells</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">row</span>.<span style="color:#a6e22e">tableCells</span>.<span style="color:#a6e22e">forEach</span>((<span style="color:#a6e22e">col</span>) =&gt; {
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">col</span>.<span style="color:#a6e22e">content</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">col</span>.<span style="color:#a6e22e">content</span>.<span style="color:#a6e22e">forEach</span>((<span style="color:#a6e22e">co</span>) =&gt; {
</span></span><span style="display:flex;"><span>                  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">co</span>.<span style="color:#a6e22e">paragraph</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">para</span>(<span style="color:#a6e22e">o</span>, <span style="color:#a6e22e">co</span>);
</span></span><span style="display:flex;"><span>                  }
</span></span><span style="display:flex;"><span>                });
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            });
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">o</span>;
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    { <span style="color:#a6e22e">requests1</span><span style="color:#f92672">:</span> [], <span style="color:#a6e22e">texts</span><span style="color:#f92672">:</span> [] }
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">putTexts</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">texts</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">t</span>) =&gt; <span style="color:#a6e22e">dataObj</span>[<span style="color:#a6e22e">t</span>].<span style="color:#a6e22e">text</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">replies</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">Docs</span>.<span style="color:#a6e22e">Documents</span>.<span style="color:#a6e22e">batchUpdate</span>(
</span></span><span style="display:flex;"><span>    { <span style="color:#a6e22e">requests</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">requests1</span>.<span style="color:#a6e22e">reverse</span>() },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">documentId</span>
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">footnoteIds</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">replies</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">reduce</span>((<span style="color:#a6e22e">ar</span>, <span style="color:#a6e22e">e</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">e</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">createFootnote</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">createFootnote</span>.<span style="color:#a6e22e">footnoteId</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">ar</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">createFootnote</span>.<span style="color:#a6e22e">footnoteId</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">ar</span>;
</span></span><span style="display:flex;"><span>    }, [])
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">reverse</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Retrieve the object after footnotes were created.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">footnotes</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">Docs</span>.<span style="color:#a6e22e">Documents</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">documentId</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Inserting texts to footnotes.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">requests2</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">footnoteIds</span>.<span style="color:#a6e22e">reduce</span>((<span style="color:#a6e22e">ar</span>, <span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">i</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">o</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">footnotes</span>[<span style="color:#a6e22e">id</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">o</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">ar</span>.<span style="color:#a6e22e">push</span>(
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">insertText</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">location</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">segmentId</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">index</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">content</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">endIndex</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">putTexts</span>[<span style="color:#a6e22e">i</span>],
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">updateTextStyle</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">range</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">segmentId</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">id</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">startIndex</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">content</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">endIndex</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">endIndex</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">putTexts</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">length</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">textStyle</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">foregroundColor</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">rgbColor</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">dataObj</span>[<span style="color:#a6e22e">texts</span>[<span style="color:#a6e22e">i</span>]].<span style="color:#a6e22e">fontColor</span> },
</span></span><span style="display:flex;"><span>              },
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">fields</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;foregroundColor&#34;</span>,
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      );
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">ar</span>;
</span></span><span style="display:flex;"><span>  }, []);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Docs</span>.<span style="color:#a6e22e">Documents</span>.<span style="color:#a6e22e">batchUpdate</span>({ <span style="color:#a6e22e">requests</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">requests2</span> }, <span style="color:#a6e22e">documentId</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When this script is run, the following result is obtained.</p>
<p><img src="https://tanaikech.github.io/image-storage/20231213a/fig3.png" alt=""></p>
<p>In this sample script, using <code>data</code>, <code>{{footnote1}}</code> of a placeholder is set as a footnote, and a value of <code>sample footnote 1</code> is used as a footnote content, and also, the font color of the footnote content is changed to <code>#ff0000</code>. Other keys are also the same way.</p>
<p>By the way, in this sample, in order to convert the hex value of the color code to each value of RGB, the Spreadsheet service is used.</p>

  
  <h4><i class="fas fa-share-alt" aria-hidden="true"></i>&nbsp;Share!</h4>
<ul class="share-buttons">
	<li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftanaikech.github.io%2f2023%2f12%2f13%2fmanaging-footnotes-on-google-documents-using-google-apps-script%2f" target="_blank" title="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span class="sr-only">Share on Facebook</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://twitter.com/intent/tweet?source=https%3a%2f%2ftanaikech.github.io%2f2023%2f12%2f13%2fmanaging-footnotes-on-google-documents-using-google-apps-script%2f" target="_blank" title="Tweet"><i class="fab fa-twitter" aria-hidden="true"></i><span class="sr-only">Tweet</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://plus.google.com/share?url=https%3a%2f%2ftanaikech.github.io%2f2023%2f12%2f13%2fmanaging-footnotes-on-google-documents-using-google-apps-script%2f" target="_blank" title="Share on Google+"><i class="fab fa-google-plus" aria-hidden="true"></i><span class="sr-only">Share on Google+</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.tumblr.com/share?v=3&u=https%3a%2f%2ftanaikech.github.io%2f2023%2f12%2f13%2fmanaging-footnotes-on-google-documents-using-google-apps-script%2f" target="_blank" title="Post to Tumblr"><i class="fab fa-tumblr" aria-hidden="true"></i><span class="sr-only">Post to Tumblr</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2ftanaikech.github.io%2f2023%2f12%2f13%2fmanaging-footnotes-on-google-documents-using-google-apps-script%2f" target="_blank" title="Pin it"><i class="fab fa-pinterest-p" aria-hidden="true"></i><span class="sr-only">Pin it</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.reddit.com/submit?url=https%3a%2f%2ftanaikech.github.io%2f2023%2f12%2f13%2fmanaging-footnotes-on-google-documents-using-google-apps-script%2f" target="_blank" title="Submit to Reddit"><i class="fab fa-reddit-alien" aria-hidden="true"></i><span class="sr-only">Submit to Reddit</span></a>
	</li>
</ul>


<style>
	ul.share-buttons{
	  list-style: none;
	  padding: 0;
	}

	ul.share-buttons li{
	  display: inline;
	}

	ul.share-buttons .sr-only{
	  position: absolute;
	  clip: rect(1px 1px 1px 1px);
	  clip: rect(1px, 1px, 1px, 1px);
	  padding: 0;
	  border: 0;
	  height: 1px;
	  width: 1px;
	  overflow: hidden;
	}
</style>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://tanaikech.github.io/2023/11/28/technique-for-managing-rich-text-on-google-spreadsheet-using-google-apps-script/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://tanaikech.github.io/2023/11/28/technique-for-managing-rich-text-on-google-spreadsheet-using-google-apps-script/">Technique for Managing Rich Text on Google Spreadsheet using Google Apps Script</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
  </div>
</div>


  
  
  
  

  

</div>

</div>
</div>
<script src="https://tanaikech.github.io/js/ui.js"></script>
<script src="https://tanaikech.github.io/js/menus.js"></script>






<script async src="https://www.googletagmanager.com/gtag/js?id=G-J3Z6T50WL5"></script>
<script>
  
  if (window.location.hostname != "localhost") {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-J3Z6T50WL5');
  }
</script>






<script src="https://tanaikech.github.io/js/math-code.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  


</body>
</html>

