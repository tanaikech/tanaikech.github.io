<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <meta name="google-site-verification" content="1BvDMY90ui0jRLHkrpqdQ_x62h5VNEMuK6mQsDvVQH0" />

  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.98.0" />

  <title>Retrieve Comments with Emoji Reactions from Google Documents, Google Slides, and Google Spreadsheets using Google Apps Script &middot; tanaike</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://tanaikech.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">

  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet" type="text/css">

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css">
  <script async src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://tanaikech.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://tanaikech.github.io/">TANAIKE</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/topics/"><i class='fa fa-folder fa-fw'></i>Topics</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/link/"><i class='fa fa-thumbs-up fa-fw'></i>Links</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/webapps/"><i class='fas fa-toolbox'></i>Web Applications</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/donate/"><i class='fas fa-donate'></i>Donate</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/tanaikech" rel="me" target="_blank"><i class="fa-brands fa-x-twitter"></i>X</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://medium.com/@tanaike" rel="me" target="_blank"><i class="fab fa-medium fa-fw"></i>Medium</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/tanaikech" rel="me" target="_blank"><i class="fab fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://gist.github.com/tanaikech" rel="me" target="_blank"><i class="fas fa-code fa-fw"></i>Gists</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/7108653" rel="me" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://zenn.dev/tanaike" rel="me" target="_blank"><i class="fas fa-edit fa-fw"></i>Zenn</a>
    </li>
    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2017. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Retrieve Comments with Emoji Reactions from Google Documents, Google Slides, and Google Spreadsheets using Google Apps Script</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>26 Oct 2023, 15:44</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/gastips">GasTips</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/spreadsheet">spreadsheet</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/document">document</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/slides">slides</a>
    
  </div>
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/google-apps-script">Google Apps Script</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/spreadsheet">spreadsheet</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/document">document</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/slides">slides</a>
    
  </div>
  
  

</div>

  <p><a href="https://gist.github.com/tanaikech/7713944094af5643fcf13b8d362d0c68">Gists</a></p>
<p><img src="https://tanaikech.github.io/image-storage/20231026a/fig1.png" alt=""></p>
<h2 id="abstract">Abstract</h2>
<p>This report introduces the method for retrieving the Emoji reactions from the comments in Google Docs files (Google Documents, Google Slides, and Google Spreadsheets) using Google Apps Script.</p>
<h2 id="introduction">Introduction</h2>
<p>Recently, the Emoji reactions have been implemented in the comments on Google Docs files (Google Documents, Google Slides, and Google Spreadsheets). <a href="https://workspaceupdates.googleblog.com/2023/10/release-notes-10-06-2023.html">Ref</a> With this implementation, the collaborative work has been higher. Here, it is considered that when the Emoji reactions can be retrieved from the Google Docs files, the statistics of the reactions will be also more useful for increasing collaboration. This report introduces a sample script for retrieving Comments including the Emoji reactions from Google Docs files.</p>
<h2 id="principle">Principle</h2>
<p>Unfortunately, in the current stage, even when <a href="https://developers.google.com/drive/api/reference/rest/v3/comments/list">&ldquo;Method: comments.list&rdquo; of Drive API</a> is used, the Emoji reactions cannot be retrieved while the comments can be retrieved. But, as a workaround, it was found that when the following process is used, the comments including the Emoji reactions can be retrieved.</p>
<ol>
<li>Convert Google Docs files (Google Documents, Google Slides, and Google Spreadsheets) to Microsoft Docs (Microsoft Word, Microsoft PowerPoint, and Microsoft Excel).</li>
<li>Convert Microsoft Docs (Microsoft Word, Microsoft PowerPoint, and Microsoft Excel) to Google Docs files (Google Documents, Google Slides, and Google Spreadsheets)</li>
</ol>
<p>By this process, the comments including the Emoji reactions can be retrieved by a script. After the next section, the sample scripts of Google Apps Script for this process are introduced.</p>
<h2 id="google-document">Google Document</h2>
<h3 id="sample-document">Sample Document</h3>
<p>The sample Document is as follows.</p>
<p><img src="https://tanaikech.github.io/image-storage/20231026a/fig2.png" alt=""></p>
<h3 id="sample-script">Sample script</h3>
<p>Please copy and paste the following script to the script editor. And, please enable Drive API at Advanced Google services.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sample1</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">docId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">DocumentApp</span>.<span style="color:#a6e22e">getActiveDocument</span>().<span style="color:#a6e22e">getId</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`https://docs.google.com/feeds/download/documents/export/Export?exportFormat=docx&amp;id=</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">docId</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">blob</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">url</span>, {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">authorization</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Bearer &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">ScriptApp</span>.<span style="color:#a6e22e">getOAuthToken</span>() },
</span></span><span style="display:flex;"><span>  }).<span style="color:#a6e22e">getBlob</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">id</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">Drive</span>.<span style="color:#a6e22e">Files</span>.<span style="color:#a6e22e">insert</span>(
</span></span><span style="display:flex;"><span>    { <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;temp&#34;</span>, <span style="color:#a6e22e">mimeType</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">MimeType</span>.<span style="color:#a6e22e">GOOGLE_DOCS</span> },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">blob</span>
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">items</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">Drive</span>.<span style="color:#a6e22e">Comments</span>.<span style="color:#a6e22e">list</span>(<span style="color:#a6e22e">id</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Drive</span>.<span style="color:#a6e22e">Files</span>.<span style="color:#a6e22e">remove</span>(<span style="color:#a6e22e">id</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">items</span>.<span style="color:#a6e22e">map</span>(({ <span style="color:#a6e22e">content</span>, <span style="color:#a6e22e">replies</span> }) =&gt; ({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">content</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">replies</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">replies</span>.<span style="color:#a6e22e">map</span>(({ <span style="color:#a6e22e">content</span>, <span style="color:#a6e22e">author</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">displayName</span> } }) =&gt; [
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">displayName</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">content</span>,
</span></span><span style="display:flex;"><span>    ]),
</span></span><span style="display:flex;"><span>  }));
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="result">Result</h3>
<p>When this script is run to the above sample Document, the following result is obtained.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;content&#34;</span>: <span style="color:#e6db74">&#34;sample comment 1\n1 total reaction\nKanshi Tanaike reacted with üëç at 2023-10-25 22:16 PM&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;replies&#34;</span>: [
</span></span><span style="display:flex;"><span>      [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Kanshi Tanaike&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sample comment 2\n2 total reactions\nKanshi Tanaike reacted with üëè at 2023-10-25 22:16 PM\nKanshi Tanaike reacted with üòÄ at 2023-10-25 23:12 PM&#34;</span>
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>When <code>console.log(res[0].content)</code> and <code>console.log(res[0].replies[0][1])</code> are run, the following results are obtained, respectively.</p>
<pre tabindex="0"><code>sample comment 1
1 total reaction
Kanshi Tanaike reacted with üëç at 2023-10-25 22:16 PM
</code></pre><pre tabindex="0"><code>sample comment 2
2 total reactions
Kanshi Tanaike reacted with üëè at 2023-10-25 22:16 PM
Kanshi Tanaike reacted with üòÄ at 2023-10-25 23:12 PM
</code></pre><p>From these values, you can create the statistics of the Emoji reactions for each comment.</p>
<h2 id="google-slide">Google Slide</h2>
<h3 id="sample-slide">Sample Slide</h3>
<p>The sample Slide is as follows.</p>
<p><img src="https://tanaikech.github.io/image-storage/20231026a/fig3.png" alt=""></p>
<h3 id="sample-script-1">Sample script</h3>
<p>Please copy and paste the following script to the script editor. And, please enable Drive API at Advanced Google services.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sample2</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">SlidesApp</span>.<span style="color:#a6e22e">getActivePresentation</span>().<span style="color:#a6e22e">getId</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`https://docs.google.com/feeds/download/presentations/Export?exportFormat=pptx&amp;id=</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">sId</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">blob</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">url</span>, {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">authorization</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Bearer &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">ScriptApp</span>.<span style="color:#a6e22e">getOAuthToken</span>() },
</span></span><span style="display:flex;"><span>  }).<span style="color:#a6e22e">getBlob</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">id</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">Drive</span>.<span style="color:#a6e22e">Files</span>.<span style="color:#a6e22e">insert</span>(
</span></span><span style="display:flex;"><span>    { <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;temp&#34;</span>, <span style="color:#a6e22e">mimeType</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">MimeType</span>.<span style="color:#a6e22e">GOOGLE_SLIDES</span> },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">blob</span>
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">items</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">Drive</span>.<span style="color:#a6e22e">Comments</span>.<span style="color:#a6e22e">list</span>(<span style="color:#a6e22e">id</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">items</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Drive</span>.<span style="color:#a6e22e">Files</span>.<span style="color:#a6e22e">remove</span>(<span style="color:#a6e22e">id</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">items</span>.<span style="color:#a6e22e">map</span>(({ <span style="color:#a6e22e">content</span>, <span style="color:#a6e22e">replies</span> }) =&gt; ({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">content</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">replies</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">replies</span>.<span style="color:#a6e22e">map</span>(({ <span style="color:#a6e22e">content</span>, <span style="color:#a6e22e">author</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">displayName</span> } }) =&gt; [
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">displayName</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">content</span>,
</span></span><span style="display:flex;"><span>    ]),
</span></span><span style="display:flex;"><span>  }));
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="result-1">Result</h3>
<p>When this script is run to the above sample Slide, the following result is obtained.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;content&#34;</span>: <span style="color:#e6db74">&#34;sample comment 1\n1 total reaction\nKanshi Tanaike reacted with üëç at 2023-10-25 22:15 PM\n-Kanshi Tanaike&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;replies&#34;</span>: []
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;content&#34;</span>: <span style="color:#e6db74">&#34;sample comment 2\n2 total reactions\nKanshi Tanaike reacted with üëè at 2023-10-25 22:15 PM\nKanshi Tanaike reacted with üòÄ at 2023-10-25 23:23 PM\n-Kanshi Tanaike&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;replies&#34;</span>: []
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>When <code>console.log(res[0].content)</code> and <code>console.log(res[1].content)</code> are run, the following results are obtained, respectively.</p>
<pre tabindex="0"><code>sample comment 1
1 total reaction
Kanshi Tanaike reacted with üëç at 2023-10-25 22:15 PM
-Kanshi Tanaike
</code></pre><pre tabindex="0"><code>sample comment 2
2 total reactions
Kanshi Tanaike reacted with üëè at 2023-10-25 22:15 PM
Kanshi Tanaike reacted with üòÄ at 2023-10-25 23:23 PM
-Kanshi Tanaike
</code></pre><p>From these values, you can create the statistics of the Emoji reactions for each comment.</p>
<h2 id="google-spreadsheet">Google Spreadsheet</h2>
<h3 id="sample-spreadsheet">Sample Spreadsheet</h3>
<p>The sample Spreadsheet is as follows.</p>
<p><img src="https://tanaikech.github.io/image-storage/20231026a/fig4.png" alt=""></p>
<h3 id="sample-script-2">Sample script</h3>
<p>Please copy and paste the following script to the script editor. And, please enable Drive API at Advanced Google services.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sample3</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ssId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">SpreadsheetApp</span>.<span style="color:#a6e22e">getActiveSpreadsheet</span>().<span style="color:#a6e22e">getId</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`https://docs.google.com/spreadsheets/export?exportFormat=xlsx&amp;id=</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">ssId</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">blob</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">url</span>, {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">authorization</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Bearer &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">ScriptApp</span>.<span style="color:#a6e22e">getOAuthToken</span>() },
</span></span><span style="display:flex;"><span>  }).<span style="color:#a6e22e">getBlob</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">id</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">Drive</span>.<span style="color:#a6e22e">Files</span>.<span style="color:#a6e22e">insert</span>(
</span></span><span style="display:flex;"><span>    { <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;temp&#34;</span>, <span style="color:#a6e22e">mimeType</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">MimeType</span>.<span style="color:#a6e22e">GOOGLE_SHEETS</span> },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">blob</span>
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">comments</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">SpreadsheetApp</span>.<span style="color:#a6e22e">openById</span>(<span style="color:#a6e22e">id</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">getSheets</span>()[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">getDataRange</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">getNotes</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">r</span>, <span style="color:#a6e22e">i</span>) =&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">j</span>) =&gt; ({ <span style="color:#a6e22e">rowIndex</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">columnIndex</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">j</span>, <span style="color:#a6e22e">comment</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">c</span> }))
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Drive</span>.<span style="color:#a6e22e">Files</span>.<span style="color:#a6e22e">remove</span>(<span style="color:#a6e22e">id</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">comments</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="result-2">Result</h3>
<p>When this script is run to the above sample Spreadsheet, the following result is obtained.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;rowIndex&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;columnIndex&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;comment&#34;</span>: <span style="color:#e6db74">&#34;sample comment 1\n1 total reaction\nKanshi Tanaike reacted with üëç at 2023-10-25 22:39 PM\n\t-Kanshi Tanaike\nsample comment 2\n2 total reactions\nKanshi Tanaike reacted with üëè at 2023-10-25 21:50 PM\nKanshi Tanaike reacted with üòÄ at 2023-10-25 22:39 PM\n\t-Kanshi Tanaike&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>When <code>console.log(comments[0][0].comment)</code> is run, the following result is obtained.</p>
<pre tabindex="0"><code>sample comment 1
1 total reaction
Kanshi Tanaike reacted with üëç at 2023-10-25 22:39 PM
	-Kanshi Tanaike
sample comment 2
2 total reactions
Kanshi Tanaike reacted with üëè at 2023-10-25 21:50 PM
Kanshi Tanaike reacted with üòÄ at 2023-10-25 22:39 PM
	-Kanshi Tanaike
</code></pre><p>From this value, you can create the statistics of the Emoji reactions for each comment.</p>
<h3 id="important">IMPORTANT</h3>
<p>In the current stage, when a Google Spreadsheet including the comments is manually exported as an XLSX file with the browser, the comments are left. But, when a Google Spreadsheet including the comments on the cells is exported as an XLSX file with a script using the above endpoint, it seems that the comments are automatically converted to notes on the cells. I&rsquo;m not sure whether this is the current specification.</p>

  
  <h4><i class="fas fa-share-alt" aria-hidden="true"></i>&nbsp;Share!</h4>
<ul class="share-buttons">
	<li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftanaikech.github.io%2f2023%2f10%2f26%2fretrieve-comments-with-emoji-reactions-from-google-documents-google-slides-and-google-spreadsheets-using-google-apps-script%2f" target="_blank" title="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span class="sr-only">Share on Facebook</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://twitter.com/intent/tweet?source=https%3a%2f%2ftanaikech.github.io%2f2023%2f10%2f26%2fretrieve-comments-with-emoji-reactions-from-google-documents-google-slides-and-google-spreadsheets-using-google-apps-script%2f" target="_blank" title="Tweet"><i class="fab fa-twitter" aria-hidden="true"></i><span class="sr-only">Tweet</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://plus.google.com/share?url=https%3a%2f%2ftanaikech.github.io%2f2023%2f10%2f26%2fretrieve-comments-with-emoji-reactions-from-google-documents-google-slides-and-google-spreadsheets-using-google-apps-script%2f" target="_blank" title="Share on Google+"><i class="fab fa-google-plus" aria-hidden="true"></i><span class="sr-only">Share on Google+</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.tumblr.com/share?v=3&u=https%3a%2f%2ftanaikech.github.io%2f2023%2f10%2f26%2fretrieve-comments-with-emoji-reactions-from-google-documents-google-slides-and-google-spreadsheets-using-google-apps-script%2f" target="_blank" title="Post to Tumblr"><i class="fab fa-tumblr" aria-hidden="true"></i><span class="sr-only">Post to Tumblr</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2ftanaikech.github.io%2f2023%2f10%2f26%2fretrieve-comments-with-emoji-reactions-from-google-documents-google-slides-and-google-spreadsheets-using-google-apps-script%2f" target="_blank" title="Pin it"><i class="fab fa-pinterest-p" aria-hidden="true"></i><span class="sr-only">Pin it</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.reddit.com/submit?url=https%3a%2f%2ftanaikech.github.io%2f2023%2f10%2f26%2fretrieve-comments-with-emoji-reactions-from-google-documents-google-slides-and-google-spreadsheets-using-google-apps-script%2f" target="_blank" title="Submit to Reddit"><i class="fab fa-reddit-alien" aria-hidden="true"></i><span class="sr-only">Submit to Reddit</span></a>
	</li>
</ul>


<style>
	ul.share-buttons{
	  list-style: none;
	  padding: 0;
	}

	ul.share-buttons li{
	  display: inline;
	}

	ul.share-buttons .sr-only{
	  position: absolute;
	  clip: rect(1px 1px 1px 1px);
	  clip: rect(1px, 1px, 1px, 1px);
	  padding: 0;
	  border: 0;
	  height: 1px;
	  width: 1px;
	  overflow: hidden;
	}
</style>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://tanaikech.github.io/2023/10/25/inserting-html-including-javascript-on-web-apps-created-by-google-apps-script/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://tanaikech.github.io/2023/10/25/inserting-html-including-javascript-on-web-apps-created-by-google-apps-script/">Inserting HTML including Javascript on Web Apps Created by Google Apps Script</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://tanaikech.github.io/2023/10/30/workaround-detecting-change-of-importrange-using-onedit-trigger-with-google-apps-script/">Workaround: Detecting Change of IMPORTRANGE using OnEdit trigger with Google Apps Script</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://tanaikech.github.io/2023/10/30/workaround-detecting-change-of-importrange-using-onedit-trigger-with-google-apps-script/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>


  
  
  
  

  

</div>

</div>
</div>
<script src="https://tanaikech.github.io/js/ui.js"></script>
<script src="https://tanaikech.github.io/js/menus.js"></script>






<script async src="https://www.googletagmanager.com/gtag/js?id=G-J3Z6T50WL5"></script>
<script>
  
  if (window.location.hostname != "localhost") {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-J3Z6T50WL5');
  }
</script>






<script src="https://tanaikech.github.io/js/math-code.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  


</body>
</html>

