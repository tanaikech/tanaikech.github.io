<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <meta name="google-site-verification" content="1BvDMY90ui0jRLHkrpqdQ_x62h5VNEMuK6mQsDvVQH0" />

  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.98.0" />

  <title>Management of PDF Metadata using Google Apps Script &middot; tanaike</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://tanaikech.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">

  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet" type="text/css">

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css">
  <script async src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://tanaikech.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://tanaikech.github.io/">TANAIKE</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/topics/"><i class='fa fa-folder fa-fw'></i>Topics</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/link/"><i class='fa fa-thumbs-up fa-fw'></i>Links</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/webapps/"><i class='fas fa-toolbox'></i>Web Applications</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/donate/"><i class='fas fa-donate'></i>Donate</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/tanaikech" rel="me" target="_blank"><i class="fa-brands fa-x-twitter"></i>X</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://medium.com/@tanaike" rel="me" target="_blank"><i class="fab fa-medium fa-fw"></i>Medium</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/tanaikech" rel="me" target="_blank"><i class="fab fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://gist.github.com/tanaikech" rel="me" target="_blank"><i class="fas fa-code fa-fw"></i>Gists</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/7108653" rel="me" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://zenn.dev/tanaike" rel="me" target="_blank"><i class="fas fa-edit fa-fw"></i>Zenn</a>
    </li>
    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2017. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Management of PDF Metadata using Google Apps Script</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>24 Jul 2023, 14:45</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/gastips">GasTips</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/jstips">jstips</a>
    
  </div>
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/google-apps-script">Google Apps Script</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/pdf">PDF</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/javascript">Javascript</a>
    
  </div>
  
  

</div>

  <p><a href="https://gist.github.com/tanaikech/9ee06b508624e252dd0e32efc348a59a">Gists</a></p>
<p><img src="https://tanaikech.github.io/image-storage/20230724b/fig1.png" alt=""></p>
<p>This is a sample script for managing the metadata of PDF data using Google Apps Script.</p>
<p>There might be a case in that you want to retrieve and update the metadata of PDF data using Google Apps Script. In this post, I would like to introduce achieving this.</p>
<h2 id="class-managepdfmetadata">Class ManagePdfMetadata</h2>
<p>This is a Class ManagePdfMetadata. This Class is used for managing the metadata of PDF files using Google Apps Script. And, in this Class, a Javascript library of <a href="https://pdf-lib.js.org/">pdf-lib</a> is used for managing the PDF metadata. This Javascript library is loaded in this Class.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * ### Description
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * This is a Class for managing the metadata of PDF data using Google Apps Script.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Author: Tanaike ( https://tanaikech.github.io/ )
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ManagePdfMetadata</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * ### Description
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * Constructor of this class.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @return {void}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">constructor</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">cdnjs</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js&#34;</span>; <span style="color:#75715e">// or &#34;https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">setTimeout</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">loadPdfLib_</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">keys</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;title&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;subject&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;author&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;creator&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;creationDate&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;modificationDate&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;keywords&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;producer&#34;</span>,
</span></span><span style="display:flex;"><span>    ];
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * ### Description
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * Get metadata of the inputted PDF data using pdf-lib.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {Object} blob Blob of PDF data by retrieving with Google Apps Script.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @return {Object} Object including the metadata of the inputted PDF data.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">getPdfMetadata</span>(<span style="color:#a6e22e">blob</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">setTimeout</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">setTimeout</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Promise(<span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">resolve</span>, <span style="color:#a6e22e">reject</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">d</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getPdfDocFromBlob_</span>(<span style="color:#a6e22e">blob</span>).<span style="color:#66d9ef">catch</span>((<span style="color:#a6e22e">err</span>) =&gt;
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">reject</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">metadata</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">keys</span>.<span style="color:#a6e22e">reduce</span>(
</span></span><span style="display:flex;"><span>          (<span style="color:#a6e22e">o</span>, <span style="color:#a6e22e">k</span>) =&gt; (
</span></span><span style="display:flex;"><span>            (<span style="color:#a6e22e">o</span>[<span style="color:#a6e22e">k</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">d</span>[<span style="color:#e6db74">`get</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">k</span>.<span style="color:#a6e22e">charAt</span>(<span style="color:#ae81ff">0</span>).<span style="color:#a6e22e">toUpperCase</span>() <span style="color:#f92672">+</span> <span style="color:#a6e22e">k</span>.<span style="color:#a6e22e">slice</span>(<span style="color:#ae81ff">1</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>]()), <span style="color:#a6e22e">o</span>
</span></span><span style="display:flex;"><span>          ),
</span></span><span style="display:flex;"><span>          {}
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">resolve</span>(<span style="color:#a6e22e">metadata</span>);
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">e</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">reject</span>(<span style="color:#a6e22e">e</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * ### Description
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * Update metadata of the inputted PDF data using pdf-lib.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {Object} blob Blob of PDF data by retrieving with Google Apps Script.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {Object} object Object for updating PDF metadata.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @return {Object} Blob of the updated PDF data.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">udpatePdfMetadata</span>(<span style="color:#a6e22e">blob</span>, <span style="color:#a6e22e">object</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">object</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;object&#34;</span> <span style="color:#f92672">||</span> Object.<span style="color:#a6e22e">keys</span>(<span style="color:#a6e22e">object</span>).<span style="color:#a6e22e">length</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#34;Please set valid object.&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">setTimeout</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">setTimeout</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Promise(<span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">resolve</span>, <span style="color:#a6e22e">reject</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">d</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getPdfDocFromBlob_</span>(<span style="color:#a6e22e">blob</span>).<span style="color:#66d9ef">catch</span>((<span style="color:#a6e22e">err</span>) =&gt; <span style="color:#a6e22e">reject</span>(<span style="color:#a6e22e">err</span>));
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        Promise.<span style="color:#a6e22e">all</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">keys</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">k</span>) =&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Promise(<span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">r</span>, <span style="color:#a6e22e">rj</span>) =&gt; {
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">object</span>.<span style="color:#a6e22e">hasOwnProperty</span>(<span style="color:#a6e22e">k</span>)) {
</span></span><span style="display:flex;"><span>                  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">f</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`set</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">k</span>.<span style="color:#a6e22e">charAt</span>(<span style="color:#ae81ff">0</span>).<span style="color:#a6e22e">toUpperCase</span>() <span style="color:#f92672">+</span> <span style="color:#a6e22e">k</span>.<span style="color:#a6e22e">slice</span>(<span style="color:#ae81ff">1</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>                  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">k</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;title&#34;</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">d</span>[<span style="color:#a6e22e">f</span>](...<span style="color:#a6e22e">object</span>[<span style="color:#a6e22e">k</span>]);
</span></span><span style="display:flex;"><span>                  } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">d</span>[<span style="color:#a6e22e">f</span>](<span style="color:#a6e22e">object</span>[<span style="color:#a6e22e">k</span>]);
</span></span><span style="display:flex;"><span>                  }
</span></span><span style="display:flex;"><span>                  <span style="color:#a6e22e">r</span>(<span style="color:#e6db74">&#34;Done&#34;</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>              } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">e</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">rj</span>(<span style="color:#a6e22e">e</span>);
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            });
</span></span><span style="display:flex;"><span>          })
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>          .<span style="color:#a6e22e">then</span>(<span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">_</span>) =&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">bytes</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">save</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">newBlob</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">newBlob</span>(
</span></span><span style="display:flex;"><span>              [...<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Int8Array</span>(<span style="color:#a6e22e">bytes</span>)],
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">MimeType</span>.<span style="color:#a6e22e">PDF</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">blob</span>.<span style="color:#a6e22e">getName</span>()
</span></span><span style="display:flex;"><span>            );
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">resolve</span>(<span style="color:#a6e22e">newBlob</span>);
</span></span><span style="display:flex;"><span>          })
</span></span><span style="display:flex;"><span>          .<span style="color:#66d9ef">catch</span>((<span style="color:#a6e22e">err</span>) =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">err</span>));
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">e</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">reject</span>(<span style="color:#a6e22e">e</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * ### Description
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * Load pdf-lib. https://pdf-lib.js.org/docs/api/classes/pdfdocument
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @return {void}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">loadPdfLib_</span>() {
</span></span><span style="display:flex;"><span>    eval(<span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">cdnjs</span>).<span style="color:#a6e22e">getContentText</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">setTimeout</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">f</span>, <span style="color:#a6e22e">t</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">sleep</span>(<span style="color:#a6e22e">t</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">f</span>();
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * ### Description
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * Get PDF document object using pdf-lib.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {Object} blob Blob of PDF data by retrieving with Google Apps Script.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @return {Object} PDF document object using pdf-lib.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">async</span> <span style="color:#a6e22e">getPdfDocFromBlob_</span>(<span style="color:#a6e22e">blob</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">blob</span>.<span style="color:#a6e22e">toString</span>() <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;Blob&#34;</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#34;Please set PDF blob.&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">setTimeout</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">setTimeout</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">await</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">PDFLib</span>.<span style="color:#a6e22e">PDFDocument</span>.<span style="color:#a6e22e">load</span>(<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Uint8Array</span>(<span style="color:#a6e22e">blob</span>.<span style="color:#a6e22e">getBytes</span>()), {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">updateMetadata</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="sample-script-1">Sample script 1</h2>
<p>This sample script retrieves the metadata from a PDF file on Google Drive using Google Apps Script.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getPdfMetadata</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fileId</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>; <span style="color:#75715e">// Please set the file ID of the PDF file on Google Drive.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">blob</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">DriveApp</span>.<span style="color:#a6e22e">getFileById</span>(<span style="color:#a6e22e">fileId</span>).<span style="color:#a6e22e">getBlob</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">MM</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ManagePdfMetadata</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">MM</span>.<span style="color:#a6e22e">getPdfMetadata</span>(<span style="color:#a6e22e">blob</span>).<span style="color:#a6e22e">then</span>((<span style="color:#a6e22e">res</span>) =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When this script is run, the following response is returned.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;###&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;subject&#34;</span>: <span style="color:#e6db74">&#34;###&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;author&#34;</span>: <span style="color:#e6db74">&#34;###&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;creator&#34;</span>: <span style="color:#e6db74">&#34;###&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;creationDate&#34;</span>: <span style="color:#e6db74">&#34;### Date object ###&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;modificationDate&#34;</span>: <span style="color:#e6db74">&#34;### Date object ###&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;keywords&#34;</span>: <span style="color:#e6db74">&#34;### key words ###&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;producer&#34;</span>: <span style="color:#e6db74">&#34;###&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When I tested this script, I noticed that the values of <code>modificationDate</code> and <code>producer</code> might be a bug in pdf-lib. <code>modificationDate</code> returns the execution time. <code>producer</code> always returns <code>pdf-lib (https://github.com/Hopding/pdf-lib)</code>. I guessed that this might be a bug in pdf-lib. And, I would like to believe that this will be resolved in the future update.</p>
<h2 id="sample-script-2">Sample script 2</h2>
<p>In this sample script, the metadata of a PDF file is updated using Google Apps Script.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">udpatePdfMetadata</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fileId</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>; <span style="color:#75715e">// Please set the file ID of the PDF file on Google Drive.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">blob</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">DriveApp</span>.<span style="color:#a6e22e">getFileById</span>(<span style="color:#a6e22e">fileId</span>).<span style="color:#a6e22e">getBlob</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">object</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;sample title&#34;</span>, { <span style="color:#a6e22e">showInWindowTitleBar</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }], <span style="color:#75715e">// This property is an array.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">subject</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;sample subject&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">author</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;sample author&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">creator</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;sample creator&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">creationDate</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> Date(<span style="color:#e6db74">&#34;2023-07-01T00:00:00&#34;</span>), <span style="color:#75715e">// This value is date object.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">modificationDate</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> Date(<span style="color:#e6db74">&#34;2023-07-01T10:00:00&#34;</span>), <span style="color:#75715e">// This value is date object.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">keywords</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;sample keyword 1&#34;</span>, <span style="color:#e6db74">&#34;sample keyword 2&#34;</span>, <span style="color:#e6db74">&#34;sample keyword 3&#34;</span>], <span style="color:#75715e">// This property is an array.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">producer</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;sample producer&#34;</span>,
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">MM</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ManagePdfMetadata</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">MM</span>.<span style="color:#a6e22e">udpatePdfMetadata</span>(<span style="color:#a6e22e">blob</span>, <span style="color:#a6e22e">object</span>).<span style="color:#a6e22e">then</span>((<span style="color:#a6e22e">newBlob</span>) =&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">DriveApp</span>.<span style="color:#a6e22e">createFile</span>(<span style="color:#a6e22e">newBlob</span>)
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>
<p>When this script is run, the metadata of &ldquo;title&rdquo;, &ldquo;subject&rdquo;, &ldquo;author&rdquo;, &ldquo;creator&rdquo;, &ldquo;creationDate&rdquo;, &ldquo;modificationDate&rdquo;, &ldquo;keywords&rdquo;, and &ldquo;producer&rdquo; is updated. And, after the update is finished, a new PDF file is created in the root folder.</p>
</li>
<li>
<p>When you want to overwrite the original PDF data with the updated PDF data, please modify the above script as follows. In this case, please enable Drive API at Advanced Google services.</p>
<ul>
<li>
<p>From</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">MM</span>.<span style="color:#a6e22e">udpatePdfMetadata</span>(<span style="color:#a6e22e">blob</span>, <span style="color:#a6e22e">object</span>).<span style="color:#a6e22e">then</span>((<span style="color:#a6e22e">newBlob</span>) =&gt;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">DriveApp</span>.<span style="color:#a6e22e">createFile</span>(<span style="color:#a6e22e">newBlob</span>)
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div></li>
<li>
<p>To</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">MM</span>.<span style="color:#a6e22e">udpatePdfMetadata</span>(<span style="color:#a6e22e">blob</span>, <span style="color:#a6e22e">object</span>).<span style="color:#a6e22e">then</span>((<span style="color:#a6e22e">newBlob</span>) =&gt;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Drive</span>.<span style="color:#a6e22e">Files</span>.<span style="color:#a6e22e">update</span>({}, <span style="color:#a6e22e">fileId</span>, <span style="color:#a6e22e">newBlob</span>)
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div></li>
</ul>
</li>
<li>
<p>When the metadata is retrieved from the output PDF file updated with this method using <code>getPdfMetadata()</code>, the values of <code>modificationDate</code>, and <code>producer</code> are the execution time and <code>pdf-lib (https://github.com/Hopding/pdf-lib)</code>, respectively. But, when I saw the output PDF file on my browser, I confirmed that the metadata was correctly updated by the giving values.</p>
</li>
<li>
<p>Official document of <code>setTitle</code> is <a href="https://pdf-lib.js.org/docs/api/classes/pdfdocument#settitle">here</a>.</p>
</li>
</ul>
<h2 id="references">References</h2>
<ul>
<li><a href="https://pdf-lib.js.org/">pdf-lib</a></li>
<li><a href="https://pdf-lib.js.org/docs/api/classes/pdfdocument">PDFDocument of pdf-lib</a></li>
<li>I answered this method to <a href="https://stackoverflow.com/q/76739862">this thread on Stackoverflow</a>.</li>
</ul>

  
  <h4><i class="fas fa-share-alt" aria-hidden="true"></i>&nbsp;Share!</h4>
<ul class="share-buttons">
	<li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftanaikech.github.io%2f2023%2f07%2f24%2fmanagement-of-pdf-metadata-using-google-apps-script%2f" target="_blank" title="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span class="sr-only">Share on Facebook</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://twitter.com/intent/tweet?source=https%3a%2f%2ftanaikech.github.io%2f2023%2f07%2f24%2fmanagement-of-pdf-metadata-using-google-apps-script%2f" target="_blank" title="Tweet"><i class="fab fa-twitter" aria-hidden="true"></i><span class="sr-only">Tweet</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://plus.google.com/share?url=https%3a%2f%2ftanaikech.github.io%2f2023%2f07%2f24%2fmanagement-of-pdf-metadata-using-google-apps-script%2f" target="_blank" title="Share on Google+"><i class="fab fa-google-plus" aria-hidden="true"></i><span class="sr-only">Share on Google+</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.tumblr.com/share?v=3&u=https%3a%2f%2ftanaikech.github.io%2f2023%2f07%2f24%2fmanagement-of-pdf-metadata-using-google-apps-script%2f" target="_blank" title="Post to Tumblr"><i class="fab fa-tumblr" aria-hidden="true"></i><span class="sr-only">Post to Tumblr</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2ftanaikech.github.io%2f2023%2f07%2f24%2fmanagement-of-pdf-metadata-using-google-apps-script%2f" target="_blank" title="Pin it"><i class="fab fa-pinterest-p" aria-hidden="true"></i><span class="sr-only">Pin it</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.reddit.com/submit?url=https%3a%2f%2ftanaikech.github.io%2f2023%2f07%2f24%2fmanagement-of-pdf-metadata-using-google-apps-script%2f" target="_blank" title="Submit to Reddit"><i class="fab fa-reddit-alien" aria-hidden="true"></i><span class="sr-only">Submit to Reddit</span></a>
	</li>
</ul>


<style>
	ul.share-buttons{
	  list-style: none;
	  padding: 0;
	}

	ul.share-buttons li{
	  display: inline;
	}

	ul.share-buttons .sr-only{
	  position: absolute;
	  clip: rect(1px 1px 1px 1px);
	  clip: rect(1px, 1px, 1px, 1px);
	  padding: 0;
	  border: 0;
	  height: 1px;
	  width: 1px;
	  overflow: hidden;
	}
</style>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://tanaikech.github.io/2023/07/24/overwrapped-cells-on-google-spreadsheet-using-google-apps-script/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://tanaikech.github.io/2023/07/24/overwrapped-cells-on-google-spreadsheet-using-google-apps-script/">Overwrapped Cells on Google Spreadsheet using Google Apps Script</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://tanaikech.github.io/2023/07/25/understanding-flow-of-request-to-web-apps-created-by-google-apps-script/">Understanding Flow of Request to Web Apps Created by Google Apps Script</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://tanaikech.github.io/2023/07/25/understanding-flow-of-request-to-web-apps-created-by-google-apps-script/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>


  
  
  
  

  

</div>

</div>
</div>
<script src="https://tanaikech.github.io/js/ui.js"></script>
<script src="https://tanaikech.github.io/js/menus.js"></script>






<script async src="https://www.googletagmanager.com/gtag/js?id=G-J3Z6T50WL5"></script>
<script>
  
  if (window.location.hostname != "localhost") {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-J3Z6T50WL5');
  }
</script>






<script src="https://tanaikech.github.io/js/math-code.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  


</body>
</html>

