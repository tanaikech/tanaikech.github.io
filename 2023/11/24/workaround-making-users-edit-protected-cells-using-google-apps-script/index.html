<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <meta name="google-site-verification" content="1BvDMY90ui0jRLHkrpqdQ_x62h5VNEMuK6mQsDvVQH0" />

  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.98.0" />

  <title>Workaround: Making Users Edit Protected Cells using Google Apps Script &middot; tanaike</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://tanaikech.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">

  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet" type="text/css">

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css">
  <script async src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://tanaikech.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://tanaikech.github.io/">TANAIKE</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/topics/"><i class='fa fa-folder fa-fw'></i>Topics</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/link/"><i class='fa fa-thumbs-up fa-fw'></i>Links</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/webapps/"><i class='fas fa-toolbox'></i>Web Applications</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/donate/"><i class='fas fa-donate'></i>Donate</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/tanaikech" rel="me" target="_blank"><i class="fa-brands fa-square-x-twitter"></i>X</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://medium.com/@tanaike" rel="me" target="_blank"><i class="fab fa-medium fa-fw"></i>Medium</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/tanaikech" rel="me" target="_blank"><i class="fab fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://gist.github.com/tanaikech" rel="me" target="_blank"><i class="fas fa-code fa-fw"></i>Gists</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/7108653" rel="me" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://zenn.dev/tanaike" rel="me" target="_blank"><i class="fas fa-edit fa-fw"></i>Zenn</a>
    </li>
    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2017. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Workaround: Making Users Edit Protected Cells using Google Apps Script</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>24 Nov 2023, 09:30</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/report">report</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/gastips">GasTips</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/spreadsheet">spreadsheet</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/workaround">workaround</a>
    
  </div>
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/google-apps-script">Google Apps Script</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/spreadsheet">Spreadsheet</a>
    
  </div>
  
  

</div>

  <p><a href="https://gist.github.com/tanaikech/a36770c4609fdb73ed1b8ed43c0612fd">Gists</a></p>
<h2 id="abstract">Abstract</h2>
<p>One day, you might have a situation where you are required to make users edit the protected cells using Google Apps Script. This report introduces a workaround for achieving this situation. The key factors for achieving this are as follows. 1. Run the script as the owner of Spreadsheet even when the script is run by a user. 2. In order to run the script as the owner, the installable triggers and the Web Apps are used.</p>
<h2 id="introduction">Introduction</h2>
<p>At Google Spreadsheets, the sheets and cells can be protected. By protecting a sheet in a Google Spreadsheet shared with some users, editing the cells in the protected sheet by the users except for the owner of the Spreadsheet can be avoided. Namely, when the users who have no permission to edit the sheet try to edit the cells of the protected sheet, the cells cannot be edited. In this case, even when the users run a script for editing the cells of the protected sheet with a button on the Spreadsheet and/or the custom menu, the user cannot edit the cells using the script. On the other hand, when the owner of the Spreadsheet runs the script, the cells in the protected sheet can be edited by the script. However, there might be a situation in which you who is the owner of Spreadsheet want to make users edit the cells by a script while you don&rsquo;t want to make users manually edit the cells. Also, I sometimes saw questions with the same situation on Stackoverflow. In this report, I would like to introduce a workaround for achieving such a situation.</p>
<h2 id="sample-situation-and-principle">Sample situation and principle</h2>
<p>Here, it introduces a sample situation for explaining this workaround. In order to test this workaround, please do the following flow.</p>
<ol>
<li>Create a new Google Spreadsheet. In this case, you are the owner of Spreadsheet.</li>
<li>Share your Spreadsheet with a user &ldquo;A&rdquo; as an editor.</li>
<li>Protect a sheet by being able to be edited by only the owner while only cell &ldquo;A1&rdquo; is unprotected.</li>
</ol>
<p>This flow can be automatically run by the following sample script. Please copy and paste the following script to the script editor, and set an email address of a sample shared user, and run the function <code>createSampleSpreadsheet</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createSampleSpreadsheet</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sharedUserEmail</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###@gmail.com&#34;</span>; <span style="color:#75715e">// Please set an email address of a sample shared user.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ss</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">SpreadsheetApp</span>.<span style="color:#a6e22e">create</span>(<span style="color:#e6db74">&#34;sampleSpreadsheet&#34;</span>).<span style="color:#a6e22e">addEditor</span>(<span style="color:#a6e22e">sharedUserEmail</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sheet</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ss</span>.<span style="color:#a6e22e">getSheets</span>()[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">setName</span>(<span style="color:#e6db74">&#34;Sheet1&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">a1</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sheet</span>.<span style="color:#a6e22e">getRange</span>(<span style="color:#e6db74">&#34;A1&#34;</span>).<span style="color:#a6e22e">insertCheckboxes</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">p</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sheet</span>.<span style="color:#a6e22e">protect</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">removeEditors</span>(<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">getEditors</span>());
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">canDomainEdit</span>()) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">setDomainEdit</span>(<span style="color:#66d9ef">false</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">setUnprotectedRanges</span>([<span style="color:#a6e22e">a1</span>]);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>After a sample Spreadsheet is created, please log in to the sample shared user and edit cell &ldquo;A1&rdquo; and a cell except for &ldquo;A1&rdquo;. By this, you can confirm that &ldquo;A1&rdquo; can be edited and you cannot edit a cell except for &ldquo;A1&rdquo;. This is a sample Spreadsheet.</p>
<p>As the next step, it tests a simple sample script. Please copy and paste the following script to the script editor of the created Spreadsheet, and save the script, and open Spreadsheet again. By this, <code>onOpen</code> is automatically run, and you can see the created custom menu.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">onOpen</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">SpreadsheetApp</span>.<span style="color:#a6e22e">getUi</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">createMenu</span>(<span style="color:#e6db74">&#34;sample&#34;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">addItem</span>(<span style="color:#e6db74">&#34;Run sample 1&#34;</span>, <span style="color:#e6db74">&#34;sample&#34;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">addToUi</span>();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sample</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">SpreadsheetApp</span>.<span style="color:#a6e22e">getActiveSheet</span>().<span style="color:#a6e22e">appendRow</span>([<span style="color:#66d9ef">new</span> Date()]);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>By the owner of Spreadsheet, please run <code>Run sample 1</code> from the custom menu. By this, you can see the date object is appended to the cell &ldquo;A2&rdquo;.</p>
<p>As the next step, by the shared user of Spreadsheet, please run <code>Run sample 1</code> from the custom menu. By this, you can see an error like <code>Exception: You are trying to edit a protected cell or object. Please contact the spreadsheet owner to remove protection if you need to edit.</code>. Because the script is run by the user who is not the owner of Spreadsheet, and the protected sheet cannot be edited by the users except for the owner of Spreadsheet. The shared user cannot edit the cells except for &ldquo;A1&rdquo;.</p>
<p>Here, when you want to make the shared user edit the cell in the protected sheet, from the above situation, it is found that when the script is run by the owner instead of the shared user, the script will work fine. In order to forcibly execute a function by the owner, it is considered the following 2 patterns.</p>
<p><img src="https://tanaikech.github.io/image-storage/20231124a/fig1.png" alt=""></p>
<p>Fig 1. Schematic illustration for understanding &ldquo;Use installable triggers&rdquo; and &ldquo;Use Web Apps&rdquo; of this workaround.
<!-- raw HTML omitted --></p>
<p>About &ldquo;Use installable triggers&rdquo; in Fig. 1, when the installable trigger is used, the script is run as the owner even when user &ldquo;A&rdquo; fires the trigger. There are several triggers in the installable triggers. <a href="https://developers.google.com/apps-script/guides/triggers/installable">Ref</a> The official document of the installable triggers says <code>Installable triggers always run under the account of the person who created them.</code>. This is the current specification.</p>
<p>About &ldquo;Use Web Apps&rdquo;, when the Web Apps is used, the script is run as the owner even when user &ldquo;A&rdquo; accesses the Web Apps. <a href="https://developers.google.com/apps-script/guides/web">Ref</a></p>
<p>In the next sections, I would like to introduce the sample scripts.</p>
<p><strong>These sample scripts use the above-created sample Spreadsheet.</strong></p>
<h2 id="pattern-1-use-installable-triggers">Pattern 1: Use installable triggers</h2>
<p>In this pattern, in order to make a shared user edit a cell except for &ldquo;A1&rdquo; using a script, the installable trigger is used. In order to test this, please do the following flow.</p>
<h3 id="1-sample-script">1. Sample script</h3>
<p>Please add the following script to the script editor of the Spreadsheet created in the above section. In this script, the function <code>sample()</code> is shown in the above section.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">installedOnEdit</span>(<span style="color:#a6e22e">e</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">range</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">range</span>.<span style="color:#a6e22e">getA1Notation</span>() <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;A1&#34;</span> <span style="color:#f92672">||</span> <span style="color:#f92672">!</span><span style="color:#a6e22e">range</span>.<span style="color:#a6e22e">isChecked</span>()) <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// --- Please put your script here.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">sample</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// ---
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">range</span>.<span style="color:#a6e22e">uncheck</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="2-install-onedit-trigger">2. Install OnEdit trigger</h3>
<p>Please install the OnEdit trigger to the function <code>installedOnEdit</code>. <a href="https://developers.google.com/apps-script/guides/triggers/installable#manage_triggers_manually">Ref</a></p>
<h3 id="3-testing">3. Testing</h3>
<p>When you (the owner of Spreadsheet) check the checkbox of &ldquo;A1&rdquo;, the function <code>installable OnEdit</code> is automatically run by the installable OnEdit trigger. And, the function <code>sample</code> is run. By this, you can see that the date object is appended to column &ldquo;A&rdquo;.</p>
<p>Also, even when the shared user checks the checkbox of &ldquo;A1&rdquo;, the function <code>sample</code> is run by the installable OnEdit trigger. And, you can see that the date object is appended to column &ldquo;A&rdquo;.</p>
<p>Here, the reason that the shared user can edit the protected cell is due to that the function <code>sample</code> is run as the owner of the Spreadsheet by the installable trigger.</p>
<h2 id="pattern-2-use-web-apps">Pattern 2: Use Web Apps</h2>
<p>In this pattern, in order to make a shared user edit a cell except for &ldquo;A1&rdquo; using a script, the Web Apps is used. In order to test this, please do the following flow.</p>
<h3 id="1-deploy-web-apps">1. Deploy Web Apps.</h3>
<p>The detailed information can be seen in <a href="https://developers.google.com/apps-script/guides/web#deploy_a_script_as_a_web_app">the official document</a>.</p>
<p>Please set this using the script editor.</p>
<ol>
<li>On the script editor, at the top right of the script editor, please click &ldquo;click Deploy&rdquo; -&gt; &ldquo;New deployment&rdquo;.</li>
<li>Please click &ldquo;Select type&rdquo; -&gt; &ldquo;Web App&rdquo;.</li>
<li>Please input the information about the Web App in the fields under &ldquo;Deployment configuration&rdquo;.</li>
<li>Please select <strong>&ldquo;Me&rdquo;</strong> for <strong>&ldquo;Execute as&rdquo;</strong>.</li>
<li>Please select <strong>&ldquo;Anyone with Google account&rdquo;</strong> for <strong>&ldquo;Who has access to the app:&rdquo;</strong>.</li>
<li>Please click &ldquo;Deploy&rdquo; button.</li>
<li>On the script editor, at the top right of the script editor, please click &ldquo;click Deploy&rdquo; -&gt; &ldquo;Test deployments&rdquo;.</li>
<li>Copy Web Apps URL. It&rsquo;s like <code>https://script.google.com/macros/s/###/dev</code>. This URL is used with the below sample script.</li>
</ol>
<h3 id="2-sample-script">2. Sample script</h3>
<p>Please add the following script to the script editor of the Spreadsheet created in the above section. And, please set your Web Apps URL to <code>webAppsUrl</code>. In this script, the function <code>sample()</code> is shown in the above section.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">doGet</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">_</span>) =&gt; <span style="color:#a6e22e">runWebApps</span>(<span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">runWebApps</span>(<span style="color:#a6e22e">e</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">e</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">webAppsUrl</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://script.google.com/macros/s/###/dev&#34;</span>; <span style="color:#75715e">// Please set your Web Apps URL.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">webAppsUrl</span>, {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">authorization</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Bearer &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">ScriptApp</span>.<span style="color:#a6e22e">getOAuthToken</span>() },
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// --- Please put your script here.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">sample</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// ---
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ### Please don&#39;t remove the following comment line.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// DriveApp.getFiles(); // This comment line is used for automatically detecting a scope of &#34;https://www.googleapis.com/auth/drive.readonly&#34;. This scope is used for requesting Web Apps.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// ###
</span></span></span></code></pre></div><p>And, please modify <code>onOpen</code> as follows.</p>
<pre tabindex="0"><code class="language-javascriot" data-lang="javascriot">function onOpen() {
  SpreadsheetApp.getUi().createMenu(&#34;sample&#34;)
  .addItem(&#34;Run sample 1&#34;, &#34;sample&#34;)
  .addItem(&#34;Run sample 2&#34;, &#34;runWebApps&#34;)
  .addToUi();
}
</code></pre><p>By this, when the Spreadsheet is reopened, you can see 2 menus in the custom menu.</p>
<h3 id="3-testing-1">3. Testing</h3>
<p>In order to test this script, when you (the owner of Spreadsheet) run &ldquo;Run sample 2&rdquo; in the updated custom menu, you can see that the date object is appended to column &ldquo;A&rdquo;.</p>
<p>Also, when the shared user runs &ldquo;Run sample 2&rdquo; in the updated custom menu, you can see that the date object is appended to column &ldquo;A&rdquo;.</p>
<p>Here, the reason that the shared user can edit the protected cell is due to that the function <code>sample</code> is run as the owner of the Spreadsheet by <code>Execute as:  Me</code> of the Web Apps.</p>
<h2 id="demonstration">Demonstration</h2>
<p>When the above workaround is used, the following result is obtained.</p>
<p><img src="https://tanaikech.github.io/image-storage/20231124a/fig2.gif" alt=""></p>
<p>Fig. 2 Demonstration of this workaround.
<!-- raw HTML omitted --></p>
<p>In this case, the user who is not the owner of Spreadsheet does the test as follows.</p>
<ol>
<li>Confirm that the user cannot edit the cells except for &ldquo;A1&rdquo;.</li>
<li>Run the function <code>sample</code> by &ldquo;Run sample 1&rdquo; of the custom menu. In this case, the user cannot put the value to the cell &ldquo;A2&rdquo; using a script.</li>
<li>Run the function <code>installedOnEdit</code> by clicking the checkbox of &ldquo;A1&rdquo;. In this case, the user can put the value to the cell &ldquo;A2&rdquo; using a script because the script is run as the owner.</li>
<li>Run the function <code>runWebApps</code> by &ldquo;Run sample 2&rdquo; of the custom menu. In this case, the user can put the value to the cell &ldquo;A3&rdquo; using a script because the script is run as the owner.</li>
</ol>
<h2 id="summary">Summary</h2>
<p>In this report, a workaround for making users edit the protected cells using a script was introduced. The key factors for achieving this are as follows.</p>
<ul>
<li>Run the script as the owner of Spreadsheet even when the script is run by a user.</li>
<li>In order to run the script as the owner, the installable triggers and the Web Apps are used.</li>
</ul>
<p>This workaround can be used with the current specification. If the specification is changed in the future update, this workaround might not be able to be used. Please be careful about this. If this report was useful for your situation, I&rsquo;m glad.</p>
<h2 id="appendix">Appendix</h2>
<p>As additional information, when the Web Apps is used as mentioned in the section &ldquo;Pattern 2: Use Web Apps&rdquo;, the email address of each user can be also obtained. The sample script is as follows. In this sample, when <code>runWebApps</code> is run by the user, the email address of the user is obtained and put into the cell.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">doGet</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">e</span>) =&gt; <span style="color:#a6e22e">runWebApps</span>(<span style="color:#a6e22e">e</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">runWebApps</span>(<span style="color:#a6e22e">e</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">e</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">webAppsUrl</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://script.google.com/macros/s/###/dev&#34;</span>; <span style="color:#75715e">// Please set your Web Apps URL.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">webAppsUrl</span><span style="color:#e6db74">}</span><span style="color:#e6db74">?email=</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">Session</span>.<span style="color:#a6e22e">getActiveUser</span>().<span style="color:#a6e22e">getEmail</span>()<span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>,
</span></span><span style="display:flex;"><span>      { <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">authorization</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Bearer &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">ScriptApp</span>.<span style="color:#a6e22e">getOAuthToken</span>() } }
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// --- Please put your script here.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">SpreadsheetApp</span>.<span style="color:#a6e22e">getActiveSheet</span>().<span style="color:#a6e22e">appendRow</span>([<span style="color:#66d9ef">new</span> Date(), <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">parameter</span>.<span style="color:#a6e22e">email</span>]);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// ---
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div>
  
  <h4><i class="fas fa-share-alt" aria-hidden="true"></i>&nbsp;Share!</h4>
<ul class="share-buttons">
	<li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftanaikech.github.io%2f2023%2f11%2f24%2fworkaround-making-users-edit-protected-cells-using-google-apps-script%2f" target="_blank" title="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span class="sr-only">Share on Facebook</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://twitter.com/intent/tweet?source=https%3a%2f%2ftanaikech.github.io%2f2023%2f11%2f24%2fworkaround-making-users-edit-protected-cells-using-google-apps-script%2f" target="_blank" title="Tweet"><i class="fab fa-twitter" aria-hidden="true"></i><span class="sr-only">Tweet</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://plus.google.com/share?url=https%3a%2f%2ftanaikech.github.io%2f2023%2f11%2f24%2fworkaround-making-users-edit-protected-cells-using-google-apps-script%2f" target="_blank" title="Share on Google+"><i class="fab fa-google-plus" aria-hidden="true"></i><span class="sr-only">Share on Google+</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.tumblr.com/share?v=3&u=https%3a%2f%2ftanaikech.github.io%2f2023%2f11%2f24%2fworkaround-making-users-edit-protected-cells-using-google-apps-script%2f" target="_blank" title="Post to Tumblr"><i class="fab fa-tumblr" aria-hidden="true"></i><span class="sr-only">Post to Tumblr</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2ftanaikech.github.io%2f2023%2f11%2f24%2fworkaround-making-users-edit-protected-cells-using-google-apps-script%2f" target="_blank" title="Pin it"><i class="fab fa-pinterest-p" aria-hidden="true"></i><span class="sr-only">Pin it</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.reddit.com/submit?url=https%3a%2f%2ftanaikech.github.io%2f2023%2f11%2f24%2fworkaround-making-users-edit-protected-cells-using-google-apps-script%2f" target="_blank" title="Submit to Reddit"><i class="fab fa-reddit-alien" aria-hidden="true"></i><span class="sr-only">Submit to Reddit</span></a>
	</li>
</ul>


<style>
	ul.share-buttons{
	  list-style: none;
	  padding: 0;
	}

	ul.share-buttons li{
	  display: inline;
	}

	ul.share-buttons .sr-only{
	  position: absolute;
	  clip: rect(1px 1px 1px 1px);
	  clip: rect(1px, 1px, 1px, 1px);
	  padding: 0;
	  border: 0;
	  height: 1px;
	  width: 1px;
	  overflow: hidden;
	}
</style>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://tanaikech.github.io/2023/11/20/technique-of-array-processing-for-custom-functions-on-google-spreadsheet-using-google-apps-script/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://tanaikech.github.io/2023/11/20/technique-of-array-processing-for-custom-functions-on-google-spreadsheet-using-google-apps-script/">Technique of Array Processing for Custom Functions on Google Spreadsheet using Google Apps Script</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://tanaikech.github.io/2023/11/26/updated-gas-library-pdfapp/">Updated: GAS Library - PDFApp</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://tanaikech.github.io/2023/11/26/updated-gas-library-pdfapp/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>


  
  
  
  

  

</div>

</div>
</div>
<script src="https://tanaikech.github.io/js/ui.js"></script>
<script src="https://tanaikech.github.io/js/menus.js"></script>






<script async src="https://www.googletagmanager.com/gtag/js?id=G-J3Z6T50WL5"></script>
<script>
  
  if (window.location.hostname != "localhost") {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-J3Z6T50WL5');
  }
</script>






<script src="https://tanaikech.github.io/js/math-code.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  


</body>
</html>

