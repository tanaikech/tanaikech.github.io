<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <meta name="google-site-verification" content="1BvDMY90ui0jRLHkrpqdQ_x62h5VNEMuK6mQsDvVQH0" />

  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.98.0" />

  <title>Technique for Processing Google Spreadsheet Including Merged Cells using Google Apps Script &middot; tanaike</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://tanaikech.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">

  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet" type="text/css">

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css">
  <script async src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://tanaikech.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://tanaikech.github.io/">TANAIKE</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/topics/"><i class='fa fa-folder fa-fw'></i>Topics</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/link/"><i class='fa fa-thumbs-up fa-fw'></i>Links</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/webapps/"><i class='fas fa-toolbox'></i>Web Applications</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/donate/"><i class='fas fa-donate'></i>Donate</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/tanaikech" rel="me" target="_blank"><i class="fab fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/tanaikech" rel="me" target="_blank"><i class="fab fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/7108653" rel="me" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2017. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Technique for Processing Google Spreadsheet Including Merged Cells using Google Apps Script</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>13 Nov 2023, 09:04</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/report">report</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/gastips">GasTips</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/spreadsheet">spreadsheet</a>
    
  </div>
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/google-apps-script">Google Apps Script</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/spreadsheet">spreadsheet</a>
    
  </div>
  
  

</div>

  <p><a href="https://gist.github.com/tanaikech/a03b0bb4218a19b41d507a5b649e3802">Gists</a></p>
<h2 id="description">Description</h2>
<p>At Google Spreadsheet, the cells can be merged as one cell. But, when the Spreadsheet including the merged cells is used with Google Apps Script, the script becomes a bit complicated. Also, I sometimes find some questions like this situation on Stackoverflow. In this report, I would like to introduce a technique for easily using the Spreadsheet including the merged cells with Google Apps Script.</p>
<h2 id="principle">Principle</h2>
<p>Before it introduces the sample scripts, I would like to introduce the principle for using the Spreadsheet for the merged cells. You can understand the principle of this method from the following sample input and output images.</p>
<p><img src="https://tanaikech.github.io/image-storage/20231113a/fig1.png" alt="">
Fig 1. Sample input situation.</p>
<p><img src="https://tanaikech.github.io/image-storage/20231113a/fig2.png" alt="">
Fig 2. Sample output situation.</p>
<p>About the above sample input situation in Fig. 1, when cells &ldquo;B2:D9&rdquo; are merged, the output situation is in Fig. 2. From these images, it is found that when the cells are merged, the top left value and style are kept and those are used in the merged cell. And, even when the merged cell of &ldquo;B2:D9&rdquo; is unmerged, the values of C2 to D9 are not recovered and the background color of all cells &ldquo;B2:D9&rdquo; is the same as that of the merged cell. Namely, it is found that when there has already been a merged cell, the cell value of the merged cell is the same as the cell value of the top left cell. In this report, this situation is used.</p>
<h2 id="sample-1">Sample 1</h2>
<p>The sample situation is shown in Fig. 3. In this case, a range of &ldquo;Sheet1!A1:D8&rdquo; including merged cells is expanded at &ldquo;Sheet2!A1:D8&rdquo;.</p>
<p><img src="https://tanaikech.github.io/image-storage/20231113a/fig3.png" alt="">
Fig 3. Sample input and output situations.</p>
<p>The sample script is as follows.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sample1</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">srcSheetName</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Sheet1&#34;</span>; <span style="color:#75715e">// Please set your source sheet name.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">dstSheetName</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Sheet2&#34;</span>; <span style="color:#75715e">// Please set your destination sheet name.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Retrieve current values and backgrounds from the merged cells.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ss</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">SpreadsheetApp</span>.<span style="color:#a6e22e">getActiveSpreadsheet</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">srcRange</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ss</span>.<span style="color:#a6e22e">getSheetByName</span>(<span style="color:#a6e22e">srcSheetName</span>).<span style="color:#a6e22e">getDataRange</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">values</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">srcRange</span>.<span style="color:#a6e22e">getValues</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">backgrounds</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">srcRange</span>.<span style="color:#a6e22e">getBackgrounds</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Expanding values and backgrounds.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">srcRange</span>.<span style="color:#a6e22e">getMergedRanges</span>().<span style="color:#a6e22e">forEach</span>((<span style="color:#a6e22e">r</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">startRow</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">getRow</span>() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">endRow</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">startRow</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">getNumRows</span>() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">startCol</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">getColumn</span>() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">endCol</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">startCol</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">getNumColumns</span>() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">values</span>[<span style="color:#a6e22e">startRow</span>][<span style="color:#a6e22e">startCol</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">b</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">backgrounds</span>[<span style="color:#a6e22e">startRow</span>][<span style="color:#a6e22e">startCol</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">r</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">startRow</span>; <span style="color:#a6e22e">r</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">endRow</span>; <span style="color:#a6e22e">r</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">c</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">startCol</span>; <span style="color:#a6e22e">c</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">endCol</span>; <span style="color:#a6e22e">c</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">values</span>[<span style="color:#a6e22e">r</span>][<span style="color:#a6e22e">c</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">v</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">backgrounds</span>[<span style="color:#a6e22e">r</span>][<span style="color:#a6e22e">c</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">b</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Put expanded values and backgrounds into destination sheet.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">dstRange</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ss</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">getSheetByName</span>(<span style="color:#a6e22e">dstSheetName</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">getRange</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">values</span>.<span style="color:#a6e22e">length</span>, <span style="color:#a6e22e">values</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">length</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">dstRange</span>.<span style="color:#a6e22e">setValues</span>(<span style="color:#a6e22e">values</span>).<span style="color:#a6e22e">setBackgrounds</span>(<span style="color:#a6e22e">backgrounds</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>In this script, the cells are not unmerged on the Spreadsheet. The cell values and cell backgrounds are unmerged in the script. The merged cells are expanded in an array. And, the result values and backgrounds are put into the destination sheet &ldquo;Sheet2&rdquo;.</p>
<p>When the values of <code>values</code> and <code>backgrounds</code> before the loop of <code>srcRange.getMergedRanges().forEach(r =&gt; {,,,}</code>, those are as follows.</p>
<pre tabindex="0"><code>[
  [&#34;A&#34;,&#34;&#34;,&#34;B&#34;,&#34;G&#34;],
  [&#34;&#34;,&#34;&#34;,&#34;E&#34;,&#34;&#34;],
  [&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;],
  [&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;],
  [&#34;C&#34;,&#34;D&#34;,&#34;&#34;,&#34;&#34;],
  [&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;],
  [&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;],
  [&#34;F&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;]
]
</code></pre><pre tabindex="0"><code>[
  [&#34;#e6b8af&#34;,&#34;#ffffff&#34;,&#34;#f4cccc&#34;,&#34;#d9d2e9&#34;],
  [&#34;#ffffff&#34;,&#34;#ffffff&#34;,&#34;#d9ead3&#34;,&#34;#ffffff&#34;],
  [&#34;#ffffff&#34;,&#34;#ffffff&#34;,&#34;#ffffff&#34;,&#34;#ffffff&#34;],
  [&#34;#ffffff&#34;,&#34;#ffffff&#34;,&#34;#ffffff&#34;,&#34;#ffffff&#34;],
  [&#34;#fce5cd&#34;,&#34;#fff2cc&#34;,&#34;#ffffff&#34;,&#34;#ffffff&#34;],
  [&#34;#ffffff&#34;,&#34;#ffffff&#34;,&#34;#ffffff&#34;,&#34;#ffffff&#34;],
  [&#34;#ffffff&#34;,&#34;#ffffff&#34;,&#34;#ffffff&#34;,&#34;#ffffff&#34;],
  [&#34;#c9daf8&#34;,&#34;#ffffff&#34;,&#34;#ffffff&#34;,&#34;#ffffff&#34;]
]
</code></pre><p>When the values of <code>values</code> and <code>backgrounds</code> after the loop of <code>srcRange.getMergedRanges().forEach(r =&gt; {,,,}</code>, those are as follows.</p>
<pre tabindex="0"><code>[
  [&#34;A&#34;,&#34;A&#34;,&#34;B&#34;,&#34;G&#34;],
  [&#34;A&#34;,&#34;A&#34;,&#34;E&#34;,&#34;G&#34;],
  [&#34;A&#34;,&#34;A&#34;,&#34;E&#34;,&#34;G&#34;],
  [&#34;A&#34;,&#34;A&#34;,&#34;E&#34;,&#34;G&#34;],
  [&#34;C&#34;,&#34;D&#34;,&#34;E&#34;,&#34;G&#34;],
  [&#34;C&#34;,&#34;D&#34;,&#34;E&#34;,&#34;G&#34;],
  [&#34;C&#34;,&#34;D&#34;,&#34;E&#34;,&#34;G&#34;],
  [&#34;F&#34;,&#34;F&#34;,&#34;F&#34;,&#34;G&#34;]
]
</code></pre><pre tabindex="0"><code>[
  [&#34;#e6b8af&#34;,&#34;#e6b8af&#34;,&#34;#f4cccc&#34;,&#34;#d9d2e9&#34;],
  [&#34;#e6b8af&#34;,&#34;#e6b8af&#34;,&#34;#d9ead3&#34;,&#34;#d9d2e9&#34;],
  [&#34;#e6b8af&#34;,&#34;#e6b8af&#34;,&#34;#d9ead3&#34;,&#34;#d9d2e9&#34;],
  [&#34;#e6b8af&#34;,&#34;#e6b8af&#34;,&#34;#d9ead3&#34;,&#34;#d9d2e9&#34;],
  [&#34;#fce5cd&#34;,&#34;#fff2cc&#34;,&#34;#d9ead3&#34;,&#34;#d9d2e9&#34;],
  [&#34;#fce5cd&#34;,&#34;#fff2cc&#34;,&#34;#d9ead3&#34;,&#34;#d9d2e9&#34;],
  [&#34;#fce5cd&#34;,&#34;#fff2cc&#34;,&#34;#d9ead3&#34;,&#34;#d9d2e9&#34;],
  [&#34;#c9daf8&#34;,&#34;#c9daf8&#34;,&#34;#c9daf8&#34;,&#34;#d9d2e9&#34;]
]
</code></pre><p>You can see the expanded values in the array. I think that this method will be useful in a situation where the individual cells of the merged cell are required to be used.</p>
<h2 id="sample-2">Sample 2</h2>
<p>The sample situation is shown in Fig. 4. In this sample, the total values and the background colors are retrieved as the keys of columns &ldquo;header1&rdquo; and &ldquo;header3&rdquo;. For example, in the case of &ldquo;sample1&rdquo; of &ldquo;header1&rdquo;, <code>{&quot;key&quot;:&quot;sample1&quot;,&quot;value&quot;:34,&quot;background&quot;:&quot;#85200c&quot;}</code> is the expected result.</p>
<p><img src="https://tanaikech.github.io/image-storage/20231113a/fig4.png" alt="">
Fig 4. Sample input situation.</p>
<p>The sample script for achieving this goal is as follows.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sample2</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sheetName</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Sheet1&#34;</span>; <span style="color:#75715e">// Please set your sheet name.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sheet</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">SpreadsheetApp</span>.<span style="color:#a6e22e">getActiveSpreadsheet</span>().<span style="color:#a6e22e">getSheetByName</span>(<span style="color:#a6e22e">sheetName</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">srcRange</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sheet</span>.<span style="color:#a6e22e">getRange</span>(<span style="color:#e6db74">&#34;B3:E&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">sheet</span>.<span style="color:#a6e22e">getLastRow</span>());
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">offsetR</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">srcRange</span>.<span style="color:#a6e22e">getRow</span>() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">offsetC</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">srcRange</span>.<span style="color:#a6e22e">getColumn</span>() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">values</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">srcRange</span>.<span style="color:#a6e22e">getValues</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">backgrounds</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">srcRange</span>.<span style="color:#a6e22e">getBackgrounds</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">srcRange</span>.<span style="color:#a6e22e">getMergedRanges</span>().<span style="color:#a6e22e">forEach</span>((<span style="color:#a6e22e">r</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">startRow</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">getRow</span>() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">offsetR</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">endRow</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">startRow</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">getNumRows</span>() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">startCol</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">getColumn</span>() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">offsetC</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">endCol</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">startCol</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">getNumColumns</span>() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">values</span>[<span style="color:#a6e22e">startRow</span>][<span style="color:#a6e22e">startCol</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">b</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">backgrounds</span>[<span style="color:#a6e22e">startRow</span>][<span style="color:#a6e22e">startCol</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">r</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">startRow</span>; <span style="color:#a6e22e">r</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">endRow</span>; <span style="color:#a6e22e">r</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">c</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">startCol</span>; <span style="color:#a6e22e">c</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">endCol</span>; <span style="color:#a6e22e">c</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">values</span>[<span style="color:#a6e22e">r</span>][<span style="color:#a6e22e">c</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">v</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">backgrounds</span>[<span style="color:#a6e22e">r</span>][<span style="color:#a6e22e">c</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">b</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    ...<span style="color:#a6e22e">values</span>
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">reduce</span>((<span style="color:#a6e22e">m</span>, <span style="color:#a6e22e">r</span>, <span style="color:#a6e22e">i</span>) =&gt; {
</span></span><span style="display:flex;"><span>        [
</span></span><span style="display:flex;"><span>          [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>          [<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>],
</span></span><span style="display:flex;"><span>        ].<span style="color:#a6e22e">forEach</span>(([<span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span>]) =&gt; {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">key</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">r</span>[<span style="color:#a6e22e">a</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">_</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">backgrounds</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">a</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">set</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">key</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">has</span>(<span style="color:#a6e22e">key</span>)
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">?</span> { ...<span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">key</span>), <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">key</span>).<span style="color:#a6e22e">value</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">r</span>[<span style="color:#a6e22e">b</span>] }
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">:</span> { <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">r</span>[<span style="color:#a6e22e">a</span>], <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">r</span>[<span style="color:#a6e22e">b</span>], <span style="color:#a6e22e">background</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">backgrounds</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">a</span>] }
</span></span><span style="display:flex;"><span>          );
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">m</span>;
</span></span><span style="display:flex;"><span>      }, <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Map</span>())
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">values</span>(),
</span></span><span style="display:flex;"><span>  ];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>In this case, the data range is not used. Instead of the data range, <code>const srcRange = sheet.getRange(&quot;B3:E&quot; + sheet.getLastRow());</code> is used as the range. In this case, the offset is required to be reflected in the array coordinates using <code>offsetR</code> and <code>offsetC</code>. Please be careful about this.</p>
<p>When this script is run with the situation of Fig. 4, the following result is obtained.</p>
<pre tabindex="0"><code>[
  {&#34;key&#34;:&#34;sample1&#34;,&#34;value&#34;:34,&#34;background&#34;:&#34;#85200c&#34;},
  {&#34;key&#34;:&#34;sample1&#34;,&#34;value&#34;:8,&#34;background&#34;:&#34;#f4cccc&#34;},
  {&#34;key&#34;:&#34;sample2&#34;,&#34;value&#34;:12,&#34;background&#34;:&#34;#d9ead3&#34;},
  {&#34;key&#34;:&#34;sample3&#34;,&#34;value&#34;:10,&#34;background&#34;:&#34;#c9daf8&#34;},
  {&#34;key&#34;:&#34;sample2&#34;,&#34;value&#34;:22,&#34;background&#34;:&#34;#38761d&#34;},
  {&#34;key&#34;:&#34;sample3&#34;,&#34;value&#34;:15,&#34;background&#34;:&#34;#1155cc&#34;}
]
</code></pre><p>From this result array, you can see that the values in each element have a specific key and a specific background color.</p>
<p>If this report brought you help understanding processing Google Spreadsheets including the merged cells, I&rsquo;m glad.</p>

  
  <h4><i class="fas fa-share-alt" aria-hidden="true"></i>&nbsp;Share!</h4>
<ul class="share-buttons">
	<li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftanaikech.github.io%2f2023%2f11%2f13%2ftechnique-for-processing-google-spreadsheet-including-merged-cells-using-google-apps-script%2f" target="_blank" title="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span class="sr-only">Share on Facebook</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://twitter.com/intent/tweet?source=https%3a%2f%2ftanaikech.github.io%2f2023%2f11%2f13%2ftechnique-for-processing-google-spreadsheet-including-merged-cells-using-google-apps-script%2f" target="_blank" title="Tweet"><i class="fab fa-twitter" aria-hidden="true"></i><span class="sr-only">Tweet</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://plus.google.com/share?url=https%3a%2f%2ftanaikech.github.io%2f2023%2f11%2f13%2ftechnique-for-processing-google-spreadsheet-including-merged-cells-using-google-apps-script%2f" target="_blank" title="Share on Google+"><i class="fab fa-google-plus" aria-hidden="true"></i><span class="sr-only">Share on Google+</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.tumblr.com/share?v=3&u=https%3a%2f%2ftanaikech.github.io%2f2023%2f11%2f13%2ftechnique-for-processing-google-spreadsheet-including-merged-cells-using-google-apps-script%2f" target="_blank" title="Post to Tumblr"><i class="fab fa-tumblr" aria-hidden="true"></i><span class="sr-only">Post to Tumblr</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2ftanaikech.github.io%2f2023%2f11%2f13%2ftechnique-for-processing-google-spreadsheet-including-merged-cells-using-google-apps-script%2f" target="_blank" title="Pin it"><i class="fab fa-pinterest-p" aria-hidden="true"></i><span class="sr-only">Pin it</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.reddit.com/submit?url=https%3a%2f%2ftanaikech.github.io%2f2023%2f11%2f13%2ftechnique-for-processing-google-spreadsheet-including-merged-cells-using-google-apps-script%2f" target="_blank" title="Submit to Reddit"><i class="fab fa-reddit-alien" aria-hidden="true"></i><span class="sr-only">Submit to Reddit</span></a>
	</li>
</ul>


<style>
	ul.share-buttons{
	  list-style: none;
	  padding: 0;
	}

	ul.share-buttons li{
	  display: inline;
	}

	ul.share-buttons .sr-only{
	  position: absolute;
	  clip: rect(1px 1px 1px 1px);
	  clip: rect(1px, 1px, 1px, 1px);
	  padding: 0;
	  border: 0;
	  height: 1px;
	  width: 1px;
	  overflow: hidden;
	}
</style>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://tanaikech.github.io/2023/11/08/uploading-files-without-authorizing-scopes-by-shared-users-with-dialog-on-google-spreadsheet-using-google-apps-script/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://tanaikech.github.io/2023/11/08/uploading-files-without-authorizing-scopes-by-shared-users-with-dialog-on-google-spreadsheet-using-google-apps-script/">Uploading Files without Authorizing Scopes by Shared Users with Dialog on Google Spreadsheet using Google Apps Script</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
  </div>
</div>


  
  
  
  

  

</div>

</div>
</div>
<script src="https://tanaikech.github.io/js/ui.js"></script>
<script src="https://tanaikech.github.io/js/menus.js"></script>






<script async src="https://www.googletagmanager.com/gtag/js?id=G-J3Z6T50WL5"></script>
<script>
  
  if (window.location.hostname != "localhost") {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-J3Z6T50WL5');
  }
</script>






<script src="https://tanaikech.github.io/js/math-code.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  


</body>
</html>

