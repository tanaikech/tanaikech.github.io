<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.24.1" />

  <title>Asynchronous Processing using Event Triggers &middot; tanaike</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.2/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.2/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.2/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://tanaikech.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://tanaikech.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://tanaikech.github.io/">TANAIKE</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/topics/"><i class='fa fa-folder fa-fw'></i>Topics</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://plus.google.com/+KanshiTanaike" target="_blank"><i class="fa fa-google-plus-square fa-fw"></i>Google+</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/tanaikech" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/7108653" target="_blank"><i class="fa fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2017. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Asynchronous Processing using Event Triggers</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>21 Sep 2018, 17:00</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/report">report</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/gastips">GasTips</a>
    
  </div>
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/google-apps-script">Google Apps Script</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/event">event</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/trigger">trigger</a>
    
  </div>
  
  

</div>

  

<p><a href="https://gist.github.com/tanaikech/88f7fd5ed14da5e9afde18310da61cb5">Gists</a></p>

<p><center>
September 21, 2018
    Published.</p>

<p>Kanshi Tanaike
</center></p>

<h2 id="overview">Overview</h2>

<p>This is a report about the possibility of asynchronous process using event triggers. This is for Google Apps Script (GAS).</p>

<h2 id="description">Description</h2>

<p><code>onEdit()</code> which is <a href="https://developers.google.com/apps-script/guides/triggers/">a simple trigger</a> is often used as a trigger when the values are modified on Spreadsheet. When users want to use the script including some methods which are required to be authorized as the onEdit event, <a href="https://developers.google.com/apps-script/guides/triggers/installable">a installable trigger</a> of onEdit is used. If the trigger is installed for the function of <code>onEdit()</code>, when the event trigger is run, <code>onEdit()</code> is run 2 times. In order to avoid this, the installable trigger is installed to the functions except for the functions of simple triggers. The functions of simple triggers which is the same events are not used in the project. When I thought about this situation, I thought that both <code>onEdit()</code> which is run by the simple trigger and the function which is run by the installable trigger might be able to be used, simultaneously. So I investigated about this situation.</p>

<p>As the result, it was found that the following simple triggers and installable triggers work as the asynchronous process.</p>

<table>
<thead>
<tr>
<th align="center">Simple triggers</th>
<th align="center">Installable triggers</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">onOpen()</td>
<td align="center">On open</td>
</tr>

<tr>
<td align="center">onEdit()</td>
<td align="center">On edit</td>
</tr>
</tbody>
</table>

<p>For example, when the event of on edit is used as the asynchronous process, it uses the following flow.</p>

<ol>
<li>Create a project as the container-bound script in a Spreadsheet.</li>
<li><code>onEdit()</code> which is used as the simple trigger is put in the project.</li>
<li><code>myFunction()</code> which is used as the installable trigger is put in the project.</li>
<li>Install <code>myFunction()</code> as the trigger of &ldquo;On edit&rdquo;.</li>
</ol>

<p>By above setting, when the cell of spreadsheet is edited, both <code>onEdit()</code> and <code>myFunction()</code> are run as the asynchronous process.</p>

<h2 id="simple-triggers-and-installable-triggers">Simple Triggers and Installable Triggers</h2>

<p>At first, it investigated about the work of simple trigger and installable trigger. The sample script is as follows. Here, &ldquo;onEdit&rdquo; was used. <code>myFunction()</code> was installed as the trigger of &ldquo;On edit&rdquo;. At both <code>onEdit()</code> and <code>myFunction()</code>, the start and end time are output after <code>Utilities.sleep(t)</code> was run. When the event trigger of on edit was run, it judges whether both functions worked as the asynchronous process by confirming the start and end time. As the result, it was found that the start and end time from both functions were almost the same. By this, it is considered that the simple trigger and installable trigger work as the asynchronous process with the 2 workers which are `<code>onEdit()</code> and <code>myFunction()</code>.</p>

<pre><code class="language-javascript">var t = 10000; // For task.

function onEdit() {
  var start = new Date();
  Utilities.sleep(t); // This is a sample task.
  var end = new Date();
  console.log(&quot;onEdit: &quot; + start + ' - ' + end);
}

function myFunction() {
  var start = new Date();
  Utilities.sleep(t); // This is a sample task.
  var end = new Date();
  console.log(&quot;myFunction: &quot; + start + ' - ' + end);
}
</code></pre>

<h2 id="applications">Applications</h2>

<p>Sample situations by the asynchronous processing using event triggers are as follows.</p>

<h3 id="sample-situations">Sample situations</h3>

<h4 id="a-2-independent-tasks-by-2-workers">A. 2 independent tasks by 2 workers</h4>

<p>In this case, each task is completely independent. The sample script becomes like the script which was used at the section of &ldquo;Simple Triggers and Installable Triggers&rdquo;.</p>

<h4 id="b-share-in-a-task-by-2-workers">B. Share in a task by 2 workers</h4>

<p>In this case, each task is summarized after each worker was finished. The sample script is as follows. When you use this script,</p>

<ul>
<li>Please install the trigger to <code>myFunction()</code> as the &ldquo;On edit&rdquo; trigger.</li>
<li>This script works at the container-bound script of Spreadsheet.</li>
<li>When a cell is edited, the script is run.</li>
</ul>

<p>The sample script is as follows.</p>

<pre><code class="language-javascript">var t = 10000; // For task.

function onEdit(e) {
  var label = &quot;sample&quot;;
  console.time(label);
  Utilities.sleep(t / 2); // This is a sample task.
  var c = CacheService.getDocumentCache();
  var v;
  while (!v) {
    v = c.get(&quot;value&quot;);
  }
  var r = Utilities.formatString(&quot;onEdit: %s, myFunction: %s&quot;, &quot;onEdit was done. value is &quot; + e.value, v);
  e.range.setValue(r);
  c.remove(&quot;value&quot;);
  console.timeEnd(label);
}

function myFunction(e) {
  Utilities.sleep(t / 2); // This is a sample task.
  var c = CacheService.getDocumentCache();
  c.put(&quot;value&quot;, &quot;myFunction was done. Value is &quot; + e.value);
}
</code></pre>

<p>The flow of this script is as follows.</p>

<ol>
<li>Users put a value in a cell.</li>
<li><code>onEdit()</code> and <code>myFunction()</code> are run by the simple trigger and the installable trigger, respectively. These functions work as the asynchronous process as mentioned above.

<ul>
<li>In this sample, <a href="https://developers.google.com/apps-script/reference/utilities/utilities#sleep(Integer)"><code>Utilities.sleep(t)</code></a> was used as the task.</li>
</ul></li>
<li>At <code>myFunction()</code>, after own task was done, it puts the result using CacheService.</li>
<li>At <code>onEdit()</code>, after own task was done, it waits for retrieving the result from <code>myFunction()</code>. When the result from <code>myFunction()</code> was retrieved, each result is summarized and show it.

<ul>
<li>When I put <code>sample</code> to &ldquo;A1&rdquo;, <code>onEdit: onEdit was done. value is sample, myFunction: myFunction was done. Value is sample</code> is put to &ldquo;A1&rdquo;.</li>
<li>For this situation, I used CacheService like the channel of golang.</li>
</ul></li>
</ol>

<p>Using this sample script, the process time with increasing the task was measured.</p>

<p><img src="https://tanaikech.github.io/img/20180921a-fig1.png" alt="" /></p>

<p>Fig. 1. Task vs. process time. Task is the time for <code>Utilities.sleep(t)</code>.</p>

<p><br></p>

<p>Figure 1 shows the result of task vs. process time. Blue and red dots mean 1 worker and 2 workers, respectively. For 1 worker, the sample script is <a href="#SampleScripts">here</a>. For 2 workers, the sample script is mentioned above. From Fig. 1, it is found that the result of 1 worker coincides with the time of task. On the other hand, it was also found that for 2 workers, the result of it is half of the time of task. From this result, it is found that the script for 2 workers works as the asynchronous process, and also the task can be shared by the workers. This result indicates the asynchronous process can be achieved by using the event triggers and the simple script.</p>

<h2 id="note">Note</h2>

<ul>
<li>This is a report about the possibility of asynchronous process using event triggers. So if you want to use more workers as the asynchronous process, please use <a href="https://github.com/tanaikech/RunAll">RunAll of the library</a>. This library can achieve the parallel processing using Google Apps Script.</li>
<li>Under the condition that the simple trigger and the installable trigger are used, when a custom function is used, only when the custom function is firstly put in a cell, 3 workers can be used. But when the custom function is recalculated, the triggers don&rsquo;t work. So after the function was put, it becomes only 1 worker.</li>
</ul>

<h1 id="appendix">Appendix</h1>

<p><a name="SampleScripts"></a></p>

<h2 id="scripts">Scripts</h2>

<h3 id="script-for-measuring-single-task">Script for measuring single task</h3>

<pre><code class="language-javascript">var t = 10000; // For task.

function onEdit(e) {
  var label = &quot;onEdit&quot;;
  console.time(label);
  Utilities.sleep(t); // t is task.
  var r = &quot;onEdit was done. value is &quot; + e.value;
  e.range.setValue(r);
  console.timeEnd(label);
}
</code></pre>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://tanaikech.github.io/2018/09/13/updated-gas-library---rangelistapp/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://tanaikech.github.io/2018/09/13/updated-gas-library---rangelistapp/">Updated: GAS Library - RangeListApp</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://tanaikech.github.io/2018/10/03/joined-to-skillshare.com/">Joined to Skillshare.com</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://tanaikech.github.io/2018/10/03/joined-to-skillshare.com/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  

</div>

</div>
</div>
<script src="https://tanaikech.github.io/js/ui.js"></script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
    }
  });
</script>
<script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML">
</script>
<meta http-equiv="X-UA-Compatible" CONTENT="IE=EmulateIE7" />


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-84325623-1', 'auto');
  ga('send', 'pageview');

</script>



</body>
</html>

