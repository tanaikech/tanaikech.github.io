<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.24.1" />

  <title>Benchmark: Search for Array Processing using Google Apps Script &middot; tanaike</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.2/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.2/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.2/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://tanaikech.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://tanaikech.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://tanaikech.github.io/">TANAIKE</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/topics/"><i class='fa fa-folder fa-fw'></i>Topics</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://plus.google.com/+KanshiTanaike" target="_blank"><i class="fa fa-google-plus-square fa-fw"></i>Google+</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/tanaikech" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/7108653" target="_blank"><i class="fa fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2017. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Benchmark: Search for Array Processing using Google Apps Script</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>02 Jul 2018, 08:55</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/report">report</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/gastips">GasTips</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/benchmark">Benchmark</a>
    
  </div>
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/google-apps-script">Google Apps Script</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/search">search</a>
    
  </div>
  
  

</div>

  

<p><a href="https://gist.github.com/tanaikech/eda9234822b5dec80549216a43c52652">Gists</a></p>

<p><a name="TOP"></a></p>

<h1 id="benchmark-search-for-array-processing-using-google-apps-script">Benchmark: Search for Array Processing using Google Apps Script</h1>

<p><center>
July 2, 2018</p>

<p>Kanshi Tanaike
</center></p>

<h1 id="introduction">Introduction</h1>

<p><strong>Please be careful! This result can be only used for Google Apps Script.</strong></p>

<p>There are a limit executing time for Google Apps Script (GAS). That is 6 minutes.<a href="#References"><sup>1</sup></a> So users always have to pay attention to reducing the process cost of the scripts. Especially, it is very important to know the process cost for the array processing, because the array processing is often used for spreadsheet and Google APIs. Recently, I have reported about the process cost of the loop for the array processing.<a href="#References"><sup>2</sup></a> Also I have reported &ldquo;Improved Algorithms for Summation of Array Elements&rdquo; as a method for reducing the process cost.<a href="#References"><sup>3</sup></a> From these reports, it has found that GAS shows much different process cost from other languages. So it is important to investigate the process cost for various scenes. In this report, the process cost of &ldquo;searching strings in an array&rdquo; for the array processing using GAS has been investigated.</p>

<p>Here, as a sample, it supposes the situation that it searches 3 strings from one dimensional array. When users use the process for this situation using GAS, the following 3 methods can be considered.</p>

<ol>
<li>Search using linear search by for loop</li>
<li>Search using hash by creating an object</li>
<li>Search using indexOf() <a href="#References"><sup>4</sup></a></li>
</ol>

<blockquote>
<p>From the report of loop cost, <a href="#References"><sup>2</sup></a> it has already found that the loop by map and filter is the fastest at GAS. <a href="#References"><sup>2</sup></a> But in this report, &ldquo;for loop&rdquo; which is the general loop was used.</p>
</blockquote>

<p>As the result, it was found that the cost of search by indexOf() was the lowest of all methods. Namely, it was the fastest of all. 2nd and last one were the search by for loop and the search by the hash, respectively. In the case of the search by hash, it was fount that although the cost of search by the hash from the object is very low, the cost for creating the object to search the hash was the highest of all. By this, the search by the hash became the lowest rank. If the object for searching has already been created, the cost of search by the hash will be the lowest of all.</p>

<h1 id="experimental-procedure">Experimental procedure</h1>

<p>In the experiment, the sample scripts for GAS were used. 1 dimensional array including 3 strings for searching was used as a source array. The 3 string values were put to the top, center and end of the array in order to measure the same condition. In this case, it uses all of elements in the array. 3 methods as mentioned above were used for searching the strings from the array. As the measurements of process cost, those 3 strings were searched from the source array by changing the number of elements of the array, and the process cost which is the search time was measured. In each search, the index of array which has the searched string was retrieved. The cost for creating array was not included. Only the cost for searching was measured. By the way, at GAS, the processing time is not stable as you know. So the average value for more than 250 times measurements was used for each data point which is shown by figures. At this time, the fluctuation of the average values was less than 1 %. I worry that each detailed-data point at my environment might be different from that at other userâ€™s environment. But I think that the trend of this result can be used.</p>

<h1 id="results">Results</h1>

<p><img src="fig1.png" alt="" /></p>

<p>Fig 1. Number of elements vs. processing time (process cost) for searching 3 strings. The solid lines with the color of red, blue and green mean the result from the search using hash, the linear search and the search using indexOf, respectively.</p>

<p><br></p>

<p><img src="fig2.png" alt="" /></p>

<p>Fig 2. Each method vs. processing efficiency time (process cost) for searching strings. Here, the chart of search using indexOf shown in Fig. 1 was magnified.</p>

<p><br></p>

<p>Figure 1 shows the number of elements vs. processing time (process cost) for searching 3 strings. At figure 2, the chart of search using indexOf shown in Fig. 1 was magnified. From Fig. 1, it was found that the search using indexOf is the fastest of all. The second is the linear search. The last is the search using hash. It is considered that the reason of this order is as follows.</p>

<ol>
<li>From the sample script, both the linear search and the search using hash process all elements in the array using the for loop. On the other hand, the search using indexOf doesn&rsquo;t process all elements using the for loop. The index of the element with the found string is directly retrieved using indexOf. When the string is found, the elements in the array are removed from the start index to the index of element with the found string. By this, the array length becomes small. This flow is repeated until to find all strings for searching. So it is considered that the search cost of indexOf which doesn&rsquo;t process all elements using the for loop became the lowest of all. This may indicate that the scan for indexOf() is different from it for the general for loop.</li>
<li>In the case of the search by hash, it was found that although the cost of search by the hash from the object is very low, the cost for creating the object to search the hash was the highest of all. So it is considered that the search by hash became the lowest rank. If the object for searching has already been created, the cost of search by the hash will be the lowest of all.</li>
<li>The linear search processes all elements using the for loop as same as the search using hash. At the linear search, the elements are scanned and the searched string is retrieved using <code>if</code>. On the other hand, at the search using hash, the object is created to search while using <code>if</code>. After the object was created, the strings are searched. From the result of order of cost, it is considered that the cost for creating an object is higher than that of <code>push()</code>. So it is considered that the linear search became the second.</li>
</ol>

<p><img src="fig3.png" alt="" /></p>

<p>Fig 3. Number of elements which can be searched per unit time. Vertical axis is the logger scale. Horizontal axis is each method. These were calculated using the slopes of each method in Figs 1 and 2.</p>

<p><br></p>

<p>Figure 3 shows the number of elements which can be searched per unit time. The vertical axis and horizontal axis are the logger scale and each method, respectively. These values were calculated using the slopes of each method in Figs 1 and 2. From Fig. 3, it was found that the search using indexOf can reduce the process cost of more than 99 % from the linear search and the search using hash.</p>

<h1 id="summary">Summary</h1>

<p>In this report, the process cost of &ldquo;searching strings in an array&rdquo; for the array processing by 3 methods using GAS was investigated. As the result, it was found the following important features for GAS.</p>

<ul>
<li>Process cost of search by indexOf() was the lowest of all methods.</li>
<li>2nd and last one were the search by for loop and the search by the hash, respectively.</li>
<li>About the search by hash, although the cost of search by the hash from the object is very low, the cost for creating the object to search the hash was the highest of all. By this, the search by hash became the lowest rank. If the object for searching has already been created, the cost of search by the hash will be the lowest of all.</li>
<li>Search using indexOf can reduce the process cost of more than 99 % from the linear search and the search using hash.</li>
<li>From these results, it is considered that the scan for indexOf() may be different from the general for loop.</li>
</ul>

<p>As a note, I have to describe that this is the result for Google Apps Script. For other languages, this result might be difference. And also, the process cost of this report might be modified by future update of Google.</p>

<p><a name="References"></a></p>

<h1 id="references">References</h1>

<ol>
<li><a href="https://developers.google.com/apps-script/guides/services/quotas#current_limitations">Current limitations at Quotas for Google Services</a></li>
<li><a href="https://gist.github.com/tanaikech/848aeafaac1ec676900bb78e3ce220b6">Benchmark: Loop for Array Processing using Google Apps Script</a></li>
<li><a href="https://tanaikech.github.io/2016/10/13/improved-algorithms-for-summation-of-array-elements/">Improved Algorithms for Summation of Array Elements</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/indexOf">String.prototype.indexOf()</a></li>
</ol>

<h2 id="appendix">Appendix</h2>

<h3 id="scripts">Scripts</h3>

<h4 id="creating-sample-arrays">Creating sample arrays</h4>

<p>The function for creating an array is as follows. &ldquo;searchText&rdquo; is put to the center, top and end of the array. In this report, the script searches the index of array elements with &ldquo;searchText&rdquo; from the array including 3 &ldquo;searchText&rdquo;.</p>

<pre><code class="language-javascript">function createSampleArray(max, searchText) {
  var r = Array.apply(null, new Array(max)).map(function(_, i) {return &quot;val&quot; + ('0000000000' + i).slice(-8)});
  // Put the search value to center of the array.
  Array.prototype.splice.apply(r, [Math.floor(r.length / 2), 0].concat([searchText]));
  // Put the search value to top of the array.
  r.unshift(searchText);
  // Put the search value to end of the array.
  r.push(searchText);
  return r;
}
</code></pre>

<p>The array becomes like below.</p>

<pre><code>[
  &quot;searchText&quot;,
  &quot;val00000000&quot;,
  &quot;val00000001&quot;,
  &quot;val00000002&quot;,
  &quot;val00000003&quot;,
  ,
  ,
  ,
  &quot;searchText&quot;,
  ,
  ,
  ,
  &quot;val00000097&quot;,
  &quot;val00000098&quot;,
  &quot;val00000099&quot;,
  &quot;val00000100&quot;,
  &quot;searchText&quot;
]
</code></pre>

<h4 id="searching-values">Searching values</h4>

<pre><code class="language-javascript">// Linear search
function linearSearch(array, searchText) {
  var result = [];
  for (var i = 0; i &lt; array.length; i++) {
    if (array[i] == searchText) {
      result.push(i);
    }
  }
  return result;
}

// Search using hash
function hashSearch(array, searchText) {
  var hash = {};
  for (var i = 0; i &lt; array.length; i++) {
    if (hash[array[i]]) {
      hash[array[i]] = hash[array[i]].concat(i);
    } else {
      hash[array[i]] = [i];
    }
  }
  return hash[searchText];
}

// Search using indexOf
function indexofSearch(array, searchText) {
  var result = [];
  var base = 0;
  var len = array.length;
  for (var i = 0; i &lt; len; i++) {
    var c = array.indexOf(searchText);
    if (c &gt; -1) {
      base += c;
      result.push(i + base);
      array.splice(0, c + 1);
    } else {
      break;
    }
  }
  return result;
}
</code></pre>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://tanaikech.github.io/2018/06/26/resumable-conversion-from-csv-file-with-large-size--50-mb-to-several-spreadsheets-by-splitting-file/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://tanaikech.github.io/2018/06/26/resumable-conversion-from-csv-file-with-large-size--50-mb-to-several-spreadsheets-by-splitting-file/">Resumable Conversion from CSV File with Large Size (&gt; 50 MB) to Several Spreadsheets by Splitting File</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
  </div>
</div>



  

</div>

</div>
</div>
<script src="https://tanaikech.github.io/js/ui.js"></script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
    }
  });
</script>
<script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML">
</script>
<meta http-equiv="X-UA-Compatible" CONTENT="IE=EmulateIE7" />


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-84325623-1', 'auto');
  ga('send', 'pageview');

</script>



</body>
</html>

