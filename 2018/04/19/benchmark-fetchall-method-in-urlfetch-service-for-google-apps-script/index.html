<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.24.1" />

  <title>Benchmark: fetchAll method in UrlFetch service for Google Apps Script &middot; tanaike</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.2/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.2/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.2/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://tanaikech.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://tanaikech.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://tanaikech.github.io/">TANAIKE</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/topics/"><i class='fa fa-folder fa-fw'></i>Topics</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://plus.google.com/+KanshiTanaike" target="_blank"><i class="fa fa-google-plus-square fa-fw"></i>Google+</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/tanaikech" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/7108653" target="_blank"><i class="fa fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2017. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Benchmark: fetchAll method in UrlFetch service for Google Apps Script</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>19 Apr 2018, 14:24</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/report">report</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/gastips">GasTips</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/benchmark">Benchmark</a>
    
  </div>
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/google-apps-script">Google Apps Script</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/urlfetch">UrlFetch</a>
    
  </div>
  
  

</div>

  

<p><a href="https://gist.github.com/tanaikech/c0f383034045ab63c19604139ecb0728">Gists</a></p>

<p>By Google&rsquo;s update at January 19, 2018, <a href="https://developers.google.com/apps-script/reference/url-fetch/url-fetch-app#fetchAll(Object)">fetchAll method</a> was added to the UrlFetch service. When I saw the usage, I couldn&rsquo;t find the detail information about the actual running state. So I investigated about it.</p>

<p>As the result, it was found that the fetchAll method is worked by the asynchronous processing. The returned data is reordered by the order of requests. By this, it was also found that if you want to retrieve the data from the several URL, the process cost of <code>UrlFetchApp.fetchAll()</code> is much lower than that of <code>UrlFetchApp.fetch()</code> using for loop.</p>

<p>The sample scripts for server side and client side are as follows.</p>

<h1 id="sample-script-for-server-side">Sample script for server side</h1>

<p>In this report, 5 Web Apps were used as the servers. At first, 5 standalone projects were created and the following server script was put to each project. Then, Web Apps was deployed for each project. These deployed Web Apps were accessed from the script of client side. When the client accesses to the server, the server returns unix time (milliseconds) and server ID. From unix time, the order of actual fetch can be obtained.</p>

<pre><code class="language-javascript">function doGet(e) {
    var url = ScriptApp.getService().getUrl().split(&quot;/&quot;);
    var val = JSON.stringify({
        date: new Date().getTime().toString(),
        serverId: url[url.length - 2],
        key: e.parameter.key,
    });

    Utilities.sleep(5000); // Waiting for 5 seconds

    return ContentService.createTextOutput(val).setMimeType(ContentService.MimeType.JSON);
}
</code></pre>

<h1 id="sample-script-for-client-side">Sample script for client side</h1>

<p>When you use this script, after you deployed Web Apps, please run a function of <code>main()</code>. The reason that I often use <code>map()</code> is <a href="https://gist.github.com/tanaikech/848aeafaac1ec676900bb78e3ce220b6">here</a>.</p>

<pre><code class="language-javascript">// As a sample, 5 URLs were used.
var actions = {
  &quot;### ID for Web Apps URL ###&quot;: &quot;action1&quot;, // https://script.google.com/macros/s/### ID for Web Apps URL ###/exec
  &quot;### ID for Web Apps URL ###&quot;: &quot;action2&quot;,
  &quot;### ID for Web Apps URL ###&quot;: &quot;action3&quot;,
  &quot;### ID for Web Apps URL ###&quot;: &quot;action4&quot;,
  &quot;### ID for Web Apps URL ###&quot;: &quot;action5&quot;,
};

function createReq() {
  return Object.keys(actions).map(function(e, i) {
    return {
      &quot;url&quot;: &quot;https://script.google.com/macros/s/&quot; + e + &quot;/exec?key=&quot; + actions[e],
      &quot;method&quot;: &quot;get&quot;,
    };
  });
}

function dispResults(response, elapsedTime) {
  var res = response.map(function(e) {return JSON.parse(e)});
  var responsedOrder = res.map(function(e) {return actions[e.serverId]});
  var actualOrder = res.sort(function(x, y) {return x.date &gt; y.date ? 1 : -1})
                       .map(function(e) {return actions[e.serverId]});
  return {
    elapsedTime: elapsedTime,
    responsedOrder: responsedOrder,
    actualOrder: actualOrder,
  };
}

// Using UrlFetchApp.fetchAll()
function useFetchAll(req) {
  var startTime = Date.now();
  var response = UrlFetchApp.fetchAll(req);
  var endTime = Date.now();
//  Logger.log(response);
  return dispResults(response, (endTime - startTime) / 1000);
}

// Using UrlFetchApp.fetch()
function useFetch(req) {
  var startTime = Date.now();
  var response = req.map(function(e) {return UrlFetchApp.fetch(e.url).getContentText()});
  var endTime = Date.now();
//  Logger.log(response);
  return dispResults(response, (endTime - startTime) / 1000);
}

// Run
function main() {
  var req = createReq();
  var results = [useFetchAll(req), useFetch(req)];
  Logger.log(JSON.stringify(results));
}
</code></pre>

<h1 id="result">Result</h1>

<p>For the results, elapsedTime, responsedOrder and actualOrder mean the elapsed time of 5 requests, the order of returned data and the order of actual fetching, respectively.</p>

<h4 id="urlfetchapp-fetchall">UrlFetchApp.fetchAll()</h4>

<pre><code class="language-json">{
    &quot;elapsedTime&quot;    : 5.502,
    &quot;responsedOrder&quot; : [&quot;action1&quot;,&quot;action2&quot;,&quot;action3&quot;,&quot;action4&quot;,&quot;action5&quot;],
    &quot;actualOrder&quot;    : [&quot;action5&quot;,&quot;action1&quot;,&quot;action3&quot;,&quot;action2&quot;,&quot;action4&quot;]
}
</code></pre>

<h4 id="urlfetchapp-fetch">UrlFetchApp.fetch()</h4>

<pre><code class="language-json">{
    &quot;elapsedTime&quot;    : 27.011,
    &quot;responsedOrder&quot; : [&quot;action1&quot;,&quot;action2&quot;,&quot;action3&quot;,&quot;action4&quot;,&quot;action5&quot;],
    &quot;actualOrder&quot;    : [&quot;action1&quot;,&quot;action2&quot;,&quot;action3&quot;,&quot;action4&quot;,&quot;action5&quot;]
}
</code></pre>

<p>These 2 results are two of results in several working. These can be said that it is an average result. From these results, the following points can be seen.</p>

<ul>
<li>In the server script, the sleep for 5 seconds is set. For fetchAll(), the total elapsed time is 5.5 s.</li>
<li>For fetchAll(), responsedOrder is the same to the order of requests. The order of requests is &ldquo;action1&rdquo;, &ldquo;action2&rdquo;, &ldquo;action3&rdquo;, &ldquo;action4&rdquo; and &ldquo;action5&rdquo;.</li>
<li>For fetchAll(), actualOrder is NOT the same to the order of requests. The order is difference every time.</li>
<li>For fetch(), the sleep for 5 seconds at each fetch is added. So the total elapsed time is 27.0 s.</li>
<li>For fetch(), responsedOrder is the same to the order of requests.</li>
<li>For fetch(), actualOrder is the same to the order of requests.</li>
</ul>

<h1 id="summary">Summary</h1>

<ul>
<li>It was found that the fetchAll method is worked by the asynchronous processing.</li>
<li>After it worked by the asynchronous processing, the returned values is reordered by the order of requests.</li>
<li>It was also found that if you want to retrieve the data from the several URL, the process cost of <code>UrlFetchApp.fetchAll()</code> is much lower than that of <code>UrlFetchApp.fetch()</code> using for loop.</li>
</ul>

<p>In this report, I could confirm 30 requests could be worked for the fetchAll method. But I couldn&rsquo;t find the limitation of the number of requests.</p>

<h1 id="limitation-of-number-of-requests">Limitation of number of requests</h1>

<p>I could confirm that 1000 requests work fine. But I couldn&rsquo;t find the limitation.</p>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://tanaikech.github.io/2018/04/16/benchmark-loop-for-array-processing-using-google-apps-script/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://tanaikech.github.io/2018/04/16/benchmark-loop-for-array-processing-using-google-apps-script/">Benchmark: Loop for Array Processing using Google Apps Script</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
  </div>
</div>



  

</div>

</div>
</div>
<script src="https://tanaikech.github.io/js/ui.js"></script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
    }
  });
</script>
<script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML">
</script>
<meta http-equiv="X-UA-Compatible" CONTENT="IE=EmulateIE7" />


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-84325623-1', 'auto');
  ga('send', 'pageview');

</script>



</body>
</html>

