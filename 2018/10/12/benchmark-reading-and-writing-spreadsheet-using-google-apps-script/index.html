<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.24.1" />

  <title>Benchmark: Reading and Writing Spreadsheet using Google Apps Script &middot; tanaike</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.2/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.2/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.2/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://tanaikech.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://tanaikech.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://tanaikech.github.io/">TANAIKE</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/topics/"><i class='fa fa-folder fa-fw'></i>Topics</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://plus.google.com/+KanshiTanaike" target="_blank"><i class="fa fa-google-plus-square fa-fw"></i>Google+</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/tanaikech" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/7108653" target="_blank"><i class="fa fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2017. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Benchmark: Reading and Writing Spreadsheet using Google Apps Script</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>12 Oct 2018, 10:42</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/report">report</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/gastips">GasTips</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/benchmark">Benchmark</a>
    
  </div>
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/google-apps-script">Google Apps Script</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/spreadsheet">Spreadsheet</a>
    
  </div>
  
  

</div>

  

<p>[Gists]()</p>

<p><a name="TOP"></a></p>

<h1 id="benchmark-reading-and-writing-spreadsheet-using-google-apps-script">Benchmark: Reading and Writing Spreadsheet using Google Apps Script</h1>

<p><center>
October 12, 2018
    Published.</p>

<p>Kanshi Tanaike
</center></p>

<h1 id="introduction">Introduction</h1>

<p><strong>Please be careful! This result can be only used for Google Apps Script.</strong></p>

<p>There are a limit executing time for Google Apps Script (GAS). That is 6 minutes for Consumer and Google Apps free edition, and 30 minutes for G Suite and Early Access. <a href="#References"><sup>1</sup></a> So many users always have to pay attention to reducing the process cost of scripts. So it is very important to know the process cost of various situations. I have already reported the costs for various processes as the reports. <a href="#References"><sup>2</sup></a> In this report, the process cost for reading and writing values for Spreadsheet using GAS has been investigated.</p>

<p>As the result, the conclusion that the methods for reading and writing Spreadsheet of Sheets API are using the different algorithm and/or process from those of Spreadsheet service were derived.</p>

<h1 id="experimental-procedure">Experimental procedure</h1>

<p>In order to measure the process cost for reading and writing spreadsheet, the size of values for reading and writing were variously changed. For measuring the reading cost, Spreadsheet which had the values for reading was used. For measuring the writing cost, Spreadsheet that all values were cleared was used. The methods for reading and writing which were used this report are as follows.</p>

<table>
<thead>
<tr>
<th align="left">Tests</th>
<th align="left">Methods used for measuring process cost</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">Reading (Spreadsheet Service)</td>
<td align="left">getValues(), getSheetValues()</td>
</tr>

<tr>
<td align="left">Reading (Sheets API)</td>
<td align="left">values.get, values.batchGet</td>
</tr>

<tr>
<td align="left">Writing (Spreadsheet Service)</td>
<td align="left">setValue(), appendRow(), setValues()</td>
</tr>

<tr>
<td align="left">Writing (Sheets API)</td>
<td align="left">values.update, values.batchUpdate, values.append</td>
</tr>
</tbody>
</table>

<p>For the methods of Sheets API, the reason these methods are chosen is because 2 dimensional array can be used as the values. At the flow of each method, the spreadsheet is opened and is read or written. From the preparation experiment, it was found that the process costs of <code>SpreadsheetApp.getActiveSheet()</code> and <code>SpreadsheetApp.openById(ID)</code> are the almost the same. So the methods of SpreadsheetApp class used <code>SpreadsheetApp.openById(ID)</code>. <a href="#References"><sup>3</sup></a> The methods of Sheets API used Advanced Google Services. <a href="#References"><sup>4</sup></a> The sample scripts of GAS which were used for this report are here. <a href="#SampleScripts"><sup>a</sup></a> For measuring the process cost, the cost for creating values for writing is not included. By the way, at GAS, the processing time is not stable as you know. So the average value for more than 100 times measurements was used for each data point which is shown by figures. At this time, the fluctuation of the average values was less than 1 %. I worry that each detailed-data point at my environment might be different from that at other user&rsquo;s environment. But I think that the trend of this result can be used.</p>

<h1 id="results">Results</h1>

<p><img src="https://tanaikech.github.io/img/20181012a-fig1.png" alt="" /></p>

<p>Fig. 1. Number of rows for reading vs. process time. About the values for reading from Spreadsheet, the rows are changed under the constant columns. Numbers of columns of Figs. (a) - (h) are 2, 10, 25, 50, 100, 200, 300 and 400, respectively. All figures are the double-logarithmic scales.</p>

<p><br></p>

<p>Figure 1 shows the process time for reading the values from Spreadsheet. For each figure in Fig. 1, the process time was measured by changing the number of rows for reading, while the columns are constant. At Figs. 1 (a) - (h), the columns are changed as 2, 10, 25, 50, 100, 200, 300 and 400, respectively. All figures are the double-logarithmic scales. From Figs. 1 (a) - (h), it was found that the process cost of the methods of Sheets API was lower than that of the methods of Spreadsheet Service. And, it was found that the cost of <code>getValues()</code> and <code>getSheetValues()</code> was almost the same. It was found that the cost of <code>values.get</code> and <code>values.batchGet</code> was also almost the same. For all methods, the costs increase with the increase in the columns of values for reading.</p>

<p><img src="https://tanaikech.github.io/img/20181012a-fig2.png" alt="" /></p>

<p>Fig. 2. Number of rows for writing vs. process time. About the values for writing to Spreadsheet, the rows are changed under the constant columns. Numbers of columns of Figs. (a) - (h) are 2, 10, 25, 50, 100, 200, 300 and 400, respectively. All figures are the double-logarithmic scales.</p>

<p><br></p>

<p>Figure 2 shows the process time for writing the values to Spreadsheet. For each figure in Fig. 2, the process time was measured by changing the number of rows for writing, while the columns are constant. At Figs. 1 (a) - (h), the columns are changed as 2, 10, 25, 50, 100, 200, 300 and 400, respectively. All figures are the double-logarithmic scales. From Figs. 2 (a) - (h), it was found that the process cost of the methods of Sheets API was lower than that of the methods of Spreadsheet Service. And, it was found that the cost of <code>values.update</code>, <code>values.batchUpdate</code> and <code>values.append</code> was almost the same. For all methods, the costs increase with the increase in the columns of values for reading.</p>

<p>Here, from Fig. 1 and Fig. 2, the process costs for reading and writing Spreadsheet under the constant rows were retrieved.</p>

<p><img src="https://tanaikech.github.io/img/20181012a-fig3.png" alt="" /></p>

<p>Fig. 3. Process costs for reading (a) and writing (b) data with 1000 rows. This figure is the linear scale.</p>

<p><br></p>

<p>Figure 3 shows the process costs for reading (a) and writing (b) data with 1000 rows. This figure was obtained by retrieving the values at 1000 rows from Figs. 1 and 2. From Fig. 3 a and b, it was found that the difference of costs for Spreadsheet Service and Sheets API increased with the increase in the number of columns. And also, it was found that from the slopes of these figures, the methods of Sheets API can reduce the process costs rather than those of Spreadsheet Service. For reading values, Sheets API can reduce the process cost from Spreadsheet Service by about 35 %. For writing values, Sheets API can reduce the process cost from Spreadsheet Service by about 19 %. These results can be obtained from Fig. 3.</p>

<p>By the way, when it shows Fig. 2, it notices an interesting trend. From the results mentioned above, it was found that Sheets API can basically can reduce the process costs larger than Spreadsheet Service. But when the number of rows for writing is is small in Fig. 2, it is found that the process cost between Spreadsheet Service and Sheets API inverses. So the inversion points were retrieved from each figure in Fig. 2.</p>

<p><img src="https://tanaikech.github.io/img/20181012a-fig4.png" alt="" /></p>

<p>Fig. 4. Inversion points of process cost of Spreadsheet Service and Sheets API. This figure is the double-logarithmic scales.</p>

<p><br></p>

<p>Figure 4 shows the inversion points of process cost of Spreadsheet Service and Sheets API. This figure is the double-logarithmic scales. This figure was obtained from Fig. 2. When it sees this figure, it is found that the number of rows decreases with increasing the number of columns. This means that in the case of the range from 2 columns to 400 columns, the upper area and the lower area of the blue line indicate the range which is suitable for using Sheets API and the range which is suitable for using Spreadsheet Service (setValues()), respectively. Namely, it indicates that the blue line is the boundary to effectively use Spreadsheet Service and Sheets API.</p>

<p>From this result, it is required to investigate the process costs of Spreadsheet Service at the small number of rows.</p>

<p><img src="https://tanaikech.github.io/img/20181012a-fig5.png" alt="" /></p>

<p>Fig. 5. Process costs for setValue() (a) appendRow() (b) and setValues() &copy; of Spreadsheet Service. This figure is the linear scale.</p>

<p><br></p>

<p>Figure 5 shows the process costs for setValue(), appendRow() and setValues() of Spreadsheet Service. (a) - &copy; in Fig. 5 are the cost of setValue(), appendRow() and setValues() of Spreadsheet Service, respectively. For (a) - &copy;, the process costs were measured by increasing the number of columns under the constant number of rows. This figure is the linear scale, and all y-axes are the same. From these figures, the process cost of setValue() increases with the increase in the number of columns. The cost of appendRow() is constant for increasing the number of columns. At setValues(), the process cost is not changed and very low for (a) - &copy;. The inversion point between setValue() and appendRow() is constant which is about 75 columns. From these results, it was found that setValues() is suitable for this situation. But if setValue() and appendRow() are used, when the number of columns of values is less than 75, setValue() is suitable. When it is more than 75, appendRow() is suitable.</p>

<h1 id="summary">Summary</h1>

<p>In this report, the process cost for reading and writing Spreadsheet has been investigated. From this investigation, the following results were obtained.</p>

<ul>
<li><p>For the process costs for reading values from Spreadsheet</p>

<ol>
<li>Process costs of getValues() and getSheetValues() of Spreadsheet Service are almost the same.</li>
<li>Process costs of values.get and values.batchGet of Sheets API are almost the same.</li>
<li>Methods of Sheets API can reduce the process costs from those of Spreadsheet Service by about 35 %.</li>
</ol></li>

<li><p>For the process costs for writing values from Spreadsheet</p>

<ol>
<li>Process costs of values.update, values.batchUpdate and values.append of Sheets API are almost the same.</li>
<li>Methods of Sheets API can reduce the process costs from those of Spreadsheet Service by about 19 %.</li>
<li>There is the inversion point between setValues() of Spreadsheet Service and the methods of Sheets API.

<ul>
<li>When the data size is small, setValues() is suitable for writing values.</li>
<li>When the data size becomes large, the methods of Sheets API are suitable for writing values.</li>
</ul></li>
</ol></li>
</ul>

<p>From these results, it is considered that the methods for reading and writing Spreadsheet of Sheets API are using the different algorithm and/or process from those of Spreadsheet service.</p>

<p>As a note, I have to describe that this is the result for Google Apps Script. For other languages, this result might be difference. And also, the process cost of this report might be modified by future update of Google.</p>

<p><a name="References"></a></p>

<h1 id="references">References</h1>

<ol>
<li><a href="https://developers.google.com/apps-script/guides/services/quotas#current_limitations">Current limitations at Quotas for Google Services</a></li>
<li><a href="https://github.com/tanaikech/taking-advantage-of-google-apps-script#Benchmarks">Benchmarks for Google Apps Script</a></li>
<li><a href="https://developers.google.com/apps-script/reference/spreadsheet/spreadsheet-app">Class SpreadsheetApp</a></li>
<li><a href="https://developers.google.com/sheets/api/reference/rest/">Google Sheets API</a></li>
</ol>

<h1 id="appendix">Appendix</h1>

<p><a name="SampleScripts"></a></p>

<h2 id="scripts">Scripts</h2>

<p>In this measurements, for example, <code>range</code> and <code>val</code> were declared like <code>var range = &quot;Sheet1!A1:B3&quot;</code> and <code>var val = [[&quot;a1&quot;, &quot;b1&quot;], [&quot;a2&quot;, &quot;b2&quot;], [&quot;a3&quot;, &quot;b3&quot;]]</code>, respectively.</p>

<h3 id="for-reading-values">For reading values</h3>

<pre><code class="language-javascript">// getValues()
SpreadsheetApp.openById(spreadsheetId).getRange(range).getValues();

// getSheetValues()
SpreadsheetApp.openById(spreadsheetId).getSheetValues(startRow, startColumn, numRows, numColumns);

// Values.get()
Sheets.Spreadsheets.Values.get(spreadsheetId, range).values;

// Values.batchGet()
Sheets.Spreadsheets.Values.batchGet(spreadsheetId, {ranges: range}).valueRanges[0].values;
</code></pre>

<h3 id="for-writing-values">For writing values</h3>

<pre><code class="language-javascript">// setValue()
var ss = SpreadsheetApp.openById(spreadsheetId).getSheetByName(&quot;Sheet1&quot;);
for (var i = 0; i &lt; val.length; i++) {
  for (var j = 0; j &lt; val[i].length; j++) {
    ss.getRange(i + 1, j + 1, 1, 1).setValue(val[i][j]);
  }
}

// appendRow()
var ss = SpreadsheetApp.openById(spreadsheetId).getSheetByName(&quot;Sheet1&quot;);
for (var i = 0; i &lt; val.length; i++) {
  ss.appendRow(val[i]);
}

// setValues()
SpreadsheetApp.openById(spreadsheetId).getRange(range).setValues(val);

// Values.update()
Sheets.Spreadsheets.Values.update({values: val}, spreadsheetId, range, {valueInputOption: &quot;USER_ENTERED&quot;});

// Values.batchUpdate()
Sheets.Spreadsheets.Values.batchUpdate({valueInputOption: &quot;USER_ENTERED&quot;, data: [{range: range, values: val}]}, spreadsheetId);

// Values.append()
Sheets.Spreadsheets.Values.append({values: val}, spreadsheetId, range, {valueInputOption: &quot;USER_ENTERED&quot;});
</code></pre>

<h3 id="note">Note:</h3>

<p>When you measure the process cost for Spreadsheet service, please be careful the following point.</p>

<ul>
<li>If the process cost is continuously measured in a for loop, it was found that the 1st of the for loop and others show the difference costs. I think that when the spreadsheet is opened using <code>SpreadsheetApp.getActiveSheet()</code> and <code>SpreadsheetApp.openById(ID)</code> for the first time, this might be cached. By this, it becomes the difference costs. In order to avoid this, please run Spreadsheet service for measuring under the isolate execution.</li>
</ul>

<p><a href="#TOP">TOP</a></p>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://tanaikech.github.io/2018/10/12/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://tanaikech.github.io/2018/10/12/"></a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
  </div>
</div>



  

</div>

</div>
</div>
<script src="https://tanaikech.github.io/js/ui.js"></script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
    }
  });
</script>
<script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML">
</script>
<meta http-equiv="X-UA-Compatible" CONTENT="IE=EmulateIE7" />


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-84325623-1', 'auto');
  ga('send', 'pageview');

</script>



</body>
</html>

