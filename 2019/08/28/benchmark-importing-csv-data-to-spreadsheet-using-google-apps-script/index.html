<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.49.2" />

  <title>Benchmark: Importing CSV Data to Spreadsheet using Google Apps Script &middot; tanaike</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://tanaikech.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://tanaikech.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://tanaikech.github.io/">TANAIKE</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/topics/"><i class='fa fa-folder fa-fw'></i>Topics</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://plus.google.com/+KanshiTanaike" target="_blank"><i class="fa fa-google-plus-square fa-fw"></i>Google+</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/tanaikech" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/7108653" target="_blank"><i class="fa fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2017. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Benchmark: Importing CSV Data to Spreadsheet using Google Apps Script</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>28 Aug 2019, 12:01</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/report">report</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/gastips">GasTips</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/benchmark">Benchmark</a>
    
  </div>
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/google-apps-script">Google Apps Script</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/spreadsheet">Spreadsheet</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/import">import</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/csv">CSV</a>
    
  </div>
  
  

</div>

  

<p>[Gists]()</p>

<p><a name="top"></a></p>

<p><center>
August 28, 2019
    Published.</p>

<p>Kanshi Tanaike</p>

<p></center></p>

<h1 id="introduction">Introduction</h1>

<p><strong>Please be careful! This result can be only used for Google Apps Script.</strong></p>

<p>There are a limit executing time for Google Apps Script (GAS). That is 6 minutes for Consumer and Google Apps free edition, and 30 minutes for G Suite and Early Access. <a href="#references"><sup>1</sup></a> So many users always have to pay attention to reducing the process cost of scripts. So it is very important to know the process cost of various situations. I have already reported the costs for various processes as the reports. <a href="#references"><sup>2</sup></a> In this report, the process cost for importing CSV data to Spreadsheet using GAS has been investigated.</p>

<p>As the result, it was found that the method using Sheets API is the lowest cost for importing CSV data to the Spreadsheet.</p>

<h1 id="experimental-procedure">Experimental procedure</h1>

<p>In order to measure the process cost for importing CSV data to a Spreadsheet, 4 patterns for importing it were used as shown in <a href="#table1">Table 1</a>. The sample CSV data was created as a text file. The sample CSV data can be seen at <a href="#samplecsvdata">here</a>. The numbers of rows and columns of the CSV data are 50,000 and 10, respectively. Each value of the cells is a string value of 15 bytes. At each pattern, the CSV data is retrieved from the file. And then, the CSV data is parsed and put to the existing Spreadsheet. The CSV data is put to the 1st tab of the existing Spreadsheet.</p>

<p>The 4 patterns for importing the CSV data are shown in Table 1.</p>

<p><br>
<a name="table1"></a>
Table 1. 4 patterns for importing the CSV data.</p>

<table>
<thead>
<tr>
<th align="left">Tests</th>
<th align="left">Process</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">pattern1</td>
<td align="left">CSV data is parsed using <code>split()</code>, and put the parsed values to Spreadsheet using <code>setValues()</code>. <a href="#references"><sup>3</sup></a></td>
</tr>

<tr>
<td align="left">pattern2</td>
<td align="left">CSV data is parsed using <code>Utilities.parseCsv()</code>, and put the parsed values to Spreadsheet using <code>setValues()</code>. <a href="#references"><sup>4</sup></a></td>
</tr>

<tr>
<td align="left">pattern3</td>
<td align="left">CSV data is converted to Spreadsheet using <code>files.copy</code> Drive API, and retrieved values from the converted Spreadsheet using <code>getValues()</code>, then, the retrieved values are put to Spreadsheet using <code>setValues()</code>. <a href="#references"><sup>5</sup></a></td>
</tr>

<tr>
<td align="left">pattern4</td>
<td align="left">CSV data is directly put to Spreadsheet using <code>pasteData</code> of Sheets API. <a href="#references"><sup>6</sup></a></td>
</tr>
</tbody>
</table>

<p><br></p>

<p>The sample scripts of GAS which were used for this report are <a href="#SampleScripts">here</a>. By the way, at GAS, the processing time is not stable as you know. So the average value for more than 100 times measurements was used for each data point which is shown by figures. At this time, the fluctuation of the average values was less than 1 %. I worry that each detailed-data point at my environment might be different from that at other user&rsquo;s environment. But I think that the trend of this result can be used.</p>

<h1 id="results">Results</h1>

<p>Figure 1 shows the process costs for importing CSV data by 4 patterns.</p>

<p><img src="https://tanaikech.github.io/img/20190829a-fig1.png" alt="" /></p>

<p>Fig 1. Process costs for importing CSV data by 4 patterns. About pattern 1 to 4, you can see them at <a href="#table1">Table 1</a>.</p>

<p><br></p>

<p>From Fig.1, the following results can be obtained.</p>

<ul>
<li><p>Costs of pattern1 and pattern2 are almost the same.</p>

<ul>
<li>When the scripts of pattern1 and pattern2 are seen, pattern1 parses the CSV file with the loop process, while pattern2 parses it with the method of <code>Utilities.parseCsv()</code>. From this, it is found that if you want to modify the values when the CSV data is parsed, pattern1 is suitable for this.</li>
</ul></li>

<li><p>Costs of pattern3 is highest of all.</p>

<ul>
<li>It is found that the cost for creating new file is very high. By this, the cost became highest of all patterns.</li>
</ul></li>

<li><p>Costs of pattern4 is lowest of all.</p>

<ul>
<li>It is found that when Sheets API is used, both parsing the CSV data and putting to Spreadsheet can be done by one API call. It is considered that the parse is processed at the internal server. By this, it is considered that the cost became lowest of all patterns.</li>
<li>pattern4 can reduce the cost by 56 % from pattern1 and pattern2.</li>
<li>pattern4 can reduce the cost by 72 % from pattern3.</li>
</ul></li>
</ul>

<h1 id="summary">Summary</h1>

<p>In this report, the process cost for importing CSV data to Spreadsheet using GAS has been investigated. As the result, the following results were obtained.</p>

<ul>
<li>It was found that pattern4, which uses <code>pasteData</code> of Sheets API, was the lowest cost of all.</li>
<li>When pattern4 is used for importing CSV data to Spreadsheet, the cost can be reduced by 56 % from pattern1 and pattern2, which use the method parsing and putting values.</li>
<li>When pattern4 is used for importing CSV data to Spreadsheet, the cost can be reduced by 72 % from pattern3, which use the method converting mimeType from CSV to Spreadsheet.</li>
</ul>

<p>As a note, I have to describe that this is the result for Google Apps Script. For other languages, this result might be difference. And also, the process cost of this report might be modified by future update of Google.</p>

<p><a name="references"></a></p>

<h1 id="references">References</h1>

<ol>
<li><a href="https://developers.google.com/apps-script/guides/services/quotas#current_limitations">Current limitations at Quotas for Google Services</a></li>
<li><a href="https://github.com/tanaikech/taking-advantage-of-google-apps-script#Benchmarks">Benchmarks for Google Apps Script</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/split">split()</a></li>
<li><a href="https://developers.google.com/apps-script/reference/utilities/utilities">Class Utilities</a></li>
<li><a href="https://developers.google.com/drive/api/v2/reference/files">Google Drive API</a></li>
<li><a href="https://developers.google.com/sheets/api/reference/rest/">Google Sheets API</a></li>
</ol>

<p><a name="appendix"></a></p>

<h1 id="appendix">Appendix</h1>

<p><a name="samplescripts"></a></p>

<h2 id="a1-scripts">A1. Scripts</h2>

<p>Here, the scripts for measuring the process cost are shown as follows. When you use these scripts, please enable Drive API and Sheets API at Advanced Google services.</p>

<h3 id="pattern1">Pattern1</h3>

<p>CSV data is parsed using <code>split()</code>, and put the parsed values to Spreadsheet using <code>setValues()</code>. <a href="https://gist.github.com/tanaikech/848aeafaac1ec676900bb78e3ce220b6">I have already know that the process cost of <code>map()</code> is the lowest of all loop processes for Google Apps Script.</a> So I used this here.</p>

<pre><code class="language-javascript">var data = DriveApp.getFileById(csvFileId)
  .getBlob()
  .getDataAsString();
var values = data.split(&quot;\n&quot;).map(function(e) {
  return e.split(&quot;,&quot;);
});
var sheet = SpreadsheetApp.openById(spreadsheetId).getSheets()[0];
sheet.getRange(1, 1, values.length, values[0].length).setValues(values);
</code></pre>

<h3 id="pattern2">Pattern2</h3>

<p>CSV data is parsed using <code>Utilities.parseCsv()</code>, and put the parsed values to Spreadsheet using <code>setValues()</code>.</p>

<pre><code class="language-javascript">var data = DriveApp.getFileById(csvFileId)
  .getBlob()
  .getDataAsString();
var values = Utilities.parseCsv(data);
var sheet = SpreadsheetApp.openById(spreadsheetId).getSheets()[0];
sheet.getRange(1, 1, values.length, values[0].length).setValues(values);
</code></pre>

<h3 id="pattern3">Pattern3</h3>

<p>CSV data is converted to Spreadsheet using <code>files.copy</code> Drive API, and retrieved values from the converted Spreadsheet using <code>getValues()</code>, then, the retrieved values are put to Spreadsheet using <code>setValues()</code>.</p>

<pre><code class="language-javascript">var fileId = Drive.Files.copy(
  {
    title: &quot;sample&quot;,
    parents: [{ id: folderId }],
    mimeType: MimeType.GOOGLE_SHEETS
  },
  csvFileId
).id;
var values = SpreadsheetApp.openById(fileId)
  .getSheets()[0]
  .getDataRange()
  .getValues();
var sheet = SpreadsheetApp.openById(spreadsheetId).getSheets()[0];
sheet.getRange(1, 1, values.length, values[0].length).setValues(values);
Drive.Files.remove(fileId);
</code></pre>

<h3 id="pattern4">Pattern4</h3>

<p>CSV data is directly put to Spreadsheet using <code>pasteData</code> of Sheets API.</p>

<pre><code class="language-javascript">var data = DriveApp.getFileById(csvFileId)
  .getBlob()
  .getDataAsString();
var sheetId = SpreadsheetApp.openById(spreadsheetId)
  .getSheets()[0]
  .getSheetId();
var resource = {
  requests: [
    {
      pasteData: {
        data: data,
        coordinate: { sheetId: sheetId },
        delimiter: &quot;,&quot;
      }
    }
  ]
};
Sheets.Spreadsheets.batchUpdate(resource, spreadsheetId);
</code></pre>

<p><a name="samplecsvdata"></a></p>

<h2 id="a2-sample-csv-data">A2. Sample CSV data</h2>

<p>The sample CSV data which was used at this report is as follows. The numbers of rows and columns are 50,000 and 10, respectively. Each value of the cells is a string value of 15 bytes.</p>

<pre><code>r1-c1##########,r1-c2##########,r1-c3##########,r1-c4##########,r1-c5##########,r1-c6##########,r1-c7##########,r1-c8##########,r1-c9##########,r1-c10##########
r2-c1##########,r2-c2##########,r2-c3##########,r2-c4##########,r2-c5##########,r2-c6##########,r2-c7##########,r2-c8##########,r2-c9##########,r2-c10##########
r3-c1##########,r3-c2##########,r3-c3##########,r3-c4##########,r3-c5##########,r3-c6##########,r3-c7##########,r3-c8##########,r3-c9##########,r3-c10##########
r4-c1##########,r4-c2##########,r4-c3##########,r4-c4##########,r4-c5##########,r4-c6##########,r4-c7##########,r4-c8##########,r4-c9##########,r4-c10##########
r5-c1##########,r5-c2##########,r5-c3##########,r5-c4##########,r5-c5##########,r5-c6##########,r5-c7##########,r5-c8##########,r5-c9##########,r5-c10##########
.
.
.

</code></pre>

<p><a href="#top">TOP</a></p>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://tanaikech.github.io/2019/08/26/running-functions-by-specifying-function-names-with-web-apps-for-google-apps-script/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://tanaikech.github.io/2019/08/26/running-functions-by-specifying-function-names-with-web-apps-for-google-apps-script/">Running Functions by Specifying Function Names with Web Apps for Google Apps Script</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
  </div>
</div>



  

</div>

</div>
</div>
<script src="https://tanaikech.github.io/js/ui.js"></script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
    }
  });
</script>
<script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML">
</script>
<meta http-equiv="X-UA-Compatible" CONTENT="IE=EmulateIE7" />


<script>
  
  if (window.location.hostname != "localhost") {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-84325623-1', 'auto');
    ga('send', 'pageview');
  }
</script>





</body>
</html>

