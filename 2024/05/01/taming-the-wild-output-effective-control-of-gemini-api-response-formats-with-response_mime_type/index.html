<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <meta name="google-site-verification" content="1BvDMY90ui0jRLHkrpqdQ_x62h5VNEMuK6mQsDvVQH0" />

  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.98.0" />

  <title>Taming the Wild Output: Effective Control of Gemini API Response Formats with response_mime_type &middot; tanaike</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://tanaikech.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">

  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet" type="text/css">

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css">
  <script async src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://tanaikech.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://tanaikech.github.io/">TANAIKE</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/topics/"><i class='fa fa-folder fa-fw'></i>Topics</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/link/"><i class='fa fa-thumbs-up fa-fw'></i>Links</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/webapps/"><i class='fas fa-toolbox'></i>Web Applications</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/donate/"><i class='fas fa-donate'></i>Donate</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/tanaikech" rel="me" target="_blank"><i class="fab fa-twitter-square fa-fw"></i>X</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/tanaikech" rel="me" target="_blank"><i class="fab fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/7108653" rel="me" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2017. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Taming the Wild Output: Effective Control of Gemini API Response Formats with response_mime_type</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>01 May 2024, 13:57</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/gastips">GasTips</a>
    
  </div>
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/google-apps-script">Google Apps Script</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/gemini">Gemini</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/ai">AI</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/llm">LLM</a>
    
  </div>
  
  

</div>

  <p><a href="https://gist.github.com/tanaikech/0a55011d3e8b8fadebb71b624bb9a8af">Gists</a></p>
<p><img src="https://tanaikech.github.io/image-storage/20240501a/fig1.jpg" alt=""></p>
<h1 id="abstract">Abstract</h1>
<p>This report explores controlling output formats for the Gemini API. Traditionally, prompts dictated the format. A new property, &ldquo;response_mime_type&rdquo;, allows specifying the format (e.g., JSON) directly. Testing confirms this property improves control over output format, especially for complex JSON schemas. The recommended approach is to combine a detailed JSON schema with &ldquo;response_mime_type&rdquo; for clear and consistent outputs.</p>
<h1 id="introduction">Introduction</h1>
<p>One of the key challenges when working with the Gemini API is ensuring the output data is in the format your application requires. Traditionally, the response format heavily relied on the specific prompt you provided. For example, retrieving data as a JSON object necessitated including a &ldquo;Return JSON&rdquo; prompt within your input text. This approach could be cumbersome and introduce potential errors if the desired format wasn&rsquo;t explicitly requested.</p>
<p>To address this limitation, a new property called &ldquo;response_mime_type&rdquo; was recently introduced as part of the GenerationConfig configuration. <a href="https://ai.google.dev/api/rest/v1beta/GenerationConfig">Ref</a> and <a href="https://ai.google.dev/gemini-api/docs/api-overview#json">Ref</a> This property allows you to explicitly specify the desired output format, such as JSON. This enhancement significantly improves the controllability and predictability of the Gemini API&rsquo;s response format.</p>
<p>This report builds upon my previous work on specifying output types for Gemini API using Google Apps Script. <a href="https://medium.com/google-cloud/specifying-output-types-for-gemini-api-with-google-apps-script-c2f6a753c8d7">Ref</a> Here, we&rsquo;ll delve deeper into testing the controllability of output formats using the &ldquo;response_mime_type&rdquo; property. We&rsquo;ll compare and analyze the behavior with and without this property, along with exploring its usage in function calls.</p>
<h1 id="usage">Usage</h1>
<p>In order to test this script, please do the following steps.</p>
<h2 id="1-create-an-api-key">1. Create an API key</h2>
<p>Please access <a href="https://makersuite.google.com/app/apikey">https://makersuite.google.com/app/apikey</a> and create your API key. At that time, please enable Generative Language API at the API console. This API key is used for this sample script.</p>
<p>This official document can also be seen. <a href="https://ai.google.dev/">Ref</a>.</p>
<h2 id="2-create-a-google-apps-script-project">2. Create a Google Apps Script project</h2>
<p>In this report, Google Apps Script is used. Of course, the method introducing this report can also be used in other languages.</p>
<p>Please create a standalone Google Apps Script project. Of course, this script can also be used with the container-bound script.</p>
<p>And, please open the script editor of the Google Apps Script project.</p>
<h2 id="3-base-script">3. Base script</h2>
<p>The base script is as follows.</p>
<ul>
<li><code>sample1_</code>: The output type is tried to control by the prompt.</li>
<li><code>sample2_</code>: The output type is tried to control by the function call. This is from <a href="https://medium.com/google-cloud/specifying-output-types-for-gemini-api-with-google-apps-script-c2f6a753c8d7">this report</a>.</li>
<li><code>sample3_</code>: The output type is tried to control by the property &ldquo;response_mime_type&rdquo;.</li>
</ul>
<p>When you use this script, please execute <code>main</code> function. But, in that case, please set your API key. In the following section, the value of <code>prompt</code> is changed and the result values are shown.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sample1_</span>({ <span style="color:#a6e22e">apiKey</span>, <span style="color:#a6e22e">model</span>, <span style="color:#a6e22e">version</span>, <span style="color:#a6e22e">prompt</span> }) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`https://generativelanguage.googleapis.com/</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">version</span><span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">model</span><span style="color:#e6db74">}</span><span style="color:#e6db74">:generateContent?key=</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">apiKey</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">payload</span> <span style="color:#f92672">=</span> { <span style="color:#a6e22e">contents</span><span style="color:#f92672">:</span> [{ <span style="color:#a6e22e">parts</span><span style="color:#f92672">:</span> [{ <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">prompt</span> }] }] };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">options</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">payload</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">payload</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">contentType</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;application/json&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">muteHttpExceptions</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">options</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">getContentText</span>());
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">candidates</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">candidates</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">content</span>.<span style="color:#a6e22e">parts</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">candidates</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">content</span>.<span style="color:#a6e22e">parts</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">text</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;No response.&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sample2_</span>({ <span style="color:#a6e22e">apiKey</span>, <span style="color:#a6e22e">model</span>, <span style="color:#a6e22e">version</span>, <span style="color:#a6e22e">prompt</span> }) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">functions</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">customType_array</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">e</span>) =&gt; <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">items</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">customType_object</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">e</span>) =&gt; <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">items</span>,
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`https://generativelanguage.googleapis.com/</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">version</span><span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">model</span><span style="color:#e6db74">}</span><span style="color:#e6db74">:generateContent?key=</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">apiKey</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">payload</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">contents</span><span style="color:#f92672">:</span> [{ <span style="color:#a6e22e">parts</span><span style="color:#f92672">:</span> [{ <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">prompt</span> }], <span style="color:#a6e22e">role</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;user&#34;</span> }],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">tools</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">function_declarations</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;customType_array&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>              <span style="color:#e6db74">&#34;Output type is array type. When the output type is array type, this is used. No descriptions and explanations.&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">parameters</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;OBJECT&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">properties</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">items</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>                  <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;ARRAY&#34;</span>,
</span></span><span style="display:flex;"><span>                  <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;Output type is array type. When the output type is array type, this is used. No descriptions and explanations.&#34;</span>,
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>              },
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">required</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;items&#34;</span>],
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;customType_object&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>              <span style="color:#e6db74">&#34;Output type is JSON object type. When the output type is object type, this is used. No descriptions and explanations.&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">parameters</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;OBJECT&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">properties</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">items</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>                  <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;OBJECT&#34;</span>,
</span></span><span style="display:flex;"><span>                  <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;Output type is JSON object type. When the output type is object type, this is used. No descriptions and explanations.&#34;</span>,
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>              },
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">required</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;items&#34;</span>],
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">options</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">payload</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">payload</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">contentType</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;application/json&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">muteHttpExceptions</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">options</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">candidates</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">getContentText</span>());
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">parts</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">candidates</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">candidates</span>[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">?</span>.<span style="color:#a6e22e">content</span><span style="color:#f92672">?</span>.<span style="color:#a6e22e">parts</span>) <span style="color:#f92672">||</span> [];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">check</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">parts</span>.<span style="color:#a6e22e">find</span>((<span style="color:#a6e22e">o</span>) =&gt; <span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">hasOwnProperty</span>(<span style="color:#e6db74">&#34;functionCall&#34;</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">check</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">functions</span>[<span style="color:#a6e22e">check</span>.<span style="color:#a6e22e">functionCall</span>.<span style="color:#a6e22e">name</span>](<span style="color:#a6e22e">check</span>.<span style="color:#a6e22e">functionCall</span>.<span style="color:#a6e22e">args</span> <span style="color:#f92672">||</span> <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;No response.&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sample3_</span>({ <span style="color:#a6e22e">apiKey</span>, <span style="color:#a6e22e">model</span>, <span style="color:#a6e22e">version</span>, <span style="color:#a6e22e">prompt</span> }) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`https://generativelanguage.googleapis.com/</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">version</span><span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">model</span><span style="color:#e6db74">}</span><span style="color:#e6db74">:generateContent?key=</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">apiKey</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">payload</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">contents</span><span style="color:#f92672">:</span> [{ <span style="color:#a6e22e">parts</span><span style="color:#f92672">:</span> [{ <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">prompt</span> }] }],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">generationConfig</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">response_mime_type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;application/json&#34;</span> },
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">options</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">payload</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">payload</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">contentType</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;application/json&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">muteHttpExceptions</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">options</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">getContentText</span>());
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">candidates</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">candidates</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">content</span>.<span style="color:#a6e22e">parts</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">candidates</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">content</span>.<span style="color:#a6e22e">parts</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">text</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;No response.&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// This is a main function.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">prompt</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>; <span style="color:#75715e">// In this report, it tests by changing this value.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">apiKey</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>; <span style="color:#75715e">// Please set your API key.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">model</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;models/gemini-1.5-pro-latest&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">version</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;v1beta&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">functions</span> <span style="color:#f92672">=</span> [<span style="color:#a6e22e">sample1_</span>, <span style="color:#a6e22e">sample2_</span>, <span style="color:#a6e22e">sample3_</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">functions</span>.<span style="color:#a6e22e">forEach</span>((<span style="color:#a6e22e">f</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">f</span>({ <span style="color:#a6e22e">apiKey</span>, <span style="color:#a6e22e">model</span>, <span style="color:#a6e22e">version</span>, <span style="color:#a6e22e">prompt</span> });
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>);
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="4-sample-prompts">4. Sample prompts</h2>
<p>In order to investigate the output formats from Gemini API, several prompts were tested as follows.</p>
<h3 id="sample-1">Sample 1</h3>
<p>In this sample, the following script is run. The value of this prompt is from <a href="https://ai.google.dev/gemini-api/docs/api-overview#json">this official document</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">prompt</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;List 5 popular cookie recipes using this JSON schema: { &#34;type&#34;: &#34;object&#34;, &#34;properties&#34;: { &#34;recipe_name&#34;: { &#34;type&#34;: &#34;string&#34; },}}&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">apiKey</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>; <span style="color:#75715e">// Please set your API key.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">model</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;models/gemini-1.5-pro-latest&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">version</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;v1beta&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">functions</span> <span style="color:#f92672">=</span> [<span style="color:#a6e22e">sample1_</span>, <span style="color:#a6e22e">sample2_</span>, <span style="color:#a6e22e">sample3_</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">functions</span>.<span style="color:#a6e22e">forEach</span>((<span style="color:#a6e22e">f</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">f</span>({ <span style="color:#a6e22e">apiKey</span>, <span style="color:#a6e22e">model</span>, <span style="color:#a6e22e">version</span>, <span style="color:#a6e22e">prompt</span> });
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>);
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When this script is run, the following result is obtained.</p>
<p>From <code>sample1_</code></p>
<pre tabindex="0"><code>```json
{
  &#34;type&#34;: &#34;object&#34;,
  &#34;properties&#34;: {
    &#34;recipe_name&#34;: {
      &#34;type&#34;: &#34;string&#34;,
      &#34;enum&#34;: [&#34;Chocolate Chip Cookies&#34;, &#34;Peanut Butter Cookies&#34;, &#34;Oatmeal Raisin Cookies&#34;, &#34;Sugar Cookies&#34;, &#34;Snickerdoodle Cookies&#34;]
    }
  }
}
```
</code></pre><p>From <code>sample2_</code></p>
<pre tabindex="0"><code>[ { recipe_name: &#39;Chocolate Chip Cookies&#39; },
  { recipe_name: &#39;Peanut Butter Cookies&#39; },
  { recipe_name: &#39;Oatmeal Raisin Cookies&#39; },
  { recipe_name: &#39;Sugar Cookies&#39; },
  { recipe_name: &#39;Shortbread Cookies&#39; } ]
</code></pre><p>From <code>sample3_</code></p>
<pre tabindex="0"><code>[
  {
    &#34;recipe_name&#34;: &#34;Chocolate Chip Cookies&#34;
  },
  {
    &#34;recipe_name&#34;: &#34;Peanut Butter Cookies&#34;
  },
  {
    &#34;recipe_name&#34;: &#34;Oatmeal Raisin Cookies&#34;
  },
  {
    &#34;recipe_name&#34;: &#34;Sugar Cookies&#34;
  },
  {
    &#34;recipe_name&#34;: &#34;Snickerdoodle Cookies&#34;
  }
]
</code></pre><p>In the case of this prompt, <code>sample1_</code> returned the updated structure of given JSON schema with the markdown format. The function call and the property &ldquo;response_mime_type&rdquo; returned the correct values. For example, when the following prompt is used,</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">prompt</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">`List 5 popular cookie recipes using this an array including JSON schema`</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">`&lt;Format&gt;`</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">`[{&#34;recipe_name&#34;: &#34;name&#34;}]`</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">`&lt;/Format&gt;`</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">`Return only array including JSON data. No markdown format. No descriptions.`</span>,
</span></span><span style="display:flex;"><span>].<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;\n&#34;</span>);
</span></span></code></pre></div><p><code>sample1_</code> returned the following result.</p>
<pre tabindex="0"><code>```json
[
  { &#34;recipe_name&#34;: &#34;Chocolate Chip Cookies&#34; },
  { &#34;recipe_name&#34;: &#34;Peanut Butter Cookies&#34; },
  { &#34;recipe_name&#34;: &#34;Oatmeal Raisin Cookies&#34; },
  { &#34;recipe_name&#34;: &#34;Sugar Cookies&#34; },
  { &#34;recipe_name&#34;: &#34;Snickerdoodles&#34; }
]
```
</code></pre><h3 id="sample-2">Sample 2</h3>
<p>In this sample, the following script is run. The value of this prompt was updated the prompt of <a href="https://ai.google.dev/gemini-api/docs/api-overview#json">this official document</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">jsonSchema</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Recipe names&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Names of recipe.&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">properties</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">recipe_name</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Names of recipe.&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">materials</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Requirement materials for running the recipe.&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;array&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">items</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Requirement material for running the recipe.&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">prompt</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`List 5 popular cookie recipes and include the required materials for each recipe as JSON schema.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&lt;JSONSchema&gt;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">jsonSchema</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&lt;/JSONSchema&gt;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`Return only array including JSON data. No markdown format. No descriptions.`</span>,
</span></span><span style="display:flex;"><span>  ].<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;\n&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">apiKey</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>; <span style="color:#75715e">// Please set your API key.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">model</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;models/gemini-1.5-pro-latest&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">version</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;v1beta&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">functions</span> <span style="color:#f92672">=</span> [<span style="color:#a6e22e">sample1_</span>, <span style="color:#a6e22e">sample2_</span>, <span style="color:#a6e22e">sample3_</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">functions</span>.<span style="color:#a6e22e">forEach</span>((<span style="color:#a6e22e">f</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">f</span>({ <span style="color:#a6e22e">apiKey</span>, <span style="color:#a6e22e">model</span>, <span style="color:#a6e22e">version</span>, <span style="color:#a6e22e">prompt</span> });
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>);
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When this script is run, the following result is obtained.</p>
<p>From <code>sample1_</code></p>
<pre tabindex="0"><code>```json
[
  {
    &#34;recipe_name&#34;: &#34;Chocolate Chip Cookies&#34;,
    &#34;materials&#34;: [
      &#34;Flour&#34;,
      &#34;Sugar&#34;,
      &#34;Brown Sugar&#34;,
      &#34;Eggs&#34;,
      &#34;Butter&#34;,
      &#34;Chocolate Chips&#34;,
      &#34;Vanilla Extract&#34;,
      &#34;Baking Soda&#34;,
      &#34;Salt&#34;
    ]
  },
  {
    &#34;recipe_name&#34;: &#34;Peanut Butter Cookies&#34;,
    &#34;materials&#34;: [
      &#34;Flour&#34;,
      &#34;Sugar&#34;,
      &#34;Brown Sugar&#34;,
      &#34;Eggs&#34;,
      &#34;Peanut Butter&#34;,
      &#34;Vanilla Extract&#34;,
      &#34;Baking Soda&#34;,
      &#34;Salt&#34;
    ]
  },
  {
    &#34;recipe_name&#34;: &#34;Oatmeal Raisin Cookies&#34;,
    &#34;materials&#34;: [
      &#34;Flour&#34;,
      &#34;Sugar&#34;,
      &#34;Brown Sugar&#34;,
      &#34;Eggs&#34;,
      &#34;Butter&#34;,
      &#34;Oats&#34;,
      &#34;Raisins&#34;,
      &#34;Vanilla Extract&#34;,
      &#34;Baking Soda&#34;,
      &#34;Salt&#34;,
      &#34;Cinnamon&#34;
    ]
  },
  {
    &#34;recipe_name&#34;: &#34;Sugar Cookies&#34;,
    &#34;materials&#34;: [
      &#34;Flour&#34;,
      &#34;Sugar&#34;,
      &#34;Eggs&#34;,
      &#34;Butter&#34;,
      &#34;Vanilla Extract&#34;,
      &#34;Baking Powder&#34;,
      &#34;Salt&#34;
    ]
  },
  {
    &#34;recipe_name&#34;: &#34;Snickerdoodle Cookies&#34;,
    &#34;materials&#34;: [
      &#34;Flour&#34;,
      &#34;Sugar&#34;,
      &#34;Eggs&#34;,
      &#34;Butter&#34;,
      &#34;Cream of Tartar&#34;,
      &#34;Baking Soda&#34;,
      &#34;Salt&#34;,
      &#34;Cinnamon&#34;
    ]
  }
]
```
</code></pre><p>From <code>sample2_</code></p>
<pre tabindex="0"><code>[ { recipe_name: &#39;Chocolate Chip Cookies&#39;,
    materials: [ &#39;flour&#39;, &#39;sugar&#39;, &#39;chocolate chips&#39;, &#39;eggs&#39;, &#39;butter&#39; ] },
  { recipe_name: &#39;Peanut Butter Cookies&#39;,
    materials: [ &#39;flour&#39;, &#39;sugar&#39;, &#39;peanut butter&#39;, &#39;eggs&#39;, &#39;butter&#39; ] },
  { materials: [ &#39;flour&#39;, &#39;sugar&#39;, &#39;oats&#39;, &#39;raisins&#39;, &#39;eggs&#39;, &#39;butter&#39; ],
    recipe_name: &#39;Oatmeal Raisin Cookies&#39; },
  { materials: [ &#39;flour&#39;, &#39;sugar&#39;, &#39;eggs&#39;, &#39;butter&#39;, &#39;vanilla extract&#39; ],
    recipe_name: &#39;Sugar Cookies&#39; },
  { materials:
     [ &#39;flour&#39;,
       &#39;sugar&#39;,
       &#39;cinnamon&#39;,
       &#39;eggs&#39;,
       &#39;butter&#39;,
       &#39;cream of tartar&#39; ],
    recipe_name: &#39;Snickerdoodles&#39; } ]
</code></pre><p>From <code>sample3_</code></p>
<pre tabindex="0"><code>[
  {
    &#34;recipe_name&#34;:&#34;Chocolate Chip Cookies&#34;,
    &#34;materials&#34;:[
      &#34;flour&#34;,
      &#34;sugar&#34;,
      &#34;brown sugar&#34;,
      &#34;eggs&#34;,
      &#34;butter&#34;,
      &#34;vanilla extract&#34;,
      &#34;chocolate chips&#34;
    ]
  },
  {
    &#34;recipe_name&#34;:&#34;Peanut Butter Cookies&#34;,
    &#34;materials&#34;:[
      &#34;flour&#34;,
      &#34;sugar&#34;,
      &#34;brown sugar&#34;,
      &#34;eggs&#34;,
      &#34;peanut butter&#34;,
      &#34;vanilla extract&#34;,
      &#34;baking soda&#34;,
      &#34;salt&#34;
    ]
  },
  {
    &#34;recipe_name&#34;:&#34;Oatmeal Raisin Cookies&#34;,
    &#34;materials&#34;:[
      &#34;flour&#34;,
      &#34;sugar&#34;,
      &#34;brown sugar&#34;,
      &#34;eggs&#34;,
      &#34;butter&#34;,
      &#34;vanilla extract&#34;,
      &#34;oats&#34;,
      &#34;raisins&#34;,
      &#34;cinnamon&#34;,
      &#34;nutmeg&#34;
    ]
  },
  {
    &#34;recipe_name&#34;:&#34;Sugar Cookies&#34;,
    &#34;materials&#34;:[
      &#34;flour&#34;,
      &#34;sugar&#34;,
      &#34;eggs&#34;,
      &#34;butter&#34;,
      &#34;vanilla extract&#34;,
      &#34;baking powder&#34;,
      &#34;salt&#34;
    ]
  },
  {
    &#34;recipe_name&#34;:&#34;Snickerdoodles&#34;,
    &#34;materials&#34;:[
      &#34;flour&#34;,
      &#34;sugar&#34;,
      &#34;eggs&#34;,
      &#34;butter&#34;,
      &#34;cream of tartar&#34;,
      &#34;baking soda&#34;,
      &#34;cinnamon&#34;
    ]
  }
]
</code></pre><p>From these results, it was found that Gemini API can correctly understand the JSON schema.</p>
<h3 id="sample-3">Sample 3</h3>
<p>In this sample, the following script is run. The value of this prompt was updated more the prompt of <a href="https://ai.google.dev/gemini-api/docs/api-overview#json">this official document</a>. The structure of the output JSON object is more complicated.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">jsonSchema</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Recipe names&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Names of recipe.&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">properties</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">recipe_name</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Names of recipe.&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">materials</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Requirement materials for running the recipe.&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;array&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">items</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">properties</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">material</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Requirement material for running the recipe.&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">amount</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;Requirement amount of material for running the recipe. Unit is grams.&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;number&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">cost</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;Cost of requirement material for running the recipe. Unit is dollar.&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;number&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">required</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;material&#34;</span>, <span style="color:#e6db74">&#34;material&#34;</span>, <span style="color:#e6db74">&#34;cost&#34;</span>],
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">additionalProperties</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">prompt</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`List 5 popular cookie recipes and include the required materials and required amount of materials and costs for each recipe as JSON schema.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&lt;JSONSchema&gt;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">jsonSchema</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&lt;/JSONSchema&gt;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`Return only array including JSON data. No markdown format. No descriptions.`</span>,
</span></span><span style="display:flex;"><span>  ].<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;\n&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">apiKey</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>; <span style="color:#75715e">// Please set your API key.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">model</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;models/gemini-1.5-pro-latest&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">version</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;v1beta&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">functions</span> <span style="color:#f92672">=</span> [<span style="color:#a6e22e">sample1_</span>, <span style="color:#a6e22e">sample2_</span>, <span style="color:#a6e22e">sample3_</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">functions</span>.<span style="color:#a6e22e">forEach</span>((<span style="color:#a6e22e">f</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">f</span>({ <span style="color:#a6e22e">apiKey</span>, <span style="color:#a6e22e">model</span>, <span style="color:#a6e22e">version</span>, <span style="color:#a6e22e">prompt</span> });
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>);
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When this script is run, the following result is obtained.</p>
<p>From <code>sample1_</code></p>
<pre tabindex="0"><code>```json
[
  {
    &#34;recipe_name&#34;: &#34;Chocolate Chip Cookies&#34;,
    &#34;materials&#34;: [
      {
        &#34;material&#34;: &#34;All-purpose flour&#34;,
        &#34;amount&#34;: 225,
        &#34;cost&#34;: 0.5
      },
      {
        &#34;material&#34;: &#34;Baking soda&#34;,
        &#34;amount&#34;: 1,
        &#34;cost&#34;: 0.1
      },
      {
        &#34;material&#34;: &#34;Salt&#34;,
        &#34;amount&#34;: 0.5,
        &#34;cost&#34;: 0.05
      },
      {
        &#34;material&#34;: &#34;Unsalted butter&#34;,
        &#34;amount&#34;: 170,
        &#34;cost&#34;: 2
      },
      {
        &#34;material&#34;: &#34;Granulated sugar&#34;,
        &#34;amount&#34;: 100,
        &#34;cost&#34;: 0.3
      },
      {
        &#34;material&#34;: &#34;Brown sugar&#34;,
        &#34;amount&#34;: 150,
        &#34;cost&#34;: 0.4
      },
      {
        &#34;material&#34;: &#34;Eggs&#34;,
        &#34;amount&#34;: 100,
        &#34;cost&#34;: 0.5
      },
      {
        &#34;material&#34;: &#34;Vanilla extract&#34;,
        &#34;amount&#34;: 2,
        &#34;cost&#34;: 0.2
      },
      {
        &#34;material&#34;: &#34;Chocolate chips&#34;,
        &#34;amount&#34;: 300,
        &#34;cost&#34;: 3
      }
    ]
  },
  {
    &#34;recipe_name&#34;: &#34;Peanut Butter Cookies&#34;,
    &#34;materials&#34;: [
      {
        &#34;material&#34;: &#34;All-purpose flour&#34;,
        &#34;amount&#34;: 150,
        &#34;cost&#34;: 0.3
      },
      {
        &#34;material&#34;: &#34;Baking soda&#34;,
        &#34;amount&#34;: 0.5,
        &#34;cost&#34;: 0.05
      },
      {
        &#34;material&#34;: &#34;Salt&#34;,
        &#34;amount&#34;: 0.5,
        &#34;cost&#34;: 0.05
      },
      {
        &#34;material&#34;: &#34;Unsalted butter&#34;,
        &#34;amount&#34;: 115,
        &#34;cost&#34;: 1.38
      },
      {
        &#34;material&#34;: &#34;Peanut butter&#34;,
        &#34;amount&#34;: 120,
        &#34;cost&#34;: 1.5
      },
      {
        &#34;material&#34;: &#34;Granulated sugar&#34;,
        &#34;amount&#34;: 75,
        &#34;cost&#34;: 0.22
      },
      {
        &#34;material&#34;: &#34;Brown sugar&#34;,
        &#34;amount&#34;: 75,
        &#34;cost&#34;: 0.22
      },
      {
        &#34;material&#34;: &#34;Eggs&#34;,
        &#34;amount&#34;: 50,
        &#34;cost&#34;: 0.25
      },
      {
        &#34;material&#34;: &#34;Vanilla extract&#34;,
        &#34;amount&#34;: 1,
        &#34;cost&#34;: 0.1
      }
    ]
  },
  {
    &#34;recipe_name&#34;: &#34;Oatmeal Raisin Cookies&#34;,
    &#34;materials&#34;: [
      {
        &#34;material&#34;: &#34;All-purpose flour&#34;,
        &#34;amount&#34;: 150,
        &#34;cost&#34;: 0.3
      },
      {
        &#34;material&#34;: &#34;Baking soda&#34;,
        &#34;amount&#34;: 0.5,
        &#34;cost&#34;: 0.05
      },
      {
        &#34;material&#34;: &#34;Salt&#34;,
        &#34;amount&#34;: 0.25,
        &#34;cost&#34;: 0.03
      },
      {
        &#34;material&#34;: &#34;Ground cinnamon&#34;,
        &#34;amount&#34;: 1,
        &#34;cost&#34;: 0.1
      },
      {
        &#34;material&#34;: &#34;Unsalted butter&#34;,
        &#34;amount&#34;: 115,
        &#34;cost&#34;: 1.38
      },
      {
        &#34;material&#34;: &#34;Granulated sugar&#34;,
        &#34;amount&#34;: 75,
        &#34;cost&#34;: 0.22
      },
      {
        &#34;material&#34;: &#34;Brown sugar&#34;,
        &#34;amount&#34;: 75,
        &#34;cost&#34;: 0.22
      },
      {
        &#34;material&#34;: &#34;Eggs&#34;,
        &#34;amount&#34;: 50,
        &#34;cost&#34;: 0.25
      },
      {
        &#34;material&#34;: &#34;Vanilla extract&#34;,
        &#34;amount&#34;: 1,
        &#34;cost&#34;: 0.1
      },
      {
        &#34;material&#34;: &#34;Rolled oats&#34;,
        &#34;amount&#34;: 150,
        &#34;cost&#34;: 0.5
      },
      {
        &#34;material&#34;: &#34;Raisins&#34;,
        &#34;amount&#34;: 100,
        &#34;cost&#34;: 1
      }
    ]
  },
  {
    &#34;recipe_name&#34;: &#34;Sugar Cookies&#34;,
    &#34;materials&#34;: [
      {
        &#34;material&#34;: &#34;All-purpose flour&#34;,
        &#34;amount&#34;: 300,
        &#34;cost&#34;: 0.6
      },
      {
        &#34;material&#34;: &#34;Baking powder&#34;,
        &#34;amount&#34;: 2,
        &#34;cost&#34;: 0.15
      },
      {
        &#34;material&#34;: &#34;Salt&#34;,
        &#34;amount&#34;: 1,
        &#34;cost&#34;: 0.1
      },
      {
        &#34;material&#34;: &#34;Unsalted butter&#34;,
        &#34;amount&#34;: 225,
        &#34;cost&#34;: 2.7
      },
      {
        &#34;material&#34;: &#34;Granulated sugar&#34;,
        &#34;amount&#34;: 150,
        &#34;cost&#34;: 0.45
      },
      {
        &#34;material&#34;: &#34;Eggs&#34;,
        &#34;amount&#34;: 50,
        &#34;cost&#34;: 0.25
      },
      {
        &#34;material&#34;: &#34;Vanilla extract&#34;,
        &#34;amount&#34;: 2,
        &#34;cost&#34;: 0.2
      },
      {
        &#34;material&#34;: &#34;Almond extract&#34;,
        &#34;amount&#34;: 1,
        &#34;cost&#34;: 0.15
      }
    ]
  },
  {
    &#34;recipe_name&#34;: &#34;Shortbread Cookies&#34;,
    &#34;materials&#34;: [
      {
        &#34;material&#34;: &#34;All-purpose flour&#34;,
        &#34;amount&#34;: 255,
        &#34;cost&#34;: 0.51
      },
      {
        &#34;material&#34;: &#34;Salt&#34;,
        &#34;amount&#34;: 0.5,
        &#34;cost&#34;: 0.05
      },
      {
        &#34;material&#34;: &#34;Unsalted butter&#34;,
        &#34;amount&#34;: 225,
        &#34;cost&#34;: 2.7
      },
      {
        &#34;material&#34;: &#34;Powdered sugar&#34;,
        &#34;amount&#34;: 60,
        &#34;cost&#34;: 0.3
      }
    ]
  }
]
```
</code></pre><p>From <code>sample2_</code></p>
<pre tabindex="0"><code>No response.
</code></pre><p>In this case, the following error occurred. Unfortunately, when I tested this several times to <code>sample2_</code>, the following error often occurred.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;error&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;code&#34;</span>: <span style="color:#ae81ff">500</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;message&#34;</span>: <span style="color:#e6db74">&#34;An internal error has occurred. Please retry or report in https://developers.generativeai.google/guide/troubleshooting&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;status&#34;</span>: <span style="color:#e6db74">&#34;INTERNAL&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>From <code>sample3_</code></p>
<pre tabindex="0"><code>[
  {
    &#34;recipe_name&#34;:&#34;Chocolate Chip Cookies&#34;,
    &#34;materials&#34;:[
      {
        &#34;material&#34;:&#34;Butter&#34;,
        &#34;amount&#34;:226,
        &#34;cost&#34;:2.5
      },
      {
        &#34;material&#34;:&#34;White sugar&#34;,
        &#34;amount&#34;:150,
        &#34;cost&#34;:0.5
      },
      {
        &#34;material&#34;:&#34;Brown sugar&#34;,
        &#34;amount&#34;:220,
        &#34;cost&#34;:0.7
      },
      {
        &#34;material&#34;:&#34;Eggs&#34;,
        &#34;amount&#34;:100,
        &#34;cost&#34;:0.5
      },
      {
        &#34;material&#34;:&#34;Vanilla extract&#34;,
        &#34;amount&#34;:5,
        &#34;cost&#34;:0.5
      },
      {
        &#34;material&#34;:&#34;All-purpose flour&#34;,
        &#34;amount&#34;:375,
        &#34;cost&#34;:1
      },
      {
        &#34;material&#34;:&#34;Baking soda&#34;,
        &#34;amount&#34;:5,
        &#34;cost&#34;:0.2
      },
      {
        &#34;material&#34;:&#34;Hot water&#34;,
        &#34;amount&#34;:2,
        &#34;cost&#34;:0
      },
      {
        &#34;material&#34;:&#34;Salt&#34;,
        &#34;amount&#34;:5,
        &#34;cost&#34;:0.1
      },
      {
        &#34;material&#34;:&#34;Chocolate chips&#34;,
        &#34;amount&#34;:340,
        &#34;cost&#34;:3
      }
    ]
  },
  {
    &#34;recipe_name&#34;:&#34;Peanut Butter Cookies&#34;,
    &#34;materials&#34;:[
      {
        &#34;material&#34;:&#34;Butter&#34;,
        &#34;amount&#34;:115,
        &#34;cost&#34;:1.25
      },
      {
        &#34;material&#34;:&#34;Peanut butter&#34;,
        &#34;amount&#34;:115,
        &#34;cost&#34;:1.5
      },
      {
        &#34;material&#34;:&#34;White sugar&#34;,
        &#34;amount&#34;:70,
        &#34;cost&#34;:0.25
      },
      {
        &#34;material&#34;:&#34;Brown sugar&#34;,
        &#34;amount&#34;:70,
        &#34;cost&#34;:0.25
      },
      {
        &#34;material&#34;:&#34;Egg&#34;,
        &#34;amount&#34;:50,
        &#34;cost&#34;:0.25
      },
      {
        &#34;material&#34;:&#34;Vanilla extract&#34;,
        &#34;amount&#34;:5,
        &#34;cost&#34;:0.5
      },
      {
        &#34;material&#34;:&#34;All-purpose flour&#34;,
        &#34;amount&#34;:160,
        &#34;cost&#34;:0.5
      },
      {
        &#34;material&#34;:&#34;Baking soda&#34;,
        &#34;amount&#34;:2,
        &#34;cost&#34;:0.05
      },
      {
        &#34;material&#34;:&#34;Salt&#34;,
        &#34;amount&#34;:2,
        &#34;cost&#34;:0.05
      }
    ]
  },
  {
    &#34;recipe_name&#34;:&#34;Oatmeal Cookies&#34;,
    &#34;materials&#34;:[
      {
        &#34;material&#34;:&#34;Butter&#34;,
        &#34;amount&#34;:115,
        &#34;cost&#34;:1.25
      },
      {
        &#34;material&#34;:&#34;White sugar&#34;,
        &#34;amount&#34;:150,
        &#34;cost&#34;:0.5
      },
      {
        &#34;material&#34;:&#34;Brown sugar&#34;,
        &#34;amount&#34;:115,
        &#34;cost&#34;:0.5
      },
      {
        &#34;material&#34;:&#34;Eggs&#34;,
        &#34;amount&#34;:100,
        &#34;cost&#34;:0.5
      },
      {
        &#34;material&#34;:&#34;Vanilla extract&#34;,
        &#34;amount&#34;:5,
        &#34;cost&#34;:0.5
      },
      {
        &#34;material&#34;:&#34;All-purpose flour&#34;,
        &#34;amount&#34;:190,
        &#34;cost&#34;:0.6
      },
      {
        &#34;material&#34;:&#34;Baking soda&#34;,
        &#34;amount&#34;:2,
        &#34;cost&#34;:0.05
      },
      {
        &#34;material&#34;:&#34;Ground cinnamon&#34;,
        &#34;amount&#34;:2,
        &#34;cost&#34;:0.1
      },
      {
        &#34;material&#34;:&#34;Salt&#34;,
        &#34;amount&#34;:2,
        &#34;cost&#34;:0.05
      },
      {
        &#34;material&#34;:&#34;Oats&#34;,
        &#34;amount&#34;:230,
        &#34;cost&#34;:0.8
      }
    ]
  },
  {
    &#34;recipe_name&#34;:&#34;Sugar Cookies&#34;,
    &#34;materials&#34;:[
      {
        &#34;material&#34;:&#34;Butter&#34;,
        &#34;amount&#34;:226,
        &#34;cost&#34;:2.5
      },
      {
        &#34;material&#34;:&#34;White sugar&#34;,
        &#34;amount&#34;:150,
        &#34;cost&#34;:0.5
      },
      {
        &#34;material&#34;:&#34;Eggs&#34;,
        &#34;amount&#34;:100,
        &#34;cost&#34;:0.5
      },
      {
        &#34;material&#34;:&#34;Vanilla extract&#34;,
        &#34;amount&#34;:5,
        &#34;cost&#34;:0.5
      },
      {
        &#34;material&#34;:&#34;All-purpose flour&#34;,
        &#34;amount&#34;:340,
        &#34;cost&#34;:1
      },
      {
        &#34;material&#34;:&#34;Baking powder&#34;,
        &#34;amount&#34;:5,
        &#34;cost&#34;:0.2
      },
      {
        &#34;material&#34;:&#34;Salt&#34;,
        &#34;amount&#34;:2,
        &#34;cost&#34;:0.05
      }
    ]
  },
  {
    &#34;recipe_name&#34;:&#34;Snickerdoodle Cookies&#34;,
    &#34;materials&#34;:[
      {
        &#34;material&#34;:&#34;Butter&#34;,
        &#34;amount&#34;:190,
        &#34;cost&#34;:2
      },
      {
        &#34;material&#34;:&#34;Shortening&#34;,
        &#34;amount&#34;:115,
        &#34;cost&#34;:1
      },
      {
        &#34;material&#34;:&#34;White sugar&#34;,
        &#34;amount&#34;:150,
        &#34;cost&#34;:0.5
      },
      {
        &#34;material&#34;:&#34;Brown sugar&#34;,
        &#34;amount&#34;:200,
        &#34;cost&#34;:0.6
      },
      {
        &#34;material&#34;:&#34;Eggs&#34;,
        &#34;amount&#34;:100,
        &#34;cost&#34;:0.5
      },
      {
        &#34;material&#34;:&#34;Vanilla extract&#34;,
        &#34;amount&#34;:5,
        &#34;cost&#34;:0.5
      },
      {
        &#34;material&#34;:&#34;All-purpose flour&#34;,
        &#34;amount&#34;:290,
        &#34;cost&#34;:0.8
      },
      {
        &#34;material&#34;:&#34;Cream of tartar&#34;,
        &#34;amount&#34;:4,
        &#34;cost&#34;:0.2
      },
      {
        &#34;material&#34;:&#34;Baking soda&#34;,
        &#34;amount&#34;:2,
        &#34;cost&#34;:0.05
      },
      {
        &#34;material&#34;:&#34;Salt&#34;,
        &#34;amount&#34;:2,
        &#34;cost&#34;:0.05
      },
      {
        &#34;material&#34;:&#34;Ground cinnamon&#34;,
        &#34;amount&#34;:15,
        &#34;cost&#34;:0.5
      },
      {
        &#34;material&#34;:&#34;White sugar&#34;,
        &#34;amount&#34;:40,
        &#34;cost&#34;:0.15
      }
    ]
  }
]
</code></pre><p>From these results, it was found that the function call is not suitable for the complicated JSON schema.</p>
<h3 id="sample-4">Sample 4</h3>
<p>From the above results, it is considered that the output format can be controlled by only the JSON schema with Gemini API as the following image.</p>
<p><img src="https://tanaikech.github.io/image-storage/20240501a/fig2.png" alt=""></p>
<p>So, I tested the following sample script. In this sample, only the function <code>sample3_</code> is used. Please be careful about this.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">jsonSchema</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;5 popular cookie recipes&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;List 5 popular cookie recipes by including the following properties.&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">properties</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">recipe_name</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Names of recipe.&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">materials</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Requirement materials for running the recipe.&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;array&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">items</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">properties</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">material</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Requirement material for running the recipe.&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">amount</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;Requirement amount of material for running the recipe. Unit is grams.&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;number&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">cost</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;Cost of requirement material for running the recipe. Unit is dollar.&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;number&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">required</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;material&#34;</span>, <span style="color:#e6db74">&#34;material&#34;</span>, <span style="color:#e6db74">&#34;cost&#34;</span>],
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">additionalProperties</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">prompt</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`Follow JSON schema.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&lt;JSONSchema&gt;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">jsonSchema</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&lt;/JSONSchema&gt;`</span>,
</span></span><span style="display:flex;"><span>  ].<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;\n&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">apiKey</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>; <span style="color:#75715e">// Please set your API key.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">model</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;models/gemini-1.5-pro-latest&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">version</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;v1beta&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">functions</span> <span style="color:#f92672">=</span> [<span style="color:#a6e22e">sample3_</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">functions</span>.<span style="color:#a6e22e">forEach</span>((<span style="color:#a6e22e">f</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">f</span>({ <span style="color:#a6e22e">apiKey</span>, <span style="color:#a6e22e">model</span>, <span style="color:#a6e22e">version</span>, <span style="color:#a6e22e">prompt</span> });
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>);
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When this script is run, the following result is obtained.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;recipe_name&#34;</span>: <span style="color:#e6db74">&#34;Chocolate Chip Cookies&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;materials&#34;</span>: [
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Flour&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">225</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Baking Soda&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">0.5</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Salt&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">0.5</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">0.25</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Butter&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">150</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;White Sugar&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">100</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Brown Sugar&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">100</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Eggs&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">100</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Vanilla Extract&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Chocolate Chips&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">200</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;recipe_name&#34;</span>: <span style="color:#e6db74">&#34;Peanut Butter Cookies&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;materials&#34;</span>: [
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Flour&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">150</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">1.5</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Baking Soda&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">0.75</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">0.37</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Salt&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">0.5</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">0.25</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Butter&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">100</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">2.5</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Peanut Butter&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">100</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;White Sugar&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">75</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">0.75</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Brown Sugar&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">75</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">0.75</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Eggs&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">50</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Vanilla Extract&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">0.5</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;recipe_name&#34;</span>: <span style="color:#e6db74">&#34;Oatmeal Raisin Cookies&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;materials&#34;</span>: [
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Flour&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">175</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">1.75</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Baking Soda&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">0.5</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">0.25</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Salt&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">0.5</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">0.25</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Cinnamon&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">0.5</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Butter&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">125</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;White Sugar&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">75</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">0.75</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Brown Sugar&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">75</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">0.75</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Eggs&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">50</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Vanilla Extract&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">0.5</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Oats&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">150</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">1.5</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Raisins&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">100</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;recipe_name&#34;</span>: <span style="color:#e6db74">&#34;Sugar Cookies&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;materials&#34;</span>: [
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Flour&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">250</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">2.5</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Baking Powder&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Salt&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">0.5</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">0.25</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Butter&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">150</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;White Sugar&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">125</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">1.25</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Eggs&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">50</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Vanilla Extract&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">0.5</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;recipe_name&#34;</span>: <span style="color:#e6db74">&#34;Shortbread Cookies&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;materials&#34;</span>: [
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Flour&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">250</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">2.5</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Salt&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">0.25</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">0.12</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;Butter&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">200</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;material&#34;</span>: <span style="color:#e6db74">&#34;White Sugar&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">50</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">0.5</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>From this result, it was found that when the detailed JSON schema and the &ldquo;response_mime_type&rdquo; property are used, the question can be simply like <code>Follow JSON schema.</code>.</p>
<h1 id="summary">Summary</h1>
<p>This report investigated the controllability of Gemini API output formats. It compared results with and without the &ldquo;response_mime_type&rdquo; property and function calls, while varying JSON schema complexity. The findings are as follows:</p>
<ul>
<li>The Gemini API can correctly interpret <a href="https://json-schema.org/">JSON schemas</a>.</li>
<li>For low-complexity JSON schemas, all tested patterns returned valid values.</li>
<li>High-complexity JSON schemas often resulted in a status code 500 error with the function call. Function calls proved ineffective for handling high complexity.</li>
<li>Combining a detailed JSON schema with the &ldquo;response_mime_type&rdquo; property allows for clear and concise queries. When the detailed JSON schema and the &ldquo;response_mime_type&rdquo; property are used, the question can be simply like <code>Follow JSON schema.</code>.</li>
</ul>
<p>Therefore, a detailed JSON schema with the &ldquo;response_mime_type&rdquo; property is recommended for controlling Gemini API output formats.</p>
<h1 id="note">Note</h1>
<ul>
<li>The top abstract image was created by <a href="https://gemini.google.com/app">Gemini</a>.</li>
</ul>

  
  <h4><i class="fas fa-share-alt" aria-hidden="true"></i>&nbsp;Share!</h4>
<ul class="share-buttons">
	<li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftanaikech.github.io%2f2024%2f05%2f01%2ftaming-the-wild-output-effective-control-of-gemini-api-response-formats-with-response_mime_type%2f" target="_blank" title="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span class="sr-only">Share on Facebook</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://twitter.com/intent/tweet?source=https%3a%2f%2ftanaikech.github.io%2f2024%2f05%2f01%2ftaming-the-wild-output-effective-control-of-gemini-api-response-formats-with-response_mime_type%2f" target="_blank" title="Tweet"><i class="fab fa-twitter" aria-hidden="true"></i><span class="sr-only">Tweet</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://plus.google.com/share?url=https%3a%2f%2ftanaikech.github.io%2f2024%2f05%2f01%2ftaming-the-wild-output-effective-control-of-gemini-api-response-formats-with-response_mime_type%2f" target="_blank" title="Share on Google+"><i class="fab fa-google-plus" aria-hidden="true"></i><span class="sr-only">Share on Google+</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.tumblr.com/share?v=3&u=https%3a%2f%2ftanaikech.github.io%2f2024%2f05%2f01%2ftaming-the-wild-output-effective-control-of-gemini-api-response-formats-with-response_mime_type%2f" target="_blank" title="Post to Tumblr"><i class="fab fa-tumblr" aria-hidden="true"></i><span class="sr-only">Post to Tumblr</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2ftanaikech.github.io%2f2024%2f05%2f01%2ftaming-the-wild-output-effective-control-of-gemini-api-response-formats-with-response_mime_type%2f" target="_blank" title="Pin it"><i class="fab fa-pinterest-p" aria-hidden="true"></i><span class="sr-only">Pin it</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.reddit.com/submit?url=https%3a%2f%2ftanaikech.github.io%2f2024%2f05%2f01%2ftaming-the-wild-output-effective-control-of-gemini-api-response-formats-with-response_mime_type%2f" target="_blank" title="Submit to Reddit"><i class="fab fa-reddit-alien" aria-hidden="true"></i><span class="sr-only">Submit to Reddit</span></a>
	</li>
</ul>


<style>
	ul.share-buttons{
	  list-style: none;
	  padding: 0;
	}

	ul.share-buttons li{
	  display: inline;
	}

	ul.share-buttons .sr-only{
	  position: absolute;
	  clip: rect(1px 1px 1px 1px);
	  clip: rect(1px, 1px, 1px, 1px);
	  padding: 0;
	  border: 0;
	  height: 1px;
	  width: 1px;
	  overflow: hidden;
	}
</style>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://tanaikech.github.io/2024/04/26/gas-library-geminiwithfiles/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://tanaikech.github.io/2024/04/26/gas-library-geminiwithfiles/">GAS Library - GeminiWithFiles</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
  </div>
</div>


  
  
  
  

  

</div>

</div>
</div>
<script src="https://tanaikech.github.io/js/ui.js"></script>
<script src="https://tanaikech.github.io/js/menus.js"></script>






<script async src="https://www.googletagmanager.com/gtag/js?id=G-J3Z6T50WL5"></script>
<script>
  
  if (window.location.hostname != "localhost") {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-J3Z6T50WL5');
  }
</script>






<script src="https://tanaikech.github.io/js/math-code.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  


</body>
</html>

