<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <meta name="google-site-verification" content="1BvDMY90ui0jRLHkrpqdQ_x62h5VNEMuK6mQsDvVQH0" />

  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.98.0" />

  <title>Batch Processing Powerhouse: Leverage Gemini 1.5 API and Google Apps Script for Efficient Content Workflows &middot; tanaike</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://tanaikech.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">

  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet" type="text/css">

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css">
  <script async src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://tanaikech.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://tanaikech.github.io/">TANAIKE</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/topics/"><i class='fa fa-folder fa-fw'></i>Topics</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/link/"><i class='fa fa-thumbs-up fa-fw'></i>Links</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/webapps/"><i class='fas fa-toolbox'></i>Web Applications</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/donate/"><i class='fas fa-donate'></i>Donate</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/tanaikech" rel="me" target="_blank"><i class="fab fa-twitter-square fa-fw"></i>X</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/tanaikech" rel="me" target="_blank"><i class="fab fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/7108653" rel="me" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2017. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Batch Processing Powerhouse: Leverage Gemini 1.5 API and Google Apps Script for Efficient Content Workflows</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>26 Apr 2024, 15:15</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/gastips">GasTips</a>
    
  </div>
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/google-apps-script">Google Apps Script</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/gemini">Gemini</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/ai">AI</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/llm">LLM</a>
    
  </div>
  
  

</div>

  <p><a href="https://gist.github.com/tanaikech/f3dbba02a620cfd7a729e13b012ea66f">Gists</a></p>
<p><img src="https://tanaikech.github.io/image-storage/20240426a/fig1.jpg" alt=""></p>
<h1 id="abstract">Abstract</h1>
<p>A new Google Apps Script library, &ldquo;GeminiWithFiles&rdquo;, simplifies using the powerful Gemini 1.5 AI model. It lets users directly upload files for content generation or create descriptions for many images at once, making it much faster than prior methods. This is helpful for tasks involving large amounts of text or images.</p>
<h1 id="introduction">Introduction</h1>
<p>Recently, Gemini, a family of Google&rsquo;s most capable AI models, has revolutionized various tasks by allowing unstructured data to be used as structured data. This breakthrough is particularly impactful for tasks involving large amounts of text or images.</p>
<p>The Gemini 1.5 API, released in February 2024, significantly expands capabilities compared to Gemini 1.0. Here are some key improvements:</p>
<ul>
<li>Content generation: Gemini 1.5 can generate content up to 1 million tokens, enabling comprehensive and detailed outputs.</li>
<li>Image processing: Gemini 1.5 can now process up to 3,000 image files, a vast leap from the 16-image limit of Gemini 1.0.</li>
</ul>
<p>While Gemini cannot directly work with Google Drive formats like Docs, Sheets, Slides, or PDFs yet (future updates will address this), workarounds exist. A previous report explored a method to convert PDFs to image data for Gemini processing. <a href="https://medium.com/google-cloud/parsing-invoices-using-gemini-1-5-api-with-google-apps-script-1f32af1678f2">Ref</a> This approach proved successful for parsing invoices and various text formats.</p>
<p>This report builds a Google Apps Script library &ldquo;GeminiWithFiles&rdquo; upon that concept by introducing a user-friendly Google Apps Script that simplifies Gemini integration. The library mainly offers two functionalities:</p>
<ul>
<li>Content generation from uploaded files: Users can directly upload files, and the script will process them through Gemini to generate content.</li>
<li>Batch image description creation: This script allows generating descriptions for a large number of images in a single API call. This significantly improves efficiency compared to the one-image-at-a-time approach used in the previous report. <a href="https://medium.com/google-cloud/automatically-creating-descriptions-of-files-on-google-drive-using-gemini-pro-api-with-google-apps-7ef597a5b9fb">Ref</a></li>
</ul>
<p>By streamlining the process and enabling batch operations, this script offers a powerful tool for various use cases.</p>
<h1 id="repository">Repository</h1>
<p>You can see the script of &ldquo;GeminiWithFiles&rdquo; in the following repository.
<a href="https://github.com/tanaikech/GeminiWithFiles">https://github.com/tanaikech/GeminiWithFiles</a></p>
<h1 id="origins-of-this-library">Origins of this library</h1>
<p>I created this library based on the following reports.</p>
<ul>
<li><a href="https://medium.com/google-cloud/automatically-creating-descriptions-of-files-on-google-drive-using-gemini-pro-api-with-google-apps-7ef597a5b9fb">Automatically Creating Descriptions of Files on Google Drive using Gemini Pro API with Google Apps Script</a></li>
<li><a href="https://medium.com/google-cloud/categorization-using-gemini-pro-api-with-google-apps-script-804df0101161">Categorization using Gemini Pro API with Google Apps Script</a></li>
<li><a href="https://medium.com/google-cloud/guide-to-function-calling-with-gemini-and-google-apps-script-0e058d472f45">Guide to Function Calling with Gemini and Google Apps Script</a></li>
<li><a href="https://medium.com/google-cloud/creating-image-bot-using-gemini-with-google-apps-script-51457cce03d7">Creating Image Bot using Gemini with Google Apps Script</a></li>
<li><a href="https://medium.com/google-cloud/crafting-bespoke-output-formats-with-gemini-api-087b029d84d5">Crafting Bespoke Output Formats with Gemini API</a></li>
<li><a href="https://medium.com/google-cloud/generating-texts-using-files-uploaded-by-gemini-1-5-api-5777f1c902ab">Generating Texts using Files Uploaded by Gemini 1.5 API</a></li>
<li><a href="https://medium.com/google-cloud/specifying-output-types-for-gemini-api-with-google-apps-script-c2f6a753c8d7">Specifying Output Types for Gemini API with Google Apps Script</a></li>
<li><a href="https://medium.com/google-cloud/parsing-invoices-using-gemini-1-5-api-with-google-apps-script-1f32af1678f2">Parsing Invoices using Gemini 1.5 API with Google Apps Script</a></li>
</ul>
<h1 id="features">Features</h1>
<p>This library GeminiWithFiles allows you to interact with Gemini, a powerful document processing and management platform, through an easy-to-use API. Here&rsquo;s what you can achieve with this library:</p>
<p>File Management:</p>
<ul>
<li>Upload files to Gemini for storage and future processing with an asynchronous process.</li>
<li>Retrieve a list of files currently stored in your Gemini account.</li>
<li>Delete files from your Gemini account with an asynchronous process.</li>
</ul>
<p>Content Upload:</p>
<ul>
<li>Upload various file formats including Google Docs (Documents, Spreadsheets, Slides), and PDFs. Gemini will convert each page of the uploaded file into images for further processing.</li>
</ul>
<p>Chat History Management:</p>
<ul>
<li>Save your chat history for later analysis or retrieval.</li>
</ul>
<p>Content Generation:</p>
<ul>
<li>Process multiple files at once (e.g., images, papers, invoices) using a single API call to generate new content based on the uploaded data.</li>
</ul>
<p>Output Specification:</p>
<ul>
<li>Specify the desired output format for the results generated by the Gemini API.</li>
</ul>
<h1 id="usage">Usage</h1>
<p>In order to test this script, please do the following steps.</p>
<h2 id="1-create-an-api-key">1. Create an API key</h2>
<p>Please access <a href="https://makersuite.google.com/app/apikey">https://makersuite.google.com/app/apikey</a> and create your API key. At that time, please enable Generative Language API at the API console. This API key is used for this sample script.</p>
<p>This official document can also be seen. <a href="https://ai.google.dev/">Ref</a>.</p>
<h2 id="2-create-a-google-apps-script-project">2. Create a Google Apps Script project</h2>
<p>Please create a standalone Google Apps Script project. Of course, this script can also be used with the container-bound script.</p>
<p>And, please open the script editor of the Google Apps Script project.</p>
<h2 id="3-how-to-use-geminiwithfiles">3. How to use GeminiWithFiles</h2>
<p>There are 2 patterns for using GeminiWithFiles.</p>
<h3 id="1-use-geminiwithfiles-as-a-google-apps-script-library">1. Use GeminiWithFiles as a Google Apps Script library</h3>
<p>If you use this library as a Google Apps Script library, please install the library to your Google Apps Script project as follows.</p>
<ol>
<li>
<p>Create a Google Apps Script project. Or, open your Google Apps Script project.</p>
<ul>
<li>You can use this library for the Google Apps Script project of both the standalone and container-bound script types.</li>
</ul>
</li>
<li>
<p><a href="https://developers.google.com/apps-script/guides/libraries">Install this library</a>.</p>
<ul>
<li>The library&rsquo;s project key is as follows.</li>
</ul>
</li>
</ol>
<pre tabindex="0"><code>12DIn1iEX4ebDB3DZAj0TQAgANGmbxZr1jlA4e7vZCdD7gXqYyhj7XePP
</code></pre><p>This library uses another library <a href="https://github.com/tanaikech/PDFApp">PDFApp</a>. This is used for converting PDF data to image data. PDFApp has already been installed in this library. So, you are not required to operate about this.</p>
<h3 id="2-use-geminiwithfiles-in-your-own-google-apps-script-project">2. Use GeminiWithFiles in your own Google Apps Script project</h3>
<p>If you use this library in your own Google Apps Script project, please copy and paste <a href="https://github.com/tanaikech/GeminiWithFiles/blob/master/classGeminiWithFiles.js">Class GeminiWithFiles</a> into your Google Apps Script project. By this, the script can be used.</p>
<p>In this case, please install another library <a href="https://github.com/tanaikech/PDFApp">PDFApp</a>. This is used for converting PDF data to image data. When an error like <code>ReferenceError: PDFApp is not defined</code> occurs, please check this.</p>
<h2 id="4-constructor">4. Constructor</h2>
<p>Before the sample script is shown, please confirm how to create the constructor of GeminiWithFiles.</p>
<p>When you install GeminiWithFiles as a library to your Google Apps Script project, please use the following script. <strong>The scripts in this report uses this.</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">g</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">GeminiWithFiles</span>.<span style="color:#a6e22e">geminiWithFiles</span>(<span style="color:#a6e22e">object</span>);
</span></span></code></pre></div><p>or</p>
<p>When you directly copy and paste the script of Class GeminiWithFiles into your Google Apps Script project, please use the following script.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">g</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">GeminiWithFiles</span>(<span style="color:#a6e22e">object</span>);
</span></span></code></pre></div><p>The value of <code>object</code> is as follows.</p>
<pre tabindex="0"><code>{Object} object API key or access token for using Gemini API.
{String} object.apiKey API key.
{String} object.accessToken Access token.
{String} object.model Model. Default is &#34;models/gemini-1.5-pro-latest&#34;.
{String} object.version Version of API. Default is &#34;v1beta&#34;.
{Boolean} object.doCountToken Default is false. If this is true, when Gemini API is requested, the token of request is shown in the log.
{Array} object.history History for continuing chat.
{Array} object.functions If you want to give the custom functions, please use this.
</code></pre><h1 id="samples">Samples</h1>
<h2 id="1-generate-content">1. Generate content</h2>
<p>This script generates content from a text.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">myFunction</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">apiKey</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>; <span style="color:#75715e">// Please set your API key.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">g</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">GeminiWithFiles</span>.<span style="color:#a6e22e">geminiWithFiles</span>({ <span style="color:#a6e22e">apiKey</span> }); <span style="color:#75715e">// This is for installing GeminiWithFiles as a library.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// const g = new GeminiWithFiles({ apiKey }); // This is for directly copying and pasting Class GeminiWithFiles into your Google Apps Script project.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">g</span>.<span style="color:#a6e22e">generateContent</span>({ <span style="color:#a6e22e">q</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;What is Google Apps Script?&#34;</span> });
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>If you use this by installing it as a library using the library key, please use <code>const g = new GeminiWithFiles.geminiWithFiles({ apiKey });</code>.</li>
<li>If you use this by directly copying and pasting, please use <code>const g = new Gemini({ apiKey });</code>.</li>
</ul>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="2-chat-1">2. Chat 1</h2>
<p>This script generates content with a chat.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">myFunction</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">apiKey</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>; <span style="color:#75715e">// Please set your API key.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">g</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">GeminiWithFiles</span>.<span style="color:#a6e22e">geminiWithFiles</span>({ <span style="color:#a6e22e">apiKey</span> }); <span style="color:#75715e">// This is for installing GeminiWithFiles as a library.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// const g = new GeminiWithFiles({ apiKey }); // This is for directly copying and pasting Class GeminiWithFiles into your Google Apps Script project.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Question 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res1</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">g</span>.<span style="color:#a6e22e">generateContent</span>({ <span style="color:#a6e22e">q</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;What is Google Apps Script?&#34;</span> });
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res1</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Question 2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res2</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">g</span>.<span style="color:#a6e22e">generateContent</span>({ <span style="color:#a6e22e">q</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;What is my 1st question?&#34;</span> });
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res2</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When this script is run, <code>res1</code> and <code>res2</code> are as follows.</p>
<p><code>res1</code></p>
<pre tabindex="0"><code>Google Apps Script is a rapid application development platform that makes it fast and easy to create business applications that integrate with Google Workspace.
</code></pre><p><code>res2</code></p>
<pre tabindex="0"><code>Your first question was &#34;What is Google Apps Script?&#34;
</code></pre><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="chat-2">Chat 2</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">myFunction</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">apiKey</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>; <span style="color:#75715e">// Please set your API key.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">g</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">GeminiWithFiles</span>.<span style="color:#a6e22e">geminiWithFiles</span>({ <span style="color:#a6e22e">apiKey</span>, <span style="color:#a6e22e">doCountToken</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }); <span style="color:#75715e">// This is for installing GeminiWithFiles as a library.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// const g = new GeminiWithFiles({ apiKey }); // This is for directly copying and pasting Class GeminiWithFiles into your Google Apps Script project.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Question 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">q</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Return the current population of Kyoto, Osaka, Aichi, Fukuoka, Tokyo in Japan as JSON data with the format that the key and values are the prefecture name and the population, respectively.&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res1</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">g</span>.<span style="color:#a6e22e">generateContent</span>({ <span style="color:#a6e22e">q</span> });
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res1</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Question 2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res2</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">g</span>.<span style="color:#a6e22e">generateContent</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">q</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Also, return the current area of them as JSON data with the format that the key and values are the prefecture name and the area (km^2), respectively.&#34;</span>,
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res2</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When this script is run, the following values can be seen in the log. By <code>doCountToken: true</code>, you can see the total tokens.</p>
<pre tabindex="0"><code>{
  &#34;totalTokens&#34;: 40
}
</code></pre><p><code>res1</code></p>
<pre tabindex="0"><code>{
  Kyoto: 1464956,
  Fukuoka: 5135214,
  Osaka: 8838716,
  Tokyo: 14047594,
  Aichi: 7552873
}
</code></pre><pre tabindex="0"><code>{
  &#34;totalTokens&#34;: 77
}
</code></pre><p><code>res2</code></p>
<pre tabindex="0"><code>{
  Kyoto: 4612.71,
  Tokyo: 2194.07,
  Aichi: 5172.4,
  Osaka: 1904.99,
  Fukuoka: 4986.51
}
</code></pre><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="upload-files-to-gemini">Upload files to Gemini</h2>
<p>In this case, async/await is used in the function.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">myFunction</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">apiKey</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>; <span style="color:#75715e">// Please set your API key.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">folderId</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>; <span style="color:#75715e">// Please set your folder ID including images.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">fileIds</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">files</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">DriveApp</span>.<span style="color:#a6e22e">getFolderById</span>(<span style="color:#a6e22e">folderId</span>).<span style="color:#a6e22e">getFiles</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">while</span> (<span style="color:#a6e22e">files</span>.<span style="color:#a6e22e">hasNext</span>()) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">file</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">files</span>.<span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fileIds</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">g</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">GeminiWithFiles</span>.<span style="color:#a6e22e">geminiWithFiles</span>({ <span style="color:#a6e22e">apiKey</span>, <span style="color:#a6e22e">doCountToken</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }); <span style="color:#75715e">// This is for installing GeminiWithFiles as a library.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// const g = new GeminiWithFiles({ apiKey }); // This is for directly copying and pasting Class GeminiWithFiles into your Google Apps Script project.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">g</span>.<span style="color:#a6e22e">setFileIds</span>(<span style="color:#a6e22e">fileIds</span>, <span style="color:#66d9ef">false</span>).<span style="color:#a6e22e">uploadFiles</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>When this script is run, the files can be uploaded to Gemini. The uploaded files can be used to generate content with Gemini API.</li>
<li>In my test, when the files are uploaded using this script, I confirmed that 100 files can always be uploaded. But, when the number of files is more than 100, an error of <code>Exceeded maximum execution time</code> sometimes occurs. Please be careful about this.</li>
</ul>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="upload-image-files-and-create-descriptions-of-images">Upload image files and create descriptions of images</h2>
<p>In this sample, multiple image files are uploaded and the descriptions are created from the uploaded image files. This sample will be the expanded version of my previous report &ldquo;<a href="https://medium.com/google-cloud/automatically-creating-descriptions-of-files-on-google-drive-using-gemini-pro-api-with-google-apps-7ef597a5b9fb">Automatically Creating Descriptions of Files on Google Drive using Gemini Pro API with Google Apps Script</a>&rdquo;.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">myFunction</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">apiKey</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>; <span style="color:#75715e">// Please set your API key.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">folderId</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>; <span style="color:#75715e">// Please set your folder ID including images.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">q</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`Create each description from each image file within 100 words in the order of given fileData.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`Return the results as an array`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`Return only raw Array without a markdown. No markdown format.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`The required properties of each element in the array are as follows`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">``</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`[Properties of each element in the array]`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&#34;name&#34;: &#34;Name of file&#34;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&#34;description&#34;: &#34;Created description&#34;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">``</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`If the requirement information is not found, set &#34;no value&#34;.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`Return only raw Array without a markdown. No markdown format. No markdown tags.`</span>,
</span></span><span style="display:flex;"><span>  ].<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;\n&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fileIds</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">files</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">DriveApp</span>.<span style="color:#a6e22e">searchFiles</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`(mimeType = &#39;image/png&#39; or mimeType = &#39;image/jpeg&#39;) and trashed = false and &#39;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">folderId</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#39; in parents`</span>
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">while</span> (<span style="color:#a6e22e">files</span>.<span style="color:#a6e22e">hasNext</span>()) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fileIds</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">files</span>.<span style="color:#a6e22e">next</span>().<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">fileIds</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">g</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">GeminiWithFiles</span>.<span style="color:#a6e22e">geminiWithFiles</span>({ <span style="color:#a6e22e">apiKey</span>, <span style="color:#a6e22e">doCountToken</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }); <span style="color:#75715e">// This is for installing GeminiWithFiles as a library.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// const g = new GeminiWithFiles({ apiKey }); // This is for directly copying and pasting Class GeminiWithFiles into your Google Apps Script project.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fileList</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">g</span>.<span style="color:#a6e22e">setFileIds</span>(<span style="color:#a6e22e">fileIds</span>).<span style="color:#a6e22e">uploadFiles</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">g</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">withUploadedFilesByGenerateContent</span>(<span style="color:#a6e22e">fileList</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">generateContent</span>({ <span style="color:#a6e22e">q</span> });
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// g.deleteFiles(fileList.map(({ name }) =&gt; name)); // If you want to delete the uploaded files, please use this.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When this script is run, the following result is obtained. In this case, the value of <code>name</code> is the file ID.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;###&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;###&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  ,
</span></span><span style="display:flex;"><span>  ,
</span></span><span style="display:flex;"><span>  ,
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>When 20 sample images generated by Gemini are used, the following result is obtained.</p>
<p><img src="https://tanaikech.github.io/image-storage/20240426a/fig2.png" alt=""></p>
<p>When this script is run, 20 images are uploaded and the descriptions of the uploaded 20 images can be obtained by one API call.</p>
<p>As an important point, in my test, when the number of image files is large, it was required to separate the script between the file upload and the content generation. Also, in the case of 50 image files, the descriptions could be correctly created. But, in the case of more than 50 images, there was a case that an error occurred. So, please adjust the number of files to your situation.</p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="upload-invoices-of-pdf-data-and-parse-them">Upload invoices of PDF data and parse them</h2>
<p>In this sample, multiple invoices of PDF files are uploaded and they are parsed as an object. This sample will be the expanded version of my previous report &ldquo;<a href="https://medium.com/google-cloud/parsing-invoices-using-gemini-1-5-api-with-google-apps-script-1f32af1678f2">Parsing Invoices using Gemini 1.5 API with Google Apps Script</a>&rdquo;.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">myFunction_parseInvoices</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">apiKey</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>; <span style="color:#75715e">// Please set your API key.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Please set file IDs of PDF files of invoices.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fileIds</span> <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;###fileID1###&#34;</span>, <span style="color:#e6db74">&#34;###fileID2###&#34;</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">q</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`Create an array including JSON object parsed the following images of the invoices.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`The giving images are the invoices.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`Return an array including JSON object.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`No descriptions and explanations. Return only raw array including JSON objects without markdown. No markdown format.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`The required properties in each JSON object in an array are as follows.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">``</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`[Properties in JSON object]`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&#34;name&#34;: &#34;Name given as &#39;Filename&#39;&#34;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&#34;invoiceTitle&#34;: &#34;title of invoice&#34;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&#34;invoiceDate&#34;: &#34;date of invoice&#34;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&#34;invoiceNumber&#34;: &#34;number of the invoice&#34;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&#34;invoiceDestinationName&#34;: &#34;Name of destination of invoice&#34;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&#34;invoiceDestinationAddress&#34;: &#34;address of the destination of invoice&#34;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&#34;totalCost&#34;: &#34;total cost of all costs&#34;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&#34;table&#34;: &#34;Table of invoice. This is a 2-dimensional array. Add the first header row to the table in the 2-dimensional array.&#34;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">``</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`[Format of 2-dimensional array of &#34;table&#34;]`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&#34;title or description of item&#34;, &#34;number of items&#34;, &#34;unit cost&#34;, &#34;total cost&#34;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">``</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`If the requirement information is not found, set &#34;no value&#34;.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`Return only raw array including JSON objects without markdown. No markdown format. No markcodn tags.`</span>,
</span></span><span style="display:flex;"><span>  ].<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;\n&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">g</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">GeminiWithFiles</span>.<span style="color:#a6e22e">geminiWithFiles</span>({ <span style="color:#a6e22e">apiKey</span>, <span style="color:#a6e22e">doCountToken</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }); <span style="color:#75715e">// This is for installing GeminiWithFiles as a library.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// const g = new GeminiWithFiles({ apiKey }); // This is for directly copying and pasting Class GeminiWithFiles into your Google Apps Script project.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fileList</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">g</span>.<span style="color:#a6e22e">setFileIds</span>(<span style="color:#a6e22e">fileIds</span>, <span style="color:#66d9ef">true</span>).<span style="color:#a6e22e">uploadFiles</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">g</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">withUploadedFilesByGenerateContent</span>(<span style="color:#a6e22e">fileList</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">generateContent</span>({ <span style="color:#a6e22e">q</span> });
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// g.deleteFiles(fileList.map(({ name }) =&gt; name)); // If you want to delete the uploaded files, please use this.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>As the sample papers, when the following papers are used,</p>
<p><a href="https://create.microsoft.com/en-us/template/service-invoice-(simple-lines-design-worksheet)-c10068f0-7a64-423b-abad-dced024877b0">This sample invoice</a> is from <a href="https://create.microsoft.com/en-us/templates/invoices">Invoice design templates of Microsoft</a>.</p>
<p><img src="https://tanaikech.github.io/image-storage/20240426a/fig3.png" alt=""></p>
<p><a href="https://create.microsoft.com/en-us/template/service-invoice-with-tax-calculations-9330a1fe-20ae-4590-ac01-54c53ed1f3ba">This sample invoice</a> is from <a href="https://create.microsoft.com/en-us/templates/invoices">Invoice design templates of Microsoft</a>.</p>
<p><img src="https://tanaikech.github.io/image-storage/20240426a/fig4.png" alt=""></p>
<p>the following result was obtained by one API call. It is found that the uploaded invoices converted from PDF data to image data can be correctly parsed.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;###fileID1###&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;invoiceDate&#34;</span>: <span style="color:#e6db74">&#34;4/1/2024&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;totalCost&#34;</span>: <span style="color:#e6db74">&#34;$192.50&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;invoiceNumber&#34;</span>: <span style="color:#e6db74">&#34;100&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;invoiceDestinationAddress&#34;</span>: <span style="color:#e6db74">&#34;The Palm Tree Nursery\\n987 6th Ave\\nSanta Fe, NM 11121&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;invoiceTitle&#34;</span>: <span style="color:#e6db74">&#34;Invoice&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;invoiceDestinationName&#34;</span>: <span style="color:#e6db74">&#34;Maria Sullivan&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;table&#34;</span>: [
</span></span><span style="display:flex;"><span>      [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Salesperson&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Job&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Sales&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Description&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Unit Price&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Line Total&#34;</span>
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      [<span style="color:#e6db74">&#34;Sonu Jain&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;20.00&#34;</span>, <span style="color:#e6db74">&#34;Areca palm&#34;</span>, <span style="color:#e6db74">&#34;$2.50&#34;</span>, <span style="color:#e6db74">&#34;$50.00&#34;</span>],
</span></span><span style="display:flex;"><span>      [<span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;35.00&#34;</span>, <span style="color:#e6db74">&#34;Majesty palm&#34;</span>, <span style="color:#e6db74">&#34;$3.00&#34;</span>, <span style="color:#e6db74">&#34;$105.00&#34;</span>],
</span></span><span style="display:flex;"><span>      [<span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;15.00&#34;</span>, <span style="color:#e6db74">&#34;Bismarck palm&#34;</span>, <span style="color:#e6db74">&#34;$2.50&#34;</span>, <span style="color:#e6db74">&#34;$37.50&#34;</span>]
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;###fileID2###&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;invoiceDate&#34;</span>: <span style="color:#e6db74">&#34;4/5, 2024&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;invoiceTitle&#34;</span>: <span style="color:#e6db74">&#34;INVOICE&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;invoiceDestinationAddress&#34;</span>: <span style="color:#e6db74">&#34;Downtown Pets\\n132 South Street\\nManhattan, NY 15161&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;totalCost&#34;</span>: <span style="color:#e6db74">&#34;$4350&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;table&#34;</span>: [
</span></span><span style="display:flex;"><span>      [<span style="color:#e6db74">&#34;DESCRIPTION&#34;</span>, <span style="color:#e6db74">&#34;HOURS&#34;</span>, <span style="color:#e6db74">&#34;RATE&#34;</span>, <span style="color:#e6db74">&#34;AMOUNT&#34;</span>],
</span></span><span style="display:flex;"><span>      [<span style="color:#e6db74">&#34;Pour cement foundation&#34;</span>, <span style="color:#e6db74">&#34;4.00&#34;</span>, <span style="color:#e6db74">&#34;$150.00&#34;</span>, <span style="color:#e6db74">&#34;$600&#34;</span>],
</span></span><span style="display:flex;"><span>      [<span style="color:#e6db74">&#34;Framing and drywall&#34;</span>, <span style="color:#e6db74">&#34;16.00&#34;</span>, <span style="color:#e6db74">&#34;$180.00&#34;</span>, <span style="color:#e6db74">&#34;$2880&#34;</span>],
</span></span><span style="display:flex;"><span>      [<span style="color:#e6db74">&#34;Tiling and flooring install&#34;</span>, <span style="color:#e6db74">&#34;9.00&#34;</span>, <span style="color:#e6db74">&#34;$150.00&#34;</span>, <span style="color:#e6db74">&#34;$1350&#34;</span>]
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;invoiceDestinationName&#34;</span>: <span style="color:#e6db74">&#34;Nazar Neill&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;invoiceNumber&#34;</span>: <span style="color:#e6db74">&#34;4/5&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="upload-papers-of-pdf-data-and-summarize-them">Upload papers of PDF data and summarize them</h2>
<p>In this sample, multiple papers of PDF data are uploaded, and the summarized texts for each paper are output.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">myFunction_parsePapers</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">apiKey</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>; <span style="color:#75715e">// Please set your API key.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Please set file IDs of the papers of PDF files.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fileIds</span> <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;###fileID1###&#34;</span>, <span style="color:#e6db74">&#34;###fileID2###&#34;</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">q</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`Summary the following manuscripts within 500 words.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`Return the results as an array`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`Return only raw Array without a markdown. No markdown format.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`The required properties of each element in the array are as follows`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">``</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`[Properties of each element in the array]`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&#34;name&#34;: &#34;Name given as &#39;Filename&#39;&#34;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&#34;title&#34;: &#34;Title of manuscript`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&#34;summary&#34;: &#34;Created description&#34;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">``</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`If the requirement information is not found, set &#34;no value&#34;.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`Return only raw Array without a markdown. No markdown format. No markdown tags.`</span>,
</span></span><span style="display:flex;"><span>  ].<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;\n&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">g</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">GeminiWithFiles</span>.<span style="color:#a6e22e">geminiWithFiles</span>({ <span style="color:#a6e22e">apiKey</span>, <span style="color:#a6e22e">doCountToken</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }); <span style="color:#75715e">// This is for installing GeminiWithFiles as a library.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// const g = new GeminiWithFiles({ apiKey }); // This is for directly copying and pasting Class GeminiWithFiles into your Google Apps Script project.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fileList</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">g</span>.<span style="color:#a6e22e">setFileIds</span>(<span style="color:#a6e22e">fileIds</span>, <span style="color:#66d9ef">true</span>).<span style="color:#a6e22e">uploadFiles</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">g</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">withUploadedFilesByGenerateContent</span>(<span style="color:#a6e22e">fileList</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">generateContent</span>({ <span style="color:#a6e22e">q</span> });
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// g.deleteFiles(fileList.map(({ name }) =&gt; name)); // If you want to delete the uploaded files, please use this.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>As the sample papers, when the following papers are used,</p>
<ul>
<li><a href="https://journals.aps.org/pr/abstract/10.1103/PhysRev.48.73">Title: The Particle Problem in the General Theory of Relativity</a>, A. Einstein and N. Rosen, Phys. Rev. 48, 73 – Published 1 July 1935</li>
<li><a href="https://research.google/pubs/attention-is-all-you-need/">Title: Attention Is All You Need</a>, Ashish Vaswani,Noam Shazeer,Niki Parmar,Jakob Uszkoreit,Llion Jones,Aidan N. Gomez,Lukasz Kaiser,Illia Polosukhin,NIPS (2017)</li>
</ul>
<p>the following result was obtained by one API call. It is found that the uploaded papers converted from PDF data to image data can be processed.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;###fileID1###&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;The Particle Problem in the General Theory of Relativity&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;summary&#34;</span>: <span style="color:#e6db74">&#34;This paper investigates the possibility of a singularity-free solution to the field equations in general relativity. The authors propose a new theoretical approach that eliminates singularities by introducing a new variable into the equations. They explore the implications of this approach for the understanding of particles, suggesting that particles can be represented as \&#34;bridges\&#34; connecting different sheets of spacetime.&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;###fileID2###&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;Attention Is All You Need&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;summary&#34;</span>: <span style="color:#e6db74">&#34;This paper proposes a novel neural network architecture called the Transformer, which relies entirely on an attention mechanism to draw global dependencies between input and output sequences. The Transformer model achieves state-of-the-art results on machine translation tasks and offers significant advantages in terms of parallelization and computational efficiency compared to recurrent neural networks.&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><h1 id="important">IMPORTANT</h1>
<ul>
<li>If an error occurs, please try again after several minutes.</li>
<li>In generative AI, the output is highly dependent on the input prompt (the question you provide). Therefore, if the generated text doesn&rsquo;t meet your expectations, try reformulating your prompt and try again.</li>
<li>On April 26, 2024, the following mimeTypes can be used with generateContent. <a href="https://ai.google.dev/gemini-api/docs/prompting_with_media?hl=en#supported_file_formats">Ref</a> I believe that this will be expanded in the future update. For example, I believe that PDF data can be directly used with generateContent in the future.</li>
<li>Images: <code>image/png,image/jpeg,image/webp,image/heic,image/heif</code></li>
<li>Videos: <code>audio/wav,audio/mp3,audio/aiff,audio/aac,audio/ogg,audio/flac</code></li>
<li>In my test, when the files are uploaded using this script, I confirmed that 100 files can be always uploaded. But, when the number of files is more than 100, an error of <code>Exceeded maximum execution time</code> sometimes occurs. Please be careful about this.</li>
</ul>

  
  <h4><i class="fas fa-share-alt" aria-hidden="true"></i>&nbsp;Share!</h4>
<ul class="share-buttons">
	<li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftanaikech.github.io%2f2024%2f04%2f26%2fbatch-processing-powerhouse-leverage-gemini-1.5-api-and-google-apps-script-for-efficient-content-workflows%2f" target="_blank" title="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span class="sr-only">Share on Facebook</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://twitter.com/intent/tweet?source=https%3a%2f%2ftanaikech.github.io%2f2024%2f04%2f26%2fbatch-processing-powerhouse-leverage-gemini-1.5-api-and-google-apps-script-for-efficient-content-workflows%2f" target="_blank" title="Tweet"><i class="fab fa-twitter" aria-hidden="true"></i><span class="sr-only">Tweet</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://plus.google.com/share?url=https%3a%2f%2ftanaikech.github.io%2f2024%2f04%2f26%2fbatch-processing-powerhouse-leverage-gemini-1.5-api-and-google-apps-script-for-efficient-content-workflows%2f" target="_blank" title="Share on Google+"><i class="fab fa-google-plus" aria-hidden="true"></i><span class="sr-only">Share on Google+</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.tumblr.com/share?v=3&u=https%3a%2f%2ftanaikech.github.io%2f2024%2f04%2f26%2fbatch-processing-powerhouse-leverage-gemini-1.5-api-and-google-apps-script-for-efficient-content-workflows%2f" target="_blank" title="Post to Tumblr"><i class="fab fa-tumblr" aria-hidden="true"></i><span class="sr-only">Post to Tumblr</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2ftanaikech.github.io%2f2024%2f04%2f26%2fbatch-processing-powerhouse-leverage-gemini-1.5-api-and-google-apps-script-for-efficient-content-workflows%2f" target="_blank" title="Pin it"><i class="fab fa-pinterest-p" aria-hidden="true"></i><span class="sr-only">Pin it</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.reddit.com/submit?url=https%3a%2f%2ftanaikech.github.io%2f2024%2f04%2f26%2fbatch-processing-powerhouse-leverage-gemini-1.5-api-and-google-apps-script-for-efficient-content-workflows%2f" target="_blank" title="Submit to Reddit"><i class="fab fa-reddit-alien" aria-hidden="true"></i><span class="sr-only">Submit to Reddit</span></a>
	</li>
</ul>


<style>
	ul.share-buttons{
	  list-style: none;
	  padding: 0;
	}

	ul.share-buttons li{
	  display: inline;
	}

	ul.share-buttons .sr-only{
	  position: absolute;
	  clip: rect(1px 1px 1px 1px);
	  clip: rect(1px, 1px, 1px, 1px);
	  padding: 0;
	  border: 0;
	  height: 1px;
	  width: 1px;
	  overflow: hidden;
	}
</style>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://tanaikech.github.io/2024/04/22/updated-gas-library-richtextassistant/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://tanaikech.github.io/2024/04/22/updated-gas-library-richtextassistant/">Updated: GAS Library - RichTextAssistant</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
  </div>
</div>


  
  
  
  

  

</div>

</div>
</div>
<script src="https://tanaikech.github.io/js/ui.js"></script>
<script src="https://tanaikech.github.io/js/menus.js"></script>






<script async src="https://www.googletagmanager.com/gtag/js?id=G-J3Z6T50WL5"></script>
<script>
  
  if (window.location.hostname != "localhost") {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-J3Z6T50WL5');
  }
</script>






<script src="https://tanaikech.github.io/js/math-code.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  


</body>
</html>

