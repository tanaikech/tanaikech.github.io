<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <meta name="google-site-verification" content="1BvDMY90ui0jRLHkrpqdQ_x62h5VNEMuK6mQsDvVQH0" />

  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.98.0" />

  <title>Gemini-Powered Dynamic Pseudo-RAG for Efficient Script Generation &middot; tanaike</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://tanaikech.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">

  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet" type="text/css">

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css">
  <script async src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://tanaikech.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://tanaikech.github.io/">TANAIKE</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/topics/"><i class='fa fa-folder fa-fw'></i>Topics</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/link/"><i class='fa fa-thumbs-up fa-fw'></i>Links</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/webapps/"><i class='fas fa-toolbox'></i>Web Applications</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/donate/"><i class='fas fa-donate'></i>Donate</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/tanaikech" rel="me" target="_blank"><i class="fab fa-twitter-square fa-fw"></i>X</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/tanaikech" rel="me" target="_blank"><i class="fab fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/7108653" rel="me" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2017. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Gemini-Powered Dynamic Pseudo-RAG for Efficient Script Generation</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>12 Sep 2024, 15:16</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/gastips">GasTips</a>
    
  </div>
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/google-apps-script">Google Apps Script</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/gemini">Gemini</a>
    
  </div>
  
  

</div>

  <p><a href="https://gist.github.com/tanaikech/7ce4cfebd06cc527cc7107987cdbd15f">Gists</a></p>
<h1 id="abstract">Abstract</h1>
<p>This report presents a method to optimize AI-generated scripts for processing costs using Gemini and Google Apps Script. By incorporating external knowledge from sources like StackOverflow, we demonstrate the effective generation of efficient scripts that minimize overhead while maintaining desired outcomes. This approach can be considered a dynamic pseudo-RAG technique.</p>
<h1 id="introduction">Introduction</h1>
<p>The proliferation of generative AI, exemplified by Google Gemini, has led to a surge in AI-generated scripts. This trend is evident in the growing number of questions on platforms like StackOverflow that involve AI-generated scripts. While this indicates a significant improvement in AI performance, it&rsquo;s crucial to note that AI-generated scripts may not always be optimized for processing costs, especially when the prompt fails to provide sufficient context.</p>
<p>To address this issue, this report demonstrates how to create scripts that consider processing costs using the Gemini API with Google Apps Script. We achieve this by incorporating additional information from StackOverflow and other relevant sources through Gemini. Our results highlight that by leveraging external knowledge, we can effectively generate efficient scripts that minimize processing overhead without compromising the desired outcome. This approach facilitated efficient script generation and can be considered a form of dynamic pseudo-RAG (Retrieval Augmented Generation).</p>
<p>The repository of this is <a href="https://github.com/tanaikech/Gemini-Powered-Dynamic-Pseudo-RAG-for-Efficient-Script-Generation">here</a>.</p>
<h1 id="workflow">Workflow</h1>
<p><img src="https://tanaikech.github.io/image-storage/20240912a/fig1.png" alt=""></p>
<ol>
<li>Retrieve HTML from URLs as PDF blobs.</li>
<li>Search questions and answers from Stackoverflow using StackExchange API as a PDF blob.</li>
<li>Generate scripts using PDF blobs with Gemini API.</li>
</ol>
<h1 id="usage">Usage</h1>
<h2 id="1-create-a-google-apps-script-project">1. Create a Google Apps Script project</h2>
<p>Please create a Google Apps Script project. In this case, both the container-bound script and the standalone script can be used.</p>
<h2 id="2-create-an-api-key">2. Create an API key</h2>
<p>Please access <a href="https://ai.google.dev/gemini-api/docs/api-key">https://ai.google.dev/gemini-api/docs/api-key</a> and create your API key. At that time, please enable Generative Language API at the API console. This API key is used for this sample script.</p>
<p>This official document can also be seen. <a href="https://ai.google.dev/">Ref</a>.</p>
<p>Of course, if you can link the Google Cloud Platform Project to the Google Apps Script Project in the copied Spreadsheet, you can also use the access token.</p>
<h2 id="3-install-google-apps-script-libraries">3. Install Google Apps Script libraries</h2>
<p>In this script, the Google Apps Script libraries GeminiWithFiles and UtlApp are used. So, please install them. You can see how to install as follows.</p>
<ul>
<li><a href="https://github.com/tanaikech/GeminiWithFiles?tab=readme-ov-file#1-use-geminiwithfiles-as-a-google-apps-script-library">Install GeminiWithFiles</a></li>
<li><a href="https://github.com/tanaikech/UtlApp?tab=readme-ov-file#1-install-library">Install UtlApp</a></li>
</ul>
<h2 id="4-main-script">4. Main script</h2>
<p>Please copy and paste the following script to the script editor of your created Google Apps Script project. This is the main class. This class object is used with the following sample scripts.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Class object for generating scripts using Gemini API.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @class
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">GenerateScript</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">constructor</span>(<span style="color:#a6e22e">obj</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// forGemini
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">forGemini</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">/** @private */</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">prompt</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">forGemini</span>.<span style="color:#a6e22e">prompt</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">/** @private */</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">apiKey</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">forGemini</span>.<span style="color:#a6e22e">apiKey</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">/** @private */</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">model</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">forGemini</span>.<span style="color:#a6e22e">model</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// forStackoverflow
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">/** @private */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">useStackoverflow</span> <span style="color:#f92672">=</span> <span style="color:#f92672">!!</span><span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">forStackoverflow</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">useStackoverflow</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">/** @private */</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onlySearchQuestions</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">forStackoverflow</span>.<span style="color:#a6e22e">onlySearchQuestions</span> <span style="color:#f92672">||</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">/** @private */</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">exportPDF</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">forStackoverflow</span>.<span style="color:#a6e22e">exportPDF</span> <span style="color:#f92672">||</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">/** @private */</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">searchQuery</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">forStackoverflow</span>.<span style="color:#a6e22e">searchQuery</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">/** @private */</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">searchTags</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">forStackoverflow</span>.<span style="color:#a6e22e">searchTags</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">/** @private */</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">numberOfQuestions</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">forStackoverflow</span>.<span style="color:#a6e22e">numberOfQuestions</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">10</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">/** @private */</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">stackExchangeAPIURL</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;https://api.stackexchange.com/2.3/search/advanced&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">/** @private */</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">stackExchangeAPIObj</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">access_token</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">forStackoverflow</span>.<span style="color:#a6e22e">access_token</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">forStackoverflow</span>.<span style="color:#a6e22e">key</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">pagesize</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">100</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">order</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;desc&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sort</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;relevance&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">accepted</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">closed</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">migrated</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">notice</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">wiki</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">site</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;stackoverflow&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">filter</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;!-tS9_NPV1puxkptfqnI5&#34;</span>,
</span></span><span style="display:flex;"><span>      };
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// forOtherSites
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">/** @private */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">useOtherSites</span> <span style="color:#f92672">=</span> <span style="color:#f92672">!!</span><span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">forOtherSites</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">useOtherSites</span> <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">forOtherSites</span>.<span style="color:#a6e22e">urls</span> <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>      Array.<span style="color:#a6e22e">isArray</span>(<span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">forOtherSites</span>.<span style="color:#a6e22e">urls</span>)
</span></span><span style="display:flex;"><span>    ) {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">/** @private */</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">otherSiteUrls</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">forOtherSites</span>.<span style="color:#a6e22e">urls</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * ### Description
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * Main method.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @return {String} Text including the generated script.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">run</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">blobs</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">useOtherSites</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`--- Retrieving the related information from other sites.`</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">temp</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">otherSiteUrls</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">url</span>) =&gt;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">convertHTMLToPDFBlob_</span>({ <span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">convertByGoogleDoc</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span> })
</span></span><span style="display:flex;"><span>      );
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">blobs</span>.<span style="color:#a6e22e">push</span>(...<span style="color:#a6e22e">temp</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">useStackoverflow</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">`--- Searching the related questions and answers from Stackoverflow.`</span>
</span></span><span style="display:flex;"><span>      );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">temp</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getQuestionsAndAnswersFromStackoverflow_</span>();
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">`--- </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">temp</span>.<span style="color:#a6e22e">length</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> questions for supporting to generate script were retrieved.`</span>
</span></span><span style="display:flex;"><span>      );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onlySearchQuestions</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">exportPDF</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">temp</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">blob</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">createPDFFromStackExchangeAPI_</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">temp</span>.<span style="color:#a6e22e">splice</span>(<span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">numberOfQuestions</span>)
</span></span><span style="display:flex;"><span>      );
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">blobs</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">blob</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">exportPDF</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">`--- Exporting the searched questions and answers as a PDF file to the root folder.`</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">file</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">DriveApp</span>.<span style="color:#a6e22e">createFile</span>(<span style="color:#a6e22e">blob</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onlySearchQuestions</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">getUrl</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getScript_</span>(<span style="color:#a6e22e">blobs</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * ### Description
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * Search questions and answers from Stackoverflow using StackExchange API.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @return {Array} Array including the searched questions and answers.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @private
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">getQuestionsAndAnswersFromStackoverflow_</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">stackExchangeAPIObj</span>.<span style="color:#a6e22e">q</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">searchQuery</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">stackExchangeAPIObj</span>.<span style="color:#a6e22e">tagged</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">searchTags</span>.<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;;&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UtlApp</span>.<span style="color:#a6e22e">addQueryParameters</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">stackExchangeAPIURL</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">stackExchangeAPIObj</span>
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">url</span>).<span style="color:#a6e22e">getContentText</span>()).<span style="color:#a6e22e">items</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * ### Description
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * Search questions and answers from Stackoverflow using StackExchange API.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {Array} blobs PDF blobs.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @return {String} Generated content using Gemini API.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @private
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">getScript_</span>(<span style="color:#a6e22e">blobs</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`--- Generate script from your prompt.`</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">g</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">GeminiWithFiles</span>.<span style="color:#a6e22e">geminiWithFiles</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">apiKey</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">apiKey</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">model</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">model</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">response_mime_type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;application/json&#34;</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">q</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">blobs</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">`--- Generate script using the referenced questions and answers of Stackoverflow or other sites.`</span>
</span></span><span style="display:flex;"><span>      );
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">q</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">`&lt;MainQuestion&gt;</span><span style="color:#e6db74">${</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">prompt</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/MainQuestion&gt;`</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">`First, understand the questions and answers in the following PDF.`</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">`As tne next step, you are required to generate a more efficient script for &#34;MainQuestion&#34; by referencing the questions and answers from Stackoverflow in the following PDF.`</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">`PDF includes the suitable questions and answers from Stackoverflow. You are required to generate more efficient script by understanding PDF.`</span>,
</span></span><span style="display:flex;"><span>      ].<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;\n&#34;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fileList</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">g</span>.<span style="color:#a6e22e">setBlobs</span>(<span style="color:#a6e22e">blobs</span>).<span style="color:#a6e22e">uploadFiles</span>();
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">g</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">g</span>.<span style="color:#a6e22e">withUploadedFilesByGenerateContent</span>(<span style="color:#a6e22e">fileList</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">`--- Generate script without using the refferenced questions and answers of Stackoverflow and other sites.`</span>
</span></span><span style="display:flex;"><span>      );
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">q</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">prompt</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">jsonSchema</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">q</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">properties</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">script</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Generated script.&#34;</span>, <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;string&#34;</span> },
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">descriptionOfScript</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Description of the generated script.&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">g</span>.<span style="color:#a6e22e">generateContent</span>({ <span style="color:#a6e22e">jsonSchema</span> });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * ### Description
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * Create PDF blob from the search result.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {Array} items Items including the searched questions and answers.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @return {Blob} PDF blob converted from HTML of the URL is returned.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @private
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">createPDFFromStackExchangeAPI_</span>(<span style="color:#a6e22e">items</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`--- Create HTML.`</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">htmlBody</span>, <span style="color:#a6e22e">links</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">items</span>.<span style="color:#a6e22e">reduce</span>(
</span></span><span style="display:flex;"><span>      (<span style="color:#a6e22e">o</span>, { <span style="color:#a6e22e">answers</span>, <span style="color:#a6e22e">body</span>, <span style="color:#a6e22e">title</span>, <span style="color:#a6e22e">link</span> }, <span style="color:#a6e22e">i</span>) =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">temp</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">`&lt;h1&gt;Question </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">i</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/h1&gt;`</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">`&lt;h2&gt;Title: &lt;a href=&#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">link</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;&gt;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">title</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/a&gt;&lt;/h2&gt;`</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">body</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">`&lt;h2&gt;Solved answer to question </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">i</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/h2&gt;`</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">answers</span>.<span style="color:#a6e22e">find</span>((<span style="color:#a6e22e">e</span>) =&gt; <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">is_accepted</span>).<span style="color:#a6e22e">body</span>,
</span></span><span style="display:flex;"><span>        ].<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">htmlBody</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">temp</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">links</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">link</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">o</span>;
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      { <span style="color:#a6e22e">htmlBody</span><span style="color:#f92672">:</span> [], <span style="color:#a6e22e">links</span><span style="color:#f92672">:</span> [] }
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`--- Links of searched questions on Stackoverflow.`</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">links</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">text</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;base target=&#34;_top&#34;&gt;&lt;style&gt;h1 { page-break-before: always; }&lt;/style&gt;&lt;/head&gt;&lt;body&gt;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">htmlBody</span>.<span style="color:#a6e22e">join</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    )<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/body&gt;&lt;/html&gt;`</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`--- Convert image data.`</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">text</span>.<span style="color:#a6e22e">matchAll</span>(<span style="color:#e6db74">/&lt;img.*?&gt;/g</span>).<span style="color:#a6e22e">forEach</span>((<span style="color:#a6e22e">e</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">t</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">match</span>(<span style="color:#e6db74">/src\=[&#34;&#39;](http.*?)[&#34;&#39;]/</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">t</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">imageUrl</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">t</span>[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">r</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">imageUrl</span>.<span style="color:#a6e22e">trim</span>(), {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">muteHttpExceptions</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">getResponseCode</span>() <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">blob</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">getBlob</span>();
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">dataUrl</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`data:</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">blob</span>.<span style="color:#a6e22e">getContentType</span>()<span style="color:#e6db74">}</span><span style="color:#e6db74">;base64,</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">base64Encode</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">blob</span>.<span style="color:#a6e22e">getBytes</span>()
</span></span><span style="display:flex;"><span>          )<span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">text</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">text</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#a6e22e">e</span>[<span style="color:#ae81ff">0</span>], <span style="color:#e6db74">`&lt;img src=&#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">dataUrl</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34; width=&#34;1000&#34;&gt;`</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`--- Convert HTML to PDF blob.`</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">pdfBlob</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">newBlob</span>(<span style="color:#a6e22e">text</span>, <span style="color:#a6e22e">MimeType</span>.<span style="color:#a6e22e">HTML</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">getAs</span>(<span style="color:#a6e22e">MimeType</span>.<span style="color:#a6e22e">PDF</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">setName</span>(<span style="color:#e6db74">&#34;GenerateScriptTempFile.pdf&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`--- Completely converted HTML to PDF blob.`</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">pdfBlob</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * ### Description
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * Convert HTML of the inputted URL to PDF blob.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * ref: https://medium.com/google-cloud/expanding-gemini-apis-capabilities-a-practical-solution-for-web-content-summarization-5617474b2ad1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {Object} object Object for running this method.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {String} object.url URL you want to use.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {Boolean} object.convertByGoogleDoc When this is true, in order to convert HTML to PDF, Google Document is used. I think that the most cases are not required to use this. But, if you use this, please set &#34;convertByGoogleDoc&#34; as true. The default value is false.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @return {Blob} PDF blob converted from HTML of the URL is returned.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @private
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">convertHTMLToPDFBlob_</span>(<span style="color:#a6e22e">object</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">convertByGoogleDoc</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">object</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`--- Get HTML from &#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">url</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;.`</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">url</span>, { <span style="color:#a6e22e">muteHttpExceptions</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> });
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">text</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">getContentText</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">getResponseCode</span>() <span style="color:#f92672">!=</span> <span style="color:#ae81ff">200</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#a6e22e">text</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`--- Convert image data.`</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Convert the source URL of img tag to the data URL.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">text</span>.<span style="color:#a6e22e">matchAll</span>(<span style="color:#e6db74">/&lt;img.*?&gt;/g</span>).<span style="color:#a6e22e">forEach</span>((<span style="color:#a6e22e">e</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">t</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">match</span>(<span style="color:#e6db74">/src\=[&#34;&#39;](http.*?)[&#34;&#39;]/</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">t</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">imageUrl</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">t</span>[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">r</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">imageUrl</span>.<span style="color:#a6e22e">trim</span>(), {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">muteHttpExceptions</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">getResponseCode</span>() <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">blob</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">getBlob</span>();
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">dataUrl</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`data:</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">blob</span>.<span style="color:#a6e22e">getContentType</span>()<span style="color:#e6db74">}</span><span style="color:#e6db74">;base64,</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">base64Encode</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">blob</span>.<span style="color:#a6e22e">getBytes</span>()
</span></span><span style="display:flex;"><span>          )<span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// text = text.replace(imageUrl, dataUrl);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">text</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">text</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#a6e22e">e</span>[<span style="color:#ae81ff">0</span>], <span style="color:#e6db74">`&lt;img src=&#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">dataUrl</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34; width=&#34;1000&#34;&gt;`</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// For medium
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">url</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#e6db74">&#34;medium.com&#34;</span>)) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">text</span>.<span style="color:#a6e22e">matchAll</span>(<span style="color:#e6db74">/&lt;picture&gt;.*?&lt;\/picture&gt;/g</span>).<span style="color:#a6e22e">forEach</span>((<span style="color:#a6e22e">e</span>) =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">t</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">match</span>(<span style="color:#e6db74">/srcSet\=[&#34;&#39;](http.*?)[&#34;&#39;]/</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">t</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">imageUrl</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">t</span>[<span style="color:#ae81ff">1</span>].<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#34; &#34;</span>)[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">trim</span>();
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">r</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">imageUrl</span>.<span style="color:#a6e22e">trim</span>(), {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">muteHttpExceptions</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>          });
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">getResponseCode</span>() <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">blob</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">getBlob</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">dataUrl</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`data:</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">blob</span>.<span style="color:#a6e22e">getContentType</span>()<span style="color:#e6db74">}</span><span style="color:#e6db74">;base64,</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">base64Encode</span>(
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">blob</span>.<span style="color:#a6e22e">getBytes</span>()
</span></span><span style="display:flex;"><span>            )<span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">text</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">text</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#a6e22e">e</span>[<span style="color:#ae81ff">0</span>], <span style="color:#e6db74">`&lt;img src=&#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">dataUrl</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;`</span>);
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">pdfBlob</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">convertByGoogleDoc</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`--- Convert HTML to PDF blob with Google Docs.`</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">doc</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Drive</span>.<span style="color:#a6e22e">Files</span>.<span style="color:#a6e22e">create</span>(
</span></span><span style="display:flex;"><span>        { <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;temp&#34;</span>, <span style="color:#a6e22e">mimeType</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">MimeType</span>.<span style="color:#a6e22e">GOOGLE_DOCS</span> },
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">newBlob</span>(<span style="color:#a6e22e">text</span>, <span style="color:#a6e22e">MimeType</span>.<span style="color:#a6e22e">HTML</span>)
</span></span><span style="display:flex;"><span>      );
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">pdfBlob</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">DriveApp</span>.<span style="color:#a6e22e">getFileById</span>(<span style="color:#a6e22e">doc</span>.<span style="color:#a6e22e">id</span>).<span style="color:#a6e22e">getBlob</span>().<span style="color:#a6e22e">setName</span>(<span style="color:#a6e22e">url</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">Drive</span>.<span style="color:#a6e22e">Files</span>.<span style="color:#a6e22e">remove</span>(<span style="color:#a6e22e">doc</span>.<span style="color:#a6e22e">id</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`--- Convert HTML to PDF blob.`</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">pdfBlob</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">newBlob</span>(<span style="color:#a6e22e">text</span>, <span style="color:#a6e22e">MimeType</span>.<span style="color:#a6e22e">HTML</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">getAs</span>(<span style="color:#a6e22e">MimeType</span>.<span style="color:#a6e22e">PDF</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">setName</span>(<span style="color:#a6e22e">url</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`--- Completely converted HTML to PDF blob.`</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">pdfBlob</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="sample-situations">Sample situations</h1>
<p>Here, I would like to introduce 2 sample situations.</p>
<h2 id="1-situation-1">1. Situation 1</h2>
<p>In order to test the above script, the following prompt is used.</p>
<pre tabindex="0"><code>About &#34;Condition&#34; and &#34;Mission&#34;, run &#34;Mission&#34; with &#34;Condition&#34;.

&lt;Condition&gt;
- There is a Google Spreadsheet including &#34;Sheet1&#34; and &#34;Sheet2&#34;.
- &#34;Sheet1&#34; has 1000 rows including the first header row and 10 columns.
&lt;/Condition&gt;

&lt;Mission&gt;
- Create a script that can efficiently move only rows where the column &#34;A&#34; is not empty from &#34;Sheet1&#34; to &#34;Sheet2&#34; on a Google Spreadsheet using Google Apps Script with low processing costs.
&lt;/Mission&gt;
</code></pre><p>In this sample Spreadsheet, the total number of rows is 1000, and the rows without empty in column &ldquo;A&rdquo; are 500.</p>
<p>In these sample scripts, the model of <code>models/gemini-1.5-pro-exp-0827</code> is used. If this model is updated when you test this script, please check the latest model and use it. It&rsquo;s like <code>models/gemini-1.5-pro-latest</code> and <code>models/gemini-1.5-flash-latest</code>.</p>
<h3 id="1-sample-1">1. Sample 1</h3>
<p>This sample generates a script using <strong>only the prompt</strong>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sample1</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">prompt</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`About &#34;Condition&#34; and &#34;Mission&#34;, run &#34;Mission&#34; with &#34;Condition&#34;.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&lt;Condition&gt;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`- There is a Google Spreadsheet including &#34;Sheet1&#34; and &#34;Sheet2&#34;.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`- &#34;Sheet1&#34; has 1000 rows including the first header row and 10 columns.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&lt;/Condition&gt;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&lt;Mission&gt;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`- Create a script that can efficiently move only rows where the column &#34;A&#34; is not empty from &#34;Sheet1&#34; to &#34;Sheet2&#34; on a Google Spreadsheet using Google Apps Script with low processing costs.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&lt;/Mission&gt;`</span>,
</span></span><span style="display:flex;"><span>  ].<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;\n&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">object</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">forGemini</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">model</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;models/gemini-1.5-pro-exp-0827&#34;</span>, <span style="color:#75715e">// or &#34;models/gemini-1.5-pro-latest&#34; or &#34;models/gemini-1.5-flash-latest&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">apiKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;###&#34;</span>, <span style="color:#75715e">// Please set your API key for using Gemini API.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">prompt</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">GenerateScript</span>(<span style="color:#a6e22e">object</span>).<span style="color:#a6e22e">run</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">script</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">descriptionOfScript</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When this script is run, the following script is generated.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">moveRows</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ss</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">SpreadsheetApp</span>.<span style="color:#a6e22e">getActiveSpreadsheet</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sheet1</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ss</span>.<span style="color:#a6e22e">getSheetByName</span>(<span style="color:#e6db74">&#34;Sheet1&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sheet2</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ss</span>.<span style="color:#a6e22e">getSheetByName</span>(<span style="color:#e6db74">&#34;Sheet2&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">values</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sheet1</span>.<span style="color:#a6e22e">getDataRange</span>().<span style="color:#a6e22e">getValues</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">rowsToMove</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Iterate through rows starting from the second row (index 1)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">values</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">row</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">values</span>[<span style="color:#a6e22e">i</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">row</span>[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#34;&#34;</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Check if column A is not empty
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">rowsToMove</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">row</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Add the rows to Sheet2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">sheet2</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">getRange</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">sheet2</span>.<span style="color:#a6e22e">getLastRow</span>() <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">rowsToMove</span>.<span style="color:#a6e22e">length</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">rowsToMove</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">length</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">setValues</span>(<span style="color:#a6e22e">rowsToMove</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Delete the moved rows from Sheet1 (iterate in reverse to avoid index issues)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">values</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">1</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">--</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">values</span>[<span style="color:#a6e22e">i</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#34;&#34;</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">sheet1</span>.<span style="color:#a6e22e">deleteRow</span>(<span style="color:#a6e22e">i</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When this script is run, the rows without empty in column &ldquo;A&rdquo; are copied from &ldquo;Sheet1&rdquo; to &ldquo;Sheet2&rdquo;. And, those rows are deleted. The script works. In this case, the processing time was about 130 seconds for processing 1000 rows.</p>
<h3 id="1-sample-2">1. Sample 2</h3>
<p>This sample generates a script using <strong>both the prompt and the questions and answers from Stackoverflow</strong>.</p>
<p>When you use this script, please set your API key for using Gemini API. And, your access token and key for using StackExchange API.</p>
<p>You can see the details of StackExchange API at <a href="https://api.stackexchange.com/">here</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sample2</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">prompt</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`About &#34;Condition&#34; and &#34;Mission&#34;, run &#34;Mission&#34; with &#34;Condition&#34;.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&lt;Condition&gt;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`- There is a Google Spreadsheet including &#34;Sheet1&#34; and &#34;Sheet2&#34;.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`- &#34;Sheet1&#34; has 1000 rows including the first header row and 10 columns.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&lt;/Condition&gt;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&lt;Mission&gt;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`- Create a script that can efficiently move only rows where the column &#34;A&#34; is not empty from &#34;Sheet1&#34; to &#34;Sheet2&#34; on a Google Spreadsheet using Google Apps Script with low processing costs.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&lt;/Mission&gt;`</span>,
</span></span><span style="display:flex;"><span>  ].<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;\n&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">object</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">forGemini</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">model</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;models/gemini-1.5-pro-exp-0827&#34;</span>, <span style="color:#75715e">// or &#34;models/gemini-1.5-pro-latest&#34; or &#34;models/gemini-1.5-flash-latest&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">apiKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;###&#34;</span>, <span style="color:#75715e">// Please set your API key for using Gemini API.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">prompt</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">forStackoverflow</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">access_token</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;###&#34;</span>, <span style="color:#75715e">// Please set your access token for using StackExchange API.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;###&#34;</span>, <span style="color:#75715e">// Please set your key for using StackExchange API.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">searchQuery</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;move rows speed&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">searchTags</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;google-apps-script&#34;</span>, <span style="color:#e6db74">&#34;google-sheets&#34;</span>],
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">GenerateScript</span>(<span style="color:#a6e22e">object</span>).<span style="color:#a6e22e">run</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">script</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">descriptionOfScript</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>In this case, the following threads on Stackoverflow using <code>searchQuery</code> and <code>searchTags</code> are used for support in generating the script.</p>
<ul>
<li><code>https://stackoverflow.com/questions/74518062/how-to-speed-up-moverows-script</code></li>
<li><code>https://stackoverflow.com/questions/56475238/pulling-data-from-google-sheets-into-html-table</code></li>
<li><code>https://stackoverflow.com/questions/64777655/google-script-timing-out</code></li>
<li><code>https://stackoverflow.com/questions/52777954/how-to-get-actual-position-of-range-when-new-rows-above-was-added</code></li>
<li><code>https://stackoverflow.com/questions/44013438/slow-google-script-difficulties-batching-information-into-an-array</code></li>
<li><code>https://stackoverflow.com/questions/47041116/script-is-taking-11-20-seconds-to-lookup-up-an-item-in-an-18-000-row-data-set</code></li>
</ul>
<p>When this script is run, the following script is generated.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">moveRows</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">ss</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">SpreadsheetApp</span>.<span style="color:#a6e22e">getActive</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">srcSheet</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ss</span>.<span style="color:#a6e22e">getSheetByName</span>(<span style="color:#e6db74">&#34;Sheet1&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">dstSheet</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ss</span>.<span style="color:#a6e22e">getSheetByName</span>(<span style="color:#e6db74">&#34;Sheet2&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">srcRange</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">srcSheet</span>.<span style="color:#a6e22e">getDataRange</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">values</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">srcRange</span>.<span style="color:#a6e22e">getValues</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> { <span style="color:#a6e22e">src</span>, <span style="color:#a6e22e">dst</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">values</span>.<span style="color:#a6e22e">reduce</span>(
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">o</span>, <span style="color:#a6e22e">r</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">o</span>[<span style="color:#a6e22e">r</span>[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;dst&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;src&#34;</span>].<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">r</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">o</span>;
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    { <span style="color:#a6e22e">src</span><span style="color:#f92672">:</span> [], <span style="color:#a6e22e">dst</span><span style="color:#f92672">:</span> [] }
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">dst</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">srcRange</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">clearContent</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">offset</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">src</span>.<span style="color:#a6e22e">length</span>, <span style="color:#a6e22e">src</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">length</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">setValues</span>(<span style="color:#a6e22e">src</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">dstSheet</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">getRange</span>(<span style="color:#a6e22e">dstSheet</span>.<span style="color:#a6e22e">getLastRow</span>() <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">dst</span>.<span style="color:#a6e22e">length</span>, <span style="color:#a6e22e">dst</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">length</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">setValues</span>(<span style="color:#a6e22e">dst</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When this script is run, all rows are retrieved. These rows are then divided into two groups: those with empty values in column &lsquo;A&rsquo; and those without. &lsquo;Sheet1&rsquo; is cleared, and the rows with empty values in column &lsquo;A&rsquo; are copied to it. Subsequently, the rows without empty values in column &lsquo;A&rsquo; are also copied to &lsquo;Sheet1&rsquo;. The script functions as expected. In a test with 1000 rows, the processing time was approximately 3 seconds.</p>
<p>Comparing the results of &lsquo;Sample 1&rsquo; and &lsquo;Sample 2&rsquo;, we observed a significant reduction in processing time from 130 seconds to 3 seconds.</p>
<p>In the development of this script, valuable information to aid in its creation was directly sourced from StackOverflow and integrated with Gemini. This approach facilitated efficient script generation and may be considered a form of pseudo-RAG.</p>
<h2 id="1-situation-2">1. Situation 2</h2>
<p>In order to test the above script, the following prompt is used.</p>
<pre tabindex="0"><code>About &#34;Condition&#34; and &#34;Mission&#34;, run &#34;Mission&#34; with &#34;Condition&#34;.

&lt;Condition&gt;
- There is a Google Spreadsheet including &#34;Sheet1&#34;.
- &#34;Sheet1&#34; has 100000 rows and 10 columns.
- Various values are put into all cells.
&lt;/Condition&gt;

&lt;Mission&gt;
- Create a script that can efficiently search for a value from &#34;Sheet1&#34; using Google Apps Script with low processing costs.
&lt;/Mission&gt;
</code></pre><h3 id="1-sample-1-1">1. Sample 1</h3>
<p>This sample generates a script using <strong>only the prompt</strong>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sample1</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">prompt</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`About &#34;Condition&#34; and &#34;Mission&#34;, run &#34;Mission&#34; with &#34;Condition&#34;.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&lt;Condition&gt;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`- &#34;Sheet1&#34; has 100000 rows and 10 columns.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`- Various values are put into all cells.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&lt;/Condition&gt;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&lt;Mission&gt;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`- Create a script that can efficiently search for a value from &#34;Sheet1&#34; using Google Apps Script with low processing costs.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`- Return the result as an array including A1Notation.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&lt;/Mission&gt;`</span>,
</span></span><span style="display:flex;"><span>  ].<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;\n&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">object</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">forGemini</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">model</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;models/gemini-1.5-pro-exp-0827&#34;</span>, <span style="color:#75715e">// or &#34;models/gemini-1.5-pro-latest&#34; or &#34;models/gemini-1.5-flash-latest&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">apiKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;###&#34;</span>, <span style="color:#75715e">// Please set your API key for using Gemini API.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">prompt</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">GenerateScript</span>(<span style="color:#a6e22e">object</span>).<span style="color:#a6e22e">run</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">script</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">descriptionOfScript</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When this script is run, the following script is generated.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Searches for a value in Sheet1 and returns an array of A1 notations.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {string} value The value to search for.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @return {Array&lt;string&gt;} An array of A1 notations where the value was found.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">searchForValue</span>(<span style="color:#a6e22e">value</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sheet</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">SpreadsheetApp</span>.<span style="color:#a6e22e">getActiveSpreadsheet</span>().<span style="color:#a6e22e">getSheetByName</span>(<span style="color:#e6db74">&#34;Sheet1&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sheet</span>.<span style="color:#a6e22e">getDataRange</span>().<span style="color:#a6e22e">getValues</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">row</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">row</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">row</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">col</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">col</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">row</span>].<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">col</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">row</span>][<span style="color:#a6e22e">col</span>] <span style="color:#f92672">===</span> <span style="color:#a6e22e">value</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">sheet</span>.<span style="color:#a6e22e">getCell</span>(<span style="color:#a6e22e">row</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">col</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>).<span style="color:#a6e22e">getA1Notation</span>());
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">result</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When this script is run with the search value, all values are retrieved from &ldquo;Sheet1&rdquo;. And, the value is searched using the loop. When the search value is found, the A1Notation of the cell is retrieved by <code>sheet.getCell(row + 1, col + 1).getA1Notation()</code>. But, unfortunately, there is no method of <code>getCell</code> in the class sheet. So, the script doesn&rsquo;t work. When <code>getCell</code> is modified to <code>getRange</code>, the script works. In this case, the processing time was about 12 seconds for processing 100,000 rows and 10 columns.</p>
<h3 id="1-sample-2-1">1. Sample 2</h3>
<p>This sample generates a script using <strong>both the information of other web site</strong>. In this case, the post of my blog is used. <a href="https://tanaikech.github.io/">Ref</a></p>
<p>When you use this script, please set your API key for using Gemini API, and also set the URLs for support to generate the script.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sample2</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">prompt</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`About &#34;Condition&#34; and &#34;Mission&#34;, run &#34;Mission&#34; with &#34;Condition&#34;.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&lt;Condition&gt;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`- &#34;Sheet1&#34; has 100000 rows and 10 columns.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`- Various values are put into all cells.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&lt;/Condition&gt;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&lt;Mission&gt;`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`- Create a script that can efficiently search for a value from &#34;Sheet1&#34; using Google Apps Script with low processing costs.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`- Return the result as an array including A1Notation.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`&lt;/Mission&gt;`</span>,
</span></span><span style="display:flex;"><span>  ].<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;\n&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">object</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">forGemini</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">model</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;models/gemini-1.5-pro-exp-0827&#34;</span>, <span style="color:#75715e">// or &#34;models/gemini-1.5-pro-latest&#34; or &#34;models/gemini-1.5-flash-latest&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">apiKey</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;###&#34;</span>, <span style="color:#75715e">// Please set your API key for using Gemini API.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">prompt</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">forOtherSites</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">urls</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;https://tanaikech.github.io/2020/09/30/benchmark-process-costs-for-searching-values-in-spreadsheet-using-google-apps-script/&#34;</span>,
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">GenerateScript</span>(<span style="color:#a6e22e">object</span>).<span style="color:#a6e22e">run</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">script</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">descriptionOfScript</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When this script is run, the following script is generated.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">searchValues</span>(<span style="color:#a6e22e">spreadsheetId</span>, <span style="color:#a6e22e">sheetName</span>, <span style="color:#a6e22e">searchValue</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sheet</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">SpreadsheetApp</span>.<span style="color:#a6e22e">openById</span>(<span style="color:#a6e22e">spreadsheetId</span>).<span style="color:#a6e22e">getSheetByName</span>(<span style="color:#a6e22e">sheetName</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">sheet</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">createTextFinder</span>(<span style="color:#a6e22e">searchValue</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">findAll</span>()
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">range</span>) =&gt; <span style="color:#a6e22e">range</span>.<span style="color:#a6e22e">getA1Notation</span>());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When this script is run by giving the arguments, the value can be correctly searched. The script works. In this case, the processing time was about 2 seconds for processing 100,000 rows and 10 columns.</p>
<p>Comparing the results of Sample 1 and Sample 2, we observed a significant reduction in processing time from 12 seconds to 2 seconds. This also suggests the importance of the supplemental information.</p>
<h1 id="note">Note</h1>
<ul>
<li>This script is a Google Apps Script. I used it because when Google Apps Script is used, authorization for using Google Docs and the files on Google Drive can be done seamlessly. The language in the sample prompt is Google Apps Script. However, in this case, you can generate the scripts for other languages using this script.</li>
</ul>

  
  <h4><i class="fas fa-share-alt" aria-hidden="true"></i>&nbsp;Share!</h4>
<ul class="share-buttons">
	<li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftanaikech.github.io%2f2024%2f09%2f12%2fgemini-powered-dynamic-pseudo-rag-for-efficient-script-generation%2f" target="_blank" title="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span class="sr-only">Share on Facebook</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://twitter.com/intent/tweet?source=https%3a%2f%2ftanaikech.github.io%2f2024%2f09%2f12%2fgemini-powered-dynamic-pseudo-rag-for-efficient-script-generation%2f" target="_blank" title="Tweet"><i class="fab fa-twitter" aria-hidden="true"></i><span class="sr-only">Tweet</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://plus.google.com/share?url=https%3a%2f%2ftanaikech.github.io%2f2024%2f09%2f12%2fgemini-powered-dynamic-pseudo-rag-for-efficient-script-generation%2f" target="_blank" title="Share on Google+"><i class="fab fa-google-plus" aria-hidden="true"></i><span class="sr-only">Share on Google+</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.tumblr.com/share?v=3&u=https%3a%2f%2ftanaikech.github.io%2f2024%2f09%2f12%2fgemini-powered-dynamic-pseudo-rag-for-efficient-script-generation%2f" target="_blank" title="Post to Tumblr"><i class="fab fa-tumblr" aria-hidden="true"></i><span class="sr-only">Post to Tumblr</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2ftanaikech.github.io%2f2024%2f09%2f12%2fgemini-powered-dynamic-pseudo-rag-for-efficient-script-generation%2f" target="_blank" title="Pin it"><i class="fab fa-pinterest-p" aria-hidden="true"></i><span class="sr-only">Pin it</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.reddit.com/submit?url=https%3a%2f%2ftanaikech.github.io%2f2024%2f09%2f12%2fgemini-powered-dynamic-pseudo-rag-for-efficient-script-generation%2f" target="_blank" title="Submit to Reddit"><i class="fab fa-reddit-alien" aria-hidden="true"></i><span class="sr-only">Submit to Reddit</span></a>
	</li>
</ul>


<style>
	ul.share-buttons{
	  list-style: none;
	  padding: 0;
	}

	ul.share-buttons li{
	  display: inline;
	}

	ul.share-buttons .sr-only{
	  position: absolute;
	  clip: rect(1px 1px 1px 1px);
	  clip: rect(1px, 1px, 1px, 1px);
	  padding: 0;
	  border: 0;
	  height: 1px;
	  width: 1px;
	  overflow: hidden;
	}
</style>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://tanaikech.github.io/2024/09/04/updated-gas-library-utlapp/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://tanaikech.github.io/2024/09/04/updated-gas-library-utlapp/">Updated: GAS Library - UtlApp</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
  </div>
</div>


  
  
  
  

  

</div>

</div>
</div>
<script src="https://tanaikech.github.io/js/ui.js"></script>
<script src="https://tanaikech.github.io/js/menus.js"></script>






<script async src="https://www.googletagmanager.com/gtag/js?id=G-J3Z6T50WL5"></script>
<script>
  
  if (window.location.hostname != "localhost") {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-J3Z6T50WL5');
  }
</script>






<script src="https://tanaikech.github.io/js/math-code.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  


</body>
</html>

