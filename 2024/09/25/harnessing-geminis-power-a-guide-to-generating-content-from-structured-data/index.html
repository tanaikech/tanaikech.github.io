<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <meta name="google-site-verification" content="1BvDMY90ui0jRLHkrpqdQ_x62h5VNEMuK6mQsDvVQH0" />

  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.98.0" />

  <title>Harnessing Gemini&#39;s Power: A Guide to Generating Content from Structured Data &middot; tanaike</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://tanaikech.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">

  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet" type="text/css">

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css">
  <script async src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://tanaikech.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://tanaikech.github.io/">TANAIKE</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/topics/"><i class='fa fa-folder fa-fw'></i>Topics</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/link/"><i class='fa fa-thumbs-up fa-fw'></i>Links</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/webapps/"><i class='fas fa-toolbox'></i>Web Applications</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/donate/"><i class='fas fa-donate'></i>Donate</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/tanaikech" rel="me" target="_blank"><i class="fab fa-twitter-square fa-fw"></i>X</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/tanaikech" rel="me" target="_blank"><i class="fab fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/7108653" rel="me" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2017. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Harnessing Gemini&#39;s Power: A Guide to Generating Content from Structured Data</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>25 Sep 2024, 15:35</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/gastips">GasTips</a>
    
  </div>
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/google-apps-script">Google Apps Script</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/gemini">Gemini</a>
    
  </div>
  
  

</div>

  <p><a href="https://gist.github.com/tanaikech/395ec09f4ddc9ffdb4c8fafdb39d69ff">Gists</a></p>
<h1 id="abstract">Abstract</h1>
<p>This report presents a method to train AI to effectively generate content from smaller, structured datasets using Python. Gemini&rsquo;s token processing capabilities are leveraged to effectively utilize limited data, while techniques for interpreting CSV and JSON formats are explored.</p>
<h1 id="introduction">Introduction</h1>
<p>In the era of rapidly advancing artificial intelligence (AI), the ability to analyze and leverage large datasets is paramount. While RAG (Retrieval Augmented Generation) environments are often ideal for such tasks, there are scenarios where content generation needs to be achieved with smaller datasets.</p>
<p>Gemini, with its capacity to process a significant number of tokens, offers a promising solution. By combining the power of prompts and uploaded files, it can effectively utilize even limited data. However, when dealing with structured data formats like CSV or JSON, it&rsquo;s essential to ensure AI can accurately interpret and understand the information.</p>
<p>This report will explore a practical approach to achieve this using Python scripting. We will delve into specific techniques and provide illustrative examples to demonstrate how AI can be effectively trained to effectively comprehend and generate content based on smaller, structured datasets.</p>
<h1 id="flow">Flow</h1>
<p><img src="https://tanaikech.github.io/image-storage/20240925a/fig1.png" alt=""></p>
<p>This is a flow diagram of the approach for generating content using Gemini and CSV data. Here are the steps involved:</p>
<ol>
<li><strong>Data Preparation</strong>:
<strong>Input</strong>: A CSV file containing the necessary data.
Schema Creation:
<strong>Direct CSV Usage</strong>: A CSV schema is generated to define the structure and types of the data within the CSV file, enabling Gemini to understand and process it effectively.
<strong>CSV to JSON Conversion</strong>: If the CSV data is converted to JSON format, a JSON schema is created to describe the structure and types of the JSON data, providing Gemini with a clear understanding of the input.</li>
<li><strong>Output Schema Definition</strong>:
A JSON schema is created to specify the desired structure and types of the output content. This schema can be used within the prompt itself or with the response_schema parameter to guide Gemini&rsquo;s generation process.</li>
<li><strong>Content Generation</strong>:
Gemini utilizes the prepared input data and the defined prompt to generate the desired content.
The output content adheres to the specified output schema.</li>
<li><strong>Result Return</strong>:
The generated content is returned as the final output.</li>
</ol>
<h1 id="usage">Usage</h1>
<h2 id="1-create-an-api-key">1. Create an API key</h2>
<p>Please access <a href="https://ai.google.dev/gemini-api/docs/api-key">https://ai.google.dev/gemini-api/docs/api-key</a> and create your API key. At that time, please enable Generative Language API at the API console. This API key is used for the following scripts.</p>
<p>This official document can also be seen. <a href="https://ai.google.dev/">Ref</a>.</p>
<h2 id="2-sample-data">2. Sample data</h2>
<p><img src="https://tanaikech.github.io/image-storage/20240925a/fig2.png" alt=""></p>
<p>This report uses the sample data above. While the image depicts a Google Spreadsheet, the actual test utilizes CSV data converted from this spreadsheet. <strong>The filename of the CSV file is <code>sample.csv</code>.</strong></p>
<p>The sample data originates from <a href="https://www.e-stat.go.jp/stat-search/files?page=1&amp;layout=dataset&amp;toukei=00200524&amp;tstat=000000090001&amp;stat_infid=000040206125">e-Stat (a portal site for Japanese Government Statistics)</a>, specifically columns &ldquo;A&rdquo;, &ldquo;B&rdquo;, and &ldquo;C&rdquo;. These columns represent years, regions (all prefectures in Japan), and populations, respectively. Although only &ldquo;Hokkaido&rdquo; is shown in the image, the actual data encompasses all prefectures. The data consists of 2,303 rows and 3 columns and is used in CSV format for the following scripts.</p>
<h2 id="3-main-script">3. Main script</h2>
<p>This is a Python script.</p>
<p>This is a main class for testing the following sample scripts. Please create a file <code>GenerateContent.py</code> including the following script. The following sample scripts use this script as <code>import GenerateContent</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> google.generativeai <span style="color:#66d9ef">as</span> genai
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> io
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Main</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>genai <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>model <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>api_key <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run</span>(self, object):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>api_key <span style="color:#f92672">=</span> object[<span style="color:#e6db74">&#34;api_key&#34;</span>]
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_setInstances(object)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Get file...&#34;</span>)
</span></span><span style="display:flex;"><span>        file <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_uploadFile(object[<span style="color:#e6db74">&#34;name&#34;</span>], object[<span style="color:#e6db74">&#34;data&#34;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Generate content...&#34;</span>)
</span></span><span style="display:flex;"><span>        response <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>model<span style="color:#f92672">.</span>generate_content(
</span></span><span style="display:flex;"><span>            [file, object[<span style="color:#e6db74">&#34;prompt&#34;</span>]], request_options<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;timeout&#34;</span>: <span style="color:#ae81ff">600</span>}
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            data <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(response<span style="color:#f92672">.</span>text)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> json<span style="color:#f92672">.</span>JSONDecodeError:
</span></span><span style="display:flex;"><span>            data <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span>text
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_setInstances</span>(self, object):
</span></span><span style="display:flex;"><span>        genai<span style="color:#f92672">.</span>configure(api_key<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>api_key)
</span></span><span style="display:flex;"><span>        generation_config <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;response_mime_type&#34;</span>: <span style="color:#e6db74">&#34;application/json&#34;</span>}
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;response_schema&#34;</span> <span style="color:#f92672">in</span> object:
</span></span><span style="display:flex;"><span>            generation_config[<span style="color:#e6db74">&#34;response_schema&#34;</span>] <span style="color:#f92672">=</span> object[<span style="color:#e6db74">&#34;response_schema&#34;</span>]
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>genai <span style="color:#f92672">=</span> genai
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>model <span style="color:#f92672">=</span> genai<span style="color:#f92672">.</span>GenerativeModel(
</span></span><span style="display:flex;"><span>            model_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;gemini-1.5-flash-002&#34;</span>, <span style="color:#75715e"># or gemini-1.5-pro-002</span>
</span></span><span style="display:flex;"><span>            generation_config<span style="color:#f92672">=</span>generation_config,
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_uploadFile</span>(self, name, text):
</span></span><span style="display:flex;"><span>        file <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            file <span style="color:#f92672">=</span> genai<span style="color:#f92672">.</span>get_file(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;files/</span><span style="color:#e6db74">{</span>name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>            requests<span style="color:#f92672">.</span>post(
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;https://generativelanguage.googleapis.com/upload/v1beta/files?uploadType=multipart&amp;key=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>api_key<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>                files<span style="color:#f92672">=</span>{
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;data&#34;</span>: (
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;metadata&#34;</span>,
</span></span><span style="display:flex;"><span>                        json<span style="color:#f92672">.</span>dumps(
</span></span><span style="display:flex;"><span>                            {
</span></span><span style="display:flex;"><span>                                <span style="color:#e6db74">&#34;file&#34;</span>: {
</span></span><span style="display:flex;"><span>                                    <span style="color:#e6db74">&#34;mimeType&#34;</span>: <span style="color:#e6db74">&#34;text/plain&#34;</span>,
</span></span><span style="display:flex;"><span>                                    <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;files/</span><span style="color:#e6db74">{</span>name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>                                }
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                        ),
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;application/json&#34;</span>,
</span></span><span style="display:flex;"><span>                    ),
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;file&#34;</span>: (<span style="color:#e6db74">&#34;file&#34;</span>, io<span style="color:#f92672">.</span>StringIO(text), <span style="color:#e6db74">&#34;text/plain&#34;</span>),
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>            time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>            file <span style="color:#f92672">=</span> genai<span style="color:#f92672">.</span>get_file(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;files/</span><span style="color:#e6db74">{</span>name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;File was uploaded.&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> file<span style="color:#f92672">.</span>state<span style="color:#f92672">.</span>name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;PROCESSING&#34;</span>:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;.&#34;</span>, end<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>            time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>            file <span style="color:#f92672">=</span> genai<span style="color:#f92672">.</span>get_file(file<span style="color:#f92672">.</span>name)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> file<span style="color:#f92672">.</span>state<span style="color:#f92672">.</span>name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;FAILED&#34;</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(file<span style="color:#f92672">.</span>state<span style="color:#f92672">.</span>name)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> file
</span></span></code></pre></div><h2 id="samples">Samples</h2>
<h3 id="pattern-1">Pattern 1</h3>
<p>In this pattern, CSV data is directly used. In order to make Gemini understand CSV data, I used a CSV schema. Also, in order to export the result as JSON data, I used a JSON schema. You can see them as <code>csvSchema</code> and <code>jsonSchema</code> in the following script. The prompt can be seen as <code>prompt</code>.</p>
<p>The function <code>createData</code> returns raw CSV data.</p>
<p>In this script, JSON schema for outputting is used in the prompt.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> GenerateContent
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>api_key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>  <span style="color:#75715e"># Please set your API key.</span>
</span></span><span style="display:flex;"><span>filename <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;sample.csv&#34;</span>  <span style="color:#75715e"># Please set your CSV file with the path.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">createPrompt</span>():
</span></span><span style="display:flex;"><span>    csvSchema <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#39;Order of &#34;fields&#34; is the order of columns of CSV data.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;name&#34; is the column name.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;type&#34; is the type of value in the column.&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;fields&#34;</span>: [
</span></span><span style="display:flex;"><span>            {<span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Year&#34;</span>, <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;number&#34;</span>},
</span></span><span style="display:flex;"><span>            {<span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Region&#34;</span>, <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>},
</span></span><span style="display:flex;"><span>            {<span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Population&#34;</span>, <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;number&#34;</span>},
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    jsonSchema <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;JSON schema for outputting the result.&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;array&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;items&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;region&#34;</span>: {<span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Region name.&#34;</span>, <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>},
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;reason&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Reasons for the population increase.&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;measures&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Details of measures to stop the population increase.&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;currentPopulation&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Current population.&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;number&#34;</span>,
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;futurePopulationWithMeasures&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Future population after 50 years with measures to keep the population increasing.&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;number&#34;</span>,
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;futurePopulationWithoutMeasures&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Future population after 50 years without measures to keep the population increasing.&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;number&#34;</span>,
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;required&#34;</span>: [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;region&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;reason&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;measures&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;currentPopulation&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;futurePopulationWithMeasures&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;futurePopulationWithoutMeasures&#34;</span>,
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    prompt <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>join(
</span></span><span style="display:flex;"><span>        [
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Run the following steps.&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;1. Read the CSV data in the following text file. The CSV schema of this data is &#34;CSVSchema&#34;.&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;&lt;CSVSchema&gt;</span><span style="color:#e6db74">{</span>json<span style="color:#f92672">.</span>dumps(csvSchema)<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/CSVSchema&gt;&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;2. Using the data collected and your knowledge, predict 3 regions that will have the largest increase in population in the future in the order of increase. Return the region name, detailed reasons for the increase, and measures to keep the population increasing by considering the features of the region. Also, return the current population and the population 50 years later predicted by you with and without measures to keep the population increasing.&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;3. Return the result by following &#34;JSONSchema&#34;.&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;&lt;JSONSchema&gt;</span><span style="color:#e6db74">{</span>json<span style="color:#f92672">.</span>dumps(jsonSchema)<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/JSONSchema&gt;&#34;</span>,
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> prompt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">createData</span>(filename):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> open(filename, <span style="color:#e6db74">&#34;r&#34;</span>)<span style="color:#f92672">.</span>read()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">=</span> createData(filename)
</span></span><span style="display:flex;"><span>prompt <span style="color:#f92672">=</span> createPrompt()
</span></span><span style="display:flex;"><span>object <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;api_key&#34;</span>: api_key,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;sample-name-1a&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;data&#34;</span>: data,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;prompt&#34;</span>: prompt,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>res <span style="color:#f92672">=</span> GenerateContent<span style="color:#f92672">.</span>Main()<span style="color:#f92672">.</span>run(object)
</span></span><span style="display:flex;"><span>print(res)
</span></span></code></pre></div><p>In this script, JSON schema for outputting is used with <code>response_schema</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> GenerateContent
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>api_key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>  <span style="color:#75715e"># Please set your API key.</span>
</span></span><span style="display:flex;"><span>filename <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;sample.csv&#34;</span>  <span style="color:#75715e"># Please set your CSV file with the path.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">createPrompt</span>():
</span></span><span style="display:flex;"><span>    csvSchema <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#39;Order of &#34;fields&#34; is the order of columns of CSV data.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;name&#34; is the column name.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;type&#34; is the type of value in the column.&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;fields&#34;</span>: [
</span></span><span style="display:flex;"><span>            {<span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Year&#34;</span>, <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;number&#34;</span>},
</span></span><span style="display:flex;"><span>            {<span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Region&#34;</span>, <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>},
</span></span><span style="display:flex;"><span>            {<span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Population&#34;</span>, <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;number&#34;</span>},
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    prompt <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>join(
</span></span><span style="display:flex;"><span>        [
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Run the following steps.&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;1. Read the CSV data in the following text file. The CSV schema of this data is &#34;CSVSchema&#34;.&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;&lt;CSVSchema&gt;</span><span style="color:#e6db74">{</span>json<span style="color:#f92672">.</span>dumps(csvSchema)<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/CSVSchema&gt;&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;2. Using the data collected and your knowledge, predict 3 regions that will have the largest increase in population in the future in the order of increase. Return the region name, detailed reasons for the increase, and measures to keep the population increasing by considering the features of the region. Also, return the current population and the population 50 years later predicted by you with and without measures to keep the population increasing.&#34;</span>,
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> prompt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">createData</span>(filename):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> open(filename, <span style="color:#e6db74">&#34;r&#34;</span>)<span style="color:#f92672">.</span>read()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>jsonSchema <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;JSON schema for outputting the result.&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;array&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;items&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;region&#34;</span>: {<span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Region name.&#34;</span>, <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>},
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;reason&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Reasons for the population increase.&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;measures&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Details of measures to stop the population increase.&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;currentPopulation&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Current population.&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;number&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;futurePopulationWithMeasures&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Future population after 50 years with measures to keep the population increasing.&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;number&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;futurePopulationWithoutMeasures&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Future population after 50 years without measures to keep the population increasing.&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;number&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;required&#34;</span>: [
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;region&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;reason&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;measures&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;currentPopulation&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;futurePopulationWithMeasures&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;futurePopulationWithoutMeasures&#34;</span>,
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">=</span> createData(filename)
</span></span><span style="display:flex;"><span>prompt <span style="color:#f92672">=</span> createPrompt()
</span></span><span style="display:flex;"><span>object <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;api_key&#34;</span>: api_key,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;sample-name-1b&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;data&#34;</span>: data,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;prompt&#34;</span>: prompt,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;response_schema&#34;</span>: jsonSchema,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>res <span style="color:#f92672">=</span> GenerateContent<span style="color:#f92672">.</span>Main()<span style="color:#f92672">.</span>run(object)
</span></span><span style="display:flex;"><span>print(res)
</span></span></code></pre></div><h3 id="pattern-2">Pattern 2</h3>
<p>In this pattern, CSV data is used by converting to JSON data. In order to make Gemini understand JSON data, I used a JSON schema. Also, in order to export the result as JSON data, I used a JSON schema. You can see them as <code>jsonSchema1</code> and <code>jsonSchema2</code> in the following script. The prompt can be seen as <code>prompt</code>.</p>
<p>The function <code>createData</code> returns JSON data converted from CSV data as follows.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  {<span style="color:#f92672">&#34;region&#34;</span>: <span style="color:#e6db74">&#34;Hokkaido&#34;</span>, <span style="color:#f92672">&#34;populations&#34;</span>: [{<span style="color:#f92672">&#34;year&#34;</span>: <span style="color:#e6db74">&#34;1975&#34;</span>, <span style="color:#f92672">&#34;population&#34;</span>: <span style="color:#e6db74">&#34;5338206&#34;</span>} ,,,]},
</span></span><span style="display:flex;"><span>  {<span style="color:#f92672">&#34;region&#34;</span>: <span style="color:#e6db74">&#34;Aomori&#34;</span>, <span style="color:#f92672">&#34;populations&#34;</span>: [{<span style="color:#f92672">&#34;year&#34;</span>: <span style="color:#e6db74">&#34;1975&#34;</span>, <span style="color:#f92672">&#34;population&#34;</span>: <span style="color:#e6db74">&#34;1468646&#34;</span>} ,,,]},
</span></span><span style="display:flex;"><span>  {<span style="color:#f92672">&#34;region&#34;</span>: <span style="color:#e6db74">&#34;Iwate&#34;</span>, <span style="color:#f92672">&#34;populations&#34;</span>: [{<span style="color:#f92672">&#34;year&#34;</span>: <span style="color:#e6db74">&#34;1975&#34;</span>, <span style="color:#f92672">&#34;population&#34;</span>: <span style="color:#e6db74">&#34;1385563&#34;</span>} ,,,]},
</span></span><span style="display:flex;"><span>  ,
</span></span><span style="display:flex;"><span>  ,
</span></span><span style="display:flex;"><span>  ,
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><p>In this script, JSON schema for outputting is used in the prompt.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> GenerateContent
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> csv
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>api_key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>  <span style="color:#75715e"># Please set your API key.</span>
</span></span><span style="display:flex;"><span>filename <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;sample.csv&#34;</span>  <span style="color:#75715e"># Please set your CSV file with the path.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">createPrompt</span>():
</span></span><span style="display:flex;"><span>    jsonSchema1 <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#39;JSON schema of the inputted value. The filename is &#34;blobName@sample.txt&#34;.&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;array&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;items&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;region&#34;</span>: {<span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Region name.&#34;</span>, <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>},
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;populations&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Populations for each year.&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;array&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;items&#34;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#34;year&#34;</span>: {<span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;number&#34;</span>, <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Year.&#34;</span>},
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#34;population&#34;</span>: {
</span></span><span style="display:flex;"><span>                                <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;number&#34;</span>,
</span></span><span style="display:flex;"><span>                                <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Population.&#34;</span>,
</span></span><span style="display:flex;"><span>                            },
</span></span><span style="display:flex;"><span>                        },
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;required&#34;</span>: [<span style="color:#e6db74">&#34;year&#34;</span>, <span style="color:#e6db74">&#34;populations&#34;</span>],
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;required&#34;</span>: [<span style="color:#e6db74">&#34;region&#34;</span>, <span style="color:#e6db74">&#34;populations&#34;</span>],
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    jsonSchema2 <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;JSON schema for outputting the result.&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;array&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;items&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;region&#34;</span>: {<span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Region name.&#34;</span>, <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>},
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;reason&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Reasons for the population increase.&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;measures&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Details of measures to stop the population increase.&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;currentPopulation&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Current population.&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;number&#34;</span>,
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;futurePopulationWithMeasures&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Future population after 50 years with measures to keep the population increasing.&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;number&#34;</span>,
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;futurePopulationWithoutMeasures&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Future population after 50 years without measures to keep the population increasing.&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;number&#34;</span>,
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;required&#34;</span>: [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;region&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;reason&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;measures&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;currentPopulation&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;futurePopulationWithMeasures&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;futurePopulationWithoutMeasures&#34;</span>,
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    prompt <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>join(
</span></span><span style="display:flex;"><span>        [
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Run the following steps.&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;1. Read the JSON data in the following text file. The JSON schema of this data is &#34;JSONSchema1&#34;.&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;&lt;JSONSchema1&gt;</span><span style="color:#e6db74">{</span>json<span style="color:#f92672">.</span>dumps(jsonSchema1)<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/JSONSchema1&gt;&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;2. Using the data collected and your knowledge, predict 3 regions that will have the largest increase in population in the future in the order of increase. Return the region name, detailed reasons for the increase, and measures to keep the population increasing by considering the features of the region. Also, return the current population and the population 50 years later predicted by you with and without measures to keep the population increasing.&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;3. Return the result by following &#34;JSONSchema2&#34;.&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;&lt;JSONSchema2&gt;</span><span style="color:#e6db74">{</span>json<span style="color:#f92672">.</span>dumps(jsonSchema2)<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/JSONSchema2&gt;&#34;</span>,
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> prompt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">createData</span>(filename):
</span></span><span style="display:flex;"><span>    ar <span style="color:#f92672">=</span> list(csv<span style="color:#f92672">.</span>reader(open(filename, <span style="color:#e6db74">&#34;r&#34;</span>), delimiter<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;,&#34;</span>))[<span style="color:#ae81ff">1</span>:]
</span></span><span style="display:flex;"><span>    obj <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> r <span style="color:#f92672">in</span> ar:
</span></span><span style="display:flex;"><span>        year, region, population <span style="color:#f92672">=</span> r
</span></span><span style="display:flex;"><span>        v <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;year&#34;</span>: year, <span style="color:#e6db74">&#34;population&#34;</span>: population}
</span></span><span style="display:flex;"><span>        obj[region] <span style="color:#f92672">=</span> (obj[region] <span style="color:#f92672">+</span> [v]) <span style="color:#66d9ef">if</span> region <span style="color:#f92672">in</span> obj <span style="color:#66d9ef">else</span> [v]
</span></span><span style="display:flex;"><span>    arr <span style="color:#f92672">=</span> [{<span style="color:#e6db74">&#34;region&#34;</span>: k, <span style="color:#e6db74">&#34;populations&#34;</span>: v} <span style="color:#66d9ef">for</span> (k, v) <span style="color:#f92672">in</span> obj<span style="color:#f92672">.</span>items()]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> json<span style="color:#f92672">.</span>dumps(arr)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">=</span> createData(filename)
</span></span><span style="display:flex;"><span>prompt <span style="color:#f92672">=</span> createPrompt()
</span></span><span style="display:flex;"><span>object <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;api_key&#34;</span>: api_key,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;sample-name-2a&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;data&#34;</span>: data,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;prompt&#34;</span>: prompt,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>res <span style="color:#f92672">=</span> GenerateContent<span style="color:#f92672">.</span>Main()<span style="color:#f92672">.</span>run(object)
</span></span><span style="display:flex;"><span>print(res)
</span></span></code></pre></div><p>In this script, JSON schema for outputting is used with <code>response_schema</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> GenerateContent
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> csv
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>api_key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>  <span style="color:#75715e"># Please set your API key.</span>
</span></span><span style="display:flex;"><span>filename <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;sample.csv&#34;</span>  <span style="color:#75715e"># Please set your CSV file with the path.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">createPrompt</span>():
</span></span><span style="display:flex;"><span>    jsonSchema1 <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#39;JSON schema of the inputted value. The filename is &#34;blobName@sample.txt&#34;.&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;array&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;items&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;region&#34;</span>: {<span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Region name.&#34;</span>, <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>},
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;populations&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Populations for each year.&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;array&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;items&#34;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#34;year&#34;</span>: {<span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;number&#34;</span>, <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Year.&#34;</span>},
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#34;population&#34;</span>: {
</span></span><span style="display:flex;"><span>                                <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;number&#34;</span>,
</span></span><span style="display:flex;"><span>                                <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Population.&#34;</span>,
</span></span><span style="display:flex;"><span>                            },
</span></span><span style="display:flex;"><span>                        },
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;required&#34;</span>: [<span style="color:#e6db74">&#34;year&#34;</span>, <span style="color:#e6db74">&#34;populations&#34;</span>],
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;required&#34;</span>: [<span style="color:#e6db74">&#34;region&#34;</span>, <span style="color:#e6db74">&#34;populations&#34;</span>],
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    prompt <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>join(
</span></span><span style="display:flex;"><span>        [
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Run the following steps.&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;1. Read the JSON data in the following text file. The JSON schema of this data is &#34;JSONSchema1&#34;.&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;&lt;JSONSchema1&gt;</span><span style="color:#e6db74">{</span>json<span style="color:#f92672">.</span>dumps(jsonSchema1)<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/JSONSchema1&gt;&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;2. Using the data collected and your knowledge, predict 3 regions that will have the largest increase in population in the future in the order of increase. Return the region name, detailed reasons for the increase, and measures to keep the population increasing by considering the features of the region. Also, return the current population and the population 50 years later predicted by you with and without measures to keep the population increasing.&#34;</span>,
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> prompt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">createData</span>(filename):
</span></span><span style="display:flex;"><span>    ar <span style="color:#f92672">=</span> list(csv<span style="color:#f92672">.</span>reader(open(filename, <span style="color:#e6db74">&#34;r&#34;</span>), delimiter<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;,&#34;</span>))[<span style="color:#ae81ff">1</span>:]
</span></span><span style="display:flex;"><span>    obj <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> r <span style="color:#f92672">in</span> ar:
</span></span><span style="display:flex;"><span>        year, region, population <span style="color:#f92672">=</span> r
</span></span><span style="display:flex;"><span>        v <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;year&#34;</span>: year, <span style="color:#e6db74">&#34;population&#34;</span>: population}
</span></span><span style="display:flex;"><span>        obj[region] <span style="color:#f92672">=</span> (obj[region] <span style="color:#f92672">+</span> [v]) <span style="color:#66d9ef">if</span> region <span style="color:#f92672">in</span> obj <span style="color:#66d9ef">else</span> [v]
</span></span><span style="display:flex;"><span>    arr <span style="color:#f92672">=</span> [{<span style="color:#e6db74">&#34;region&#34;</span>: k, <span style="color:#e6db74">&#34;populations&#34;</span>: v} <span style="color:#66d9ef">for</span> (k, v) <span style="color:#f92672">in</span> obj<span style="color:#f92672">.</span>items()]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> json<span style="color:#f92672">.</span>dumps(arr)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>jsonSchema2 <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;JSON schema for outputting the result.&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;array&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;items&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;region&#34;</span>: {<span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Region name.&#34;</span>, <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>},
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;reason&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Reasons for the population increase.&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;measures&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Details of measures to stop the population increase.&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;currentPopulation&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Current population.&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;number&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;futurePopulationWithMeasures&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Future population after 50 years with measures to keep the population increasing.&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;number&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;futurePopulationWithoutMeasures&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Future population after 50 years without measures to keep the population increasing.&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;number&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;required&#34;</span>: [
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;region&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;reason&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;measures&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;currentPopulation&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;futurePopulationWithMeasures&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;futurePopulationWithoutMeasures&#34;</span>,
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">=</span> createData(filename)
</span></span><span style="display:flex;"><span>prompt <span style="color:#f92672">=</span> createPrompt()
</span></span><span style="display:flex;"><span>object <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;api_key&#34;</span>: api_key,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;sample-name-2b&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;data&#34;</span>: data,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;prompt&#34;</span>: prompt,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;response_schema&#34;</span>: jsonSchema2,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>res <span style="color:#f92672">=</span> GenerateContent<span style="color:#f92672">.</span>Main()<span style="color:#f92672">.</span>run(object)
</span></span><span style="display:flex;"><span>print(res)
</span></span></code></pre></div><h1 id="result">Result</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;region&#34;</span>: <span style="color:#e6db74">&#34;Tokyo&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;reason&#34;</span>: <span style="color:#e6db74">&#34;Tokyo&#39;s robust economy, diverse job market, and well-established infrastructure continue to attract both domestic and international migrants.  Its status as a global hub for business and culture ensures ongoing population growth.&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;measures&#34;</span>: <span style="color:#e6db74">&#34;Invest in affordable housing, improve public transportation, enhance green spaces and recreational facilities to improve quality of life, and continue promoting Tokyo as a global center for innovation and opportunity.&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;currentPopulation&#34;</span>: <span style="color:#ae81ff">14086000</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;futurePopulationWithMeasures&#34;</span>: <span style="color:#ae81ff">16000000</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;futurePopulationWithoutMeasures&#34;</span>: <span style="color:#ae81ff">15000000</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;region&#34;</span>: <span style="color:#e6db74">&#34;Osaka&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;reason&#34;</span>: <span style="color:#e6db74">&#34;Osaka is a major economic center with a strong industrial base and a thriving service sector. Its vibrant culture and relatively lower cost of living compared to Tokyo attract individuals seeking opportunities.&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;measures&#34;</span>: <span style="color:#e6db74">&#34;Focus on attracting skilled workers and entrepreneurs by offering tax incentives and streamlining business regulations. Improve affordable housing options and educational facilities. Promote Osaka&#39;s cultural attractions to attract tourists and residents.&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;currentPopulation&#34;</span>: <span style="color:#ae81ff">8763000</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;futurePopulationWithMeasures&#34;</span>: <span style="color:#ae81ff">10500000</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;futurePopulationWithoutMeasures&#34;</span>: <span style="color:#ae81ff">9500000</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;region&#34;</span>: <span style="color:#e6db74">&#34;Aichi&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;reason&#34;</span>: <span style="color:#e6db74">&#34;Aichi Prefecture benefits from its position as a major manufacturing and automotive hub. This strong industrial base and associated employment opportunities fuel consistent population growth.&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;measures&#34;</span>: <span style="color:#e6db74">&#34;Promote further diversification of the economy beyond automotive manufacturing to ensure long-term resilience. Invest in education and technology to attract highly skilled professionals. Develop sustainable infrastructure to enhance quality of life.&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;currentPopulation&#34;</span>: <span style="color:#ae81ff">7477000</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;futurePopulationWithMeasures&#34;</span>: <span style="color:#ae81ff">9000000</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;futurePopulationWithoutMeasures&#34;</span>: <span style="color:#ae81ff">8000000</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>Upon executing the scripts in the above section, we observed the following outcomes:</p>
<ul>
<li>Data Format Processing: Gemini successfully processed both CSV and JSON structured data formats by utilizing their corresponding schemas (CSV schema and JSON schema).</li>
<li>Schema Effectiveness: Both schema approaches proved effective for Gemini&rsquo;s understanding of the input data.</li>
<li>Reason Field Variability: While the specific values of the &ldquo;reason&rdquo; field might vary slightly across script executions due to the non-zero temperature input, the values of other fields remained consistent.</li>
<li>Region Prediction Accuracy: In some cases, the predicted region differed from the expected outcome. However, in this case, the primary focus was on whether Gemini accurately understood the input data, regardless of the specific region prediction.</li>
</ul>
<p>These findings highlight Gemini&rsquo;s ability to effectively handle structured data formats and leverage schemas for improved comprehension.</p>
<h1 id="note">Note</h1>
<ul>
<li>In this report, Python script is used. However, this approach can be used for various languages for using Gemini API.</li>
<li>The data size depends on the maximum token for Gemini API.</li>
</ul>
<h1 id="references">References</h1>
<p>This report refers to the following references.</p>
<ul>
<li><a href="https://medium.com/google-cloud/taming-the-wild-output-effective-control-of-gemini-api-response-formats-with-response-mime-type-da273c08be85">Taming the Wild Output: Effective Control of Gemini API Response Formats with response_mime_type</a>: Published on May 1, 2024</li>
<li><a href="https://medium.com/google-cloud/gemini-api-with-json-schema-3dbdabac7d19">Gemini API with JSON schema</a>: Published on May 7, 2024</li>
<li><a href="https://medium.com/google-cloud/taming-the-wild-output-effective-control-of-gemini-api-response-formats-with-response-schema-ae0097b97502">Taming the Wild Output: Effective Control of Gemini API Response Formats with response_schema</a> Published on May 21, 2024</li>
</ul>

  
  <h4><i class="fas fa-share-alt" aria-hidden="true"></i>&nbsp;Share!</h4>
<ul class="share-buttons">
	<li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftanaikech.github.io%2f2024%2f09%2f25%2fharnessing-geminis-power-a-guide-to-generating-content-from-structured-data%2f" target="_blank" title="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span class="sr-only">Share on Facebook</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://twitter.com/intent/tweet?source=https%3a%2f%2ftanaikech.github.io%2f2024%2f09%2f25%2fharnessing-geminis-power-a-guide-to-generating-content-from-structured-data%2f" target="_blank" title="Tweet"><i class="fab fa-twitter" aria-hidden="true"></i><span class="sr-only">Tweet</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://plus.google.com/share?url=https%3a%2f%2ftanaikech.github.io%2f2024%2f09%2f25%2fharnessing-geminis-power-a-guide-to-generating-content-from-structured-data%2f" target="_blank" title="Share on Google+"><i class="fab fa-google-plus" aria-hidden="true"></i><span class="sr-only">Share on Google+</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.tumblr.com/share?v=3&u=https%3a%2f%2ftanaikech.github.io%2f2024%2f09%2f25%2fharnessing-geminis-power-a-guide-to-generating-content-from-structured-data%2f" target="_blank" title="Post to Tumblr"><i class="fab fa-tumblr" aria-hidden="true"></i><span class="sr-only">Post to Tumblr</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2ftanaikech.github.io%2f2024%2f09%2f25%2fharnessing-geminis-power-a-guide-to-generating-content-from-structured-data%2f" target="_blank" title="Pin it"><i class="fab fa-pinterest-p" aria-hidden="true"></i><span class="sr-only">Pin it</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.reddit.com/submit?url=https%3a%2f%2ftanaikech.github.io%2f2024%2f09%2f25%2fharnessing-geminis-power-a-guide-to-generating-content-from-structured-data%2f" target="_blank" title="Submit to Reddit"><i class="fab fa-reddit-alien" aria-hidden="true"></i><span class="sr-only">Submit to Reddit</span></a>
	</li>
</ul>


<style>
	ul.share-buttons{
	  list-style: none;
	  padding: 0;
	}

	ul.share-buttons li{
	  display: inline;
	}

	ul.share-buttons .sr-only{
	  position: absolute;
	  clip: rect(1px 1px 1px 1px);
	  clip: rect(1px, 1px, 1px, 1px);
	  padding: 0;
	  border: 0;
	  height: 1px;
	  width: 1px;
	  overflow: hidden;
	}
</style>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://tanaikech.github.io/2024/09/19/flexible-labeling-for-gmail-using-gemini-api-with-google-apps-script-part-3/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://tanaikech.github.io/2024/09/19/flexible-labeling-for-gmail-using-gemini-api-with-google-apps-script-part-3/">Flexible Labeling for Gmail using Gemini API with Google Apps Script Part 3</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
  </div>
</div>


  
  
  
  

  

</div>

</div>
</div>
<script src="https://tanaikech.github.io/js/ui.js"></script>
<script src="https://tanaikech.github.io/js/menus.js"></script>






<script async src="https://www.googletagmanager.com/gtag/js?id=G-J3Z6T50WL5"></script>
<script>
  
  if (window.location.hostname != "localhost") {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-J3Z6T50WL5');
  }
</script>






<script src="https://tanaikech.github.io/js/math-code.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  


</body>
</html>

