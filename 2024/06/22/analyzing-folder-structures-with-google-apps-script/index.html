<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <meta name="google-site-verification" content="1BvDMY90ui0jRLHkrpqdQ_x62h5VNEMuK6mQsDvVQH0" />

  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.98.0" />

  <title>Analyzing Folder Structures with Google Apps Script &middot; tanaike</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://tanaikech.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">

  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet" type="text/css">

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css">
  <script async src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://tanaikech.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://tanaikech.github.io/">TANAIKE</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/topics/"><i class='fa fa-folder fa-fw'></i>Topics</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/link/"><i class='fa fa-thumbs-up fa-fw'></i>Links</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/webapps/"><i class='fas fa-toolbox'></i>Web Applications</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/donate/"><i class='fas fa-donate'></i>Donate</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/tanaikech" rel="me" target="_blank"><i class="fab fa-twitter-square fa-fw"></i>X</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/tanaikech" rel="me" target="_blank"><i class="fab fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/7108653" rel="me" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2017. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Analyzing Folder Structures with Google Apps Script</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>22 Jun 2024, 14:38</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/gastips">GasTips</a>
    
  </div>
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/google-apps-script">Google Apps Script</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/google-drive">Google Drive</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/drive-api">drive-api</a>
    
  </div>
  
  

</div>

  <p><a href="https://gist.github.com/tanaikech/aa654883775702d02bc3e40fdc3af69e">Gists</a></p>
<h1 id="abstract">Abstract</h1>
<p>This report provides a Google Apps Script to retrieve all files, including those within subfolders, for a designated folder. It addresses the challenges of retrieving files within deeply nested folder structures and obtaining complete file paths.</p>
<h1 id="introduction">Introduction</h1>
<p>Google Apps Script empowers developers to interact with Google Drive data programmatically, unlocking a wide range of functionalities. A core component of this interaction is the Drive service (DriveApp) and Drive API. These services provide programmatic control over files and folders within your Drive.</p>
<p>While retrieving all files and folders within your Drive and just under a specific folder is straightforward, managing nested subfolders within a specific folder presents a greater challenge. On forums like Stackoverflow, users frequently encounter difficulties retrieving files buried deep within complex folder structures (folder trees) and obtaining complete file paths for these files.</p>
<p>This report bridges this gap by presenting a custom Google Apps Script designed to efficiently retrieve all files, encompassing those nestled within subfolders, for a designated folder. We&rsquo;ll explore the script&rsquo;s inner workings and provide a sample script as a reference. By understanding this script, you&rsquo;ll be well-equipped to leverage Google Apps Script for developing powerful applications that interact seamlessly with your Google Drive data.</p>
<p>The repository of this is <a href="https://github.com/tanaikech/taking-advantage-of-google-apps-script">here</a>.</p>
<h1 id="usage">Usage</h1>
<h2 id="1-create-a-google-apps-script-project">1. Create a Google Apps Script project</h2>
<p>Please create a Google Apps Script project. You can use both the standalone script and the container-bound script.</p>
<h2 id="2-prepare-folder">2. Prepare folder</h2>
<p>In order to test this script, please prepare a folder including the subfolders and the files. In this report, I used the following folder including the subfolders and the files as a sample folder.</p>
<p><img src="https://tanaikech.github.io/image-storage/20240622a/fig1.png" alt=""></p>
<h2 id="3-scripts">3. Scripts</h2>
<p>I would like to introduce the following 2 patterned scripts as class objects.</p>
<h3 id="1-using-drive-service-driveapp">1. Using Drive service (DriveApp)</h3>
<p>In this pattern, Drive service (DriveApp) is used. The sample class object is as follows. Please copy and paste the following class object to the script editor.</p>
<p>In this case, it is NOT required to enable Drive API at Advanced Google services.</p>
<p><strong>In this script, the folder trees can be obtained from your Drive and the shared drives.</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * ### Description
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Get folder tree using DriveApp (Drive service) from own drive and shared drive.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * ref: https://developers.google.com/apps-script/reference/drive
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Required scopes:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * - `https://www.googleapis.com/auth/drive.readonly`
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">GetFolderTreeForDriveApp</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {Object} object Source folder ID.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {String} object.id Source folder ID. Default is root folder.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">constructor</span>(<span style="color:#a6e22e">object</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;root&#34;</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">object</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/** @private */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">id</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * ### Description
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * Get folder tree.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {Object} object Object for retrieving folder tree.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @returns {Array} Array including folder tree.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">getTree</span>(<span style="color:#a6e22e">object</span> <span style="color:#f92672">=</span> {}) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">loop</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">object</span> =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">parents</span> <span style="color:#f92672">=</span> { <span style="color:#a6e22e">ids</span><span style="color:#f92672">:</span> [], <span style="color:#a6e22e">names</span><span style="color:#f92672">:</span> [] }, <span style="color:#a6e22e">folders</span> <span style="color:#f92672">=</span> [] } <span style="color:#f92672">=</span> <span style="color:#a6e22e">object</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">folder</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">DriveApp</span>.<span style="color:#a6e22e">getFolderById</span>(<span style="color:#a6e22e">id</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">parents</span>.<span style="color:#a6e22e">ids</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">parents</span>.<span style="color:#a6e22e">ids</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">id</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">parents</span>.<span style="color:#a6e22e">names</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">folder</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">pid</span> <span style="color:#f92672">=</span> [...<span style="color:#a6e22e">parents</span>.<span style="color:#a6e22e">ids</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">pn</span> <span style="color:#f92672">=</span> [...<span style="color:#a6e22e">parents</span>.<span style="color:#a6e22e">names</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fols</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">folder</span>.<span style="color:#a6e22e">getFolders</span>();
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">folderList</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> (<span style="color:#a6e22e">fols</span>.<span style="color:#a6e22e">hasNext</span>()) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">f</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">fols</span>.<span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">folderList</span>.<span style="color:#a6e22e">push</span>({ <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">getId</span>(), <span style="color:#a6e22e">treeIds</span><span style="color:#f92672">:</span> [...<span style="color:#a6e22e">pid</span>, <span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">getId</span>()], <span style="color:#a6e22e">treeNames</span><span style="color:#f92672">:</span> [...<span style="color:#a6e22e">pn</span>, <span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">getName</span>()] });
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">folderList</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">folders</span>.<span style="color:#a6e22e">push</span>(...<span style="color:#a6e22e">folderList</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">folderList</span>.<span style="color:#a6e22e">forEach</span>(({ <span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">treeIds</span>, <span style="color:#a6e22e">treeNames</span> }) =&gt;
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">loop</span>({ <span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">parents</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">ids</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">treeIds</span>, <span style="color:#a6e22e">names</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">treeNames</span> }, <span style="color:#a6e22e">folders</span> })
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">folders</span>.<span style="color:#a6e22e">map</span>(({ <span style="color:#a6e22e">treeIds</span>, <span style="color:#a6e22e">treeNames</span> }) =&gt; ({ <span style="color:#a6e22e">treeIds</span>, <span style="color:#a6e22e">treeNames</span> }));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">loop</span>(<span style="color:#a6e22e">object</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * ### Description
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * Get folder tree with files in each folder.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {Object} object Object for retrieving folder tree with files.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @returns {Array} Array including folder tree with files.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">getTreeWithFiles</span>(<span style="color:#a6e22e">object</span> <span style="color:#f92672">=</span> {}) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">loop</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">object</span> =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">parents</span> <span style="color:#f92672">=</span> { <span style="color:#a6e22e">ids</span><span style="color:#f92672">:</span> [], <span style="color:#a6e22e">names</span><span style="color:#f92672">:</span> [] }, <span style="color:#a6e22e">folders</span> <span style="color:#f92672">=</span> [] } <span style="color:#f92672">=</span> <span style="color:#a6e22e">object</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">folder</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">DriveApp</span>.<span style="color:#a6e22e">getFolderById</span>(<span style="color:#a6e22e">id</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">parents</span>.<span style="color:#a6e22e">ids</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">parents</span>.<span style="color:#a6e22e">ids</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">id</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">parents</span>.<span style="color:#a6e22e">names</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">folder</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">folders</span>.<span style="color:#a6e22e">push</span>({ <span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">treeIds</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">parents</span>.<span style="color:#a6e22e">ids</span>, <span style="color:#a6e22e">treeNames</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">parents</span>.<span style="color:#a6e22e">names</span>, <span style="color:#a6e22e">parent</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">folderId</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">folderName</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">folder</span>.<span style="color:#a6e22e">getName</span>() }, <span style="color:#a6e22e">fileList</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getFiles_</span>(<span style="color:#a6e22e">folder</span>) });
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">pid</span> <span style="color:#f92672">=</span> [...<span style="color:#a6e22e">parents</span>.<span style="color:#a6e22e">ids</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">pn</span> <span style="color:#f92672">=</span> [...<span style="color:#a6e22e">parents</span>.<span style="color:#a6e22e">names</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fols</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">folder</span>.<span style="color:#a6e22e">getFolders</span>();
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">folderList</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> (<span style="color:#a6e22e">fols</span>.<span style="color:#a6e22e">hasNext</span>()) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">f</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">fols</span>.<span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">folderId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">getId</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">folderName</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">getName</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">folderList</span>.<span style="color:#a6e22e">push</span>({ <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">getId</span>(), <span style="color:#a6e22e">treeIds</span><span style="color:#f92672">:</span> [...<span style="color:#a6e22e">pid</span>, <span style="color:#a6e22e">folderId</span>], <span style="color:#a6e22e">treeNames</span><span style="color:#f92672">:</span> [...<span style="color:#a6e22e">pn</span>, <span style="color:#a6e22e">folderName</span>], <span style="color:#a6e22e">parent</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">folderId</span>, <span style="color:#a6e22e">folderName</span> }, <span style="color:#a6e22e">fileList</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getFiles_</span>(<span style="color:#a6e22e">f</span>) });
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">folderList</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">folders</span>.<span style="color:#a6e22e">push</span>(...<span style="color:#a6e22e">folderList</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">folderList</span>.<span style="color:#a6e22e">forEach</span>(({ <span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">treeIds</span>, <span style="color:#a6e22e">treeNames</span> }) =&gt;
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">loop</span>({ <span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">parents</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">ids</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">treeIds</span>, <span style="color:#a6e22e">names</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">treeNames</span> }, <span style="color:#a6e22e">folders</span> })
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">folders</span>.<span style="color:#a6e22e">map</span>(({ <span style="color:#a6e22e">treeIds</span>, <span style="color:#a6e22e">treeNames</span>, <span style="color:#a6e22e">parent</span>, <span style="color:#a6e22e">fileList</span> }) =&gt; ({ <span style="color:#a6e22e">treeIds</span>, <span style="color:#a6e22e">treeNames</span>, <span style="color:#a6e22e">parent</span>, <span style="color:#a6e22e">fileList</span> }));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">loop</span>(<span style="color:#a6e22e">object</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * ### Description
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * Get filename with path.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {String} delimiter Delimiter for showing path. Default is &#34;/&#34;.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @returns {Array} Array including filenames including each path.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">getFilenameWithPath</span>(<span style="color:#a6e22e">delimiter</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/&#34;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getTreeWithFiles</span>().<span style="color:#a6e22e">flatMap</span>(({ <span style="color:#a6e22e">treeNames</span>, <span style="color:#a6e22e">fileList</span> }) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">path</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">treeNames</span>.<span style="color:#a6e22e">join</span>(<span style="color:#a6e22e">delimiter</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fileList</span>.<span style="color:#a6e22e">map</span>(({ <span style="color:#a6e22e">name</span> }) =&gt; <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">path</span><span style="color:#e6db74">}${</span><span style="color:#a6e22e">delimiter</span><span style="color:#e6db74">}${</span><span style="color:#a6e22e">name</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * ### Description
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * Get files under a folder.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {DriveApp.Folder} folder Folder object.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @returns {Array} Array including files.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @private
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">getFiles_</span>(<span style="color:#a6e22e">folder</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fileList</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">files</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">folder</span>.<span style="color:#a6e22e">getFiles</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (<span style="color:#a6e22e">files</span>.<span style="color:#a6e22e">hasNext</span>()) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">file</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">files</span>.<span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fileList</span>.<span style="color:#a6e22e">push</span>({ <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">getName</span>(), <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">getId</span>(), <span style="color:#a6e22e">mimeType</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">getMimeType</span>() });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fileList</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="scopes">Scopes</h4>
<p>This class uses the following scopes.</p>
<ul>
<li><code>https://www.googleapis.com/auth/drive.readonly</code></li>
</ul>
<h4 id="sample-scripts">Sample scripts</h4>
<p>The sample script for using this class <strong>GetFolderTreeForDriveApp</strong> is as follows. Also, please copy and paste the following script to the same script editor.</p>
<h5 id="gettree-method-of-class-getfoldertreefordriveapp">getTree method of class GetFolderTreeForDriveApp</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sample1</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">folderId</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>; <span style="color:#75715e">// Please set the folder ID.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">GetFolderTreeForDriveApp</span>({ <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">folderId</span> }).<span style="color:#a6e22e">getTree</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">obj</span>));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When the function <code>sample1</code> is run to the above sample folder, the following result is obtained.</p>
<pre tabindex="0"><code>[
  {
    &#34;treeIds&#34;: [&#34;ID of sampleTopFolder&#34;, &#34;ID of folder_2&#34;],
    &#34;treeNames&#34;: [&#34;sampleTopFolder&#34;, &#34;folder_2&#34;]
  },
  {
    &#34;treeIds&#34;: [&#34;ID of sampleTopFolder&#34;, &#34;ID of folder_1&#34;],
    &#34;treeNames&#34;: [&#34;sampleTopFolder&#34;, &#34;folder_1&#34;]
  },
  {
    &#34;treeIds&#34;: [&#34;ID of sampleTopFolder&#34;, &#34;ID of folder_2&#34;, &#34;ID of folder_2_1&#34;],
    &#34;treeNames&#34;: [&#34;sampleTopFolder&#34;, &#34;folder_2&#34;, &#34;folder_2_1&#34;]
  },
  {
    &#34;treeIds&#34;: [&#34;ID of sampleTopFolder&#34;, &#34;ID of folder_2&#34;, &#34;ID of folder_2_1&#34;, &#34;ID of folder_2_1_1&#34;],
    &#34;treeNames&#34;: [&#34;sampleTopFolder&#34;, &#34;folder_2&#34;, &#34;folder_2_1&#34;, &#34;folder_2_1_1&#34;]
  },
  {
    &#34;treeIds&#34;: [&#34;ID of sampleTopFolder&#34;, &#34;ID of folder_1&#34;, &#34;ID of folder_1_2&#34;],
    &#34;treeNames&#34;: [&#34;sampleTopFolder&#34;, &#34;folder_1&#34;, &#34;folder_1_2&#34;]
  },
  {
    &#34;treeIds&#34;: [&#34;ID of sampleTopFolder&#34;, &#34;ID of folder_1&#34;, &#34;ID of folder_1_1&#34;],
    &#34;treeNames&#34;: [&#34;sampleTopFolder&#34;, &#34;folder_1&#34;, &#34;folder_1_1&#34;]
  }
]
</code></pre><h5 id="gettreewithfiles-method-of-class-getfoldertreefordriveapp">getTreeWithFiles method of class GetFolderTreeForDriveApp</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sample2</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">folderId</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>; <span style="color:#75715e">// Please set the folder ID.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">GetFolderTreeForDriveApp</span>({ <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">folderId</span> }).<span style="color:#a6e22e">getTreeWithFiles</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">obj</span>));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When the function <code>sample2</code> is run to the above sample folder, the following result is obtained.</p>
<pre tabindex="0"><code>[
  {
    &#34;treeIds&#34;: [&#34;ID of sampleTopFolder&#34;],
    &#34;treeNames&#34;: [&#34;sampleTopFolder&#34;],
    &#34;parent&#34;: { &#34;folderId&#34;: &#34;ID of sampleTopFolder&#34;, &#34;folderName&#34;: &#34;sampleTopFolder&#34; },
    &#34;fileList&#34;: [
      { &#34;name&#34;: &#34;sample_file_1.txt&#34;, &#34;id&#34;: &#34;###&#34;, &#34;mimeType&#34;: &#34;text/plain&#34; }
    ]
  },
  {
    &#34;treeIds&#34;: [&#34;ID of sampleTopFolder&#34;, &#34;ID of folder_2&#34;],
    &#34;treeNames&#34;: [&#34;sampleTopFolder&#34;, &#34;folder_2&#34;],
    &#34;parent&#34;: { &#34;folderId&#34;: &#34;ID of folder_2&#34;, &#34;folderName&#34;: &#34;folder_2&#34; },
    &#34;fileList&#34;: [
      { &#34;name&#34;: &#34;sample_file_6.txt&#34;, &#34;id&#34;: &#34;###&#34;, &#34;mimeType&#34;: &#34;text/plain&#34; },
      { &#34;name&#34;: &#34;sample_file_5.txt&#34;, &#34;id&#34;: &#34;###&#34;, &#34;mimeType&#34;: &#34;text/plain&#34; }
    ]
  },
  {
    &#34;treeIds&#34;: [&#34;ID of sampleTopFolder&#34;, &#34;ID of folder_1&#34;],
    &#34;treeNames&#34;: [&#34;sampleTopFolder&#34;, &#34;folder_1&#34;],
    &#34;parent&#34;: { &#34;folderId&#34;: &#34;ID of folder_1&#34;, &#34;folderName&#34;: &#34;folder_1&#34; },
    &#34;fileList&#34;: [
      { &#34;name&#34;: &#34;sample_file_4.txt&#34;, &#34;id&#34;: &#34;###&#34;, &#34;mimeType&#34;: &#34;text/plain&#34; },
      { &#34;name&#34;: &#34;sample_file_3.txt&#34;, &#34;id&#34;: &#34;###&#34;, &#34;mimeType&#34;: &#34;text/plain&#34; },
      { &#34;name&#34;: &#34;sample_file_2.txt&#34;, &#34;id&#34;: &#34;###&#34;, &#34;mimeType&#34;: &#34;text/plain&#34; }
    ]
  },
  {
    &#34;treeIds&#34;: [&#34;ID of sampleTopFolder&#34;, &#34;ID of folder_2&#34;, &#34;ID of folder_2_1&#34;],
    &#34;treeNames&#34;: [&#34;sampleTopFolder&#34;, &#34;folder_2&#34;, &#34;folder_2_1&#34;],
    &#34;parent&#34;: { &#34;folderId&#34;: &#34;ID of folder_2_1&#34;, &#34;folderName&#34;: &#34;folder_2_1&#34; },
    &#34;fileList&#34;: [
      { &#34;name&#34;: &#34;sample_file_7.txt&#34;, &#34;id&#34;: &#34;###&#34;, &#34;mimeType&#34;: &#34;text/plain&#34; }
    ]
  },
  {
    &#34;treeIds&#34;: [&#34;ID of sampleTopFolder&#34;, &#34;ID of folder_2&#34;, &#34;ID of folder_2_1&#34;, &#34;ID of folder_2_1_1&#34;],
    &#34;treeNames&#34;: [&#34;sampleTopFolder&#34;, &#34;folder_2&#34;, &#34;folder_2_1&#34;, &#34;folder_2_1_1&#34;],
    &#34;parent&#34;: { &#34;folderId&#34;: &#34;ID of folder_2_1_1&#34;, &#34;folderName&#34;: &#34;folder_2_1_1&#34; },
    &#34;fileList&#34;: []
  },
  {
    &#34;treeIds&#34;: [&#34;ID of sampleTopFolder&#34;, &#34;ID of folder_1&#34;, &#34;ID of folder_1_2&#34;],
    &#34;treeNames&#34;: [&#34;sampleTopFolder&#34;, &#34;folder_1&#34;, &#34;folder_1_2&#34;],
    &#34;parent&#34;: { &#34;folderId&#34;: &#34;ID of folder_1_2&#34;, &#34;folderName&#34;: &#34;folder_1_2&#34; },
    &#34;fileList&#34;: [
      { &#34;name&#34;: &#34;sample_file_8.txt&#34;, &#34;id&#34;: &#34;###&#34;, &#34;mimeType&#34;: &#34;text/plain&#34; }
    ]
  },
  {
    &#34;treeIds&#34;: [&#34;ID of sampleTopFolder&#34;, &#34;ID of folder_1&#34;, &#34;ID of folder_1_1&#34;],
    &#34;treeNames&#34;: [&#34;sampleTopFolder&#34;, &#34;folder_1&#34;, &#34;folder_1_1&#34;],
    &#34;parent&#34;: { &#34;folderId&#34;: &#34;ID of folder_1_1&#34;, &#34;folderName&#34;: &#34;folder_1_1&#34; },
    &#34;fileList&#34;: [
      { &#34;name&#34;: &#34;sample_file_9.txt&#34;, &#34;id&#34;: &#34;###&#34;, &#34;mimeType&#34;: &#34;text/plain&#34; }
    ]
  }
]
</code></pre><h5 id="getfilenamewithpath-method-of-class-getfoldertreefordriveapp">getFilenameWithPath method of class GetFolderTreeForDriveApp</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sample3</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">folderId</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>; <span style="color:#75715e">// Please set the folder ID.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">GetFolderTreeForDriveApp</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">folderId</span>,
</span></span><span style="display:flex;"><span>  }).<span style="color:#a6e22e">getFilenameWithPath</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">obj</span>));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When the function <code>sample3</code> is run to the above sample folder, the following result is obtained. In this case, in order to have high readability, the order was sorted by the filename.</p>
<p>When <code>const obj = new GetFolderTreeForDriveApp({ id: folderId }).getFilenameWithPath(&quot;---&quot;);</code> is run, the delimiter of path uses <code>---</code>.</p>
<pre tabindex="0"><code>[
  &#34;sampleTopFolder/sample_file_1.txt&#34;,
  &#34;sampleTopFolder/folder_1/sample_file_2.txt&#34;,
  &#34;sampleTopFolder/folder_1/sample_file_3.txt&#34;,
  &#34;sampleTopFolder/folder_1/sample_file_4.txt&#34;,
  &#34;sampleTopFolder/folder_2/sample_file_5.txt&#34;,
  &#34;sampleTopFolder/folder_2/sample_file_6.txt&#34;,
  &#34;sampleTopFolder/folder_2/folder_2_1/sample_file_7.txt&#34;,
  &#34;sampleTopFolder/folder_1/folder_1_2/sample_file_8.txt&#34;,
  &#34;sampleTopFolder/folder_1/folder_1_1/sample_file_9.txt&#34;
]
</code></pre><h3 id="2-using-drive-api">2. Using Drive API</h3>
<p>In this pattern, Drive API is used. The sample class object is as follows. Please copy and paste the following class object to the script editor.</p>
<p>And, please enable Drive API at Advanced Google services.</p>
<p><strong>In this script, the folder trees can be obtained from your Drive, the shared drives, and the drive of the service account.</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * ### Description
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Get folder tree using Drive API from own drive, shared drive and service account&#39;s drive.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * When you want to retrieve the folder tree from the service account, please give the access token from the service account.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * ref: https://developers.google.com/drive/api/reference/rest/v3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Required scopes:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * - `https://www.googleapis.com/auth/drive.metadata.readonly`
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * - `https://www.googleapis.com/auth/script.external_request`
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">GetFolderTreeForDriveAPI</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {Object} object Source folder ID.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {String} object.id Source folder ID. Default is root folder.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">constructor</span>(<span style="color:#a6e22e">object</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;root&#34;</span>, <span style="color:#a6e22e">accessToken</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ScriptApp</span>.<span style="color:#a6e22e">getOAuthToken</span>() } <span style="color:#f92672">=</span> <span style="color:#a6e22e">object</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/** @private */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">id</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/** @private */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">headers</span> <span style="color:#f92672">=</span> { <span style="color:#a6e22e">authorization</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`Bearer </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">accessToken</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span> };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/** @private */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://www.googleapis.com/drive/v3/files&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">Drive</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;undefined&#34;</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">Drive</span>.<span style="color:#a6e22e">getVersion</span>() <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;v3&#34;</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#34;Please enable Drive API v3 at Advanced Google services. ref: https://developers.google.com/apps-script/guides/services/advanced#enable_advanced_services&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * ### Description
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * Get folder tree.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {Object} object Object for retrieving folder tree.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @returns {Array} Array including folder tree.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">getTree</span>(<span style="color:#a6e22e">object</span> <span style="color:#f92672">=</span> {}) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">loop</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">object</span> =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">parents</span> <span style="color:#f92672">=</span> { <span style="color:#a6e22e">ids</span><span style="color:#f92672">:</span> [], <span style="color:#a6e22e">names</span><span style="color:#f92672">:</span> [] }, <span style="color:#a6e22e">folders</span> <span style="color:#f92672">=</span> [] } <span style="color:#f92672">=</span> <span style="color:#a6e22e">object</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">parents</span>.<span style="color:#a6e22e">ids</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">folder</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">addQueryParameters_</span>(<span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">url</span><span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">id</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>, { <span style="color:#a6e22e">supportsAllDrives</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">fields</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;name&#34;</span> }), { <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">headers</span> }).<span style="color:#a6e22e">getContentText</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">parents</span>.<span style="color:#a6e22e">ids</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">id</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">parents</span>.<span style="color:#a6e22e">names</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">folder</span>.<span style="color:#a6e22e">name</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">pid</span> <span style="color:#f92672">=</span> [...<span style="color:#a6e22e">parents</span>.<span style="color:#a6e22e">ids</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">pn</span> <span style="color:#f92672">=</span> [...<span style="color:#a6e22e">parents</span>.<span style="color:#a6e22e">names</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">query</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">q</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`&#39;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">id</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#39; in parents and mimeType=&#39;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">MimeType</span>.<span style="color:#a6e22e">FOLDER</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#39; and trashed=false`</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fields</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;files(id,name,parents),nextPageToken&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">pageSize</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1000</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">supportsAllDrives</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">includeItemsFromAllDrives</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>      };
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">folderList</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">pageToken</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">do</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">addQueryParameters_</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">query</span>), { <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">headers</span> });
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">getContentText</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">files</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">folderList</span>.<span style="color:#a6e22e">push</span>(...<span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">files</span>.<span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">o</span> =&gt; ({ <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">treeIds</span><span style="color:#f92672">:</span> [...<span style="color:#a6e22e">pid</span>, <span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">id</span>], <span style="color:#a6e22e">treeNames</span><span style="color:#f92672">:</span> [...<span style="color:#a6e22e">pn</span>, <span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">name</span>] })));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">pageToken</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">nextPageToken</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">query</span>.<span style="color:#a6e22e">pageToken</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">pageToken</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">while</span> (<span style="color:#a6e22e">pageToken</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">folderList</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">folders</span>.<span style="color:#a6e22e">push</span>(...<span style="color:#a6e22e">folderList</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">folderList</span>.<span style="color:#a6e22e">forEach</span>(({ <span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">treeIds</span>, <span style="color:#a6e22e">treeNames</span> }) =&gt;
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">loop</span>({ <span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">parents</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">ids</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">treeIds</span>, <span style="color:#a6e22e">names</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">treeNames</span> }, <span style="color:#a6e22e">folders</span> })
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">folders</span>.<span style="color:#a6e22e">map</span>(({ <span style="color:#a6e22e">treeIds</span>, <span style="color:#a6e22e">treeNames</span> }) =&gt; ({ <span style="color:#a6e22e">treeIds</span>, <span style="color:#a6e22e">treeNames</span> }));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">loop</span>(<span style="color:#a6e22e">object</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * ### Description
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * Get folder tree with files in each folder.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {Object} object Object for retrieving folder tree with files.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @returns {Array} Array including folder tree with files.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">getTreeWithFiles</span>(<span style="color:#a6e22e">object</span> <span style="color:#f92672">=</span> {}) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">loop</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">object</span> =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">parents</span> <span style="color:#f92672">=</span> { <span style="color:#a6e22e">ids</span><span style="color:#f92672">:</span> [], <span style="color:#a6e22e">names</span><span style="color:#f92672">:</span> [] }, <span style="color:#a6e22e">folders</span> <span style="color:#f92672">=</span> [] } <span style="color:#f92672">=</span> <span style="color:#a6e22e">object</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">parents</span>.<span style="color:#a6e22e">ids</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">folder</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">addQueryParameters_</span>(<span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">url</span><span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">id</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>, { <span style="color:#a6e22e">supportsAllDrives</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">fields</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;name&#34;</span> }), { <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">headers</span> }).<span style="color:#a6e22e">getContentText</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">parents</span>.<span style="color:#a6e22e">ids</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">id</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">parents</span>.<span style="color:#a6e22e">names</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">folder</span>.<span style="color:#a6e22e">name</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">folders</span>.<span style="color:#a6e22e">push</span>({ <span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">treeIds</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">parents</span>.<span style="color:#a6e22e">ids</span>, <span style="color:#a6e22e">treeNames</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">parents</span>.<span style="color:#a6e22e">names</span>, <span style="color:#a6e22e">parent</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">folderId</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">folderName</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">folder</span>.<span style="color:#a6e22e">name</span> }, <span style="color:#a6e22e">fileList</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getFiles_</span>({ <span style="color:#a6e22e">id</span> }) });
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">pid</span> <span style="color:#f92672">=</span> [...<span style="color:#a6e22e">parents</span>.<span style="color:#a6e22e">ids</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">pn</span> <span style="color:#f92672">=</span> [...<span style="color:#a6e22e">parents</span>.<span style="color:#a6e22e">names</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">query</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">q</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`&#39;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">id</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#39; in parents and mimeType=&#39;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">MimeType</span>.<span style="color:#a6e22e">FOLDER</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#39; and trashed=false`</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fields</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;files(id,name,parents),nextPageToken&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">pageSize</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1000</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">supportsAllDrives</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">includeItemsFromAllDrives</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>      };
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">folderList</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">pageToken</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">do</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">addQueryParameters_</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">query</span>), { <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">headers</span> });
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">getContentText</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">files</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">folderList</span>.<span style="color:#a6e22e">push</span>(...<span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">files</span>.<span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">o</span> =&gt;
</span></span><span style="display:flex;"><span>            ({ <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">treeIds</span><span style="color:#f92672">:</span> [...<span style="color:#a6e22e">pid</span>, <span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">id</span>], <span style="color:#a6e22e">treeNames</span><span style="color:#f92672">:</span> [...<span style="color:#a6e22e">pn</span>, <span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">name</span>], <span style="color:#a6e22e">parent</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">folderId</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">folderName</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">name</span> }, <span style="color:#a6e22e">fileList</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getFiles_</span>(<span style="color:#a6e22e">o</span>) })
</span></span><span style="display:flex;"><span>          ));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">pageToken</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">nextPageToken</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">query</span>.<span style="color:#a6e22e">pageToken</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">pageToken</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">while</span> (<span style="color:#a6e22e">pageToken</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">folderList</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">folders</span>.<span style="color:#a6e22e">push</span>(...<span style="color:#a6e22e">folderList</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">folderList</span>.<span style="color:#a6e22e">forEach</span>(({ <span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">treeIds</span>, <span style="color:#a6e22e">treeNames</span> }) =&gt;
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">loop</span>({ <span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">parents</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">ids</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">treeIds</span>, <span style="color:#a6e22e">names</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">treeNames</span> }, <span style="color:#a6e22e">folders</span> })
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">folders</span>.<span style="color:#a6e22e">map</span>(({ <span style="color:#a6e22e">treeIds</span>, <span style="color:#a6e22e">treeNames</span>, <span style="color:#a6e22e">parent</span>, <span style="color:#a6e22e">fileList</span> }) =&gt; ({ <span style="color:#a6e22e">treeIds</span>, <span style="color:#a6e22e">treeNames</span>, <span style="color:#a6e22e">parent</span>, <span style="color:#a6e22e">fileList</span> }));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">loop</span>(<span style="color:#a6e22e">object</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * ### Description
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * Get filename with path.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {String} delimiter Delimiter for showing path. Default is &#34;/&#34;.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @returns {Array} Array including filenames including each path.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">getFilenameWithPath</span>(<span style="color:#a6e22e">delimiter</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/&#34;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getTreeWithFiles</span>().<span style="color:#a6e22e">flatMap</span>(({ <span style="color:#a6e22e">treeNames</span>, <span style="color:#a6e22e">fileList</span> }) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">path</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">treeNames</span>.<span style="color:#a6e22e">join</span>(<span style="color:#a6e22e">delimiter</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fileList</span>.<span style="color:#a6e22e">map</span>(({ <span style="color:#a6e22e">name</span> }) =&gt; <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">path</span><span style="color:#e6db74">}${</span><span style="color:#a6e22e">delimiter</span><span style="color:#e6db74">}${</span><span style="color:#a6e22e">name</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * ### Description
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * Get files under a folder.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {Object} object Object including folder ID.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @returns {Array} Array including files.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @private
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">getFiles_</span>(<span style="color:#a6e22e">object</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">id</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">object</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">query</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">q</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`&#39;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">id</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#39; in parents and mimeType!=&#39;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">MimeType</span>.<span style="color:#a6e22e">FOLDER</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#39; and trashed=false`</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fields</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;files(id,name,mimeType),nextPageToken&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">pageSize</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1000</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">supportsAllDrives</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">includeItemsFromAllDrives</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fileList</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">pageToken</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">do</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">addQueryParameters_</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">query</span>), { <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">headers</span> });
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">getContentText</span>());
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">files</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fileList</span>.<span style="color:#a6e22e">push</span>(...<span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">files</span>.<span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">o</span> =&gt; ({ <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">mimeType</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">mimeType</span> })));
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">pageToken</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">nextPageToken</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">query</span>.<span style="color:#a6e22e">pageToken</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">pageToken</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">while</span> (<span style="color:#a6e22e">pageToken</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fileList</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * ### Description
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * This method is used for adding the query parameters to the URL.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * Ref: https://github.com/tanaikech/UtlApp?tab=readme-ov-file#addqueryparameters
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {String} url The base URL for adding the query parameters.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @param {Object} obj JSON object including query parameters.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @return {String} URL including the query parameters.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   * @private
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">addQueryParameters_</span>(<span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">obj</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">url</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;string&#34;</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#34;Please give URL (String) and query parameter (JSON object).&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (<span style="color:#a6e22e">url</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">url</span><span style="color:#e6db74">}</span><span style="color:#e6db74">?`</span>) <span style="color:#f92672">+</span> Object.<span style="color:#a6e22e">entries</span>(<span style="color:#a6e22e">obj</span>).<span style="color:#a6e22e">flatMap</span>(([<span style="color:#a6e22e">k</span>, <span style="color:#a6e22e">v</span>]) =&gt; Array.<span style="color:#a6e22e">isArray</span>(<span style="color:#a6e22e">v</span>) <span style="color:#f92672">?</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">e</span> =&gt; <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">k</span><span style="color:#e6db74">}</span><span style="color:#e6db74">=</span><span style="color:#e6db74">${</span>encodeURIComponent(<span style="color:#a6e22e">e</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>) <span style="color:#f92672">:</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">k</span><span style="color:#e6db74">}</span><span style="color:#e6db74">=</span><span style="color:#e6db74">${</span>encodeURIComponent(<span style="color:#a6e22e">v</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>).<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;&amp;&#34;</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="scopes-1">Scopes</h4>
<p>This class uses the following scopes.</p>
<ul>
<li><code>https://www.googleapis.com/auth/drive.metadata.readonly</code></li>
<li><code>https://www.googleapis.com/auth/script.external_request</code></li>
</ul>
<h4 id="sample-scripts-1">Sample scripts</h4>
<p>The sample script for using this class <strong>GetFolderTreeForDriveAPI</strong> is as follows. Also, please copy and paste the following script to the same script editor.</p>
<h5 id="gettree-method-of-class-getfoldertreefordriveapi">getTree method of class GetFolderTreeForDriveAPI</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sample4</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">folderId</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>; <span style="color:#75715e">// Please set the folder ID.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">GetFolderTreeForDriveAPI</span>({ <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">folderId</span> }).<span style="color:#a6e22e">getTree</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">obj</span>));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When the function <code>sample4</code> is run to the above sample folder, the same result with the above <code>sample1</code> is obtained.</p>
<h5 id="gettreewithfiles-method-of-class-getfoldertreefordriveapi">getTreeWithFiles method of class GetFolderTreeForDriveAPI</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sample5</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">folderId</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>; <span style="color:#75715e">// Please set the folder ID.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">GetFolderTreeForDriveAPI</span>({ <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">folderId</span> }).<span style="color:#a6e22e">getTreeWithFiles</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">obj</span>));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When the function <code>sample5</code> is run to the above sample folder, the same result with the above <code>sample2</code> is obtained.</p>
<h5 id="getfilenamewithpath-method-of-class-getfoldertreefordriveapi">getFilenameWithPath method of class GetFolderTreeForDriveAPI</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sample6</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">folderId</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>; <span style="color:#75715e">// Please set the folder ID.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">GetFolderTreeForDriveAPI</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">folderId</span>,
</span></span><span style="display:flex;"><span>  }).<span style="color:#a6e22e">getFilenameWithPath</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">obj</span>));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When the function <code>sample6</code> is run to the above sample folder, the same result with the above <code>sample3</code> is obtained.</p>
<h5 id="use-of-service-account">Use of service account</h5>
<p>This class <strong>GetFolderTreeForDriveAPI</strong> can retrieve the folder tree from the drive of the service account. In the case of <code>new GetFolderTreeForDriveAPI({ id: folderId })</code>, the access token is retrieved by <code>ScriptApp.getOAuthToken()</code>. If you want to retrieve the folder tree from the drive of the service account, please give the access token retrieved from the service account. The sample script is as follows. The function <code>getAccessTokenFromServiceAccount_</code> is from <a href="https://tanaikech.github.io/2018/12/07/retrieving-access-token-for-service-account-using-google-apps-script/">my post</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * ### Description
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Get access token from service account.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * ref: https://tanaikech.github.io/2018/12/07/retrieving-access-token-for-service-account-using-google-apps-script/
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {Object} object Object including private_key, client_email, impersonate_email.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {String} object.private_key
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {String} object.client_email
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {String} object.impersonate_email
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {Array} object.scopes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @returns {String} Access token.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getAccessTokenFromServiceAccount_</span>(<span style="color:#a6e22e">object</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">private_key</span>, <span style="color:#a6e22e">client_email</span>, <span style="color:#a6e22e">impersonate_email</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#a6e22e">scopes</span> <span style="color:#f92672">=</span> [] } <span style="color:#f92672">=</span> <span style="color:#a6e22e">object</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://www.googleapis.com/oauth2/v4/token&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">header</span> <span style="color:#f92672">=</span> { <span style="color:#a6e22e">alg</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;RS256&#34;</span>, <span style="color:#a6e22e">typ</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;JWT&#34;</span> };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">now</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">floor</span>(Date.<span style="color:#a6e22e">now</span>() <span style="color:#f92672">/</span> <span style="color:#ae81ff">1000</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">claim</span> <span style="color:#f92672">=</span> { <span style="color:#a6e22e">iss</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">client_email</span>, <span style="color:#a6e22e">scope</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">scopes</span>.<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34; &#34;</span>), <span style="color:#a6e22e">aud</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">exp</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">now</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">3600</span>).<span style="color:#a6e22e">toString</span>(), <span style="color:#a6e22e">iat</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">now</span>.<span style="color:#a6e22e">toString</span>() };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">impersonate_email</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">claim</span>.<span style="color:#a6e22e">sub</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">impersonate_email</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">signature</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">base64Encode</span>(<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">header</span>)) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">base64Encode</span>(<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">claim</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">jwt</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">signature</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">base64Encode</span>(<span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">computeRsaSha256Signature</span>(<span style="color:#a6e22e">signature</span>, <span style="color:#a6e22e">private_key</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">params</span> <span style="color:#f92672">=</span> { <span style="color:#a6e22e">payload</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">assertion</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">jwt</span>, <span style="color:#a6e22e">grant_type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;urn:ietf:params:oauth:grant-type:jwt-bearer&#34;</span> } };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">params</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">access_token</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">getContentText</span>());
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">access_token</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sample</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">object</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">private_key</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;-----BEGIN PRIVATE KEY-----\n###-----END PRIVATE KEY-----\n&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">client_email</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;###&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">scopes</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;https://www.googleapis.com/auth/drive.metadata.readonly&#34;</span>],
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">accessToken</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">getAccessTokenFromServiceAccount_</span>(<span style="color:#a6e22e">object</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">GetFolderTreeForDriveAPI</span>({ <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;root&#34;</span>, <span style="color:#a6e22e">accessToken</span> }).<span style="color:#a6e22e">getFilenameWithPath</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">obj</span>))
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When this script is run, all files are retrieved from the drive of the service account with the file path.</p>

  
  <h4><i class="fas fa-share-alt" aria-hidden="true"></i>&nbsp;Share!</h4>
<ul class="share-buttons">
	<li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftanaikech.github.io%2f2024%2f06%2f22%2fanalyzing-folder-structures-with-google-apps-script%2f" target="_blank" title="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span class="sr-only">Share on Facebook</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://twitter.com/intent/tweet?source=https%3a%2f%2ftanaikech.github.io%2f2024%2f06%2f22%2fanalyzing-folder-structures-with-google-apps-script%2f" target="_blank" title="Tweet"><i class="fab fa-twitter" aria-hidden="true"></i><span class="sr-only">Tweet</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://plus.google.com/share?url=https%3a%2f%2ftanaikech.github.io%2f2024%2f06%2f22%2fanalyzing-folder-structures-with-google-apps-script%2f" target="_blank" title="Share on Google+"><i class="fab fa-google-plus" aria-hidden="true"></i><span class="sr-only">Share on Google+</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.tumblr.com/share?v=3&u=https%3a%2f%2ftanaikech.github.io%2f2024%2f06%2f22%2fanalyzing-folder-structures-with-google-apps-script%2f" target="_blank" title="Post to Tumblr"><i class="fab fa-tumblr" aria-hidden="true"></i><span class="sr-only">Post to Tumblr</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2ftanaikech.github.io%2f2024%2f06%2f22%2fanalyzing-folder-structures-with-google-apps-script%2f" target="_blank" title="Pin it"><i class="fab fa-pinterest-p" aria-hidden="true"></i><span class="sr-only">Pin it</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.reddit.com/submit?url=https%3a%2f%2ftanaikech.github.io%2f2024%2f06%2f22%2fanalyzing-folder-structures-with-google-apps-script%2f" target="_blank" title="Submit to Reddit"><i class="fab fa-reddit-alien" aria-hidden="true"></i><span class="sr-only">Submit to Reddit</span></a>
	</li>
</ul>


<style>
	ul.share-buttons{
	  list-style: none;
	  padding: 0;
	}

	ul.share-buttons li{
	  display: inline;
	}

	ul.share-buttons .sr-only{
	  position: absolute;
	  clip: rect(1px 1px 1px 1px);
	  clip: rect(1px, 1px, 1px, 1px);
	  padding: 0;
	  border: 0;
	  height: 1px;
	  width: 1px;
	  overflow: hidden;
	}
</style>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://tanaikech.github.io/2024/06/18/updated-gas-library-movefolder/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://tanaikech.github.io/2024/06/18/updated-gas-library-movefolder/">Updated: GAS Library - MoveFolder</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
  </div>
</div>


  
  
  
  

  

</div>

</div>
</div>
<script src="https://tanaikech.github.io/js/ui.js"></script>
<script src="https://tanaikech.github.io/js/menus.js"></script>






<script async src="https://www.googletagmanager.com/gtag/js?id=G-J3Z6T50WL5"></script>
<script>
  
  if (window.location.hostname != "localhost") {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-J3Z6T50WL5');
  }
</script>






<script src="https://tanaikech.github.io/js/math-code.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  


</body>
</html>

