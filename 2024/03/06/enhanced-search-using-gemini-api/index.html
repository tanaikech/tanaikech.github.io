<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <meta name="google-site-verification" content="1BvDMY90ui0jRLHkrpqdQ_x62h5VNEMuK6mQsDvVQH0" />

  <meta name="description" content="Official profile of Kanshi Tanaike, a Google Developer Expert (GDE) in Google Workspace and Physicist. Specializing in Google Apps Script, Gemini API, and innovative IT solutions.">
  <meta name="generator" content="Hugo 0.98.0" />

  <meta property="og:title" content="tanaike - Developer Blog">
  <meta property="og:description" content="Leverage Google APIs, GAS, and Gemini with specialized technical insights.">
  <meta property="og:url" content="https://tanaikech.github.io/">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://tanaikech.github.io/img/og-main.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@tanaikech">

  <title>tanaike - Google Apps Script, Gemini API Expert & Physicist</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://tanaikech.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.6.0/css/all.css">

  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet" type="text/css">

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css">
  <script async src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://tanaikech.github.io/img/favicon.ico" type="image/x-icon" />

  
  

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Person",
  "name": "Kanshi Tanaike",
  "alternateName": "tanaike",
  "url": "https://tanaikech.github.io/",
  "image": "https://tanaikech.github.io/img/og-main.png",
  "jobTitle": "Google Developer Expert",
  "honorificPrefix": "Ph.D.",
  "description": "Japanese scientist, Physicist and Google Developer Expert for Google Workspace.",
  "award": "First place in the Outstanding GDE Award 2025",
  "sameAs": [
    "https://twitter.com/tanaikech",
    "https://github.com/tanaikech",
    "https://stackoverflow.com/users/7108653/tanaike",
    "https://developers.google.com/community/experts/directory?text=tanaike",
    "https://zenn.dev/tanaike",
    "https://medium.com/@tanaike"
  ]
}
</script>

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://tanaikech.github.io/">TANAIKE</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/topics/"><i class='fa fa-folder fa-fw'></i>Topics</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/link/"><i class='fa fa-thumbs-up fa-fw'></i>Links</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/webapps/"><i class='fas fa-toolbox'></i>Web Applications</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/donate/"><i class='fas fa-donate'></i>Donate</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/tanaikech" rel="me" target="_blank"><i class="fa-brands fa-square-x-twitter"></i>X</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://medium.com/@tanaike" rel="me" target="_blank"><i class="fa-brands fa-medium"></i>Medium</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://www.youtube.com/@tanaike" rel="me" target="_blank"><i class="fab fa-youtube-square fa-fw"></i>YouTube</a>
    </li>
    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/tanaike" rel="me" target="_blank"><i class="fab fa-linkedin fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/tanaikech" rel="me" target="_blank"><i class="fa-brands fa-github"></i>GitHub</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://gist.github.com/tanaikech" rel="me" target="_blank"><i class="fas fa-code fa-fw"></i>Gists</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/7108653" rel="me" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://dev.to/tanaike" rel="me" target="_blank"><i class="fa-brands fa-dev fa-fw"></i>DEV</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://zenn.dev/tanaike" rel="me" target="_blank"><i class="fas fa-edit fa-fw"></i>Zenn</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://devpost.com/tanaike" rel="me" target="_blank"><i class="fas fa-code fa-fw"></i>Devpost</a>
    </li>
    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2026. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Enhanced Search using Gemini API</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>06 Mar 2024, 15:24</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/gastips">GasTips</a>
    
  </div>
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/google-apps-script">Google Apps Script</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/gemini">Gemini</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/ai">AI</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/llm">LLM</a>
    
  </div>
  
  

</div>

  <p><a href="https://gist.github.com/tanaikech/70c28ddff49e8a0cf474f7f48d996b8a">Gists</a></p>
<p><img src="https://tanaikech.github.io/image-storage/20240306a/fig1.png" alt=""></p>
<h1 id="abstract">Abstract</h1>
<p>The Gemini API can now do semantic searches, going beyond content generation. This means it can understand the meaning of your search and provide better results, even if your words don&rsquo;t exactly match the data. This report introduces the enhanced search capabilities of the Gemini API.</p>
<h1 id="introduction">Introduction</h1>
<p>The Gemini API expands its potential beyond content generation to encompass powerful semantic search capabilities. Searching existing data is crucial in various situations. However, before the introduction of generative AI, traditional search methods relied solely on keyword matching. Recent advancements in semantic search have introduced similarity search, allowing for a more nuanced understanding of queries. Combining this with the generative power of the Gemini API can significantly enhance the search results of existing data. This report explores the possibilities of enhanced search using the Gemini API.</p>
<h1 id="usage">Usage</h1>
<p>In this report, Google Apps Script is used.</p>
<h2 id="1-create-a-gas-project">1. Create a GAS project.</h2>
<p>Please create a new Google Spreadsheet and open the script editor.</p>
<h2 id="2-linking-google-cloud-platform-project-to-google-apps-script-project-for-new-ide">2. Linking Google Cloud Platform Project to Google Apps Script Project for New IDE</h2>
<p>In this case, you can see how to do this at <a href="https://github.com/tanaikech/Linking-Google-Cloud-Platform-Project-to-Google-Apps-Script-Project-for-New-IDE">my repository</a>.</p>
<p>Also, please enable Generative Language API at the API console.</p>
<p>After the above setting, the following sample script can be used.</p>
<h2 id="3-install-library">3. Install library</h2>
<p>In this script, in order to manage Corpora, a Google Apps Script library of CorporaApp is used. Please install the library. You can see how to install it at <a href="https://github.com/tanaikech/CorporaApp?tab=readme-ov-file#usage">my repository</a>.</p>
<p>The library&rsquo;s project key is <strong><code>1XrAybct1KUwGcFrEZ9BOd5sa0SoHeQwGhOWkDOHki9lDFAX9OHlO03y_</code></strong>.</p>
<p>When you install this library, the following required scopes are automatically installed.</p>
<ul>
<li><code>https://www.googleapis.com/auth/script.external_request</code></li>
<li><code>https://www.googleapis.com/auth/generative-language.retriever</code></li>
</ul>
<h2 id="4-prepare-sample-data">4. Prepare sample data</h2>
<p>In order to test the enhanced search using Gemini API, first, it is required to prepare sample data. In this report, <a href="https://tanaikech.github.io/">my blog</a> is used. In my blog, XML data can be obtained by <a href="https://tanaikech.github.io/index.xml">https://tanaikech.github.io/index.xml</a>. This data is stored in a document in a corpus. The search text is searched with <a href="https://ai.google.dev/api/rest/v1beta/models/generateAnswer">Method: models.generateAnswer</a>.</p>
<h3 id="a-base-variables">A. Base variables</h3>
<p>The base variable is as follows. This function is used with the following scripts. Of course, you can modify the corpus and the document name from the following script.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">init_</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">accessToken</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ScriptApp</span>.<span style="color:#a6e22e">getOAuthToken</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">newCorpusName</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;corpora/sample-1&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">displayName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;sample corpus 1&#34;</span>,
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">newDocumentName</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">newCorpusName</span>.<span style="color:#a6e22e">name</span><span style="color:#e6db74">}</span><span style="color:#e6db74">/documents/sample-1`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">displayName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;sample document 1&#34;</span>,
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> { <span style="color:#a6e22e">accessToken</span>, <span style="color:#a6e22e">newCorpusName</span>, <span style="color:#a6e22e">newDocumentName</span> };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="b-create-corpus-and-document">B. Create corpus and document</h3>
<p>The script for creating a corpus and a document is as follows. When this script is run, a new corpus of <code>corpora/sample-1</code> is created, and a new document <code>corpora/sample-1/documents/sample-1</code> is created in the corpus.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createCorpusDocument</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">accessToken</span>, <span style="color:#a6e22e">newCorpusName</span>, <span style="color:#a6e22e">newDocumentName</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">init_</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ca</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">CorporaApp</span>.<span style="color:#a6e22e">setAccessToken</span>(<span style="color:#a6e22e">accessToken</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">r</span> <span style="color:#f92672">=</span> {};
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res1</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ca</span>.<span style="color:#a6e22e">getCorpora</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">res1</span>.<span style="color:#a6e22e">some</span>(({ <span style="color:#a6e22e">name</span> }) =&gt; <span style="color:#a6e22e">name</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">newCorpusName</span>.<span style="color:#a6e22e">name</span>)) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ca</span>.<span style="color:#a6e22e">createCorpus</span>(<span style="color:#a6e22e">newCorpusName</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">corpus</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">res</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res2</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ca</span>.<span style="color:#a6e22e">getDocuments</span>(<span style="color:#a6e22e">newCorpusName</span>.<span style="color:#a6e22e">name</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">res2</span>.<span style="color:#a6e22e">some</span>(({ <span style="color:#a6e22e">name</span> }) =&gt; <span style="color:#a6e22e">name</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">newDocumentName</span>.<span style="color:#a6e22e">name</span>)) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ca</span>.<span style="color:#a6e22e">createDocument</span>(<span style="color:#a6e22e">newCorpusName</span>.<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">newDocumentName</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">r</span>.document <span style="color:#f92672">=</span> <span style="color:#a6e22e">res</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">keys</span> <span style="color:#f92672">=</span> Object.<span style="color:#a6e22e">keys</span>(<span style="color:#a6e22e">r</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">keys</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;Corpus and document have already been existing.&#34;</span>);
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`Created </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">keys</span>.<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34; and &#34;</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">.`</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>If you want to delete a document, you can also use the following script.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">deleteDocument</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">accessToken</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">newDocumentName</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">name</span> },
</span></span><span style="display:flex;"><span>  } <span style="color:#f92672">=</span> <span style="color:#a6e22e">init_</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ca</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">CorporaApp</span>.<span style="color:#a6e22e">setAccessToken</span>(<span style="color:#a6e22e">accessToken</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ca</span>.<span style="color:#a6e22e">deleteDocument</span>(<span style="color:#a6e22e">name</span>, <span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="c-store-data-in-corpus">C. Store data in corpus</h3>
<p>The script for storing the blog data is as follows. When this script is run, the values retrieved from the XML data are stored in the created document as chunks.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setChunks</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://tanaikech.github.io/post/index.xml&#34;</span>; <span style="color:#75715e">// This is RSS of my blog (https://tanaikech.github.io/).
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">accessToken</span>, <span style="color:#a6e22e">newDocumentName</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">init_</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">resourceNameOfdocument</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">newDocumentName</span>.<span style="color:#a6e22e">name</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">str</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">url</span>).<span style="color:#a6e22e">getContentText</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">xml</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">XmlService</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">str</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">root</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">xml</span>.<span style="color:#a6e22e">getRootElement</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ns</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">getNamespace</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">items</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">getChild</span>(<span style="color:#e6db74">&#34;channel&#34;</span>, <span style="color:#a6e22e">ns</span>).<span style="color:#a6e22e">getChildren</span>(<span style="color:#e6db74">&#34;item&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">keys</span> <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;title&#34;</span>, <span style="color:#e6db74">&#34;link&#34;</span>, <span style="color:#e6db74">&#34;pubDate&#34;</span>, <span style="color:#e6db74">&#34;description&#34;</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">requests</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">items</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">e</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Map</span>(<span style="color:#a6e22e">keys</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">k</span>) =&gt; [<span style="color:#a6e22e">k</span>, <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">getChild</span>(<span style="color:#a6e22e">k</span>, <span style="color:#a6e22e">ns</span>).<span style="color:#a6e22e">getValue</span>()]));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">stringValue</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`Title is </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;title&#34;</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">. Description is as follows.</span><span style="color:#e6db74">${</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;description&#34;</span>).<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#34;.&#34;</span>)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">}</span><span style="color:#e6db74">. URL is </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;link&#34;</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">.`</span>,
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">obj</span>.<span style="color:#66d9ef">delete</span>(<span style="color:#e6db74">&#34;description&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">parent</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">resourceNameOfdocument</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">chunk</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">data</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">customMetadata</span><span style="color:#f92672">:</span> [...<span style="color:#a6e22e">obj</span>].<span style="color:#a6e22e">map</span>(([<span style="color:#a6e22e">key</span>, <span style="color:#a6e22e">stringValue</span>]) =&gt; ({
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">key</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">stringValue</span>,
</span></span><span style="display:flex;"><span>        })),
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">CorporaApp</span>.<span style="color:#a6e22e">setAccessToken</span>(<span style="color:#a6e22e">accessToken</span>).<span style="color:#a6e22e">setChunks</span>(<span style="color:#a6e22e">resourceNameOfdocument</span>, {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">requests</span>,
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;Done.&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When a long text is used to the chunk data, an error like <code>At least one text exceeds the token limit by #### for the given embedding model.</code> occurs. Please be careful about this. I believe that this limitation will be expanded in future updates.</p>
<p>By this step, the preparation has been finished.</p>
<h2 id="5-test-1">5. Test 1</h2>
<p>In order to test the search, please run the following script.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">search</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">text</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Can you tell me several links showing sample scripts to upload a file to Google Drive?&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">accessToken</span>, <span style="color:#a6e22e">newCorpusName</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">init_</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">requestBody</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">contents</span><span style="color:#f92672">:</span> [{ <span style="color:#a6e22e">parts</span><span style="color:#f92672">:</span> [{ <span style="color:#a6e22e">text</span> }], <span style="color:#a6e22e">role</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;user&#34;</span> }],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">answerStyle</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;VERBOSE&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">semanticRetriever</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">source</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">newCorpusName</span>.<span style="color:#a6e22e">name</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">query</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">parts</span><span style="color:#f92672">:</span> [{ <span style="color:#a6e22e">text</span> }] },
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">CorporaApp</span>.<span style="color:#a6e22e">setAccessToken</span>(<span style="color:#a6e22e">accessToken</span>).<span style="color:#a6e22e">searchQueryWithGenerateAnswer</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">requestBody</span>
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">getResponseCode</span>() <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">getContentText</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">answer</span>.<span style="color:#a6e22e">content</span>.<span style="color:#a6e22e">parts</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">text</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">result</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>By this script, the following result is obtained.</p>
<pre tabindex="0"><code>Here are several links to sample scripts that show you how to upload a file to Google Drive:

* [Uploading File to Google Drive using HTML and Google Apps Script](https://tanaikech.github.io/2020/02/18/uploading-file-to-google-drive-using-html-and-google-apps-script/)
* [Uploading Local Files to Google Drive without Authorization using HTML Form](https://tanaikech.github.io/2017/11/06/uploading-local-files-to-google-drive-without-authorization-using-html-form/)
* [Uploading File to Google Drive from External HTML without Authorization](https://tanaikech.github.io/2020/08/13/uploading-file-to-google-drive-from-external-html-without-authorization/)
* [Safe-Uploading for Google Drive by HTML in External Server using Google Apps Script](https://tanaikech.github.io/2020/12/29/safe-uploading-for-google-drive-by-html-in-external-server-using-google-apps-script/)
</code></pre><p>Those results are from my blog. In this result, the URLs are included. The response values include the chunk names. So, from the above <code>setChunks</code> function, you can also directly retrieve the URLs from the chunks using the chunk names.</p>
<p>As additional information. for example, when the corpus without enough data is used, the following result is obtained.</p>
<pre tabindex="0"><code>Here are several links showing sample scripts to upload a file to Google Drive:

* [Upload a File to Google Drive](https://developers.google.com/drive/api/v3/quickstart/python)
* [Uploading Files to Google Drive with Python](https://www.twilio.com/blog/2017/04/uploading-files-to-google-drive-with-python.html)
* [How to Upload Files to Google Drive Using Python](https://www.datacamp.com/courses/how-to-upload-files-to-google-drive-using-python)
* [Upload Files to Google Drive Using Python - Google Cloud](https://cloud.google.com/storage/docs/reference/libraries)
</code></pre><p>In this case, the broken URLs are included.</p>
<p>When the empty corpus is used, the following error occurs.</p>
<pre tabindex="0"><code>Error: {
  &#34;error&#34;: {
    &#34;code&#34;: 400,
    &#34;message&#34;: &#34;No passages found from provided grounding config.&#34;,
    &#34;status&#34;: &#34;FAILED_PRECONDITION&#34;
  }
}
</code></pre><h2 id="6-test-2">6. Test 2</h2>
<p>As another test case, the enhanced search can be also used for <a href="https://workspaceupdates.googleblog.com/">Google Workspace Updates</a>. Google Workspace Updates can obtain the XML data from <a href="http://workspaceupdates.googleblog.com/atom.xml">http://workspaceupdates.googleblog.com/atom.xml</a>. The scripts are as follows.</p>
<p><strong>Before you use this script, please run the functions <code>deleteDocument </code> and <code>createCorpusDocument</code> in order. By this, the document is reset. Of course, you can add the new data to the existing document. But, in this case, when the search is run, the data of both Google Workspace Updates and my blog. Please be careful about this.</strong></p>
<p>This script stores the data from Google Workspace Updates to a document in a corpus.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setChunks</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://workspaceupdates.googleblog.com/atom.xml&#34;</span>; <span style="color:#75715e">// This is RSS of https://workspaceupdates.googleblog.com/
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">accessToken</span>, <span style="color:#a6e22e">newDocumentName</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">init_</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">resourceNameOfdocument</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">newDocumentName</span>.<span style="color:#a6e22e">name</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">str</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">url</span>).<span style="color:#a6e22e">getContentText</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">xml</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">XmlService</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">str</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">root</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">xml</span>.<span style="color:#a6e22e">getRootElement</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ns</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">getNamespace</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">entries</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">getChildren</span>(<span style="color:#e6db74">&#34;entry&#34;</span>, <span style="color:#a6e22e">ns</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">keys_single</span> <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;title&#34;</span>, <span style="color:#e6db74">&#34;published&#34;</span>, <span style="color:#e6db74">&#34;content&#34;</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">keys_multiple</span> <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;category&#34;</span>, <span style="color:#e6db74">&#34;link&#34;</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">requests</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">entries</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">e</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ar1</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">keys_single</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">k</span>) =&gt; [<span style="color:#a6e22e">k</span>, <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">getChild</span>(<span style="color:#a6e22e">k</span>, <span style="color:#a6e22e">ns</span>).<span style="color:#a6e22e">getValue</span>()]);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ar2</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">keys_multiple</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">k</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">k</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;category&#34;</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">k</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">getChildren</span>(<span style="color:#a6e22e">k</span>, <span style="color:#a6e22e">ns</span>).<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">f</span>) =&gt; <span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">getAttribute</span>(<span style="color:#e6db74">&#34;term&#34;</span>).<span style="color:#a6e22e">getValue</span>())
</span></span><span style="display:flex;"><span>          ),
</span></span><span style="display:flex;"><span>        ];
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">k</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;link&#34;</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">k</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">e</span>
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">getChildren</span>(<span style="color:#a6e22e">k</span>, <span style="color:#a6e22e">ns</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">find</span>((<span style="color:#a6e22e">f</span>) =&gt; <span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">getAttribute</span>(<span style="color:#e6db74">&#34;rel&#34;</span>).<span style="color:#a6e22e">getValue</span>() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;alternate&#34;</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">getAttribute</span>(<span style="color:#e6db74">&#34;href&#34;</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">getValue</span>(),
</span></span><span style="display:flex;"><span>        ];
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> [<span style="color:#a6e22e">k</span>, <span style="color:#66d9ef">null</span>];
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Map</span>([...<span style="color:#a6e22e">ar1</span>, ...<span style="color:#a6e22e">ar2</span>]);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">stringValue</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`Title is </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;title&#34;</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">. Description is as follows.</span><span style="color:#e6db74">${</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;content&#34;</span>).<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#34;.&#34;</span>)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">}</span><span style="color:#e6db74">. URL is </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;link&#34;</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">., Categirues are </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;category&#34;</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">.`</span>,
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">obj</span>.<span style="color:#66d9ef">delete</span>(<span style="color:#e6db74">&#34;content&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">parent</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">resourceNameOfdocument</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">chunk</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">data</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">customMetadata</span><span style="color:#f92672">:</span> [...<span style="color:#a6e22e">obj</span>].<span style="color:#a6e22e">map</span>(([<span style="color:#a6e22e">key</span>, <span style="color:#a6e22e">stringValue</span>]) =&gt; ({
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">key</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">stringValue</span>,
</span></span><span style="display:flex;"><span>        })),
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">CorporaApp</span>.<span style="color:#a6e22e">setAccessToken</span>(<span style="color:#a6e22e">accessToken</span>).<span style="color:#a6e22e">setChunks</span>(<span style="color:#a6e22e">resourceNameOfdocument</span>, {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">requests</span>,
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;Done.&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This script searches from a document in a corpus.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">search</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">text</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Can you tell me several links related to Google Spreadsheet?&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">accessToken</span>, <span style="color:#a6e22e">newCorpusName</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">init_</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">requestBody</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">contents</span><span style="color:#f92672">:</span> [{ <span style="color:#a6e22e">parts</span><span style="color:#f92672">:</span> [{ <span style="color:#a6e22e">text</span> }], <span style="color:#a6e22e">role</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;user&#34;</span> }],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">answerStyle</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;VERBOSE&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">semanticRetriever</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">source</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">newCorpusName</span>.<span style="color:#a6e22e">name</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">query</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">parts</span><span style="color:#f92672">:</span> [{ <span style="color:#a6e22e">text</span> }] },
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ca</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">CorporaApp</span>.<span style="color:#a6e22e">setAccessToken</span>(<span style="color:#a6e22e">accessToken</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ca</span>.<span style="color:#a6e22e">searchQueryWithGenerateAnswer</span>(<span style="color:#a6e22e">requestBody</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">getResponseCode</span>() <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">getContentText</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">answer</span>.<span style="color:#a6e22e">content</span>.<span style="color:#a6e22e">parts</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">text</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">result</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When this script is run, the following result is obtained.</p>
<pre tabindex="0"><code>Here are several links related to Google Spreadsheet:

* [New ways to annotate Google Docs](http://workspaceupdates.googleblog.com/2024/02/new-ways-to-annotate-google-docs.html)
* [Import and convert sensitive Excel files into client-side encrypted Google Sheets](http://workspaceupdates.googleblog.com/2024/02/import-convert-excel-files-into-client-side-encrypted-google-sheets-now-generally-available.html)
* [Sort, filter and manage comments faster in Google Docs, Sheets and Slides](http://workspaceupdates.googleblog.com/2024/02/manage-comments-faster-google-docs-sheets-slides.html)
* [Google Workspace Updates Weekly Recap - March 1, 2024](http://workspaceupdates.googleblog.com/2024/02/release-notes-03-01-2024.html)
</code></pre>
  
  <h4><i class="fas fa-share-alt" aria-hidden="true"></i>&nbsp;Share!</h4>
<ul class="share-buttons">
	<li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftanaikech.github.io%2f2024%2f03%2f06%2fenhanced-search-using-gemini-api%2f" target="_blank" title="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span class="sr-only">Share on Facebook</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://twitter.com/intent/tweet?source=https%3a%2f%2ftanaikech.github.io%2f2024%2f03%2f06%2fenhanced-search-using-gemini-api%2f" target="_blank" title="Tweet"><i class="fab fa-twitter" aria-hidden="true"></i><span class="sr-only">Tweet</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://plus.google.com/share?url=https%3a%2f%2ftanaikech.github.io%2f2024%2f03%2f06%2fenhanced-search-using-gemini-api%2f" target="_blank" title="Share on Google+"><i class="fab fa-google-plus" aria-hidden="true"></i><span class="sr-only">Share on Google+</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.tumblr.com/share?v=3&u=https%3a%2f%2ftanaikech.github.io%2f2024%2f03%2f06%2fenhanced-search-using-gemini-api%2f" target="_blank" title="Post to Tumblr"><i class="fab fa-tumblr" aria-hidden="true"></i><span class="sr-only">Post to Tumblr</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2ftanaikech.github.io%2f2024%2f03%2f06%2fenhanced-search-using-gemini-api%2f" target="_blank" title="Pin it"><i class="fab fa-pinterest-p" aria-hidden="true"></i><span class="sr-only">Pin it</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.reddit.com/submit?url=https%3a%2f%2ftanaikech.github.io%2f2024%2f03%2f06%2fenhanced-search-using-gemini-api%2f" target="_blank" title="Submit to Reddit"><i class="fab fa-reddit-alien" aria-hidden="true"></i><span class="sr-only">Submit to Reddit</span></a>
	</li>
</ul>


<style>
	ul.share-buttons{
	  list-style: none;
	  padding: 0;
	}

	ul.share-buttons li{
	  display: inline;
	}

	ul.share-buttons .sr-only{
	  position: absolute;
	  clip: rect(1px 1px 1px 1px);
	  clip: rect(1px, 1px, 1px, 1px);
	  padding: 0;
	  border: 0;
	  height: 1px;
	  width: 1px;
	  overflow: hidden;
	}
</style>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://tanaikech.github.io/2024/03/06/updated-gas-library-corporaapp/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://tanaikech.github.io/2024/03/06/updated-gas-library-corporaapp/">Updated: GAS Library - CorporaApp</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://tanaikech.github.io/2024/03/09/updated-goodls-to-v204/">Updated goodls to v204</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://tanaikech.github.io/2024/03/09/updated-goodls-to-v204/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>


  
  
  
  

  

</div>

</div>
</div>
<script src="https://tanaikech.github.io/js/ui.js"></script>
<script src="https://tanaikech.github.io/js/menus.js"></script>






<script async src="https://www.googletagmanager.com/gtag/js?id=G-J3Z6T50WL5"></script>
<script>
  
  if (window.location.hostname != "localhost") {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-J3Z6T50WL5');
  }
</script>






<script src="https://tanaikech.github.io/js/math-code.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  


</body>
</html>

