<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <meta name="google-site-verification" content="1BvDMY90ui0jRLHkrpqdQ_x62h5VNEMuK6mQsDvVQH0" />

  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.98.0" />

  <title>Pseudo Function Calling for Gemini API Through Prompt Engineering &middot; tanaike</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://tanaikech.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">

  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet" type="text/css">

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css">
  <script async src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://tanaikech.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://tanaikech.github.io/">TANAIKE</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/topics/"><i class='fa fa-folder fa-fw'></i>Topics</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/link/"><i class='fa fa-thumbs-up fa-fw'></i>Links</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/webapps/"><i class='fas fa-toolbox'></i>Web Applications</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/donate/"><i class='fas fa-donate'></i>Donate</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/tanaikech" rel="me" target="_blank"><i class="fab fa-twitter-square fa-fw"></i>X</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/tanaikech" rel="me" target="_blank"><i class="fab fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/7108653" rel="me" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2017. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Pseudo Function Calling for Gemini API Through Prompt Engineering</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>01 Oct 2024, 10:39</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/pythontips">PythonTips</a>
    
  </div>
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/python">python</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/gemini">Gemini</a>
    
  </div>
  
  

</div>

  <p><a href="https://gist.github.com/tanaikech/65c720a1fdc56d99c35b24aeaaa57f7e">Gists</a></p>
<h1 id="abstract">Abstract</h1>
<p>This research explores &ldquo;pseudo function calling&rdquo; in LLMs using prompt engineering with JSON schema, bypassing model dependency limitations.</p>
<h1 id="introduction">Introduction</h1>
<p>Large Language Models (LLMs) like Gemini and ChatGPT offer powerful functionalities, but their capabilities can be further extended through function calling. This feature allows the LLM to execute pre-defined functions with arguments generated based on the user&rsquo;s prompt. This unlocks a wide range of applications, as demonstrated in these resources (see References).</p>
<p>However, the current implementation of function calling with Gemini API exhibits model dependency. While models like gemini-1.5-pro-002 support this functionality, others like gemini-1.5-flash-002 currently do not. This limitation is expected to be addressed in future updates.</p>
<p>In a recent publication, &ldquo;Harnessing Gemini&rsquo;s Power: A Guide to Generating Content from Structured Data,&rdquo; we explored the control of JSON output format within Gemini using JSON schema in both the prompt and &ldquo;response_schema&rdquo; parameters. <a href="https://medium.com/google-cloud/harnessing-geminis-power-a-guide-to-generating-content-from-structured-data-45080dac0bbb">Ref</a> This finding led us to hypothesize the possibility of achieving a pseudo function calling mechanism through careful prompt engineering with JSON schema. This report delves into this concept and explores how to leverage pseudo-function calling for enhanced LLM interactions.</p>
<h1 id="pseudo-function-calling-flow-diagram">Pseudo-Function Calling Flow Diagram</h1>
<p><img src="https://tanaikech.github.io/image-storage/20241001a/fig1.png" alt=""></p>
<ol>
<li><strong>User Input:</strong> A user enters a question.</li>
<li><strong>Prompt Creation:</strong> A prompt is generated, incorporating the inputted question and a JSON schema for selecting functions.</li>
<li><strong>Content Generation:</strong> Content is generated based on the created prompt.</li>
<li><strong>JSON Data Extraction:</strong> The generated content is analyzed to extract JSON data with a structure matching the function calling format. This data provides the function name and arguments.</li>
<li><strong>Function Execution:</strong> The selected function is executed using the extracted arguments.</li>
<li><strong>Result Return:</strong> The function&rsquo;s result is returned to the user.</li>
</ol>
<h1 id="usage">Usage</h1>
<h2 id="1-create-an-api-key">1. Create an API key</h2>
<p>Please access <a href="https://ai.google.dev/gemini-api/docs/api-key">https://ai.google.dev/gemini-api/docs/api-key</a> and create your API key. At that time, please enable Generative Language API at the API console. This API key is used for the following scripts.</p>
<p>This official document can also be seen. <a href="https://ai.google.dev/">Ref</a>.</p>
<h2 id="2-sample-scripts">2. Sample scripts</h2>
<p>In this report, Python is used for explaining the pseudo function calling.</p>
<h3 id="1-sample-1-current-functioncall">1. Sample 1: Current FunctionÂ Call</h3>
<p>In this sample, the function call is used as <code>function_declarations</code> in the <code>tools</code> property.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> google.generativeai <span style="color:#66d9ef">as</span> genai
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>apiKey <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>  <span style="color:#75715e"># Please set your API key for using Gemini API.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># This is from https://ai.google.dev/gemini-api/docs/function-calling</span>
</span></span><span style="display:flex;"><span>function_declarations <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;function_declarations&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;find_movies&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;find movie titles currently playing in theaters based on any description, genre, title words, etc.&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;type_&#34;</span>: <span style="color:#e6db74">&#34;OBJECT&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;location&#34;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;type_&#34;</span>: <span style="color:#e6db74">&#34;STRING&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;The city and state, e.g. San Francisco, CA or a zip code e.g. 95616&#34;</span>,
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;description&#34;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;type_&#34;</span>: <span style="color:#e6db74">&#34;STRING&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Any kind of description including category or genre, title words, attributes, etc.&#34;</span>,
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;required&#34;</span>: [<span style="color:#e6db74">&#34;description&#34;</span>],
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;find_theaters&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;find theaters based on location and optionally movie title which is currently playing in theaters&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;type_&#34;</span>: <span style="color:#e6db74">&#34;OBJECT&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;location&#34;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;type_&#34;</span>: <span style="color:#e6db74">&#34;STRING&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;The city and state, e.g. San Francisco, CA or a zip code e.g. 95616&#34;</span>,
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;movie&#34;</span>: {<span style="color:#e6db74">&#34;type_&#34;</span>: <span style="color:#e6db74">&#34;STRING&#34;</span>, <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Any movie title&#34;</span>},
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;required&#34;</span>: [<span style="color:#e6db74">&#34;location&#34;</span>],
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;get_showtimes&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Find the start times for movies playing in a specific theater&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;type_&#34;</span>: <span style="color:#e6db74">&#34;OBJECT&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;location&#34;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;type_&#34;</span>: <span style="color:#e6db74">&#34;STRING&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;The city and state, e.g. San Francisco, CA or a zip code e.g. 95616&#34;</span>,
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;movie&#34;</span>: {<span style="color:#e6db74">&#34;type_&#34;</span>: <span style="color:#e6db74">&#34;STRING&#34;</span>, <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Any movie title&#34;</span>},
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;theater&#34;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;type_&#34;</span>: <span style="color:#e6db74">&#34;STRING&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Name of the theater&#34;</span>,
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;date&#34;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;type_&#34;</span>: <span style="color:#e6db74">&#34;STRING&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Date for requested showtime&#34;</span>,
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;required&#34;</span>: [<span style="color:#e6db74">&#34;location&#34;</span>, <span style="color:#e6db74">&#34;movie&#34;</span>, <span style="color:#e6db74">&#34;theater&#34;</span>, <span style="color:#e6db74">&#34;date&#34;</span>],
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>prompt <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Which theaters in Mountain View show Barbie movie?&#34;</span>  <span style="color:#75715e"># or prompt = &#34;What movies are showing in North Seattle tonight?&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>genai<span style="color:#f92672">.</span>configure(api_key<span style="color:#f92672">=</span>apiKey)
</span></span><span style="display:flex;"><span>model <span style="color:#f92672">=</span> genai<span style="color:#f92672">.</span>GenerativeModel(<span style="color:#e6db74">&#34;gemini-1.5-flash-latest&#34;</span>, tools<span style="color:#f92672">=</span>genai<span style="color:#f92672">.</span>protos<span style="color:#f92672">.</span>Tool(function_declarations))
</span></span><span style="display:flex;"><span>chat <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>start_chat()
</span></span><span style="display:flex;"><span>response <span style="color:#f92672">=</span> chat<span style="color:#f92672">.</span>send_message(prompt)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>function_call <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span>candidates[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>content<span style="color:#f92672">.</span>parts[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>function_call
</span></span><span style="display:flex;"><span>res <span style="color:#f92672">=</span> function_call<span style="color:#f92672">.</span>__class__<span style="color:#f92672">.</span>to_dict(function_call)
</span></span><span style="display:flex;"><span>print(res)
</span></span></code></pre></div><p>When <code>Which theaters in Mountain View show Barbie movie?</code> is used as the prompt, the following result is obtained.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;find_theaters&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;args&#34;</span>: { <span style="color:#f92672">&#34;movie&#34;</span>: <span style="color:#e6db74">&#34;Barbie&#34;</span>, <span style="color:#f92672">&#34;location&#34;</span>: <span style="color:#e6db74">&#34;Mountain View, CA&#34;</span> }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When <code>What movies are showing in North Seattle tonight?</code> is used as the prompt, the following result is obtained.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;find_movies&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;args&#34;</span>: { <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;movie&#34;</span>, <span style="color:#f92672">&#34;location&#34;</span>: <span style="color:#e6db74">&#34;North Seattle&#34;</span> }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="sample-2-pseudo-functioncall">Sample 2: Pseudo FunctionÂ Call</h3>
<p>In this sample, the function call is used as the prompt using JSON schema.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> google.generativeai <span style="color:#66d9ef">as</span> genai
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>apiKey <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>  <span style="color:#75715e"># Please set your API key for using Gemini API.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># These schemas are from https://ai.google.dev/gemini-api/docs/function-calling</span>
</span></span><span style="display:flex;"><span>json_schema <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;find movie titles currently playing in theaters based on any description, genre, title words, etc.&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;name&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Value is always &#39;find_movies&#39;.&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;const&#34;</span>: <span style="color:#e6db74">&#34;find_movies&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;args&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;location&#34;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;type_&#34;</span>: <span style="color:#e6db74">&#34;STRING&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;The city and state, e.g. San Francisco, CA or a zip code e.g. 95616&#34;</span>,
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;description&#34;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;type_&#34;</span>: <span style="color:#e6db74">&#34;STRING&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Any kind of description including category or genre, title words, attributes, etc.&#34;</span>,
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;required&#34;</span>: [<span style="color:#e6db74">&#34;description&#34;</span>],
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;find theaters based on location and optionally movie title which is currently playing in theaters&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;name&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Value is always &#39;find_theaters&#39;.&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;const&#34;</span>: <span style="color:#e6db74">&#34;find_theaters&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;args&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;location&#34;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;type_&#34;</span>: <span style="color:#e6db74">&#34;STRING&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;The city and state, e.g. San Francisco, CA or a zip code e.g. 95616&#34;</span>,
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;movie&#34;</span>: {<span style="color:#e6db74">&#34;type_&#34;</span>: <span style="color:#e6db74">&#34;STRING&#34;</span>, <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Any movie title&#34;</span>},
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;required&#34;</span>: [<span style="color:#e6db74">&#34;location&#34;</span>],
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Find the start times for movies playing in a specific theater&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;name&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Value is always &#39;get_showtimes&#39;.&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;const&#34;</span>: <span style="color:#e6db74">&#34;get_showtimes&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;args&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;location&#34;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;type_&#34;</span>: <span style="color:#e6db74">&#34;STRING&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;The city and state, e.g. San Francisco, CA or a zip code e.g. 95616&#34;</span>,
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;movie&#34;</span>: {<span style="color:#e6db74">&#34;type_&#34;</span>: <span style="color:#e6db74">&#34;STRING&#34;</span>, <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Any movie title&#34;</span>},
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;theater&#34;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;type_&#34;</span>: <span style="color:#e6db74">&#34;STRING&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Name of the theater&#34;</span>,
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;date&#34;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;type_&#34;</span>: <span style="color:#e6db74">&#34;STRING&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Date for requested showtime&#34;</span>,
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;required&#34;</span>: [<span style="color:#e6db74">&#34;location&#34;</span>, <span style="color:#e6db74">&#34;movie&#34;</span>, <span style="color:#e6db74">&#34;theater&#34;</span>, <span style="color:#e6db74">&#34;date&#34;</span>],
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>ar <span style="color:#f92672">=</span> sum(
</span></span><span style="display:flex;"><span>    [
</span></span><span style="display:flex;"><span>        [
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;If the result is related to &#39;</span><span style="color:#e6db74">{</span>o[<span style="color:#e6db74">&#39;description&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;, return the result by following &#39;json_schema</span><span style="color:#e6db74">{</span>i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;.&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;&lt;json_schema</span><span style="color:#e6db74">{</span>i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&gt;</span><span style="color:#e6db74">{</span>json<span style="color:#f92672">.</span>dumps(o)<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/json_schema</span><span style="color:#e6db74">{</span>i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&gt;&#34;</span>,
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i, o <span style="color:#f92672">in</span> enumerate(json_schema)
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    [],
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>prompt <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>join(
</span></span><span style="display:flex;"><span>    [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Which theaters in Mountain View show Barbie movie?&#34;</span>, <span style="color:#75715e"># or &#34;What movies are showing in North Seattle tonight?&#34;,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">*</span>ar,
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>genai<span style="color:#f92672">.</span>configure(api_key<span style="color:#f92672">=</span>apiKey)
</span></span><span style="display:flex;"><span>model <span style="color:#f92672">=</span> genai<span style="color:#f92672">.</span>GenerativeModel(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;gemini-1.5-flash-latest&#34;</span>,
</span></span><span style="display:flex;"><span>    generation_config<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;response_mime_type&#34;</span>: <span style="color:#e6db74">&#34;application/json&#34;</span>},
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>chat <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>start_chat()
</span></span><span style="display:flex;"><span>response <span style="color:#f92672">=</span> chat<span style="color:#f92672">.</span>send_message(prompt)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>res <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(response<span style="color:#f92672">.</span>candidates[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>content<span style="color:#f92672">.</span>parts[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>text)
</span></span><span style="display:flex;"><span>print(res)
</span></span></code></pre></div><p>When <code>Which theaters in Mountain View show Barbie movie?</code> is used as the prompt, the following result is obtained.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;find_theaters&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;args&#34;</span>: { <span style="color:#f92672">&#34;location&#34;</span>: <span style="color:#e6db74">&#34;Mountain View, CA&#34;</span>, <span style="color:#f92672">&#34;movie&#34;</span>: <span style="color:#e6db74">&#34;Barbie&#34;</span> }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When <code>What movies are showing in North Seattle tonight?</code> is used as the prompt, the following result is obtained.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;find_movies&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;args&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;location&#34;</span>: <span style="color:#e6db74">&#34;North Seattle&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;movies showing tonight&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="result">Result</h1>
<p>From this result, it was found that even when JSON schema is used in the prompt, the same result with the function call can be obtained.</p>
<p>However, there are limitations to function calls at the current stage. For example, the model <strong>models/gemini-1.5-flash-002</strong> cannot be used with function calls. In contrast, this pseud function call can be used to overcome this limitation.</p>
<p>Additionally, this result demonstrates that the JSON output format can be controlled through prompt engineering.</p>
<h1 id="references">References</h1>
<ul>
<li><a href="https://ai.google.dev/gemini-api/docs/function-calling">Intro to Function Calling with Gemini API</a></li>
<li><a href="https://ai.google.dev/gemini-api/docs/function-calling/tutorial?lang=python">Function calling tutorial</a></li>
<li><a href="https://medium.com/google-cloud/guide-to-function-calling-with-gemini-and-google-apps-script-0e058d472f45">Guide to Function Calling with Gemini and Google Apps Script</a>: Published on Feb 18, 2024</li>
</ul>

  
  <h4><i class="fas fa-share-alt" aria-hidden="true"></i>&nbsp;Share!</h4>
<ul class="share-buttons">
	<li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftanaikech.github.io%2f2024%2f10%2f01%2fpseudo-function-calling-for-gemini-api-through-prompt-engineering%2f" target="_blank" title="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span class="sr-only">Share on Facebook</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://twitter.com/intent/tweet?source=https%3a%2f%2ftanaikech.github.io%2f2024%2f10%2f01%2fpseudo-function-calling-for-gemini-api-through-prompt-engineering%2f" target="_blank" title="Tweet"><i class="fab fa-twitter" aria-hidden="true"></i><span class="sr-only">Tweet</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://plus.google.com/share?url=https%3a%2f%2ftanaikech.github.io%2f2024%2f10%2f01%2fpseudo-function-calling-for-gemini-api-through-prompt-engineering%2f" target="_blank" title="Share on Google+"><i class="fab fa-google-plus" aria-hidden="true"></i><span class="sr-only">Share on Google+</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.tumblr.com/share?v=3&u=https%3a%2f%2ftanaikech.github.io%2f2024%2f10%2f01%2fpseudo-function-calling-for-gemini-api-through-prompt-engineering%2f" target="_blank" title="Post to Tumblr"><i class="fab fa-tumblr" aria-hidden="true"></i><span class="sr-only">Post to Tumblr</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2ftanaikech.github.io%2f2024%2f10%2f01%2fpseudo-function-calling-for-gemini-api-through-prompt-engineering%2f" target="_blank" title="Pin it"><i class="fab fa-pinterest-p" aria-hidden="true"></i><span class="sr-only">Pin it</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.reddit.com/submit?url=https%3a%2f%2ftanaikech.github.io%2f2024%2f10%2f01%2fpseudo-function-calling-for-gemini-api-through-prompt-engineering%2f" target="_blank" title="Submit to Reddit"><i class="fab fa-reddit-alien" aria-hidden="true"></i><span class="sr-only">Submit to Reddit</span></a>
	</li>
</ul>


<style>
	ul.share-buttons{
	  list-style: none;
	  padding: 0;
	}

	ul.share-buttons li{
	  display: inline;
	}

	ul.share-buttons .sr-only{
	  position: absolute;
	  clip: rect(1px 1px 1px 1px);
	  clip: rect(1px, 1px, 1px, 1px);
	  padding: 0;
	  border: 0;
	  height: 1px;
	  width: 1px;
	  overflow: hidden;
	}
</style>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://tanaikech.github.io/2024/09/26/updated-gas-library-geminiwithfiles/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://tanaikech.github.io/2024/09/26/updated-gas-library-geminiwithfiles/">Updated: GAS Library - GeminiWithFiles</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
  </div>
</div>


  
  
  
  

  

</div>

</div>
</div>
<script src="https://tanaikech.github.io/js/ui.js"></script>
<script src="https://tanaikech.github.io/js/menus.js"></script>






<script async src="https://www.googletagmanager.com/gtag/js?id=G-J3Z6T50WL5"></script>
<script>
  
  if (window.location.hostname != "localhost") {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-J3Z6T50WL5');
  }
</script>






<script src="https://tanaikech.github.io/js/math-code.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  


</body>
</html>

