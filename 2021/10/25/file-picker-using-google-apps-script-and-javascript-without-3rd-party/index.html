<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <meta name="google-site-verification" content="1BvDMY90ui0jRLHkrpqdQ_x62h5VNEMuK6mQsDvVQH0" />

  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.98.0" />

  <title>File Picker using Google Apps Script and Javascript without 3rd party &middot; tanaike</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://tanaikech.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">

  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet" type="text/css">

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css">
  <script async src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://tanaikech.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://tanaikech.github.io/">TANAIKE</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/topics/"><i class='fa fa-folder fa-fw'></i>Topics</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/link/"><i class='fa fa-thumbs-up fa-fw'></i>Links</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/webapps/"><i class='fas fa-toolbox'></i>Web Applications</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/donate/"><i class='fas fa-donate'></i>Donate</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/tanaikech" rel="me" target="_blank"><i class="fab fa-twitter-square fa-fw"></i>X</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://medium.com/@tanaike" rel="me" target="_blank"><i class="fab fa-medium fa-fw"></i>Medium</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/tanaikech" rel="me" target="_blank"><i class="fab fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://gist.github.com/tanaikech" rel="me" target="_blank"><i class="fas fa-code fa-fw"></i>Gists</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/7108653" rel="me" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://zenn.dev/tanaike" rel="me" target="_blank"><i class="fas fa-edit fa-fw"></i>Zenn</a>
    </li>
    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2017. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>File Picker using Google Apps Script and Javascript without 3rd party</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>25 Oct 2021, 14:50</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/gastips">GasTips</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/drive-api">drive-api</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/filelist">filelist</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/spreadsheet">spreadsheet</a>
    
  </div>
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/google-apps-script">Google Apps Script</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/driveapitips">DriveAPITips</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/spreadsheet">spreadsheet</a>
    
  </div>
  
  

</div>

  <p><a href="https://github.com/tanaikech/File_Picker_using_Google_Apps_Script_and_Javascript_without_3rd_party">GitHub</a></p>
<p><img src="https://tanaikech.github.io/image-storage/20211025a/fig1.gif" alt=""></p>
<p>This is a sample script for the file picker using Google Apps Script and Javascript without 3rd party. I had created the same sample script before. <a href="https://gist.github.com/tanaikech/96166a32e7781fee22da9e498b2289d0">Ref</a> But, in the case of that script, jQuery is used. And, only Google Drive of own account could be used. In this sample script, 3rd party of jQuery is not used, and also, not only Google Drive of your own account, but also Google Drive of the service account can be used. By this, I thought that this file picker will be useful for various scenes.</p>
<p>The flow for using this sample script is as follows.</p>
<h1 id="usage">Usage</h1>
<p>In order to test this sample script, please run the following flow.</p>
<h2 id="1-create-new-spreadsheet">1. Create new Spreadsheet</h2>
<p>Please create new Spreadsheet and open the script editor of the Spreadsheet.</p>
<h2 id="2-enable-drive-api">2. Enable Drive API</h2>
<p>This script uses Drive API. So, please enable Drive API at Advanced Google services. <a href="https://developers.google.com/apps-script/guides/services/advanced#enable_advanced_services">Ref</a></p>
<h2 id="3-sample-script">3. Sample script</h2>
<p>In this sample script, Google Drive of your own account is used. And, the files are shown from the root folder.</p>
<h3 id="google-apps-script-side-codegs">Google Apps Script side: <code>Code.gs</code></h3>
<p>Please copy and paste the following script to the script editor as <code>Code.gs</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getFiles</span>(<span style="color:#a6e22e">e</span>, <span style="color:#a6e22e">rootFolderId</span>, <span style="color:#a6e22e">mimeType</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">accessToken</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ScriptApp</span>.<span style="color:#a6e22e">getOAuthToken</span>(); <span style="color:#75715e">// In this case, the files and folders are retrieved from your own Google Drive.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">mimeType</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">mimeType</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;*&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> {};
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">idn</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;root&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url1</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`https://www.googleapis.com/drive/v3/files/</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">e</span><span style="color:#e6db74">}</span><span style="color:#e6db74">?fields=id%2Cname%2Cparents`</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">folderObj</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">url1</span>, {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">authorization</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`Bearer </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">accessToken</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span> },
</span></span><span style="display:flex;"><span>    }).<span style="color:#a6e22e">getContentText</span>()
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">e</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;root&#34;</span>) <span style="color:#a6e22e">e</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">folderObj</span>.<span style="color:#a6e22e">id</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">e</span>] <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">keyname</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">folderObj</span>.<span style="color:#a6e22e">name</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">keyparent</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">idn</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">rootFolderId</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">folderObj</span>.<span style="color:#a6e22e">parents</span>[<span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">files</span><span style="color:#f92672">:</span> [],
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">pageToken</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">do</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">q</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">mimeType</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;*&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">?</span> <span style="color:#e6db74">`&#39;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">e</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#39; in parents and trashed=false`</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">:</span> <span style="color:#e6db74">`&#39;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">e</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#39; in parents and (mimeType = &#39;application/vnd.google-apps.folder&#39; or mimeType = &#39;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">mimeType</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;) and trashed=false`</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url2</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`https://www.googleapis.com/drive/v3/files?fields=nextPageToken%2Cfiles%28id%2Cname%2CmimeType%29&amp;q=</span><span style="color:#e6db74">${</span>encodeURIComponent(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">q</span>
</span></span><span style="display:flex;"><span>    )<span style="color:#e6db74">}</span><span style="color:#e6db74">&amp;orderBy=name&amp;pageSize=1000&amp;pageToken=</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">pageToken</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">url2</span>, {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">authorization</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`Bearer </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">accessToken</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span> },
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fileList</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">getContentText</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">fileList</span>.<span style="color:#a6e22e">files</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">e</span>].<span style="color:#a6e22e">files</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">e</span>].<span style="color:#a6e22e">files</span>.<span style="color:#a6e22e">concat</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fileList</span>.<span style="color:#a6e22e">files</span>.<span style="color:#a6e22e">map</span>(({ <span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">mimeType</span> }) =&gt; ({
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">name</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">id</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">mimeType</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">mimeType</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">MimeType</span>.<span style="color:#a6e22e">FOLDER</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;folder&#34;</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">mimeType</span>,
</span></span><span style="display:flex;"><span>        }))
</span></span><span style="display:flex;"><span>      );
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">pageToken</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">fileList</span>.<span style="color:#a6e22e">nextPageToken</span>;
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">while</span> (<span style="color:#a6e22e">pageToken</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">data</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// DriveApp.getFiles()  // This is used for automatically detecting the scope of &#34;https://www.googleapis.com/auth/drive.readonly&#34;. Also, you can use the scope of &#34;https://www.googleapis.com/auth/drive&#34;.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// When the file is selected, this function is run from `work(value)` in Javascript side.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">doSomething</span>(<span style="color:#a6e22e">id</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// do something
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">id</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Please run this function.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">SpreadsheetApp</span>.<span style="color:#a6e22e">getUi</span>().<span style="color:#a6e22e">showSidebar</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">HtmlService</span>.<span style="color:#a6e22e">createTemplateFromFile</span>(<span style="color:#e6db74">&#34;index&#34;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">evaluate</span>()
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">setTitle</span>(<span style="color:#e6db74">&#34;Sample File Picker&#34;</span>)
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="html--javascript-side-indexhtml">HTML &amp; Javascript side: <code>index.html</code></h3>
<p>Please copy and paste the following script to the script editor as <code>index.html</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>  #filePicker {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">text-align</span>: <span style="color:#66d9ef">left</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">95</span><span style="color:#66d9ef">%</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">font-size</span>: <span style="color:#ae81ff">1</span><span style="color:#66d9ef">em</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">margin</span>: <span style="color:#66d9ef">auto</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">height</span>: <span style="color:#ae81ff">3</span><span style="color:#66d9ef">em</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">select</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;filePicker&#34;</span>&gt;&lt;/<span style="color:#f92672">select</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;result&#34;</span>&gt;&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">rootFolderId</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;root&#34;</span>; <span style="color:#75715e">// Please set the top folder ID here.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">emimeType</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;*&#34;</span>; <span style="color:#75715e">// In this case, all files are shown.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">//   const emimeType = &#34;application/pdf&#34;; // When you use this line, you can show only files with this mimeType.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// --- When you want to run the script for the selected file, please modify this function.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">work</span> <span style="color:#f92672">=</span> (...<span style="color:#a6e22e">args</span>) =&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">google</span>.<span style="color:#a6e22e">script</span>.<span style="color:#a6e22e">run</span>.<span style="color:#a6e22e">withSuccessHandler</span>(<span style="color:#a6e22e">output</span>).<span style="color:#a6e22e">doSomething</span>(...<span style="color:#a6e22e">args</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">output</span>(<span style="color:#a6e22e">res</span>) {
</span></span><span style="display:flex;"><span>    document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;result&#34;</span>).<span style="color:#a6e22e">innerHTML</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">res</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// ---
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">alldata</span> <span style="color:#f92672">=</span> {};
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">getFileList</span> <span style="color:#f92672">=</span> (...<span style="color:#a6e22e">args</span>) =&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">google</span>.<span style="color:#a6e22e">script</span>.<span style="color:#a6e22e">run</span>.<span style="color:#a6e22e">withSuccessHandler</span>(<span style="color:#a6e22e">importData</span>).<span style="color:#a6e22e">getFiles</span>(...<span style="color:#a6e22e">args</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">getFileList</span>(<span style="color:#a6e22e">rootFolderId</span>, <span style="color:#a6e22e">rootFolderId</span>, <span style="color:#a6e22e">emimeType</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;filePicker&#34;</span>).<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;change&#34;</span>, <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">value</span>, <span style="color:#a6e22e">options</span> } <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">disp</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">options</span>[<span style="color:#a6e22e">options</span>.<span style="color:#a6e22e">selectedIndex</span>].<span style="color:#a6e22e">text</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">disp</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#e6db74">&#34;Folder&#34;</span>) <span style="color:#f92672">||</span> <span style="color:#a6e22e">disp</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#e6db74">&#34;../&#34;</span>)) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">lastChild</span>) <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">removeChild</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">lastChild</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">alldata</span>[<span style="color:#a6e22e">value</span>]) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">importData</span>({ [<span style="color:#a6e22e">value</span>]<span style="color:#f92672">:</span> <span style="color:#a6e22e">alldata</span>[<span style="color:#a6e22e">value</span>] });
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">getFileList</span>(<span style="color:#a6e22e">value</span>, <span style="color:#a6e22e">rootFolderId</span>, <span style="color:#a6e22e">emimeType</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">work</span>(<span style="color:#a6e22e">value</span>);
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">importData</span>(<span style="color:#a6e22e">e</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">key</span> <span style="color:#f92672">=</span> Object.<span style="color:#a6e22e">keys</span>(<span style="color:#a6e22e">e</span>)[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">alldata</span>[<span style="color:#a6e22e">key</span>]) <span style="color:#a6e22e">alldata</span>[<span style="color:#a6e22e">key</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span>[<span style="color:#a6e22e">key</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">select</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;filePicker&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span>[<span style="color:#a6e22e">key</span>][<span style="color:#e6db74">&#34;keyparent&#34;</span>]
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">?</span> [
</span></span><span style="display:flex;"><span>          { <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`./</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">e</span>[<span style="color:#a6e22e">key</span>][<span style="color:#e6db74">&#34;keyname&#34;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">key</span> },
</span></span><span style="display:flex;"><span>          { <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;../&#34;</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">e</span>[<span style="color:#a6e22e">key</span>][<span style="color:#e6db74">&#34;keyparent&#34;</span>] },
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">:</span> [{ <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`./</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">e</span>[<span style="color:#a6e22e">key</span>][<span style="color:#e6db74">&#34;keyname&#34;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">key</span> }];
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">forEach</span>(({ <span style="color:#a6e22e">text</span>, <span style="color:#a6e22e">value</span> }) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">option</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#34;option&#34;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">option</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">text</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">option</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">value</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">select</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">option</span>);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">e</span>[<span style="color:#a6e22e">key</span>][<span style="color:#e6db74">&#34;files&#34;</span>].<span style="color:#a6e22e">forEach</span>(({ <span style="color:#a6e22e">mimeType</span>, <span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">id</span> }) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">option</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#34;option&#34;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">option</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">mimeType</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;folder&#34;</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;[Folder]&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">name</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">name</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">option</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">id</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">select</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">option</span>);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">script</span>&gt;
</span></span></code></pre></div><ul>
<li>
<p>When you want to change the top folder, please modify <code>const rootFolderId = &quot;root&quot;;</code> like <code>const rootFolderId = &quot;### folder ID ###&quot;;</code>.</p>
</li>
<li>
<p>When you want to show the files with the specific mimeType, please modify <code>const emimeType = &quot;*&quot;;</code> like <code>const emimeType = &quot;### mimeType ###&quot;;</code>.</p>
</li>
</ul>
<h2 id="4-testing">4. Testing</h2>
<p>Please run <code>main</code> function at the script editor. By this, a sidebar is opened at Google Spreadsheet. By this, you can see the file picker as shown in the top demonstration.</p>
<!-- raw HTML omitted -->
<h1 id="for-service-account">For Service account</h1>
<p>When you want to use this file picker using the service account, please modify the above Google Apps Script as follows. HTML &amp; Javascript is not required to be modified. In this case, Google Drive of the service account can be used.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// This script is from https://gist.github.com/tanaikech/20ea127a8e23a7c609f8d764c8b7ed7c
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getAccessTokenFromServiceAccount</span>(<span style="color:#a6e22e">scopes</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">private_key</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;-----BEGIN PRIVATE KEY-----\n-----END PRIVATE KEY-----\n&#34;</span>; <span style="color:#75715e">// private_key of JSON file retrieved by creating Service Account
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">client_email</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;###&#34;</span>; <span style="color:#75715e">// client_email of JSON file retrieved by creating Service Account
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://www.googleapis.com/oauth2/v3/token&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">header</span> <span style="color:#f92672">=</span> { <span style="color:#a6e22e">alg</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;RS256&#34;</span>, <span style="color:#a6e22e">typ</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;JWT&#34;</span> };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">now</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">floor</span>(Date.<span style="color:#a6e22e">now</span>() <span style="color:#f92672">/</span> <span style="color:#ae81ff">1000</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">claim</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">iss</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">client_email</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">scope</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">scopes</span>.<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34; &#34;</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">aud</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">url</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">exp</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">now</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">3600</span>).<span style="color:#a6e22e">toString</span>(),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">iat</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">now</span>.<span style="color:#a6e22e">toString</span>(),
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">signature</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">base64Encode</span>(<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">header</span>)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;.&#34;</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">base64Encode</span>(<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">claim</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">jwt</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">signature</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;.&#34;</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">base64Encode</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">computeRsaSha256Signature</span>(<span style="color:#a6e22e">signature</span>, <span style="color:#a6e22e">private_key</span>)
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">params</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">method</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;post&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">payload</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">assertion</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">jwt</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">grant_type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;urn:ietf:params:oauth:grant-type:jwt-bearer&#34;</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">params</span>).<span style="color:#a6e22e">getContentText</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">data</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">access_token</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getFiles</span>(<span style="color:#a6e22e">e</span>, <span style="color:#a6e22e">rootFolderId</span>, <span style="color:#a6e22e">mimeType</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">scopes</span> <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;https://www.googleapis.com/auth/drive.readonly&#34;</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">accessToken</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">getAccessTokenFromServiceAccount</span>(<span style="color:#a6e22e">scopes</span>); <span style="color:#75715e">// In this case, the files and folders are retrieved from Google Drive of the service account.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">mimeType</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">mimeType</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;*&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> {};
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">idn</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;root&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url1</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`https://www.googleapis.com/drive/v3/files/</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">e</span><span style="color:#e6db74">}</span><span style="color:#e6db74">?fields=id%2Cname%2Cparents`</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">folderObj</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">url1</span>, {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">authorization</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`Bearer </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">accessToken</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span> },
</span></span><span style="display:flex;"><span>    }).<span style="color:#a6e22e">getContentText</span>()
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">e</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;root&#34;</span>) <span style="color:#a6e22e">e</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">folderObj</span>.<span style="color:#a6e22e">id</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">e</span>] <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">keyname</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">folderObj</span>.<span style="color:#a6e22e">name</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">keyparent</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">idn</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">rootFolderId</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">folderObj</span>.<span style="color:#a6e22e">parents</span>[<span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">files</span><span style="color:#f92672">:</span> [],
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">pageToken</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">do</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">q</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">mimeType</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;*&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">?</span> <span style="color:#e6db74">`&#39;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">e</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#39; in parents and trashed=false`</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">:</span> <span style="color:#e6db74">`&#39;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">e</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#39; in parents and (mimeType = &#39;application/vnd.google-apps.folder&#39; or mimeType = &#39;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">mimeType</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;) and trashed=false`</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url2</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`https://www.googleapis.com/drive/v3/files?fields=nextPageToken%2Cfiles%28id%2Cname%2CmimeType%29&amp;q=</span><span style="color:#e6db74">${</span>encodeURIComponent(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">q</span>
</span></span><span style="display:flex;"><span>    )<span style="color:#e6db74">}</span><span style="color:#e6db74">&amp;orderBy=name&amp;pageSize=1000&amp;pageToken=</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">pageToken</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">url2</span>, {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">authorization</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`Bearer </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">accessToken</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span> },
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fileList</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">getContentText</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">fileList</span>.<span style="color:#a6e22e">files</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">e</span>].<span style="color:#a6e22e">files</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">e</span>].<span style="color:#a6e22e">files</span>.<span style="color:#a6e22e">concat</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fileList</span>.<span style="color:#a6e22e">files</span>.<span style="color:#a6e22e">map</span>(({ <span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">mimeType</span> }) =&gt; ({
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">name</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">id</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">mimeType</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">mimeType</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">MimeType</span>.<span style="color:#a6e22e">FOLDER</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;folder&#34;</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">mimeType</span>,
</span></span><span style="display:flex;"><span>        }))
</span></span><span style="display:flex;"><span>      );
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">pageToken</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">fileList</span>.<span style="color:#a6e22e">nextPageToken</span>;
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">while</span> (<span style="color:#a6e22e">pageToken</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">data</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// DriveApp.getFiles()  // This is used for automatically detecting the scope of &#34;https://www.googleapis.com/auth/drive.readonly&#34;. Also, you can use the scope of &#34;https://www.googleapis.com/auth/drive&#34;.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// When the file is selected, this function is run from `work(value)` in Javascript side.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">doSomething</span>(<span style="color:#a6e22e">id</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// do something
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">id</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Please run this function.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">SpreadsheetApp</span>.<span style="color:#a6e22e">getUi</span>().<span style="color:#a6e22e">showSidebar</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">HtmlService</span>.<span style="color:#a6e22e">createTemplateFromFile</span>(<span style="color:#e6db74">&#34;index&#34;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">evaluate</span>()
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">setTitle</span>(<span style="color:#e6db74">&#34;Sample File Picker&#34;</span>)
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
  
  <h4><i class="fas fa-share-alt" aria-hidden="true"></i>&nbsp;Share!</h4>
<ul class="share-buttons">
	<li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftanaikech.github.io%2f2021%2f10%2f25%2ffile-picker-using-google-apps-script-and-javascript-without-3rd-party%2f" target="_blank" title="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span class="sr-only">Share on Facebook</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://twitter.com/intent/tweet?source=https%3a%2f%2ftanaikech.github.io%2f2021%2f10%2f25%2ffile-picker-using-google-apps-script-and-javascript-without-3rd-party%2f" target="_blank" title="Tweet"><i class="fab fa-twitter" aria-hidden="true"></i><span class="sr-only">Tweet</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://plus.google.com/share?url=https%3a%2f%2ftanaikech.github.io%2f2021%2f10%2f25%2ffile-picker-using-google-apps-script-and-javascript-without-3rd-party%2f" target="_blank" title="Share on Google+"><i class="fab fa-google-plus" aria-hidden="true"></i><span class="sr-only">Share on Google+</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.tumblr.com/share?v=3&u=https%3a%2f%2ftanaikech.github.io%2f2021%2f10%2f25%2ffile-picker-using-google-apps-script-and-javascript-without-3rd-party%2f" target="_blank" title="Post to Tumblr"><i class="fab fa-tumblr" aria-hidden="true"></i><span class="sr-only">Post to Tumblr</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2ftanaikech.github.io%2f2021%2f10%2f25%2ffile-picker-using-google-apps-script-and-javascript-without-3rd-party%2f" target="_blank" title="Pin it"><i class="fab fa-pinterest-p" aria-hidden="true"></i><span class="sr-only">Pin it</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.reddit.com/submit?url=https%3a%2f%2ftanaikech.github.io%2f2021%2f10%2f25%2ffile-picker-using-google-apps-script-and-javascript-without-3rd-party%2f" target="_blank" title="Submit to Reddit"><i class="fab fa-reddit-alien" aria-hidden="true"></i><span class="sr-only">Submit to Reddit</span></a>
	</li>
</ul>


<style>
	ul.share-buttons{
	  list-style: none;
	  padding: 0;
	}

	ul.share-buttons li{
	  display: inline;
	}

	ul.share-buttons .sr-only{
	  position: absolute;
	  clip: rect(1px 1px 1px 1px);
	  clip: rect(1px, 1px, 1px, 1px);
	  padding: 0;
	  border: 0;
	  height: 1px;
	  width: 1px;
	  overflow: hidden;
	}
</style>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://tanaikech.github.io/2021/10/24/converting-values-of-google-spreadsheet-to-object-using-google-apps-script/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://tanaikech.github.io/2021/10/24/converting-values-of-google-spreadsheet-to-object-using-google-apps-script/">Converting Values of Google Spreadsheet to Object using Google Apps Script</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://tanaikech.github.io/2021/10/29/report-images-put-with-image-function-on-google-spreadsheet/">Report: Images put with IMAGE function on Google Spreadsheet</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://tanaikech.github.io/2021/10/29/report-images-put-with-image-function-on-google-spreadsheet/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>


  
  
  
  

  

</div>

</div>
</div>
<script src="https://tanaikech.github.io/js/ui.js"></script>
<script src="https://tanaikech.github.io/js/menus.js"></script>






<script async src="https://www.googletagmanager.com/gtag/js?id=G-J3Z6T50WL5"></script>
<script>
  
  if (window.location.hostname != "localhost") {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-J3Z6T50WL5');
  }
</script>






<script src="https://tanaikech.github.io/js/math-code.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  


</body>
</html>

