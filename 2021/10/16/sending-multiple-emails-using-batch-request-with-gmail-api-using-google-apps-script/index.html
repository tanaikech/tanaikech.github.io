<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <meta name="google-site-verification" content="1BvDMY90ui0jRLHkrpqdQ_x62h5VNEMuK6mQsDvVQH0" />

  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.98.0" />

  <title>Sending Multiple Emails using Batch Request with Gmail API using Google Apps Script &middot; tanaike</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://tanaikech.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://tanaikech.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">

  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet" type="text/css">

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css">
  <script async src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://tanaikech.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://tanaikech.github.io/">TANAIKE</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/topics/"><i class='fa fa-folder fa-fw'></i>Topics</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/link/"><i class='fa fa-thumbs-up fa-fw'></i>Links</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/webapps/"><i class='fas fa-toolbox'></i>Web Applications</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/donate/"><i class='fas fa-donate'></i>Donate</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://tanaikech.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/tanaikech" rel="me" target="_blank"><i class="fab fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/tanaikech" rel="me" target="_blank"><i class="fab fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/7108653" rel="me" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2017. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Sending Multiple Emails using Batch Request with Gmail API using Google Apps Script</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>16 Oct 2021, 10:04</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="https://tanaikech.github.io/topics/gastips">GasTips</a>
    
  </div>
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/google-apps-script">Google Apps Script</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/gmail">gmail</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://tanaikech.github.io/tags/batch-request">batch request</a>
    
  </div>
  
  

</div>

  <p><a href="https://gist.github.com/tanaikech/44e055214ab470c9b3143a469d7a7d21">Gists</a></p>
<p><img src="https://tanaikech.github.io/image-storage/20211016a/fig1.png" alt=""></p>
<p>This is a sample script for sending multiple emails using the batch request with Gmail API using Google Apps Script. When multiple emails are sent using &ldquo;GmailApp.sendEmail&rdquo; and &ldquo;MailApp.sendEmail&rdquo;, a loop is used. But in this case, the process cost becomes high. In this post, I would like to introduce the sample script for reducing the process cost under this situation. Gmail API can be requested with the batch request. The batch request can be processed with the asynchronous process. By this, I thought that the process cost for sending multiple emails. So, this sample script sends multiple emails using the batch request with Gmail API.</p>
<h2 id="sample-script">Sample script</h2>
<p>This sample script uses <a href="https://github.com/tanaikech/BatchRequest">a Google Apps Script library of BatchRequest</a>. So, before you use this script, please install a Google Apps Script library of BatchRequest. You can see how to install this library at <a href="https://github.com/tanaikech/BatchRequest#how-to-install">here</a>.</p>
<p>And, <a href="https://developers.google.com/apps-script/guides/services/advanced#enable_advanced_services">please enable Gmail API at Advanced Google services</a>.</p>
<p>And please set <code>obj</code> and if you want to attachment files, please set the file IDs of <code>attachmentFileIds</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">convert_</span> <span style="color:#f92672">=</span> ({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">to</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">cc</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">bcc</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">fromName</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">fromEmail</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">subject</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">textBody</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">htmlBody</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">attachments</span>,
</span></span><span style="display:flex;"><span>}) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">to</span>) <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#34;Please set &#39;to&#39;.&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> [<span style="color:#e6db74">`MIME-Version: 1.0`</span>, <span style="color:#e6db74">`To: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">to</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">cc</span>) <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">push</span>(<span style="color:#e6db74">`CC: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">cc</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">bcc</span>) <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">push</span>(<span style="color:#e6db74">`BCC: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">bcc</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ((<span style="color:#a6e22e">fromName</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">fromEmail</span>) <span style="color:#f92672">||</span> <span style="color:#a6e22e">fromEmail</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">push</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fromName</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">fromEmail</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">`From: &#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">fromName</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34; &lt;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">fromEmail</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&gt;`</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">fromEmail</span>
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">boundary1</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;boundaryboundary001&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">boundary2</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;boundaryboundary002&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">attachments</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">attachments</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">push</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">`Subject: =?UTF-8?B?</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">base64Encode</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">subject</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">Charset</span>.<span style="color:#a6e22e">UTF_8</span>
</span></span><span style="display:flex;"><span>      )<span style="color:#e6db74">}</span><span style="color:#e6db74">?=`</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">`Content-Type: multipart/mixed; boundary=</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">boundary1</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">``</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">`--</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">boundary1</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">`Content-Type: multipart/alternative; boundary=</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">boundary2</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">``</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">`--</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">boundary2</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">`Content-Type: text/plain; charset=UTF-8`</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">``</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">textBody</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">`--</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">boundary2</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">`Content-Type: text/html; charset=UTF-8`</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">`Content-Transfer-Encoding: base64`</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">``</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">base64Encode</span>(<span style="color:#a6e22e">htmlBody</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">Charset</span>.<span style="color:#a6e22e">UTF_8</span>),
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">`--</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">boundary2</span><span style="color:#e6db74">}</span><span style="color:#e6db74">--`</span>
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">attachments</span>.<span style="color:#a6e22e">forEach</span>((<span style="color:#a6e22e">f</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">push</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">`--</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">boundary1</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">`Content-Type: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">mimeType</span><span style="color:#e6db74">}</span><span style="color:#e6db74">; charset=UTF-8; name=&#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">filename</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;`</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">`Content-Transfer-Encoding: base64`</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">``</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">data</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">`--</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">boundary1</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>
</span></span><span style="display:flex;"><span>      );
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">push</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">`Subject: =?UTF-8?B?</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">base64Encode</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">subject</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">Charset</span>.<span style="color:#a6e22e">UTF_8</span>
</span></span><span style="display:flex;"><span>      )<span style="color:#e6db74">}</span><span style="color:#e6db74">?=`</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">`Content-Type: multipart/alternative; boundary=</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">boundary1</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">``</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">`--</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">boundary1</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">`Content-Type: text/plain; charset=UTF-8`</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">``</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">textBody</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">`--</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">boundary1</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">`Content-Type: text/html; charset=UTF-8`</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">`Content-Transfer-Encoding: base64`</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">``</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">base64Encode</span>(<span style="color:#a6e22e">htmlBody</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">Charset</span>.<span style="color:#a6e22e">UTF_8</span>),
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">`--</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">boundary1</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">base64EncodeWebSafe</span>(<span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;\r\n&#34;</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;--&#34;</span>);
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Please run this function.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">attachmentFileIds</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;### file ID1 of attachment file ###&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;### file ID1 of attachment file ###&#34;</span>,
</span></span><span style="display:flex;"><span>  ];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">attachmentFiles</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">attachmentFileIds</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">id</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">file</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">DriveApp</span>.<span style="color:#a6e22e">getFileById</span>(<span style="color:#a6e22e">id</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">filename</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">getName</span>(),
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">mimeType</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">getMimeType</span>(),
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">base64Encode</span>(<span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">getBlob</span>().<span style="color:#a6e22e">getBytes</span>()),
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">to</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;### email address 1 ###&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">cc</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;###&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fromEmail</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;###&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fromName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;###&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">subject</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;sample mail 1&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">textBody</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Hello World&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">htmlBody</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&lt;p&gt;Hello World&lt;/p&gt;&#34;</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">to</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;### email address 2 ###&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">bcc</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;###&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">subject</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;sample mail 2&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">textBody</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Hello World&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">attachments</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">attachmentFiles</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  ];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">raws</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">e</span>) =&gt; <span style="color:#a6e22e">convert_</span>(<span style="color:#a6e22e">e</span>));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">requests</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">raws</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">raw</span>) =&gt; ({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">method</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;POST&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">endpoint</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;https://gmail.googleapis.com/gmail/v1/users/me/messages/send&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">requestBody</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">raw</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">raw</span> },
</span></span><span style="display:flex;"><span>  }));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">BatchRequest</span>.<span style="color:#a6e22e">EDo</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">batchPath</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;batch/gmail/v1&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">accessToken</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ScriptApp</span>.<span style="color:#a6e22e">getOAuthToken</span>(),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">requests</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">requests</span>,
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>When you run this script, 2 emails are sent.</li>
</ul>
<h2 id="note">Note</h2>
<ul>
<li>
<p>When you change the endpoint from <code>https://gmail.googleapis.com/gmail/v1/users/me/messages/send</code> to <code>https://gmail.googleapis.com/gmail/v1/users/me/drafts</code>, the draft emails are created.</p>
</li>
<li>
<p>When you use this script, please be careful about the limitation of Gmail API. <a href="https://developers.google.com/gmail/api/reference/quota">Ref1</a> and <a href="https://developers.google.com/apps-script/guides/services/quotas">Ref2</a></p>
</li>
<li>
<p>This is a simple sample script. So please modify it for your actual situation.</p>
</li>
</ul>
<h2 id="references">References</h2>
<ul>
<li><a href="https://developers.google.com/gmail/api/guides/batch">Batching Requests for Gmail API</a></li>
<li><a href="https://github.com/tanaikech/BatchRequest">BatchRequest of Google Apps Script library</a></li>
<li><a href="https://developers.google.com/gmail/api/reference/rest/v1/users.messages/send">Method: users.messages.send</a></li>
<li>I answered this sample script at <a href="https://stackoverflow.com/q/69552432/7108653">this thread of Stackoverflow</a>.</li>
</ul>

  
  <h4><i class="fas fa-share-alt" aria-hidden="true"></i>&nbsp;Share!</h4>
<ul class="share-buttons">
	<li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftanaikech.github.io%2f2021%2f10%2f16%2fsending-multiple-emails-using-batch-request-with-gmail-api-using-google-apps-script%2f" target="_blank" title="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span class="sr-only">Share on Facebook</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://twitter.com/intent/tweet?source=https%3a%2f%2ftanaikech.github.io%2f2021%2f10%2f16%2fsending-multiple-emails-using-batch-request-with-gmail-api-using-google-apps-script%2f" target="_blank" title="Tweet"><i class="fab fa-twitter" aria-hidden="true"></i><span class="sr-only">Tweet</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://plus.google.com/share?url=https%3a%2f%2ftanaikech.github.io%2f2021%2f10%2f16%2fsending-multiple-emails-using-batch-request-with-gmail-api-using-google-apps-script%2f" target="_blank" title="Share on Google+"><i class="fab fa-google-plus" aria-hidden="true"></i><span class="sr-only">Share on Google+</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.tumblr.com/share?v=3&u=https%3a%2f%2ftanaikech.github.io%2f2021%2f10%2f16%2fsending-multiple-emails-using-batch-request-with-gmail-api-using-google-apps-script%2f" target="_blank" title="Post to Tumblr"><i class="fab fa-tumblr" aria-hidden="true"></i><span class="sr-only">Post to Tumblr</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2ftanaikech.github.io%2f2021%2f10%2f16%2fsending-multiple-emails-using-batch-request-with-gmail-api-using-google-apps-script%2f" target="_blank" title="Pin it"><i class="fab fa-pinterest-p" aria-hidden="true"></i><span class="sr-only">Pin it</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.reddit.com/submit?url=https%3a%2f%2ftanaikech.github.io%2f2021%2f10%2f16%2fsending-multiple-emails-using-batch-request-with-gmail-api-using-google-apps-script%2f" target="_blank" title="Submit to Reddit"><i class="fab fa-reddit-alien" aria-hidden="true"></i><span class="sr-only">Submit to Reddit</span></a>
	</li>
</ul>


<style>
	ul.share-buttons{
	  list-style: none;
	  padding: 0;
	}

	ul.share-buttons li{
	  display: inline;
	}

	ul.share-buttons .sr-only{
	  position: absolute;
	  clip: rect(1px 1px 1px 1px);
	  clip: rect(1px, 1px, 1px, 1px);
	  padding: 0;
	  border: 0;
	  height: 1px;
	  width: 1px;
	  overflow: hidden;
	}
</style>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://tanaikech.github.io/2021/10/15/putting-all-response-values-from-google-form-to-google-spreadsheet-using-google-apps-script/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://tanaikech.github.io/2021/10/15/putting-all-response-values-from-google-form-to-google-spreadsheet-using-google-apps-script/">Putting All Response Values from Google Form to Google Spreadsheet using Google Apps Script</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://tanaikech.github.io/2021/10/16/announcing-the-google-forms-api/">Announcing the Google Forms API</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://tanaikech.github.io/2021/10/16/announcing-the-google-forms-api/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>


  
  
  
  

  

</div>

</div>
</div>
<script src="https://tanaikech.github.io/js/ui.js"></script>
<script src="https://tanaikech.github.io/js/menus.js"></script>






<script async src="https://www.googletagmanager.com/gtag/js?id=G-J3Z6T50WL5"></script>
<script>
  
  if (window.location.hostname != "localhost") {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-J3Z6T50WL5');
  }
</script>






<script src="https://tanaikech.github.io/js/math-code.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  


</body>
</html>

